var OM=Object.defineProperty,jM=Object.defineProperties;var qM=Object.getOwnPropertyDescriptors;var sd=Object.getOwnPropertySymbols;var gZ=Object.prototype.hasOwnProperty,aZ=Object.prototype.propertyIsEnumerable;var rZ=(n,e,t)=>e in n?OM(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,gt=(n,e)=>{for(var t in e||(e={}))gZ.call(e,t)&&rZ(n,t,e[t]);if(sd)for(var t of sd(e))aZ.call(e,t)&&rZ(n,t,e[t]);return n},Mt=(n,e)=>jM(n,qM(e));var qn=(n,e)=>{var t={};for(var i in n)gZ.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&sd)for(var i of sd(n))e.indexOf(i)<0&&aZ.call(n,i)&&(t[i]=n[i]);return t};function $M(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var ce={exports:{}},xt={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var lZ=Object.getOwnPropertySymbols,eK=Object.prototype.hasOwnProperty,tK=Object.prototype.propertyIsEnumerable;function nK(n){if(n==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function iK(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de",Object.getOwnPropertyNames(n)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var i=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(i.join("")!=="0123456789")return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(s){o[s]=s}),Object.keys(Object.assign({},o)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var cG=iK()?Object.assign:function(n,e){for(var t,i=nK(n),o,s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var r in t)eK.call(t,r)&&(i[r]=t[r]);if(lZ){o=lZ(t);for(var g=0;g<o.length;g++)tK.call(t,o[g])&&(i[o[g]]=t[o[g]])}}return i};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CG=cG,sI=60103,BW=60106;xt.Fragment=60107;xt.StrictMode=60108;xt.Profiler=60114;var yW=60109,vW=60110,ZW=60112;xt.Suspense=60113;var wW=60115,RW=60116;if(typeof Symbol=="function"&&Symbol.for){var yo=Symbol.for;sI=yo("react.element"),BW=yo("react.portal"),xt.Fragment=yo("react.fragment"),xt.StrictMode=yo("react.strict_mode"),xt.Profiler=yo("react.profiler"),yW=yo("react.provider"),vW=yo("react.context"),ZW=yo("react.forward_ref"),xt.Suspense=yo("react.suspense"),wW=yo("react.memo"),RW=yo("react.lazy")}var IZ=typeof Symbol=="function"&&Symbol.iterator;function oK(n){return n===null||typeof n!="object"?null:(n=IZ&&n[IZ]||n["@@iterator"],typeof n=="function"?n:null)}function FC(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var WW={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},SW={};function rI(n,e,t){this.props=n,this.context=e,this.refs=SW,this.updater=t||WW}rI.prototype.isReactComponent={};rI.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error(FC(85));this.updater.enqueueSetState(this,n,e,"setState")};rI.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function VW(){}VW.prototype=rI.prototype;function uG(n,e,t){this.props=n,this.context=e,this.refs=SW,this.updater=t||WW}var dG=uG.prototype=new VW;dG.constructor=uG;CG(dG,rI.prototype);dG.isPureReactComponent=!0;var AG={current:null},xW=Object.prototype.hasOwnProperty,HW={key:!0,ref:!0,__self:!0,__source:!0};function XW(n,e,t){var i,o={},s=null,r=null;if(e!=null)for(i in e.ref!==void 0&&(r=e.ref),e.key!==void 0&&(s=""+e.key),e)xW.call(e,i)&&!HW.hasOwnProperty(i)&&(o[i]=e[i]);var g=arguments.length-2;if(g===1)o.children=t;else if(1<g){for(var a=Array(g),l=0;l<g;l++)a[l]=arguments[l+2];o.children=a}if(n&&n.defaultProps)for(i in g=n.defaultProps,g)o[i]===void 0&&(o[i]=g[i]);return{$$typeof:sI,type:n,key:s,ref:r,props:o,_owner:AG.current}}function sK(n,e){return{$$typeof:sI,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function hG(n){return typeof n=="object"&&n!==null&&n.$$typeof===sI}function rK(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var cZ=/\/+/g;function Qm(n,e){return typeof n=="object"&&n!==null&&n.key!=null?rK(""+n.key):e.toString(36)}function bA(n,e,t,i,o){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var r=!1;if(n===null)r=!0;else switch(s){case"string":case"number":r=!0;break;case"object":switch(n.$$typeof){case sI:case BW:r=!0}}if(r)return r=n,o=o(r),n=i===""?"."+Qm(r,0):i,Array.isArray(o)?(t="",n!=null&&(t=n.replace(cZ,"$&/")+"/"),bA(o,e,t,"",function(l){return l})):o!=null&&(hG(o)&&(o=sK(o,t+(!o.key||r&&r.key===o.key?"":(""+o.key).replace(cZ,"$&/")+"/")+n)),e.push(o)),1;if(r=0,i=i===""?".":i+":",Array.isArray(n))for(var g=0;g<n.length;g++){s=n[g];var a=i+Qm(s,g);r+=bA(s,e,t,a,o)}else if(a=oK(n),typeof a=="function")for(n=a.call(n),g=0;!(s=n.next()).done;)s=s.value,a=i+Qm(s,g++),r+=bA(s,e,t,a,o);else if(s==="object")throw e=""+n,Error(FC(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e));return r}function rd(n,e,t){if(n==null)return n;var i=[],o=0;return bA(n,i,"","",function(s){return e.call(t,s,o++)}),i}function gK(n){if(n._status===-1){var e=n._result;e=e(),n._status=0,n._result=e,e.then(function(t){n._status===0&&(t=t.default,n._status=1,n._result=t)},function(t){n._status===0&&(n._status=2,n._result=t)})}if(n._status===1)return n._result;throw n._result}var MW={current:null};function zs(){var n=MW.current;if(n===null)throw Error(FC(321));return n}var aK={ReactCurrentDispatcher:MW,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:AG,IsSomeRendererActing:{current:!1},assign:CG};xt.Children={map:rd,forEach:function(n,e,t){rd(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return rd(n,function(){e++}),e},toArray:function(n){return rd(n,function(e){return e})||[]},only:function(n){if(!hG(n))throw Error(FC(143));return n}};xt.Component=rI;xt.PureComponent=uG;xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aK;xt.cloneElement=function(n,e,t){if(n==null)throw Error(FC(267,n));var i=CG({},n.props),o=n.key,s=n.ref,r=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,r=AG.current),e.key!==void 0&&(o=""+e.key),n.type&&n.type.defaultProps)var g=n.type.defaultProps;for(a in e)xW.call(e,a)&&!HW.hasOwnProperty(a)&&(i[a]=e[a]===void 0&&g!==void 0?g[a]:e[a])}var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){g=Array(a);for(var l=0;l<a;l++)g[l]=arguments[l+2];i.children=g}return{$$typeof:sI,type:n.type,key:o,ref:s,props:i,_owner:r}};xt.createContext=function(n,e){return e===void 0&&(e=null),n={$$typeof:vW,_calculateChangedBits:e,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null},n.Provider={$$typeof:yW,_context:n},n.Consumer=n};xt.createElement=XW;xt.createFactory=function(n){var e=XW.bind(null,n);return e.type=n,e};xt.createRef=function(){return{current:null}};xt.forwardRef=function(n){return{$$typeof:ZW,render:n}};xt.isValidElement=hG;xt.lazy=function(n){return{$$typeof:RW,_payload:{_status:-1,_result:n},_init:gK}};xt.memo=function(n,e){return{$$typeof:wW,type:n,compare:e===void 0?null:e}};xt.useCallback=function(n,e){return zs().useCallback(n,e)};xt.useContext=function(n,e){return zs().useContext(n,e)};xt.useDebugValue=function(){};xt.useEffect=function(n,e){return zs().useEffect(n,e)};xt.useImperativeHandle=function(n,e,t){return zs().useImperativeHandle(n,e,t)};xt.useLayoutEffect=function(n,e){return zs().useLayoutEffect(n,e)};xt.useMemo=function(n,e){return zs().useMemo(n,e)};xt.useReducer=function(n,e,t){return zs().useReducer(n,e,t)};xt.useRef=function(n){return zs().useRef(n)};xt.useState=function(n){return zs().useState(n)};xt.version="17.0.2";ce.exports=xt;var kt=ce.exports,xl=$M({__proto__:null,default:kt},[ce.exports]),KW={exports:{}},Ao={},Al={exports:{}},FW={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){var e,t,i,o;if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var r=Date,g=r.now();n.unstable_now=function(){return r.now()-g}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var a=null,l=null,u=function(){if(a!==null)try{var T=n.unstable_now();a(!0,T),a=null}catch(P){throw setTimeout(u,0),P}};e=function(T){a!==null?setTimeout(e,0,T):(a=T,setTimeout(u,0))},t=function(T,P){l=setTimeout(T,P)},i=function(){clearTimeout(l)},n.unstable_shouldYield=function(){return!1},o=n.unstable_forceFrameRate=function(){}}else{var d=window.setTimeout,C=window.clearTimeout;if(typeof console!="undefined"){var A=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof A!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var f=!1,b=null,G=-1,m=5,h=0;n.unstable_shouldYield=function(){return n.unstable_now()>=h},o=function(){},n.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):m=0<T?Math.floor(1e3/T):5};var B=new MessageChannel,y=B.port2;B.port1.onmessage=function(){if(b!==null){var T=n.unstable_now();h=T+m;try{b(!0,T)?y.postMessage(null):(f=!1,b=null)}catch(P){throw y.postMessage(null),P}}else f=!1},e=function(T){b=T,f||(f=!0,y.postMessage(null))},t=function(T,P){G=d(function(){T(n.unstable_now())},P)},i=function(){C(G),G=-1}}function Z(T,P){var Ce=T.length;T.push(P);e:for(;;){var Me=Ce-1>>>1,ee=T[Me];if(ee!==void 0&&0<x(ee,P))T[Me]=P,T[Ce]=ee,Ce=Me;else break e}}function R(T){return T=T[0],T===void 0?null:T}function W(T){var P=T[0];if(P!==void 0){var Ce=T.pop();if(Ce!==P){T[0]=Ce;e:for(var Me=0,ee=T.length;Me<ee;){var _=2*(Me+1)-1,Ae=T[_],ye=_+1,ge=T[ye];if(Ae!==void 0&&0>x(Ae,Ce))ge!==void 0&&0>x(ge,Ae)?(T[Me]=ge,T[ye]=Ce,Me=ye):(T[Me]=Ae,T[_]=Ce,Me=_);else if(ge!==void 0&&0>x(ge,Ce))T[Me]=ge,T[ye]=Ce,Me=ye;else break e}}return P}return null}function x(T,P){var Ce=T.sortIndex-P.sortIndex;return Ce!==0?Ce:T.id-P.id}var X=[],Y=[],S=1,H=null,k=3,U=!1,D=!1,Q=!1;function $(T){for(var P=R(Y);P!==null;){if(P.callback===null)W(Y);else if(P.startTime<=T)W(Y),P.sortIndex=P.expirationTime,Z(X,P);else break;P=R(Y)}}function j(T){if(Q=!1,$(T),!D)if(R(X)!==null)D=!0,e(oe);else{var P=R(Y);P!==null&&t(j,P.startTime-T)}}function oe(T,P){D=!1,Q&&(Q=!1,i()),U=!0;var Ce=k;try{for($(P),H=R(X);H!==null&&(!(H.expirationTime>P)||T&&!n.unstable_shouldYield());){var Me=H.callback;if(typeof Me=="function"){H.callback=null,k=H.priorityLevel;var ee=Me(H.expirationTime<=P);P=n.unstable_now(),typeof ee=="function"?H.callback=ee:H===R(X)&&W(X),$(P)}else W(X);H=R(X)}if(H!==null)var _=!0;else{var Ae=R(Y);Ae!==null&&t(j,Ae.startTime-P),_=!1}return _}finally{H=null,k=Ce,U=!1}}var Ie=o;n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(T){T.callback=null},n.unstable_continueExecution=function(){D||U||(D=!0,e(oe))},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return R(X)},n.unstable_next=function(T){switch(k){case 1:case 2:case 3:var P=3;break;default:P=k}var Ce=k;k=P;try{return T()}finally{k=Ce}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=Ie,n.unstable_runWithPriority=function(T,P){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var Ce=k;k=T;try{return P()}finally{k=Ce}},n.unstable_scheduleCallback=function(T,P,Ce){var Me=n.unstable_now();switch(typeof Ce=="object"&&Ce!==null?(Ce=Ce.delay,Ce=typeof Ce=="number"&&0<Ce?Me+Ce:Me):Ce=Me,T){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=Ce+ee,T={id:S++,callback:P,priorityLevel:T,startTime:Ce,expirationTime:ee,sortIndex:-1},Ce>Me?(T.sortIndex=Ce,Z(Y,T),R(X)===null&&T===R(Y)&&(Q?i():Q=!0,t(j,Ce-Me))):(T.sortIndex=ee,Z(X,T),D||U||(D=!0,e(oe))),T},n.unstable_wrapCallback=function(T){var P=k;return function(){var Ce=k;k=P;try{return T.apply(this,arguments)}finally{k=Ce}}}})(FW);Al.exports=FW;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vh=ce.exports,Cn=cG,Dn=Al.exports;function Ne(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!vh)throw Error(Ne(227));var YW=new Set,tC={};function ga(n,e){Hl(n,e),Hl(n+"Capture",e)}function Hl(n,e){for(tC[n]=e,n=0;n<e.length;n++)YW.add(e[n])}var Fs=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),lK=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,CZ=Object.prototype.hasOwnProperty,uZ={},dZ={};function IK(n){return CZ.call(dZ,n)?!0:CZ.call(uZ,n)?!1:lK.test(n)?dZ[n]=!0:(uZ[n]=!0,!1)}function cK(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function CK(n,e,t,i){if(e===null||typeof e=="undefined"||cK(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function vi(n,e,t,i,o,s,r){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=r}var ii={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){ii[n]=new vi(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];ii[e]=new vi(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){ii[n]=new vi(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){ii[n]=new vi(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){ii[n]=new vi(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){ii[n]=new vi(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){ii[n]=new vi(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){ii[n]=new vi(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){ii[n]=new vi(n,5,!1,n.toLowerCase(),null,!1,!1)});var pG=/[\-:]([a-z])/g;function mG(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(pG,mG);ii[e]=new vi(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(pG,mG);ii[e]=new vi(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(pG,mG);ii[e]=new vi(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){ii[n]=new vi(n,1,!1,n.toLowerCase(),null,!1,!1)});ii.xlinkHref=new vi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){ii[n]=new vi(n,1,!1,n.toLowerCase(),null,!0,!0)});function fG(n,e,t,i){var o=ii.hasOwnProperty(e)?ii[e]:null,s=o!==null?o.type===0:i?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");s||(CK(e,t,o,i)&&(t=null),i||o===null?IK(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):o.mustUseProperty?n[o.propertyName]=t===null?o.type===3?!1:"":t:(e=o.attributeName,i=o.attributeNamespace,t===null?n.removeAttribute(e):(o=o.type,t=o===3||o===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var aa=vh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,vc=60103,Rg=60106,Ar=60107,bG=60108,Xc=60114,GG=60109,BG=60110,Zh=60112,Mc=60113,_A=60120,wh=60115,yG=60116,vG=60121,ZG=60128,NW=60129,wG=60130,Bb=60131;if(typeof Symbol=="function"&&Symbol.for){var _n=Symbol.for;vc=_n("react.element"),Rg=_n("react.portal"),Ar=_n("react.fragment"),bG=_n("react.strict_mode"),Xc=_n("react.profiler"),GG=_n("react.provider"),BG=_n("react.context"),Zh=_n("react.forward_ref"),Mc=_n("react.suspense"),_A=_n("react.suspense_list"),wh=_n("react.memo"),yG=_n("react.lazy"),vG=_n("react.block"),_n("react.scope"),ZG=_n("react.opaque.id"),NW=_n("react.debug_trace_mode"),wG=_n("react.offscreen"),Bb=_n("react.legacy_hidden")}var AZ=typeof Symbol=="function"&&Symbol.iterator;function _I(n){return n===null||typeof n!="object"?null:(n=AZ&&n[AZ]||n["@@iterator"],typeof n=="function"?n:null)}var Om;function Zc(n){if(Om===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Om=e&&e[1]||""}return`
`+Om+n}var jm=!1;function gd(n,e){if(!n||jm)return"";jm=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(a){var i=a}Reflect.construct(n,[],e)}else{try{e.call()}catch(a){i=a}n.call(e.prototype)}else{try{throw Error()}catch(a){i=a}n()}}catch(a){if(a&&i&&typeof a.stack=="string"){for(var o=a.stack.split(`
`),s=i.stack.split(`
`),r=o.length-1,g=s.length-1;1<=r&&0<=g&&o[r]!==s[g];)g--;for(;1<=r&&0<=g;r--,g--)if(o[r]!==s[g]){if(r!==1||g!==1)do if(r--,g--,0>g||o[r]!==s[g])return`
`+o[r].replace(" at new "," at ");while(1<=r&&0<=g);break}}}finally{jm=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Zc(n):""}function uK(n){switch(n.tag){case 5:return Zc(n.type);case 16:return Zc("Lazy");case 13:return Zc("Suspense");case 19:return Zc("SuspenseList");case 0:case 2:case 15:return n=gd(n.type,!1),n;case 11:return n=gd(n.type.render,!1),n;case 22:return n=gd(n.type._render,!1),n;case 1:return n=gd(n.type,!0),n;default:return""}}function hl(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Ar:return"Fragment";case Rg:return"Portal";case Xc:return"Profiler";case bG:return"StrictMode";case Mc:return"Suspense";case _A:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case BG:return(n.displayName||"Context")+".Consumer";case GG:return(n._context.displayName||"Context")+".Provider";case Zh:var e=n.render;return e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case wh:return hl(n.type);case vG:return hl(n._render);case yG:e=n._payload,n=n._init;try{return hl(n(e))}catch{}}return null}function Hr(n){switch(typeof n){case"boolean":case"number":case"object":case"string":case"undefined":return n;default:return""}}function LW(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dK(n){var e=LW(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t!="undefined"&&typeof t.get=="function"&&typeof t.set=="function"){var o=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return o.call(this)},set:function(r){i=""+r,s.call(this,r)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(r){i=""+r},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function ad(n){n._valueTracker||(n._valueTracker=dK(n))}function zW(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=LW(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function JA(n){if(n=n||(typeof document!="undefined"?document:void 0),typeof n=="undefined")return null;try{return n.activeElement||n.body}catch{return n.body}}function yb(n,e){var t=e.checked;return Cn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t!=null?t:n._wrapperState.initialChecked})}function hZ(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=Hr(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function kW(n,e){e=e.checked,e!=null&&fG(n,"checked",e,!1)}function vb(n,e){kW(n,e);var t=Hr(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Zb(n,e.type,t):e.hasOwnProperty("defaultValue")&&Zb(n,e.type,Hr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function pZ(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Zb(n,e,t){(e!=="number"||JA(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}function AK(n){var e="";return vh.Children.forEach(n,function(t){t!=null&&(e+=t)}),e}function wb(n,e){return n=Cn({children:void 0},e),(e=AK(e.children))&&(n.children=e),n}function pl(n,e,t,i){if(n=n.options,e){e={};for(var o=0;o<t.length;o++)e["$"+t[o]]=!0;for(t=0;t<n.length;t++)o=e.hasOwnProperty("$"+n[t].value),n[t].selected!==o&&(n[t].selected=o),o&&i&&(n[t].defaultSelected=!0)}else{for(t=""+Hr(t),e=null,o=0;o<n.length;o++){if(n[o].value===t){n[o].selected=!0,i&&(n[o].defaultSelected=!0);return}e!==null||n[o].disabled||(e=n[o])}e!==null&&(e.selected=!0)}}function Rb(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ne(91));return Cn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function mZ(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Ne(92));if(Array.isArray(t)){if(!(1>=t.length))throw Error(Ne(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Hr(t)}}function TW(n,e){var t=Hr(e.value),i=Hr(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function fZ(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}var Wb={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function EW(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sb(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?EW(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ld,_W=function(n){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,t,i,o){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,o)})}:n}(function(n,e){if(n.namespaceURI!==Wb.svg||"innerHTML"in n)n.innerHTML=e;else{for(ld=ld||document.createElement("div"),ld.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ld.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function nC(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Kc={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hK=["Webkit","ms","Moz","O"];Object.keys(Kc).forEach(function(n){hK.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Kc[e]=Kc[n]})});function JW(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Kc.hasOwnProperty(n)&&Kc[n]?(""+e).trim():e+"px"}function DW(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,o=JW(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,o):n[t]=o}}var pK=Cn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vb(n,e){if(e){if(pK[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ne(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ne(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(Ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ne(62))}}function xb(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function RG(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Hb=null,ml=null,fl=null;function bZ(n){if(n=NC(n)){if(typeof Hb!="function")throw Error(Ne(280));var e=n.stateNode;e&&(e=Hh(e),Hb(n.stateNode,n.type,e))}}function UW(n){ml?fl?fl.push(n):fl=[n]:ml=n}function PW(){if(ml){var n=ml,e=fl;if(fl=ml=null,bZ(n),e)for(n=0;n<e.length;n++)bZ(e[n])}}function WG(n,e){return n(e)}function QW(n,e,t,i,o){return n(e,t,i,o)}function SG(){}var OW=WG,Wg=!1,qm=!1;function VG(){(ml!==null||fl!==null)&&(SG(),PW())}function mK(n,e,t){if(qm)return n(e,t);qm=!0;try{return OW(n,e,t)}finally{qm=!1,VG()}}function iC(n,e){var t=n.stateNode;if(t===null)return null;var i=Hh(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Ne(231,e,typeof t));return t}var Xb=!1;if(Fs)try{var JI={};Object.defineProperty(JI,"passive",{get:function(){Xb=!0}}),window.addEventListener("test",JI,JI),window.removeEventListener("test",JI,JI)}catch{Xb=!1}function fK(n,e,t,i,o,s,r,g,a){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(u){this.onError(u)}}var Fc=!1,DA=null,UA=!1,Mb=null,bK={onError:function(n){Fc=!0,DA=n}};function GK(n,e,t,i,o,s,r,g,a){Fc=!1,DA=null,fK.apply(bK,arguments)}function BK(n,e,t,i,o,s,r,g,a){if(GK.apply(this,arguments),Fc){if(Fc){var l=DA;Fc=!1,DA=null}else throw Error(Ne(198));UA||(UA=!0,Mb=l)}}function la(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,(e.flags&1026)!==0&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function jW(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function GZ(n){if(la(n)!==n)throw Error(Ne(188))}function yK(n){var e=n.alternate;if(!e){if(e=la(n),e===null)throw Error(Ne(188));return e!==n?null:n}for(var t=n,i=e;;){var o=t.return;if(o===null)break;var s=o.alternate;if(s===null){if(i=o.return,i!==null){t=i;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===t)return GZ(o),n;if(s===i)return GZ(o),e;s=s.sibling}throw Error(Ne(188))}if(t.return!==i.return)t=o,i=s;else{for(var r=!1,g=o.child;g;){if(g===t){r=!0,t=o,i=s;break}if(g===i){r=!0,i=o,t=s;break}g=g.sibling}if(!r){for(g=s.child;g;){if(g===t){r=!0,t=s,i=o;break}if(g===i){r=!0,i=s,t=o;break}g=g.sibling}if(!r)throw Error(Ne(189))}}if(t.alternate!==i)throw Error(Ne(190))}if(t.tag!==3)throw Error(Ne(188));return t.stateNode.current===t?n:e}function qW(n){if(n=yK(n),!n)return null;for(var e=n;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===n)break;for(;!e.sibling;){if(!e.return||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function BZ(n,e){for(var t=n.alternate;e!==null;){if(e===n||e===t)return!0;e=e.return}return!1}var $W,xG,eS,tS,Kb=!1,Qo=[],Br=null,yr=null,vr=null,oC=new Map,sC=new Map,DI=[],yZ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Fb(n,e,t,i,o){return{blockedOn:n,domEventName:e,eventSystemFlags:t|16,nativeEvent:o,targetContainers:[i]}}function vZ(n,e){switch(n){case"focusin":case"focusout":Br=null;break;case"dragenter":case"dragleave":yr=null;break;case"mouseover":case"mouseout":vr=null;break;case"pointerover":case"pointerout":oC.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":sC.delete(e.pointerId)}}function UI(n,e,t,i,o,s){return n===null||n.nativeEvent!==s?(n=Fb(e,t,i,o,s),e!==null&&(e=NC(e),e!==null&&xG(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),n)}function vK(n,e,t,i,o){switch(e){case"focusin":return Br=UI(Br,n,e,t,i,o),!0;case"dragenter":return yr=UI(yr,n,e,t,i,o),!0;case"mouseover":return vr=UI(vr,n,e,t,i,o),!0;case"pointerover":var s=o.pointerId;return oC.set(s,UI(oC.get(s)||null,n,e,t,i,o)),!0;case"gotpointercapture":return s=o.pointerId,sC.set(s,UI(sC.get(s)||null,n,e,t,i,o)),!0}return!1}function ZK(n){var e=Sg(n.target);if(e!==null){var t=la(e);if(t!==null){if(e=t.tag,e===13){if(e=jW(t),e!==null){n.blockedOn=e,tS(n.lanePriority,function(){Dn.unstable_runWithPriority(n.priority,function(){eS(t)})});return}}else if(e===3&&t.stateNode.hydrate){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function GA(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=KG(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t!==null)return e=NC(t),e!==null&&xG(e),n.blockedOn=t,!1;e.shift()}return!0}function ZZ(n,e,t){GA(n)&&t.delete(e)}function wK(){for(Kb=!1;0<Qo.length;){var n=Qo[0];if(n.blockedOn!==null){n=NC(n.blockedOn),n!==null&&$W(n);break}for(var e=n.targetContainers;0<e.length;){var t=KG(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t!==null){n.blockedOn=t;break}e.shift()}n.blockedOn===null&&Qo.shift()}Br!==null&&GA(Br)&&(Br=null),yr!==null&&GA(yr)&&(yr=null),vr!==null&&GA(vr)&&(vr=null),oC.forEach(ZZ),sC.forEach(ZZ)}function PI(n,e){n.blockedOn===e&&(n.blockedOn=null,Kb||(Kb=!0,Dn.unstable_scheduleCallback(Dn.unstable_NormalPriority,wK)))}function nS(n){function e(o){return PI(o,n)}if(0<Qo.length){PI(Qo[0],n);for(var t=1;t<Qo.length;t++){var i=Qo[t];i.blockedOn===n&&(i.blockedOn=null)}}for(Br!==null&&PI(Br,n),yr!==null&&PI(yr,n),vr!==null&&PI(vr,n),oC.forEach(e),sC.forEach(e),t=0;t<DI.length;t++)i=DI[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<DI.length&&(t=DI[0],t.blockedOn===null);)ZK(t),t.blockedOn===null&&DI.shift()}function Id(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var il={animationend:Id("Animation","AnimationEnd"),animationiteration:Id("Animation","AnimationIteration"),animationstart:Id("Animation","AnimationStart"),transitionend:Id("Transition","TransitionEnd")},$m={},iS={};Fs&&(iS=document.createElement("div").style,"AnimationEvent"in window||(delete il.animationend.animation,delete il.animationiteration.animation,delete il.animationstart.animation),"TransitionEvent"in window||delete il.transitionend.transition);function Rh(n){if($m[n])return $m[n];if(!il[n])return n;var e=il[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in iS)return $m[n]=e[t];return n}var oS=Rh("animationend"),sS=Rh("animationiteration"),rS=Rh("animationstart"),gS=Rh("transitionend"),aS=new Map,HG=new Map,RK=["abort","abort",oS,"animationEnd",sS,"animationIteration",rS,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",gS,"transitionEnd","waiting","waiting"];function XG(n,e){for(var t=0;t<n.length;t+=2){var i=n[t],o=n[t+1];o="on"+(o[0].toUpperCase()+o.slice(1)),HG.set(i,e),aS.set(i,o),ga(o,[i])}}var WK=Dn.unstable_now;WK();var $t=8;function el(n){if((1&n)!==0)return $t=15,1;if((2&n)!==0)return $t=14,2;if((4&n)!==0)return $t=13,4;var e=24&n;return e!==0?($t=12,e):(n&32)!==0?($t=11,32):(e=192&n,e!==0?($t=10,e):(n&256)!==0?($t=9,256):(e=3584&n,e!==0?($t=8,e):(n&4096)!==0?($t=7,4096):(e=4186112&n,e!==0?($t=6,e):(e=62914560&n,e!==0?($t=5,e):n&67108864?($t=4,67108864):(n&134217728)!==0?($t=3,134217728):(e=805306368&n,e!==0?($t=2,e):(1073741824&n)!==0?($t=1,1073741824):($t=8,n))))))}function SK(n){switch(n){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function VK(n){switch(n){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(Ne(358,n))}}function rC(n,e){var t=n.pendingLanes;if(t===0)return $t=0;var i=0,o=0,s=n.expiredLanes,r=n.suspendedLanes,g=n.pingedLanes;if(s!==0)i=s,o=$t=15;else if(s=t&134217727,s!==0){var a=s&~r;a!==0?(i=el(a),o=$t):(g&=s,g!==0&&(i=el(g),o=$t))}else s=t&~r,s!==0?(i=el(s),o=$t):g!==0&&(i=el(g),o=$t);if(i===0)return 0;if(i=31-Xr(i),i=t&((0>i?0:1<<i)<<1)-1,e!==0&&e!==i&&(e&r)===0){if(el(e),o<=$t)return e;$t=o}if(e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Xr(e),o=1<<t,i|=n[t],e&=~o;return i}function lS(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function PA(n,e){switch(n){case 15:return 1;case 14:return 2;case 12:return n=tl(24&~e),n===0?PA(10,e):n;case 10:return n=tl(192&~e),n===0?PA(8,e):n;case 8:return n=tl(3584&~e),n===0&&(n=tl(4186112&~e),n===0&&(n=512)),n;case 2:return e=tl(805306368&~e),e===0&&(e=268435456),e}throw Error(Ne(358,n))}function tl(n){return n&-n}function ef(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Wh(n,e,t){n.pendingLanes|=e;var i=e-1;n.suspendedLanes&=i,n.pingedLanes&=i,n=n.eventTimes,e=31-Xr(e),n[e]=t}var Xr=Math.clz32?Math.clz32:XK,xK=Math.log,HK=Math.LN2;function XK(n){return n===0?32:31-(xK(n)/HK|0)|0}var MK=Dn.unstable_UserBlockingPriority,KK=Dn.unstable_runWithPriority,BA=!0;function FK(n,e,t,i){Wg||SG();var o=MG,s=Wg;Wg=!0;try{QW(o,n,e,t,i)}finally{(Wg=s)||VG()}}function YK(n,e,t,i){KK(MK,MG.bind(null,n,e,t,i))}function MG(n,e,t,i){if(BA){var o;if((o=(e&4)===0)&&0<Qo.length&&-1<yZ.indexOf(n))n=Fb(null,n,e,t,i),Qo.push(n);else{var s=KG(n,e,t,i);if(s===null)o&&vZ(n,i);else{if(o){if(-1<yZ.indexOf(n)){n=Fb(s,n,e,t,i),Qo.push(n);return}if(vK(s,n,e,t,i))return;vZ(n,i)}BS(n,e,i,null,t)}}}}function KG(n,e,t,i){var o=RG(i);if(o=Sg(o),o!==null){var s=la(o);if(s===null)o=null;else{var r=s.tag;if(r===13){if(o=jW(s),o!==null)return o;o=null}else if(r===3){if(s.stateNode.hydrate)return s.tag===3?s.stateNode.containerInfo:null;o=null}else s!==o&&(o=null)}}return BS(n,e,i,o,t),null}var hr=null,FG=null,yA=null;function IS(){if(yA)return yA;var n,e=FG,t=e.length,i,o="value"in hr?hr.value:hr.textContent,s=o.length;for(n=0;n<t&&e[n]===o[n];n++);var r=t-n;for(i=1;i<=r&&e[t-i]===o[s-i];i++);return yA=o.slice(n,1<i?1-i:void 0)}function vA(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function cd(){return!0}function wZ(){return!1}function ji(n){function e(t,i,o,s,r){this._reactName=t,this._targetInst=o,this.type=i,this.nativeEvent=s,this.target=r,this.currentTarget=null;for(var g in n)n.hasOwnProperty(g)&&(t=n[g],this[g]=t?t(s):s[g]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?cd:wZ,this.isPropagationStopped=wZ,this}return Cn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=cd)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=cd)},persist:function(){},isPersistent:cd}),e}var gI={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},YG=ji(gI),YC=Cn({},gI,{view:0,detail:0}),NK=ji(YC),tf,nf,QI,Sh=Cn({},YC,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:NG,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==QI&&(QI&&n.type==="mousemove"?(tf=n.screenX-QI.screenX,nf=n.screenY-QI.screenY):nf=tf=0,QI=n),tf)},movementY:function(n){return"movementY"in n?n.movementY:nf}}),RZ=ji(Sh),LK=Cn({},Sh,{dataTransfer:0}),zK=ji(LK),kK=Cn({},YC,{relatedTarget:0}),of=ji(kK),TK=Cn({},gI,{animationName:0,elapsedTime:0,pseudoElement:0}),EK=ji(TK),_K=Cn({},gI,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),JK=ji(_K),DK=Cn({},gI,{data:0}),WZ=ji(DK),UK={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PK={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},QK={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OK(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=QK[n])?!!e[n]:!1}function NG(){return OK}var jK=Cn({},YC,{key:function(n){if(n.key){var e=UK[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=vA(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?PK[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:NG,charCode:function(n){return n.type==="keypress"?vA(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?vA(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),qK=ji(jK),$K=Cn({},Sh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),SZ=ji($K),eF=Cn({},YC,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:NG}),tF=ji(eF),nF=Cn({},gI,{propertyName:0,elapsedTime:0,pseudoElement:0}),iF=ji(nF),oF=Cn({},Sh,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),sF=ji(oF),rF=[9,13,27,32],LG=Fs&&"CompositionEvent"in window,Yc=null;Fs&&"documentMode"in document&&(Yc=document.documentMode);var gF=Fs&&"TextEvent"in window&&!Yc,cS=Fs&&(!LG||Yc&&8<Yc&&11>=Yc),VZ=String.fromCharCode(32),xZ=!1;function CS(n,e){switch(n){case"keyup":return rF.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function uS(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ol=!1;function aF(n,e){switch(n){case"compositionend":return uS(e);case"keypress":return e.which!==32?null:(xZ=!0,VZ);case"textInput":return n=e.data,n===VZ&&xZ?null:n;default:return null}}function lF(n,e){if(ol)return n==="compositionend"||!LG&&CS(n,e)?(n=IS(),yA=FG=hr=null,ol=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return cS&&e.locale!=="ko"?null:e.data;default:return null}}var IF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function HZ(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!IF[n.type]:e==="textarea"}function dS(n,e,t,i){UW(i),e=QA(e,"onChange"),0<e.length&&(t=new YG("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var Nc=null,gC=null;function cF(n){fS(n,0)}function Vh(n){var e=rl(n);if(zW(e))return n}function CF(n,e){if(n==="change")return e}var AS=!1;if(Fs){var sf;if(Fs){var rf="oninput"in document;if(!rf){var XZ=document.createElement("div");XZ.setAttribute("oninput","return;"),rf=typeof XZ.oninput=="function"}sf=rf}else sf=!1;AS=sf&&(!document.documentMode||9<document.documentMode)}function MZ(){Nc&&(Nc.detachEvent("onpropertychange",hS),gC=Nc=null)}function hS(n){if(n.propertyName==="value"&&Vh(gC)){var e=[];if(dS(e,gC,n,RG(n)),n=cF,Wg)n(e);else{Wg=!0;try{WG(n,e)}finally{Wg=!1,VG()}}}}function uF(n,e,t){n==="focusin"?(MZ(),Nc=e,gC=t,Nc.attachEvent("onpropertychange",hS)):n==="focusout"&&MZ()}function dF(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Vh(gC)}function AF(n,e){if(n==="click")return Vh(e)}function hF(n,e){if(n==="input"||n==="change")return Vh(e)}function pF(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ao=typeof Object.is=="function"?Object.is:pF,mF=Object.prototype.hasOwnProperty;function aC(n,e){if(ao(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++)if(!mF.call(e,t[i])||!ao(n[t[i]],e[t[i]]))return!1;return!0}function KZ(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function FZ(n,e){var t=KZ(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=KZ(t)}}function pS(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?pS(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function YZ(){for(var n=window,e=JA();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=JA(n.document)}return e}function Yb(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}var fF=Fs&&"documentMode"in document&&11>=document.documentMode,sl=null,Nb=null,Lc=null,Lb=!1;function NZ(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Lb||sl==null||sl!==JA(i)||(i=sl,"selectionStart"in i&&Yb(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Lc&&aC(Lc,i)||(Lc=i,i=QA(Nb,"onSelect"),0<i.length&&(e=new YG("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=sl)))}XG("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);XG("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);XG(RK,2);for(var LZ="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),gf=0;gf<LZ.length;gf++)HG.set(LZ[gf],0);Hl("onMouseEnter",["mouseout","mouseover"]);Hl("onMouseLeave",["mouseout","mouseover"]);Hl("onPointerEnter",["pointerout","pointerover"]);Hl("onPointerLeave",["pointerout","pointerover"]);ga("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ga("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ga("onBeforeInput",["compositionend","keypress","textInput","paste"]);ga("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ga("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ga("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mS=new Set("cancel close invalid load scroll toggle".split(" ").concat(wc));function zZ(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,BK(i,e,void 0,n),n.currentTarget=null}function fS(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],o=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var r=i.length-1;0<=r;r--){var g=i[r],a=g.instance,l=g.currentTarget;if(g=g.listener,a!==s&&o.isPropagationStopped())break e;zZ(o,g,l),s=a}else for(r=0;r<i.length;r++){if(g=i[r],a=g.instance,l=g.currentTarget,g=g.listener,a!==s&&o.isPropagationStopped())break e;zZ(o,g,l),s=a}}}if(UA)throw n=Mb,UA=!1,Mb=null,n}function sn(n,e){var t=vS(e),i=n+"__bubble";t.has(i)||(GS(e,n,2,!1),t.add(i))}var kZ="_reactListening"+Math.random().toString(36).slice(2);function bS(n){n[kZ]||(n[kZ]=!0,YW.forEach(function(e){mS.has(e)||TZ(e,!1,n,null),TZ(e,!0,n,null)}))}function TZ(n,e,t,i){var o=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,s=t;if(n==="selectionchange"&&t.nodeType!==9&&(s=t.ownerDocument),i!==null&&!e&&mS.has(n)){if(n!=="scroll")return;o|=2,s=i}var r=vS(s),g=n+"__"+(e?"capture":"bubble");r.has(g)||(e&&(o|=4),GS(s,n,o,e),r.add(g))}function GS(n,e,t,i){var o=HG.get(e);switch(o===void 0?2:o){case 0:o=FK;break;case 1:o=YK;break;default:o=MG}t=o.bind(null,e,t,n),o=void 0,!Xb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),i?o!==void 0?n.addEventListener(e,t,{capture:!0,passive:o}):n.addEventListener(e,t,!0):o!==void 0?n.addEventListener(e,t,{passive:o}):n.addEventListener(e,t,!1)}function BS(n,e,t,i,o){var s=i;if((e&1)===0&&(e&2)===0&&i!==null)e:for(;;){if(i===null)return;var r=i.tag;if(r===3||r===4){var g=i.stateNode.containerInfo;if(g===o||g.nodeType===8&&g.parentNode===o)break;if(r===4)for(r=i.return;r!==null;){var a=r.tag;if((a===3||a===4)&&(a=r.stateNode.containerInfo,a===o||a.nodeType===8&&a.parentNode===o))return;r=r.return}for(;g!==null;){if(r=Sg(g),r===null)return;if(a=r.tag,a===5||a===6){i=s=r;continue e}g=g.parentNode}}i=i.return}mK(function(){var l=s,u=RG(t),d=[];e:{var C=aS.get(n);if(C!==void 0){var A=YG,f=n;switch(n){case"keypress":if(vA(t)===0)break e;case"keydown":case"keyup":A=qK;break;case"focusin":f="focus",A=of;break;case"focusout":f="blur",A=of;break;case"beforeblur":case"afterblur":A=of;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=RZ;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=zK;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=tF;break;case oS:case sS:case rS:A=EK;break;case gS:A=iF;break;case"scroll":A=NK;break;case"wheel":A=sF;break;case"copy":case"cut":case"paste":A=JK;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=SZ}var b=(e&4)!==0,G=!b&&n==="scroll",m=b?C!==null?C+"Capture":null:C;b=[];for(var h=l,B;h!==null;){B=h;var y=B.stateNode;if(B.tag===5&&y!==null&&(B=y,m!==null&&(y=iC(h,m),y!=null&&b.push(lC(h,y,B)))),G)break;h=h.return}0<b.length&&(C=new A(C,f,null,t,u),d.push({event:C,listeners:b}))}}if((e&7)===0){e:{if(C=n==="mouseover"||n==="pointerover",A=n==="mouseout"||n==="pointerout",C&&(e&16)===0&&(f=t.relatedTarget||t.fromElement)&&(Sg(f)||f[aI]))break e;if((A||C)&&(C=u.window===u?u:(C=u.ownerDocument)?C.defaultView||C.parentWindow:window,A?(f=t.relatedTarget||t.toElement,A=l,f=f?Sg(f):null,f!==null&&(G=la(f),f!==G||f.tag!==5&&f.tag!==6)&&(f=null)):(A=null,f=l),A!==f)){if(b=RZ,y="onMouseLeave",m="onMouseEnter",h="mouse",(n==="pointerout"||n==="pointerover")&&(b=SZ,y="onPointerLeave",m="onPointerEnter",h="pointer"),G=A==null?C:rl(A),B=f==null?C:rl(f),C=new b(y,h+"leave",A,t,u),C.target=G,C.relatedTarget=B,y=null,Sg(u)===l&&(b=new b(m,h+"enter",f,t,u),b.target=B,b.relatedTarget=G,y=b),G=y,A&&f)t:{for(b=A,m=f,h=0,B=b;B;B=Sa(B))h++;for(B=0,y=m;y;y=Sa(y))B++;for(;0<h-B;)b=Sa(b),h--;for(;0<B-h;)m=Sa(m),B--;for(;h--;){if(b===m||m!==null&&b===m.alternate)break t;b=Sa(b),m=Sa(m)}b=null}else b=null;A!==null&&EZ(d,C,A,b,!1),f!==null&&G!==null&&EZ(d,G,f,b,!0)}}e:{if(C=l?rl(l):window,A=C.nodeName&&C.nodeName.toLowerCase(),A==="select"||A==="input"&&C.type==="file")var Z=CF;else if(HZ(C))if(AS)Z=hF;else{Z=dF;var R=uF}else(A=C.nodeName)&&A.toLowerCase()==="input"&&(C.type==="checkbox"||C.type==="radio")&&(Z=AF);if(Z&&(Z=Z(n,l))){dS(d,Z,t,u);break e}R&&R(n,C,l),n==="focusout"&&(R=C._wrapperState)&&R.controlled&&C.type==="number"&&Zb(C,"number",C.value)}switch(R=l?rl(l):window,n){case"focusin":(HZ(R)||R.contentEditable==="true")&&(sl=R,Nb=l,Lc=null);break;case"focusout":Lc=Nb=sl=null;break;case"mousedown":Lb=!0;break;case"contextmenu":case"mouseup":case"dragend":Lb=!1,NZ(d,t,u);break;case"selectionchange":if(fF)break;case"keydown":case"keyup":NZ(d,t,u)}var W;if(LG)e:{switch(n){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else ol?CS(n,t)&&(x="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(x="onCompositionStart");x&&(cS&&t.locale!=="ko"&&(ol||x!=="onCompositionStart"?x==="onCompositionEnd"&&ol&&(W=IS()):(hr=u,FG="value"in hr?hr.value:hr.textContent,ol=!0)),R=QA(l,x),0<R.length&&(x=new WZ(x,n,null,t,u),d.push({event:x,listeners:R}),W?x.data=W:(W=uS(t),W!==null&&(x.data=W)))),(W=gF?aF(n,t):lF(n,t))&&(l=QA(l,"onBeforeInput"),0<l.length&&(u=new WZ("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:l}),u.data=W))}fS(d,e)})}function lC(n,e,t){return{instance:n,listener:e,currentTarget:t}}function QA(n,e){for(var t=e+"Capture",i=[];n!==null;){var o=n,s=o.stateNode;o.tag===5&&s!==null&&(o=s,s=iC(n,t),s!=null&&i.unshift(lC(n,s,o)),s=iC(n,e),s!=null&&i.push(lC(n,s,o))),n=n.return}return i}function Sa(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function EZ(n,e,t,i,o){for(var s=e._reactName,r=[];t!==null&&t!==i;){var g=t,a=g.alternate,l=g.stateNode;if(a!==null&&a===i)break;g.tag===5&&l!==null&&(g=l,o?(a=iC(t,s),a!=null&&r.unshift(lC(t,a,g))):o||(a=iC(t,s),a!=null&&r.push(lC(t,a,g)))),t=t.return}r.length!==0&&n.push({event:e,listeners:r})}function OA(){}var af=null,lf=null;function yS(n,e){switch(n){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function zb(n,e){return n==="textarea"||n==="option"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _Z=typeof setTimeout=="function"?setTimeout:void 0,bF=typeof clearTimeout=="function"?clearTimeout:void 0;function zG(n){n.nodeType===1?n.textContent="":n.nodeType===9&&(n=n.body,n!=null&&(n.textContent=""))}function bl(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break}return n}function JZ(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var If=0;function GF(n){return{$$typeof:ZG,toString:n,valueOf:n}}var xh=Math.random().toString(36).slice(2),pr="__reactFiber$"+xh,jA="__reactProps$"+xh,aI="__reactContainer$"+xh,DZ="__reactEvents$"+xh;function Sg(n){var e=n[pr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[aI]||t[pr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=JZ(n);n!==null;){if(t=n[pr])return t;n=JZ(n)}return e}n=t,t=n.parentNode}return null}function NC(n){return n=n[pr]||n[aI],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function rl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ne(33))}function Hh(n){return n[jA]||null}function vS(n){var e=n[DZ];return e===void 0&&(e=n[DZ]=new Set),e}var kb=[],gl=-1;function Dr(n){return{current:n}}function an(n){0>gl||(n.current=kb[gl],kb[gl]=null,gl--)}function Gn(n,e){gl++,kb[gl]=n.current,n.current=e}var Mr={},pi=Dr(Mr),Fi=Dr(!1),_g=Mr;function Xl(n,e){var t=n.type.contextTypes;if(!t)return Mr;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var o={},s;for(s in t)o[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=o),o}function Yi(n){return n=n.childContextTypes,n!=null}function qA(){an(Fi),an(pi)}function UZ(n,e,t){if(pi.current!==Mr)throw Error(Ne(168));Gn(pi,e),Gn(Fi,t)}function ZS(n,e,t){var i=n.stateNode;if(n=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var o in i)if(!(o in n))throw Error(Ne(108,hl(e)||"Unknown",o));return Cn({},t,i)}function ZA(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Mr,_g=pi.current,Gn(pi,n),Gn(Fi,Fi.current),!0}function PZ(n,e,t){var i=n.stateNode;if(!i)throw Error(Ne(169));t?(n=ZS(n,e,_g),i.__reactInternalMemoizedMergedChildContext=n,an(Fi),an(pi),Gn(pi,n)):an(Fi),Gn(Fi,t)}var kG=null,Fg=null,BF=Dn.unstable_runWithPriority,TG=Dn.unstable_scheduleCallback,Tb=Dn.unstable_cancelCallback,yF=Dn.unstable_shouldYield,QZ=Dn.unstable_requestPaint,Eb=Dn.unstable_now,vF=Dn.unstable_getCurrentPriorityLevel,Xh=Dn.unstable_ImmediatePriority,wS=Dn.unstable_UserBlockingPriority,RS=Dn.unstable_NormalPriority,WS=Dn.unstable_LowPriority,SS=Dn.unstable_IdlePriority,cf={},ZF=QZ!==void 0?QZ:function(){},Ws=null,wA=null,Cf=!1,OZ=Eb(),di=1e4>OZ?Eb:function(){return Eb()-OZ};function Ml(){switch(vF()){case Xh:return 99;case wS:return 98;case RS:return 97;case WS:return 96;case SS:return 95;default:throw Error(Ne(332))}}function VS(n){switch(n){case 99:return Xh;case 98:return wS;case 97:return RS;case 96:return WS;case 95:return SS;default:throw Error(Ne(332))}}function Jg(n,e){return n=VS(n),BF(n,e)}function IC(n,e,t){return n=VS(n),TG(n,e,t)}function ls(){if(wA!==null){var n=wA;wA=null,Tb(n)}xS()}function xS(){if(!Cf&&Ws!==null){Cf=!0;var n=0;try{var e=Ws;Jg(99,function(){for(;n<e.length;n++){var t=e[n];do t=t(!0);while(t!==null)}}),Ws=null}catch(t){throw Ws!==null&&(Ws=Ws.slice(n+1)),TG(Xh,ls),t}finally{Cf=!1}}}var wF=aa.ReactCurrentBatchConfig;function So(n,e){if(n&&n.defaultProps){e=Cn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var $A=Dr(null),eh=null,al=null,th=null;function EG(){th=al=eh=null}function _G(n){var e=$A.current;an($A),n.type._context._currentValue=e}function HS(n,e){for(;n!==null;){var t=n.alternate;if((n.childLanes&e)===e){if(t===null||(t.childLanes&e)===e)break;t.childLanes|=e}else n.childLanes|=e,t!==null&&(t.childLanes|=e);n=n.return}}function Gl(n,e){eh=n,th=al=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&e)!==0&&(xo=!0),n.firstContext=null)}function co(n,e){if(th!==n&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(th=n,e=1073741823),e={context:n,observedBits:e,next:null},al===null){if(eh===null)throw Error(Ne(308));al=e,eh.dependencies={lanes:0,firstContext:e,responders:null}}else al=al.next=e;return n._currentValue}var ur=!1;function JG(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function XS(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Zr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function wr(n,e){if(n=n.updateQueue,n!==null){n=n.shared;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}}function jZ(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var o=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var r={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?o=s=r:s=s.next=r,t=t.next}while(t!==null);s===null?o=s=e:s=s.next=e}else o=s=e;t={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function cC(n,e,t,i){var o=n.updateQueue;ur=!1;var s=o.firstBaseUpdate,r=o.lastBaseUpdate,g=o.shared.pending;if(g!==null){o.shared.pending=null;var a=g,l=a.next;a.next=null,r===null?s=l:r.next=l,r=a;var u=n.alternate;if(u!==null){u=u.updateQueue;var d=u.lastBaseUpdate;d!==r&&(d===null?u.firstBaseUpdate=l:d.next=l,u.lastBaseUpdate=a)}}if(s!==null){d=o.baseState,r=0,u=l=a=null;do{g=s.lane;var C=s.eventTime;if((i&g)===g){u!==null&&(u=u.next={eventTime:C,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var A=n,f=s;switch(g=e,C=t,f.tag){case 1:if(A=f.payload,typeof A=="function"){d=A.call(C,d,g);break e}d=A;break e;case 3:A.flags=A.flags&-4097|64;case 0:if(A=f.payload,g=typeof A=="function"?A.call(C,d,g):A,g==null)break e;d=Cn({},d,g);break e;case 2:ur=!0}}s.callback!==null&&(n.flags|=32,g=o.effects,g===null?o.effects=[s]:g.push(s))}else C={eventTime:C,lane:g,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(l=u=C,a=d):u=u.next=C,r|=g;if(s=s.next,s===null){if(g=o.shared.pending,g===null)break;s=g.next,g.next=null,o.lastBaseUpdate=g,o.shared.pending=null}}while(1);u===null&&(a=d),o.baseState=a,o.firstBaseUpdate=l,o.lastBaseUpdate=u,zC|=r,n.lanes=r,n.memoizedState=d}}function qZ(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],o=i.callback;if(o!==null){if(i.callback=null,i=t,typeof o!="function")throw Error(Ne(191,o));o.call(i)}}}var MS=new vh.Component().refs;function nh(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Cn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Mh={isMounted:function(n){return(n=n._reactInternals)?la(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Ui(),o=Rr(n),s=Zr(i,o);s.payload=e,t!=null&&(s.callback=t),wr(n,s),Wr(n,o,i)},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Ui(),o=Rr(n),s=Zr(i,o);s.tag=1,s.payload=e,t!=null&&(s.callback=t),wr(n,s),Wr(n,o,i)},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ui(),i=Rr(n),o=Zr(t,i);o.tag=2,e!=null&&(o.callback=e),wr(n,o),Wr(n,i,t)}};function $Z(n,e,t,i,o,s,r){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,r):e.prototype&&e.prototype.isPureReactComponent?!aC(t,i)||!aC(o,s):!0}function KS(n,e,t){var i=!1,o=Mr,s=e.contextType;return typeof s=="object"&&s!==null?s=co(s):(o=Yi(e)?_g:pi.current,i=e.contextTypes,s=(i=i!=null)?Xl(n,o):Mr),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Mh,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=s),e}function ew(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&Mh.enqueueReplaceState(e,e.state,null)}function _b(n,e,t,i){var o=n.stateNode;o.props=t,o.state=n.memoizedState,o.refs=MS,JG(n);var s=e.contextType;typeof s=="object"&&s!==null?o.context=co(s):(s=Yi(e)?_g:pi.current,o.context=Xl(n,s)),cC(n,t,o,i),o.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(nh(n,e,s,t),o.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&Mh.enqueueReplaceState(o,o.state,null),cC(n,t,o,i),o.state=n.memoizedState),typeof o.componentDidMount=="function"&&(n.flags|=4)}var Cd=Array.isArray;function OI(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Ne(309));var i=t.stateNode}if(!i)throw Error(Ne(147,n));var o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var r=i.refs;r===MS&&(r=i.refs={}),s===null?delete r[o]:r[o]=s},e._stringRef=o,e)}if(typeof n!="string")throw Error(Ne(284));if(!t._owner)throw Error(Ne(290,n))}return n}function ud(n,e){if(n.type!=="textarea")throw Error(Ne(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function FS(n){function e(G,m){if(n){var h=G.lastEffect;h!==null?(h.nextEffect=m,G.lastEffect=m):G.firstEffect=G.lastEffect=m,m.nextEffect=null,m.flags=8}}function t(G,m){if(!n)return null;for(;m!==null;)e(G,m),m=m.sibling;return null}function i(G,m){for(G=new Map;m!==null;)m.key!==null?G.set(m.key,m):G.set(m.index,m),m=m.sibling;return G}function o(G,m){return G=Fr(G,m),G.index=0,G.sibling=null,G}function s(G,m,h){return G.index=h,n?(h=G.alternate,h!==null?(h=h.index,h<m?(G.flags=2,m):h):(G.flags=2,m)):m}function r(G){return n&&G.alternate===null&&(G.flags=2),G}function g(G,m,h,B){return m===null||m.tag!==6?(m=pf(h,G.mode,B),m.return=G,m):(m=o(m,h),m.return=G,m)}function a(G,m,h,B){return m!==null&&m.elementType===h.type?(B=o(m,h.props),B.ref=OI(G,m,h),B.return=G,B):(B=VA(h.type,h.key,h.props,null,G.mode,B),B.ref=OI(G,m,h),B.return=G,B)}function l(G,m,h,B){return m===null||m.tag!==4||m.stateNode.containerInfo!==h.containerInfo||m.stateNode.implementation!==h.implementation?(m=mf(h,G.mode,B),m.return=G,m):(m=o(m,h.children||[]),m.return=G,m)}function u(G,m,h,B,y){return m===null||m.tag!==7?(m=Zl(h,G.mode,B,y),m.return=G,m):(m=o(m,h),m.return=G,m)}function d(G,m,h){if(typeof m=="string"||typeof m=="number")return m=pf(""+m,G.mode,h),m.return=G,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case vc:return h=VA(m.type,m.key,m.props,null,G.mode,h),h.ref=OI(G,null,m),h.return=G,h;case Rg:return m=mf(m,G.mode,h),m.return=G,m}if(Cd(m)||_I(m))return m=Zl(m,G.mode,h,null),m.return=G,m;ud(G,m)}return null}function C(G,m,h,B){var y=m!==null?m.key:null;if(typeof h=="string"||typeof h=="number")return y!==null?null:g(G,m,""+h,B);if(typeof h=="object"&&h!==null){switch(h.$$typeof){case vc:return h.key===y?h.type===Ar?u(G,m,h.props.children,B,y):a(G,m,h,B):null;case Rg:return h.key===y?l(G,m,h,B):null}if(Cd(h)||_I(h))return y!==null?null:u(G,m,h,B,null);ud(G,h)}return null}function A(G,m,h,B,y){if(typeof B=="string"||typeof B=="number")return G=G.get(h)||null,g(m,G,""+B,y);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case vc:return G=G.get(B.key===null?h:B.key)||null,B.type===Ar?u(m,G,B.props.children,y,B.key):a(m,G,B,y);case Rg:return G=G.get(B.key===null?h:B.key)||null,l(m,G,B,y)}if(Cd(B)||_I(B))return G=G.get(h)||null,u(m,G,B,y,null);ud(m,B)}return null}function f(G,m,h,B){for(var y=null,Z=null,R=m,W=m=0,x=null;R!==null&&W<h.length;W++){R.index>W?(x=R,R=null):x=R.sibling;var X=C(G,R,h[W],B);if(X===null){R===null&&(R=x);break}n&&R&&X.alternate===null&&e(G,R),m=s(X,m,W),Z===null?y=X:Z.sibling=X,Z=X,R=x}if(W===h.length)return t(G,R),y;if(R===null){for(;W<h.length;W++)R=d(G,h[W],B),R!==null&&(m=s(R,m,W),Z===null?y=R:Z.sibling=R,Z=R);return y}for(R=i(G,R);W<h.length;W++)x=A(R,G,W,h[W],B),x!==null&&(n&&x.alternate!==null&&R.delete(x.key===null?W:x.key),m=s(x,m,W),Z===null?y=x:Z.sibling=x,Z=x);return n&&R.forEach(function(Y){return e(G,Y)}),y}function b(G,m,h,B){var y=_I(h);if(typeof y!="function")throw Error(Ne(150));if(h=y.call(h),h==null)throw Error(Ne(151));for(var Z=y=null,R=m,W=m=0,x=null,X=h.next();R!==null&&!X.done;W++,X=h.next()){R.index>W?(x=R,R=null):x=R.sibling;var Y=C(G,R,X.value,B);if(Y===null){R===null&&(R=x);break}n&&R&&Y.alternate===null&&e(G,R),m=s(Y,m,W),Z===null?y=Y:Z.sibling=Y,Z=Y,R=x}if(X.done)return t(G,R),y;if(R===null){for(;!X.done;W++,X=h.next())X=d(G,X.value,B),X!==null&&(m=s(X,m,W),Z===null?y=X:Z.sibling=X,Z=X);return y}for(R=i(G,R);!X.done;W++,X=h.next())X=A(R,G,W,X.value,B),X!==null&&(n&&X.alternate!==null&&R.delete(X.key===null?W:X.key),m=s(X,m,W),Z===null?y=X:Z.sibling=X,Z=X);return n&&R.forEach(function(S){return e(G,S)}),y}return function(G,m,h,B){var y=typeof h=="object"&&h!==null&&h.type===Ar&&h.key===null;y&&(h=h.props.children);var Z=typeof h=="object"&&h!==null;if(Z)switch(h.$$typeof){case vc:e:{for(Z=h.key,y=m;y!==null;){if(y.key===Z){switch(y.tag){case 7:if(h.type===Ar){t(G,y.sibling),m=o(y,h.props.children),m.return=G,G=m;break e}break;default:if(y.elementType===h.type){t(G,y.sibling),m=o(y,h.props),m.ref=OI(G,y,h),m.return=G,G=m;break e}}t(G,y);break}else e(G,y);y=y.sibling}h.type===Ar?(m=Zl(h.props.children,G.mode,B,h.key),m.return=G,G=m):(B=VA(h.type,h.key,h.props,null,G.mode,B),B.ref=OI(G,m,h),B.return=G,G=B)}return r(G);case Rg:e:{for(y=h.key;m!==null;){if(m.key===y)if(m.tag===4&&m.stateNode.containerInfo===h.containerInfo&&m.stateNode.implementation===h.implementation){t(G,m.sibling),m=o(m,h.children||[]),m.return=G,G=m;break e}else{t(G,m);break}else e(G,m);m=m.sibling}m=mf(h,G.mode,B),m.return=G,G=m}return r(G)}if(typeof h=="string"||typeof h=="number")return h=""+h,m!==null&&m.tag===6?(t(G,m.sibling),m=o(m,h),m.return=G,G=m):(t(G,m),m=pf(h,G.mode,B),m.return=G,G=m),r(G);if(Cd(h))return f(G,m,h,B);if(_I(h))return b(G,m,h,B);if(Z&&ud(G,h),typeof h=="undefined"&&!y)switch(G.tag){case 1:case 22:case 0:case 11:case 15:throw Error(Ne(152,hl(G.type)||"Component"))}return t(G,m)}}var ih=FS(!0),YS=FS(!1),LC={},$o=Dr(LC),CC=Dr(LC),uC=Dr(LC);function Vg(n){if(n===LC)throw Error(Ne(174));return n}function Jb(n,e){switch(Gn(uC,e),Gn(CC,n),Gn($o,LC),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Sb(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Sb(e,n)}an($o),Gn($o,e)}function Kl(){an($o),an(CC),an(uC)}function tw(n){Vg(uC.current);var e=Vg($o.current),t=Sb(e,n.type);e!==t&&(Gn(CC,n),Gn($o,t))}function DG(n){CC.current===n&&(an($o),an(CC))}var bn=Dr(0);function oh(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Vs=null,mr=null,es=!1;function NS(n,e){var t=lo(5,null,null,0);t.elementType="DELETED",t.type="DELETED",t.stateNode=e,t.return=n,t.flags=8,n.lastEffect!==null?(n.lastEffect.nextEffect=t,n.lastEffect=t):n.firstEffect=n.lastEffect=t}function nw(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function Db(n){if(es){var e=mr;if(e){var t=e;if(!nw(n,e)){if(e=bl(t.nextSibling),!e||!nw(n,e)){n.flags=n.flags&-1025|2,es=!1,Vs=n;return}NS(Vs,t)}Vs=n,mr=bl(e.firstChild)}else n.flags=n.flags&-1025|2,es=!1,Vs=n}}function iw(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Vs=n}function dd(n){if(n!==Vs)return!1;if(!es)return iw(n),es=!0,!1;var e=n.type;if(n.tag!==5||e!=="head"&&e!=="body"&&!zb(e,n.memoizedProps))for(e=mr;e;)NS(n,e),e=bl(e.nextSibling);if(iw(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ne(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){mr=bl(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}mr=null}}else mr=Vs?bl(n.stateNode.nextSibling):null;return!0}function uf(){mr=Vs=null,es=!1}var Bl=[];function UG(){for(var n=0;n<Bl.length;n++)Bl[n]._workInProgressVersionPrimary=null;Bl.length=0}var zc=aa.ReactCurrentDispatcher,Io=aa.ReactCurrentBatchConfig,dC=0,Vn=null,Ci=null,ei=null,sh=!1,kc=!1;function Si(){throw Error(Ne(321))}function PG(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!ao(n[t],e[t]))return!1;return!0}function QG(n,e,t,i,o,s){if(dC=s,Vn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,zc.current=n===null||n.memoizedState===null?WF:SF,n=t(i,o),kc){s=0;do{if(kc=!1,!(25>s))throw Error(Ne(301));s+=1,ei=Ci=null,e.updateQueue=null,zc.current=VF,n=t(i,o)}while(kc)}if(zc.current=lh,e=Ci!==null&&Ci.next!==null,dC=0,ei=Ci=Vn=null,sh=!1,e)throw Error(Ne(300));return n}function xg(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ei===null?Vn.memoizedState=ei=n:ei=ei.next=n,ei}function Ia(){if(Ci===null){var n=Vn.alternate;n=n!==null?n.memoizedState:null}else n=Ci.next;var e=ei===null?Vn.memoizedState:ei.next;if(e!==null)ei=e,Ci=n;else{if(n===null)throw Error(Ne(310));Ci=n,n={memoizedState:Ci.memoizedState,baseState:Ci.baseState,baseQueue:Ci.baseQueue,queue:Ci.queue,next:null},ei===null?Vn.memoizedState=ei=n:ei=ei.next=n}return ei}function Oo(n,e){return typeof e=="function"?e(n):e}function jI(n){var e=Ia(),t=e.queue;if(t===null)throw Error(Ne(311));t.lastRenderedReducer=n;var i=Ci,o=i.baseQueue,s=t.pending;if(s!==null){if(o!==null){var r=o.next;o.next=s.next,s.next=r}i.baseQueue=o=s,t.pending=null}if(o!==null){o=o.next,i=i.baseState;var g=r=s=null,a=o;do{var l=a.lane;if((dC&l)===l)g!==null&&(g=g.next={lane:0,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null}),i=a.eagerReducer===n?a.eagerState:n(i,a.action);else{var u={lane:l,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null};g===null?(r=g=u,s=i):g=g.next=u,Vn.lanes|=l,zC|=l}a=a.next}while(a!==null&&a!==o);g===null?s=i:g.next=r,ao(i,e.memoizedState)||(xo=!0),e.memoizedState=i,e.baseState=s,e.baseQueue=g,t.lastRenderedState=i}return[e.memoizedState,t.dispatch]}function qI(n){var e=Ia(),t=e.queue;if(t===null)throw Error(Ne(311));t.lastRenderedReducer=n;var i=t.dispatch,o=t.pending,s=e.memoizedState;if(o!==null){t.pending=null;var r=o=o.next;do s=n(s,r.action),r=r.next;while(r!==o);ao(s,e.memoizedState)||(xo=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function ow(n,e,t){var i=e._getVersion;i=i(e._source);var o=e._workInProgressVersionPrimary;if(o!==null?n=o===i:(n=n.mutableReadLanes,(n=(dC&n)===n)&&(e._workInProgressVersionPrimary=i,Bl.push(e))),n)return t(e._source);throw Bl.push(e),Error(Ne(350))}function LS(n,e,t,i){var o=bi;if(o===null)throw Error(Ne(349));var s=e._getVersion,r=s(e._source),g=zc.current,a=g.useState(function(){return ow(o,e,t)}),l=a[1],u=a[0];a=ei;var d=n.memoizedState,C=d.refs,A=C.getSnapshot,f=d.source;d=d.subscribe;var b=Vn;return n.memoizedState={refs:C,source:e,subscribe:i},g.useEffect(function(){C.getSnapshot=t,C.setSnapshot=l;var G=s(e._source);if(!ao(r,G)){G=t(e._source),ao(u,G)||(l(G),G=Rr(b),o.mutableReadLanes|=G&o.pendingLanes),G=o.mutableReadLanes,o.entangledLanes|=G;for(var m=o.entanglements,h=G;0<h;){var B=31-Xr(h),y=1<<B;m[B]|=G,h&=~y}}},[t,e,i]),g.useEffect(function(){return i(e._source,function(){var G=C.getSnapshot,m=C.setSnapshot;try{m(G(e._source));var h=Rr(b);o.mutableReadLanes|=h&o.pendingLanes}catch(B){m(function(){throw B})}})},[e,i]),ao(A,t)&&ao(f,e)&&ao(d,i)||(n={pending:null,dispatch:null,lastRenderedReducer:Oo,lastRenderedState:u},n.dispatch=l=qG.bind(null,Vn,n),a.queue=n,a.baseQueue=null,u=ow(o,e,t),a.memoizedState=a.baseState=u),u}function zS(n,e,t){var i=Ia();return LS(i,n,e,t)}function $I(n){var e=xg();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n=e.queue={pending:null,dispatch:null,lastRenderedReducer:Oo,lastRenderedState:n},n=n.dispatch=qG.bind(null,Vn,n),[e.memoizedState,n]}function rh(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Vn.updateQueue,e===null?(e={lastEffect:null},Vn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function sw(n){var e=xg();return n={current:n},e.memoizedState=n}function gh(){return Ia().memoizedState}function Ub(n,e,t,i){var o=xg();Vn.flags|=n,o.memoizedState=rh(1|e,t,void 0,i===void 0?null:i)}function OG(n,e,t,i){var o=Ia();i=i===void 0?null:i;var s=void 0;if(Ci!==null){var r=Ci.memoizedState;if(s=r.destroy,i!==null&&PG(i,r.deps)){rh(e,t,s,i);return}}Vn.flags|=n,o.memoizedState=rh(1|e,t,s,i)}function rw(n,e){return Ub(516,4,n,e)}function ah(n,e){return OG(516,4,n,e)}function kS(n,e){return OG(4,2,n,e)}function TS(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function ES(n,e,t){return t=t!=null?t.concat([n]):null,OG(4,2,TS.bind(null,e,n),t)}function jG(){}function _S(n,e){var t=Ia();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&PG(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function JS(n,e){var t=Ia();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&PG(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function RF(n,e){var t=Ml();Jg(98>t?98:t,function(){n(!0)}),Jg(97<t?97:t,function(){var i=Io.transition;Io.transition=1;try{n(!1),e()}finally{Io.transition=i}})}function qG(n,e,t){var i=Ui(),o=Rr(n),s={lane:o,action:t,eagerReducer:null,eagerState:null,next:null},r=e.pending;if(r===null?s.next=s:(s.next=r.next,r.next=s),e.pending=s,r=n.alternate,n===Vn||r!==null&&r===Vn)kc=sh=!0;else{if(n.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var g=e.lastRenderedState,a=r(g,t);if(s.eagerReducer=r,s.eagerState=a,ao(a,g))return}catch{}finally{}Wr(n,o,i)}}var lh={readContext:co,useCallback:Si,useContext:Si,useEffect:Si,useImperativeHandle:Si,useLayoutEffect:Si,useMemo:Si,useReducer:Si,useRef:Si,useState:Si,useDebugValue:Si,useDeferredValue:Si,useTransition:Si,useMutableSource:Si,useOpaqueIdentifier:Si,unstable_isNewReconciler:!1},WF={readContext:co,useCallback:function(n,e){return xg().memoizedState=[n,e===void 0?null:e],n},useContext:co,useEffect:rw,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Ub(4,2,TS.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Ub(4,2,n,e)},useMemo:function(n,e){var t=xg();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=xg();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n=i.queue={pending:null,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},n=n.dispatch=qG.bind(null,Vn,n),[i.memoizedState,n]},useRef:sw,useState:$I,useDebugValue:jG,useDeferredValue:function(n){var e=$I(n),t=e[0],i=e[1];return rw(function(){var o=Io.transition;Io.transition=1;try{i(n)}finally{Io.transition=o}},[n]),t},useTransition:function(){var n=$I(!1),e=n[0];return n=RF.bind(null,n[1]),sw(n),[n,e]},useMutableSource:function(n,e,t){var i=xg();return i.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:n,subscribe:t},LS(i,n,e,t)},useOpaqueIdentifier:function(){if(es){var n=!1,e=GF(function(){throw n||(n=!0,t("r:"+(If++).toString(36))),Error(Ne(355))}),t=$I(e)[1];return(Vn.mode&2)===0&&(Vn.flags|=516,rh(5,function(){t("r:"+(If++).toString(36))},void 0,null)),e}return e="r:"+(If++).toString(36),$I(e),e},unstable_isNewReconciler:!1},SF={readContext:co,useCallback:_S,useContext:co,useEffect:ah,useImperativeHandle:ES,useLayoutEffect:kS,useMemo:JS,useReducer:jI,useRef:gh,useState:function(){return jI(Oo)},useDebugValue:jG,useDeferredValue:function(n){var e=jI(Oo),t=e[0],i=e[1];return ah(function(){var o=Io.transition;Io.transition=1;try{i(n)}finally{Io.transition=o}},[n]),t},useTransition:function(){var n=jI(Oo)[0];return[gh().current,n]},useMutableSource:zS,useOpaqueIdentifier:function(){return jI(Oo)[0]},unstable_isNewReconciler:!1},VF={readContext:co,useCallback:_S,useContext:co,useEffect:ah,useImperativeHandle:ES,useLayoutEffect:kS,useMemo:JS,useReducer:qI,useRef:gh,useState:function(){return qI(Oo)},useDebugValue:jG,useDeferredValue:function(n){var e=qI(Oo),t=e[0],i=e[1];return ah(function(){var o=Io.transition;Io.transition=1;try{i(n)}finally{Io.transition=o}},[n]),t},useTransition:function(){var n=qI(Oo)[0];return[gh().current,n]},useMutableSource:zS,useOpaqueIdentifier:function(){return qI(Oo)[0]},unstable_isNewReconciler:!1},xF=aa.ReactCurrentOwner,xo=!1;function xi(n,e,t,i){e.child=n===null?YS(e,null,t,i):ih(e,n.child,t,i)}function gw(n,e,t,i,o){t=t.render;var s=e.ref;return Gl(e,o),i=QG(n,e,t,i,s,o),n!==null&&!xo?(e.updateQueue=n.updateQueue,e.flags&=-517,n.lanes&=~o,xs(n,e,o)):(e.flags|=1,xi(n,e,i,o),e.child)}function aw(n,e,t,i,o,s){if(n===null){var r=t.type;return typeof r=="function"&&!oB(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,DS(n,e,r,i,o,s)):(n=VA(t.type,null,i,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}return r=n.child,(o&s)===0&&(o=r.memoizedProps,t=t.compare,t=t!==null?t:aC,t(o,i)&&n.ref===e.ref)?xs(n,e,s):(e.flags|=1,n=Fr(r,i),n.ref=e.ref,n.return=e,e.child=n)}function DS(n,e,t,i,o,s){if(n!==null&&aC(n.memoizedProps,i)&&n.ref===e.ref)if(xo=!1,(s&o)!==0)(n.flags&16384)!==0&&(xo=!0);else return e.lanes=n.lanes,xs(n,e,s);return Pb(n,e,t,i,s)}function df(n,e,t){var i=e.pendingProps,o=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden"||i.mode==="unstable-defer-without-hiding")if((e.mode&4)===0)e.memoizedState={baseLanes:0},hd(e,t);else if((t&1073741824)!==0)e.memoizedState={baseLanes:0},hd(e,s!==null?s.baseLanes:t);else return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n},hd(e,n),null;else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,hd(e,i);return xi(n,e,o,t),e.child}function US(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=128)}function Pb(n,e,t,i,o){var s=Yi(t)?_g:pi.current;return s=Xl(e,s),Gl(e,o),t=QG(n,e,t,i,s,o),n!==null&&!xo?(e.updateQueue=n.updateQueue,e.flags&=-517,n.lanes&=~o,xs(n,e,o)):(e.flags|=1,xi(n,e,t,o),e.child)}function lw(n,e,t,i,o){if(Yi(t)){var s=!0;ZA(e)}else s=!1;if(Gl(e,o),e.stateNode===null)n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),KS(e,t,i),_b(e,t,i,o),i=!0;else if(n===null){var r=e.stateNode,g=e.memoizedProps;r.props=g;var a=r.context,l=t.contextType;typeof l=="object"&&l!==null?l=co(l):(l=Yi(t)?_g:pi.current,l=Xl(e,l));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof r.getSnapshotBeforeUpdate=="function";d||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(g!==i||a!==l)&&ew(e,r,i,l),ur=!1;var C=e.memoizedState;r.state=C,cC(e,i,r,o),a=e.memoizedState,g!==i||C!==a||Fi.current||ur?(typeof u=="function"&&(nh(e,t,u,i),a=e.memoizedState),(g=ur||$Z(e,t,g,i,C,a,l))?(d||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount()),typeof r.componentDidMount=="function"&&(e.flags|=4)):(typeof r.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=i,e.memoizedState=a),r.props=i,r.state=a,r.context=l,i=g):(typeof r.componentDidMount=="function"&&(e.flags|=4),i=!1)}else{r=e.stateNode,XS(n,e),g=e.memoizedProps,l=e.type===e.elementType?g:So(e.type,g),r.props=l,d=e.pendingProps,C=r.context,a=t.contextType,typeof a=="object"&&a!==null?a=co(a):(a=Yi(t)?_g:pi.current,a=Xl(e,a));var A=t.getDerivedStateFromProps;(u=typeof A=="function"||typeof r.getSnapshotBeforeUpdate=="function")||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(g!==d||C!==a)&&ew(e,r,i,a),ur=!1,C=e.memoizedState,r.state=C,cC(e,i,r,o);var f=e.memoizedState;g!==d||C!==f||Fi.current||ur?(typeof A=="function"&&(nh(e,t,A,i),f=e.memoizedState),(l=ur||$Z(e,t,l,i,C,f,a))?(u||typeof r.UNSAFE_componentWillUpdate!="function"&&typeof r.componentWillUpdate!="function"||(typeof r.componentWillUpdate=="function"&&r.componentWillUpdate(i,f,a),typeof r.UNSAFE_componentWillUpdate=="function"&&r.UNSAFE_componentWillUpdate(i,f,a)),typeof r.componentDidUpdate=="function"&&(e.flags|=4),typeof r.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof r.componentDidUpdate!="function"||g===n.memoizedProps&&C===n.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||g===n.memoizedProps&&C===n.memoizedState||(e.flags|=256),e.memoizedProps=i,e.memoizedState=f),r.props=i,r.state=f,r.context=a,i=l):(typeof r.componentDidUpdate!="function"||g===n.memoizedProps&&C===n.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||g===n.memoizedProps&&C===n.memoizedState||(e.flags|=256),i=!1)}return Qb(n,e,t,i,s,o)}function Qb(n,e,t,i,o,s){US(n,e);var r=(e.flags&64)!==0;if(!i&&!r)return o&&PZ(e,t,!1),xs(n,e,s);i=e.stateNode,xF.current=e;var g=r&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&r?(e.child=ih(e,n.child,null,s),e.child=ih(e,null,g,s)):xi(n,e,g,s),e.memoizedState=i.state,o&&PZ(e,t,!0),e.child}function Iw(n){var e=n.stateNode;e.pendingContext?UZ(n,e.pendingContext,e.pendingContext!==e.context):e.context&&UZ(n,e.context,!1),Jb(n,e.containerInfo)}var Ad={dehydrated:null,retryLane:0};function cw(n,e,t){var i=e.pendingProps,o=bn.current,s=!1,r;return(r=(e.flags&64)!==0)||(r=n!==null&&n.memoizedState===null?!1:(o&2)!==0),r?(s=!0,e.flags&=-65):n!==null&&n.memoizedState===null||i.fallback===void 0||i.unstable_avoidThisFallback===!0||(o|=1),Gn(bn,o&1),n===null?(i.fallback!==void 0&&Db(e),n=i.children,o=i.fallback,s?(n=Cw(e,n,o,t),e.child.memoizedState={baseLanes:t},e.memoizedState=Ad,n):typeof i.unstable_expectedLoadTime=="number"?(n=Cw(e,n,o,t),e.child.memoizedState={baseLanes:t},e.memoizedState=Ad,e.lanes=33554432,n):(t=sB({mode:"visible",children:n},e.mode,t,null),t.return=e,e.child=t)):n.memoizedState!==null?s?(i=dw(n,e,i.children,i.fallback,t),s=e.child,o=n.child.memoizedState,s.memoizedState=o===null?{baseLanes:t}:{baseLanes:o.baseLanes|t},s.childLanes=n.childLanes&~t,e.memoizedState=Ad,i):(t=uw(n,e,i.children,t),e.memoizedState=null,t):s?(i=dw(n,e,i.children,i.fallback,t),s=e.child,o=n.child.memoizedState,s.memoizedState=o===null?{baseLanes:t}:{baseLanes:o.baseLanes|t},s.childLanes=n.childLanes&~t,e.memoizedState=Ad,i):(t=uw(n,e,i.children,t),e.memoizedState=null,t)}function Cw(n,e,t,i){var o=n.mode,s=n.child;return e={mode:"hidden",children:e},(o&2)===0&&s!==null?(s.childLanes=0,s.pendingProps=e):s=sB(e,o,0,null),t=Zl(t,o,i,null),s.return=n,t.return=n,s.sibling=t,n.child=s,t}function uw(n,e,t,i){var o=n.child;return n=o.sibling,t=Fr(o,{mode:"visible",children:t}),(e.mode&2)===0&&(t.lanes=i),t.return=e,t.sibling=null,n!==null&&(n.nextEffect=null,n.flags=8,e.firstEffect=e.lastEffect=n),e.child=t}function dw(n,e,t,i,o){var s=e.mode,r=n.child;n=r.sibling;var g={mode:"hidden",children:t};return(s&2)===0&&e.child!==r?(t=e.child,t.childLanes=0,t.pendingProps=g,r=t.lastEffect,r!==null?(e.firstEffect=t.firstEffect,e.lastEffect=r,r.nextEffect=null):e.firstEffect=e.lastEffect=null):t=Fr(r,g),n!==null?i=Fr(n,i):(i=Zl(i,s,o,null),i.flags|=2),i.return=e,t.return=e,t.sibling=i,e.child=t,i}function Aw(n,e){n.lanes|=e;var t=n.alternate;t!==null&&(t.lanes|=e),HS(n.return,e)}function Af(n,e,t,i,o,s){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:o,lastEffect:s}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=t,r.tailMode=o,r.lastEffect=s)}function hw(n,e,t){var i=e.pendingProps,o=i.revealOrder,s=i.tail;if(xi(n,e,i.children,t),i=bn.current,(i&2)!==0)i=i&1|2,e.flags|=64;else{if(n!==null&&(n.flags&64)!==0)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Aw(n,t);else if(n.tag===19)Aw(n,t);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Gn(bn,i),(e.mode&2)===0)e.memoizedState=null;else switch(o){case"forwards":for(t=e.child,o=null;t!==null;)n=t.alternate,n!==null&&oh(n)===null&&(o=t),t=t.sibling;t=o,t===null?(o=e.child,e.child=null):(o=t.sibling,t.sibling=null),Af(e,!1,o,t,s,e.lastEffect);break;case"backwards":for(t=null,o=e.child,e.child=null;o!==null;){if(n=o.alternate,n!==null&&oh(n)===null){e.child=o;break}n=o.sibling,o.sibling=t,t=o,o=n}Af(e,!0,t,null,s,e.lastEffect);break;case"together":Af(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function xs(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),zC|=e.lanes,(t&e.childLanes)!==0){if(n!==null&&e.child!==n.child)throw Error(Ne(153));if(e.child!==null){for(n=e.child,t=Fr(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Fr(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}return null}var PS,Ob,QS,OS;PS=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Ob=function(){};QS=function(n,e,t,i){var o=n.memoizedProps;if(o!==i){n=e.stateNode,Vg($o.current);var s=null;switch(t){case"input":o=yb(n,o),i=yb(n,i),s=[];break;case"option":o=wb(n,o),i=wb(n,i),s=[];break;case"select":o=Cn({},o,{value:void 0}),i=Cn({},i,{value:void 0}),s=[];break;case"textarea":o=Rb(n,o),i=Rb(n,i),s=[];break;default:typeof o.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=OA)}Vb(t,i);var r;t=null;for(l in o)if(!i.hasOwnProperty(l)&&o.hasOwnProperty(l)&&o[l]!=null)if(l==="style"){var g=o[l];for(r in g)g.hasOwnProperty(r)&&(t||(t={}),t[r]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(tC.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var a=i[l];if(g=o!=null?o[l]:void 0,i.hasOwnProperty(l)&&a!==g&&(a!=null||g!=null))if(l==="style")if(g){for(r in g)!g.hasOwnProperty(r)||a&&a.hasOwnProperty(r)||(t||(t={}),t[r]="");for(r in a)a.hasOwnProperty(r)&&g[r]!==a[r]&&(t||(t={}),t[r]=a[r])}else t||(s||(s=[]),s.push(l,t)),t=a;else l==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,g=g?g.__html:void 0,a!=null&&g!==a&&(s=s||[]).push(l,a)):l==="children"?typeof a!="string"&&typeof a!="number"||(s=s||[]).push(l,""+a):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(tC.hasOwnProperty(l)?(a!=null&&l==="onScroll"&&sn("scroll",n),s||g===a||(s=[])):typeof a=="object"&&a!==null&&a.$$typeof===ZG?a.toString():(s=s||[]).push(l,a))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};OS=function(n,e,t,i){t!==i&&(e.flags|=4)};function ec(n,e){if(!es)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function HF(n,e,t){var i=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Yi(e.type)&&qA(),null;case 3:return Kl(),an(Fi),an(pi),UG(),i=e.stateNode,i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(dd(e)?e.flags|=4:i.hydrate||(e.flags|=256)),Ob(e),null;case 5:DG(e);var o=Vg(uC.current);if(t=e.type,n!==null&&e.stateNode!=null)QS(n,e,t,i,o),n.ref!==e.ref&&(e.flags|=128);else{if(!i){if(e.stateNode===null)throw Error(Ne(166));return null}if(n=Vg($o.current),dd(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[pr]=e,i[jA]=s,t){case"dialog":sn("cancel",i),sn("close",i);break;case"iframe":case"object":case"embed":sn("load",i);break;case"video":case"audio":for(n=0;n<wc.length;n++)sn(wc[n],i);break;case"source":sn("error",i);break;case"img":case"image":case"link":sn("error",i),sn("load",i);break;case"details":sn("toggle",i);break;case"input":hZ(i,s),sn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},sn("invalid",i);break;case"textarea":mZ(i,s),sn("invalid",i)}Vb(t,s),n=null;for(var r in s)s.hasOwnProperty(r)&&(o=s[r],r==="children"?typeof o=="string"?i.textContent!==o&&(n=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(n=["children",""+o]):tC.hasOwnProperty(r)&&o!=null&&r==="onScroll"&&sn("scroll",i));switch(t){case"input":ad(i),pZ(i,s,!0);break;case"textarea":ad(i),fZ(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=OA)}i=n,e.updateQueue=i,i!==null&&(e.flags|=4)}else{switch(r=o.nodeType===9?o:o.ownerDocument,n===Wb.html&&(n=EW(t)),n===Wb.html?t==="script"?(n=r.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=r.createElement(t,{is:i.is}):(n=r.createElement(t),t==="select"&&(r=n,i.multiple?r.multiple=!0:i.size&&(r.size=i.size))):n=r.createElementNS(n,t),n[pr]=e,n[jA]=i,PS(n,e,!1,!1),e.stateNode=n,r=xb(t,i),t){case"dialog":sn("cancel",n),sn("close",n),o=i;break;case"iframe":case"object":case"embed":sn("load",n),o=i;break;case"video":case"audio":for(o=0;o<wc.length;o++)sn(wc[o],n);o=i;break;case"source":sn("error",n),o=i;break;case"img":case"image":case"link":sn("error",n),sn("load",n),o=i;break;case"details":sn("toggle",n),o=i;break;case"input":hZ(n,i),o=yb(n,i),sn("invalid",n);break;case"option":o=wb(n,i);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},o=Cn({},i,{value:void 0}),sn("invalid",n);break;case"textarea":mZ(n,i),o=Rb(n,i),sn("invalid",n);break;default:o=i}Vb(t,o);var g=o;for(s in g)if(g.hasOwnProperty(s)){var a=g[s];s==="style"?DW(n,a):s==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&_W(n,a)):s==="children"?typeof a=="string"?(t!=="textarea"||a!=="")&&nC(n,a):typeof a=="number"&&nC(n,""+a):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(tC.hasOwnProperty(s)?a!=null&&s==="onScroll"&&sn("scroll",n):a!=null&&fG(n,s,a,r))}switch(t){case"input":ad(n),pZ(n,i,!1);break;case"textarea":ad(n),fZ(n);break;case"option":i.value!=null&&n.setAttribute("value",""+Hr(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?pl(n,!!i.multiple,s,!1):i.defaultValue!=null&&pl(n,!!i.multiple,i.defaultValue,!0);break;default:typeof o.onClick=="function"&&(n.onclick=OA)}yS(t,i)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(n&&e.stateNode!=null)OS(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ne(166));t=Vg(uC.current),Vg($o.current),dd(e)?(i=e.stateNode,t=e.memoizedProps,i[pr]=e,i.nodeValue!==t&&(e.flags|=4)):(i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[pr]=e,e.stateNode=i)}return null;case 13:return an(bn),i=e.memoizedState,(e.flags&64)!==0?(e.lanes=t,e):(i=i!==null,t=!1,n===null?e.memoizedProps.fallback!==void 0&&dd(e):t=n.memoizedState!==null,i&&!t&&(e.mode&2)!==0&&(n===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(bn.current&1)!==0?ti===0&&(ti=3):((ti===0||ti===3)&&(ti=4),bi===null||(zC&134217727)===0&&(II&134217727)===0||yl(bi,hi))),(i||t)&&(e.flags|=4),null);case 4:return Kl(),Ob(e),n===null&&bS(e.stateNode.containerInfo),null;case 10:return _G(e),null;case 17:return Yi(e.type)&&qA(),null;case 19:if(an(bn),i=e.memoizedState,i===null)return null;if(s=(e.flags&64)!==0,r=i.rendering,r===null)if(s)ec(i,!1);else{if(ti!==0||n!==null&&(n.flags&64)!==0)for(n=e.child;n!==null;){if(r=oh(n),r!==null){for(e.flags|=64,ec(i,!1),s=r.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),i.lastEffect===null&&(e.firstEffect=null),e.lastEffect=i.lastEffect,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,r=s.alternate,r===null?(s.childLanes=0,s.lanes=n,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=r.childLanes,s.lanes=r.lanes,s.child=r.child,s.memoizedProps=r.memoizedProps,s.memoizedState=r.memoizedState,s.updateQueue=r.updateQueue,s.type=r.type,n=r.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Gn(bn,bn.current&1|2),e.child}n=n.sibling}i.tail!==null&&di()>n0&&(e.flags|=64,s=!0,ec(i,!1),e.lanes=33554432)}else{if(!s)if(n=oh(r),n!==null){if(e.flags|=64,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ec(i,!0),i.tail===null&&i.tailMode==="hidden"&&!r.alternate&&!es)return e=e.lastEffect=i.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*di()-i.renderingStartTime>n0&&t!==1073741824&&(e.flags|=64,s=!0,ec(i,!1),e.lanes=33554432);i.isBackwards?(r.sibling=e.child,e.child=r):(t=i.last,t!==null?t.sibling=r:e.child=r,i.last=r)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.lastEffect=e.lastEffect,i.renderingStartTime=di(),t.sibling=null,e=bn.current,Gn(bn,s?e&1|2:e&1),t):null;case 23:case 24:return iB(),n!==null&&n.memoizedState!==null!=(e.memoizedState!==null)&&i.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(Ne(156,e.tag))}function XF(n){switch(n.tag){case 1:Yi(n.type)&&qA();var e=n.flags;return e&4096?(n.flags=e&-4097|64,n):null;case 3:if(Kl(),an(Fi),an(pi),UG(),e=n.flags,(e&64)!==0)throw Error(Ne(285));return n.flags=e&-4097|64,n;case 5:return DG(n),null;case 13:return an(bn),e=n.flags,e&4096?(n.flags=e&-4097|64,n):null;case 19:return an(bn),null;case 4:return Kl(),null;case 10:return _G(n),null;case 23:case 24:return iB(),null;default:return null}}function $G(n,e){try{var t="",i=e;do t+=uK(i),i=i.return;while(i);var o=t}catch(s){o=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:o}}function jb(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var MF=typeof WeakMap=="function"?WeakMap:Map;function jS(n,e,t){t=Zr(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){ch||(ch=!0,i0=i),jb(n,e)},t}function qS(n,e,t){t=Zr(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var o=e.value;t.payload=function(){return jb(n,e),i(o)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){typeof i!="function"&&(jo===null?jo=new Set([this]):jo.add(this),jb(n,e));var r=e.stack;this.componentDidCatch(e.value,{componentStack:r!==null?r:""})}),t}var KF=typeof WeakSet=="function"?WeakSet:Set;function pw(n){var e=n.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(t){Sr(n,t)}else e.current=null}function FF(n,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&n!==null){var t=n.memoizedProps,i=n.memoizedState;n=e.stateNode,e=n.getSnapshotBeforeUpdate(e.elementType===e.type?t:So(e.type,t),i),n.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&zG(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(Ne(163))}function YF(n,e,t){switch(t.tag){case 0:case 11:case 15:case 22:if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){n=e=e.next;do{if((n.tag&3)===3){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){n=e=e.next;do{var o=n;i=o.next,o=o.tag,(o&4)!==0&&(o&1)!==0&&(gV(t,n),JF(t,n)),n=i}while(n!==e)}return;case 1:n=t.stateNode,t.flags&4&&(e===null?n.componentDidMount():(i=t.elementType===t.type?e.memoizedProps:So(t.type,e.memoizedProps),n.componentDidUpdate(i,e.memoizedState,n.__reactInternalSnapshotBeforeUpdate))),e=t.updateQueue,e!==null&&qZ(t,e,n);return;case 3:if(e=t.updateQueue,e!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}qZ(t,e,n)}return;case 5:n=t.stateNode,e===null&&t.flags&4&&yS(t.type,t.memoizedProps)&&n.focus();return;case 6:return;case 4:return;case 12:return;case 13:t.memoizedState===null&&(t=t.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&nS(t))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(Ne(163))}function mw(n,e){for(var t=n;;){if(t.tag===5){var i=t.stateNode;if(e)i=i.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none";else{i=t.stateNode;var o=t.memoizedProps.style;o=o!=null&&o.hasOwnProperty("display")?o.display:null,i.style.display=JW("display",o)}}else if(t.tag===6)t.stateNode.nodeValue=e?"":t.memoizedProps;else if((t.tag!==23&&t.tag!==24||t.memoizedState===null||t===n)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break;for(;t.sibling===null;){if(t.return===null||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}}function fw(n,e){if(Fg&&typeof Fg.onCommitFiberUnmount=="function")try{Fg.onCommitFiberUnmount(kG,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(n=e.updateQueue,n!==null&&(n=n.lastEffect,n!==null)){var t=n=n.next;do{var i=t,o=i.destroy;if(i=i.tag,o!==void 0)if((i&4)!==0)gV(e,t);else{i=e;try{o()}catch(s){Sr(i,s)}}t=t.next}while(t!==n)}break;case 1:if(pw(e),n=e.stateNode,typeof n.componentWillUnmount=="function")try{n.props=e.memoizedProps,n.state=e.memoizedState,n.componentWillUnmount()}catch(s){Sr(e,s)}break;case 5:pw(e);break;case 4:$S(n,e)}}function bw(n){n.alternate=null,n.child=null,n.dependencies=null,n.firstEffect=null,n.lastEffect=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.return=null,n.updateQueue=null}function Gw(n){return n.tag===5||n.tag===3||n.tag===4}function Bw(n){e:{for(var e=n.return;e!==null;){if(Gw(e))break e;e=e.return}throw Error(Ne(160))}var t=e;switch(e=t.stateNode,t.tag){case 5:var i=!1;break;case 3:e=e.containerInfo,i=!0;break;case 4:e=e.containerInfo,i=!0;break;default:throw Error(Ne(161))}t.flags&16&&(nC(e,""),t.flags&=-17);e:t:for(t=n;;){for(;t.sibling===null;){if(t.return===null||Gw(t.return)){t=null;break e}t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue t;t.child.return=t,t=t.child}if(!(t.flags&2)){t=t.stateNode;break e}}i?qb(n,t,e):$b(n,t,e)}function qb(n,e,t){var i=n.tag,o=i===5||i===6;if(o)n=o?n.stateNode:n.stateNode.instance,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=OA));else if(i!==4&&(n=n.child,n!==null))for(qb(n,e,t),n=n.sibling;n!==null;)qb(n,e,t),n=n.sibling}function $b(n,e,t){var i=n.tag,o=i===5||i===6;if(o)n=o?n.stateNode:n.stateNode.instance,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for($b(n,e,t),n=n.sibling;n!==null;)$b(n,e,t),n=n.sibling}function $S(n,e){for(var t=e,i=!1,o,s;;){if(!i){i=t.return;e:for(;;){if(i===null)throw Error(Ne(160));switch(o=i.stateNode,i.tag){case 5:s=!1;break e;case 3:o=o.containerInfo,s=!0;break e;case 4:o=o.containerInfo,s=!0;break e}i=i.return}i=!0}if(t.tag===5||t.tag===6){e:for(var r=n,g=t,a=g;;)if(fw(r,a),a.child!==null&&a.tag!==4)a.child.return=a,a=a.child;else{if(a===g)break e;for(;a.sibling===null;){if(a.return===null||a.return===g)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}s?(r=o,g=t.stateNode,r.nodeType===8?r.parentNode.removeChild(g):r.removeChild(g)):o.removeChild(t.stateNode)}else if(t.tag===4){if(t.child!==null){o=t.stateNode.containerInfo,s=!0,t.child.return=t,t=t.child;continue}}else if(fw(n,t),t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return,t.tag===4&&(i=!1)}t.sibling.return=t.return,t=t.sibling}}function hf(n,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var t=e.updateQueue;if(t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do(i.tag&3)===3&&(n=i.destroy,i.destroy=void 0,n!==void 0&&n()),i=i.next;while(i!==t)}return;case 1:return;case 5:if(t=e.stateNode,t!=null){i=e.memoizedProps;var o=n!==null?n.memoizedProps:i;n=e.type;var s=e.updateQueue;if(e.updateQueue=null,s!==null){for(t[jA]=i,n==="input"&&i.type==="radio"&&i.name!=null&&kW(t,i),xb(n,o),e=xb(n,i),o=0;o<s.length;o+=2){var r=s[o],g=s[o+1];r==="style"?DW(t,g):r==="dangerouslySetInnerHTML"?_W(t,g):r==="children"?nC(t,g):fG(t,r,g,e)}switch(n){case"input":vb(t,i);break;case"textarea":TW(t,i);break;case"select":n=t._wrapperState.wasMultiple,t._wrapperState.wasMultiple=!!i.multiple,s=i.value,s!=null?pl(t,!!i.multiple,s,!1):n!==!!i.multiple&&(i.defaultValue!=null?pl(t,!!i.multiple,i.defaultValue,!0):pl(t,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(Ne(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:t=e.stateNode,t.hydrate&&(t.hydrate=!1,nS(t.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(nB=di(),mw(e.child,!0)),yw(e);return;case 19:yw(e);return;case 17:return;case 23:case 24:mw(e,e.memoizedState!==null);return}throw Error(Ne(163))}function yw(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new KF),e.forEach(function(i){var o=PF.bind(null,n,i);t.has(i)||(t.add(i),i.then(o,o))})}}function NF(n,e){return n!==null&&(n=n.memoizedState,n===null||n.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var LF=Math.ceil,Ih=aa.ReactCurrentDispatcher,eB=aa.ReactCurrentOwner,dt=0,bi=null,zn=null,hi=0,Dg=0,e0=Dr(0),ti=0,Kh=null,lI=0,zC=0,II=0,tB=0,t0=null,nB=0,n0=1/0;function cI(){n0=di()+500}var je=null,ch=!1,i0=null,jo=null,Kr=!1,Tc=null,Rc=90,o0=[],s0=[],Xs=null,Ec=0,r0=null,RA=-1,Ss=0,WA=0,_c=null,SA=!1;function Ui(){return(dt&48)!==0?di():RA!==-1?RA:RA=di()}function Rr(n){if(n=n.mode,(n&2)===0)return 1;if((n&4)===0)return Ml()===99?1:2;if(Ss===0&&(Ss=lI),wF.transition!==0){WA!==0&&(WA=t0!==null?t0.pendingLanes:0),n=Ss;var e=4186112&~WA;return e&=-e,e===0&&(n=4186112&~n,e=n&-n,e===0&&(e=8192)),e}return n=Ml(),(dt&4)!==0&&n===98?n=PA(12,Ss):(n=SK(n),n=PA(n,Ss)),n}function Wr(n,e,t){if(50<Ec)throw Ec=0,r0=null,Error(Ne(185));if(n=Fh(n,e),n===null)return null;Wh(n,e,t),n===bi&&(II|=e,ti===4&&yl(n,hi));var i=Ml();e===1?(dt&8)!==0&&(dt&48)===0?g0(n):(Co(n,t),dt===0&&(cI(),ls())):((dt&4)===0||i!==98&&i!==99||(Xs===null?Xs=new Set([n]):Xs.add(n)),Co(n,t)),t0=n}function Fh(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}function Co(n,e){for(var t=n.callbackNode,i=n.suspendedLanes,o=n.pingedLanes,s=n.expirationTimes,r=n.pendingLanes;0<r;){var g=31-Xr(r),a=1<<g,l=s[g];if(l===-1){if((a&i)===0||(a&o)!==0){l=e,el(a);var u=$t;s[g]=10<=u?l+250:6<=u?l+5e3:-1}}else l<=e&&(n.expiredLanes|=a);r&=~a}if(i=rC(n,n===bi?hi:0),e=$t,i===0)t!==null&&(t!==cf&&Tb(t),n.callbackNode=null,n.callbackPriority=0);else{if(t!==null){if(n.callbackPriority===e)return;t!==cf&&Tb(t)}e===15?(t=g0.bind(null,n),Ws===null?(Ws=[t],wA=TG(Xh,xS)):Ws.push(t),t=cf):e===14?t=IC(99,g0.bind(null,n)):(t=VK(e),t=IC(t,eV.bind(null,n))),n.callbackPriority=e,n.callbackNode=t}}function eV(n){if(RA=-1,WA=Ss=0,(dt&48)!==0)throw Error(Ne(327));var e=n.callbackNode;if(Ur()&&n.callbackNode!==e)return null;var t=rC(n,n===bi?hi:0);if(t===0)return null;var i=t,o=dt;dt|=16;var s=oV();(bi!==n||hi!==i)&&(cI(),vl(n,i));do try{TF();break}catch(g){iV(n,g)}while(1);if(EG(),Ih.current=s,dt=o,zn!==null?i=0:(bi=null,hi=0,i=ti),(lI&II)!==0)vl(n,0);else if(i!==0){if(i===2&&(dt|=64,n.hydrate&&(n.hydrate=!1,zG(n.containerInfo)),t=lS(n),t!==0&&(i=Wc(n,t))),i===1)throw e=Kh,vl(n,0),yl(n,t),Co(n,di()),e;switch(n.finishedWork=n.current.alternate,n.finishedLanes=t,i){case 0:case 1:throw Error(Ne(345));case 2:fg(n);break;case 3:if(yl(n,t),(t&62914560)===t&&(i=nB+500-di(),10<i)){if(rC(n,0)!==0)break;if(o=n.suspendedLanes,(o&t)!==t){Ui(),n.pingedLanes|=n.suspendedLanes&o;break}n.timeoutHandle=_Z(fg.bind(null,n),i);break}fg(n);break;case 4:if(yl(n,t),(t&4186112)===t)break;for(i=n.eventTimes,o=-1;0<t;){var r=31-Xr(t);s=1<<r,r=i[r],r>o&&(o=r),t&=~s}if(t=o,t=di()-t,t=(120>t?120:480>t?480:1080>t?1080:1920>t?1920:3e3>t?3e3:4320>t?4320:1960*LF(t/1960))-t,10<t){n.timeoutHandle=_Z(fg.bind(null,n),t);break}fg(n);break;case 5:fg(n);break;default:throw Error(Ne(329))}}return Co(n,di()),n.callbackNode===e?eV.bind(null,n):null}function yl(n,e){for(e&=~tB,e&=~II,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Xr(e),i=1<<t;n[t]=-1,e&=~i}}function g0(n){if((dt&48)!==0)throw Error(Ne(327));if(Ur(),n===bi&&(n.expiredLanes&hi)!==0){var e=hi,t=Wc(n,e);(lI&II)!==0&&(e=rC(n,e),t=Wc(n,e))}else e=rC(n,0),t=Wc(n,e);if(n.tag!==0&&t===2&&(dt|=64,n.hydrate&&(n.hydrate=!1,zG(n.containerInfo)),e=lS(n),e!==0&&(t=Wc(n,e))),t===1)throw t=Kh,vl(n,0),yl(n,e),Co(n,di()),t;return n.finishedWork=n.current.alternate,n.finishedLanes=e,fg(n),Co(n,di()),null}function zF(){if(Xs!==null){var n=Xs;Xs=null,n.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,Co(e,di())})}ls()}function tV(n,e){var t=dt;dt|=1;try{return n(e)}finally{dt=t,dt===0&&(cI(),ls())}}function nV(n,e){var t=dt;dt&=-2,dt|=8;try{return n(e)}finally{dt=t,dt===0&&(cI(),ls())}}function hd(n,e){Gn(e0,Dg),Dg|=e,lI|=e}function iB(){Dg=e0.current,an(e0)}function vl(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,bF(t)),zn!==null)for(t=zn.return;t!==null;){var i=t;switch(i.tag){case 1:i=i.type.childContextTypes,i!=null&&qA();break;case 3:Kl(),an(Fi),an(pi),UG();break;case 5:DG(i);break;case 4:Kl();break;case 13:an(bn);break;case 19:an(bn);break;case 10:_G(i);break;case 23:case 24:iB()}t=t.return}bi=n,zn=Fr(n.current,null),hi=Dg=lI=e,ti=0,Kh=null,tB=II=zC=0}function iV(n,e){do{var t=zn;try{if(EG(),zc.current=lh,sh){for(var i=Vn.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}sh=!1}if(dC=0,ei=Ci=Vn=null,kc=!1,eB.current=null,t===null||t.return===null){ti=1,Kh=e,zn=null;break}e:{var s=n,r=t.return,g=t,a=e;if(e=hi,g.flags|=2048,g.firstEffect=g.lastEffect=null,a!==null&&typeof a=="object"&&typeof a.then=="function"){var l=a;if((g.mode&2)===0){var u=g.alternate;u?(g.updateQueue=u.updateQueue,g.memoizedState=u.memoizedState,g.lanes=u.lanes):(g.updateQueue=null,g.memoizedState=null)}var d=(bn.current&1)!==0,C=r;do{var A;if(A=C.tag===13){var f=C.memoizedState;if(f!==null)A=f.dehydrated!==null;else{var b=C.memoizedProps;A=b.fallback===void 0?!1:b.unstable_avoidThisFallback!==!0?!0:!d}}if(A){var G=C.updateQueue;if(G===null){var m=new Set;m.add(l),C.updateQueue=m}else G.add(l);if((C.mode&2)===0){if(C.flags|=64,g.flags|=16384,g.flags&=-2981,g.tag===1)if(g.alternate===null)g.tag=17;else{var h=Zr(-1,1);h.tag=2,wr(g,h)}g.lanes|=1;break e}a=void 0,g=e;var B=s.pingCache;if(B===null?(B=s.pingCache=new MF,a=new Set,B.set(l,a)):(a=B.get(l),a===void 0&&(a=new Set,B.set(l,a))),!a.has(g)){a.add(g);var y=UF.bind(null,s,l,g);l.then(y,y)}C.flags|=4096,C.lanes=e;break e}C=C.return}while(C!==null);a=Error((hl(g.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}ti!==5&&(ti=2),a=$G(a,g),C=r;do{switch(C.tag){case 3:s=a,C.flags|=4096,e&=-e,C.lanes|=e;var Z=jS(C,s,e);jZ(C,Z);break e;case 1:s=a;var R=C.type,W=C.stateNode;if((C.flags&64)===0&&(typeof R.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(jo===null||!jo.has(W)))){C.flags|=4096,e&=-e,C.lanes|=e;var x=qS(C,s,e);jZ(C,x);break e}}C=C.return}while(C!==null)}rV(t)}catch(X){e=X,zn===t&&t!==null&&(zn=t=t.return);continue}break}while(1)}function oV(){var n=Ih.current;return Ih.current=lh,n===null?lh:n}function Wc(n,e){var t=dt;dt|=16;var i=oV();bi===n&&hi===e||vl(n,e);do try{kF();break}catch(o){iV(n,o)}while(1);if(EG(),dt=t,Ih.current=i,zn!==null)throw Error(Ne(261));return bi=null,hi=0,ti}function kF(){for(;zn!==null;)sV(zn)}function TF(){for(;zn!==null&&!yF();)sV(zn)}function sV(n){var e=aV(n.alternate,n,Dg);n.memoizedProps=n.pendingProps,e===null?rV(n):zn=e,eB.current=null}function rV(n){var e=n;do{var t=e.alternate;if(n=e.return,(e.flags&2048)===0){if(t=HF(t,e,Dg),t!==null){zn=t;return}if(t=e,t.tag!==24&&t.tag!==23||t.memoizedState===null||(Dg&1073741824)!==0||(t.mode&4)===0){for(var i=0,o=t.child;o!==null;)i|=o.lanes|o.childLanes,o=o.sibling;t.childLanes=i}n!==null&&(n.flags&2048)===0&&(n.firstEffect===null&&(n.firstEffect=e.firstEffect),e.lastEffect!==null&&(n.lastEffect!==null&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.flags&&(n.lastEffect!==null?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(t=XF(e),t!==null){t.flags&=2047,zn=t;return}n!==null&&(n.firstEffect=n.lastEffect=null,n.flags|=2048)}if(e=e.sibling,e!==null){zn=e;return}zn=e=n}while(e!==null);ti===0&&(ti=5)}function fg(n){var e=Ml();return Jg(99,EF.bind(null,n,e)),null}function EF(n,e){do Ur();while(Tc!==null);if((dt&48)!==0)throw Error(Ne(327));var t=n.finishedWork;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Ne(177));n.callbackNode=null;var i=t.lanes|t.childLanes,o=i,s=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;for(var r=n.eventTimes,g=n.expirationTimes;0<s;){var a=31-Xr(s),l=1<<a;o[a]=0,r[a]=-1,g[a]=-1,s&=~l}if(Xs!==null&&(i&24)===0&&Xs.has(n)&&Xs.delete(n),n===bi&&(zn=bi=null,hi=0),1<t.flags?t.lastEffect!==null?(t.lastEffect.nextEffect=t,i=t.firstEffect):i=t:i=t.firstEffect,i!==null){if(o=dt,dt|=32,eB.current=null,af=BA,r=YZ(),Yb(r)){if("selectionStart"in r)g={start:r.selectionStart,end:r.selectionEnd};else e:if(g=(g=r.ownerDocument)&&g.defaultView||window,(l=g.getSelection&&g.getSelection())&&l.rangeCount!==0){g=l.anchorNode,s=l.anchorOffset,a=l.focusNode,l=l.focusOffset;try{g.nodeType,a.nodeType}catch{g=null;break e}var u=0,d=-1,C=-1,A=0,f=0,b=r,G=null;t:for(;;){for(var m;b!==g||s!==0&&b.nodeType!==3||(d=u+s),b!==a||l!==0&&b.nodeType!==3||(C=u+l),b.nodeType===3&&(u+=b.nodeValue.length),(m=b.firstChild)!==null;)G=b,b=m;for(;;){if(b===r)break t;if(G===g&&++A===s&&(d=u),G===a&&++f===l&&(C=u),(m=b.nextSibling)!==null)break;b=G,G=b.parentNode}b=m}g=d===-1||C===-1?null:{start:d,end:C}}else g=null;g=g||{start:0,end:0}}else g=null;lf={focusedElem:r,selectionRange:g},BA=!1,_c=null,SA=!1,je=i;do try{_F()}catch(X){if(je===null)throw Error(Ne(330));Sr(je,X),je=je.nextEffect}while(je!==null);_c=null,je=i;do try{for(r=n;je!==null;){var h=je.flags;if(h&16&&nC(je.stateNode,""),h&128){var B=je.alternate;if(B!==null){var y=B.ref;y!==null&&(typeof y=="function"?y(null):y.current=null)}}switch(h&1038){case 2:Bw(je),je.flags&=-3;break;case 6:Bw(je),je.flags&=-3,hf(je.alternate,je);break;case 1024:je.flags&=-1025;break;case 1028:je.flags&=-1025,hf(je.alternate,je);break;case 4:hf(je.alternate,je);break;case 8:g=je,$S(r,g);var Z=g.alternate;bw(g),Z!==null&&bw(Z)}je=je.nextEffect}}catch(X){if(je===null)throw Error(Ne(330));Sr(je,X),je=je.nextEffect}while(je!==null);if(y=lf,B=YZ(),h=y.focusedElem,r=y.selectionRange,B!==h&&h&&h.ownerDocument&&pS(h.ownerDocument.documentElement,h)){for(r!==null&&Yb(h)&&(B=r.start,y=r.end,y===void 0&&(y=B),"selectionStart"in h?(h.selectionStart=B,h.selectionEnd=Math.min(y,h.value.length)):(y=(B=h.ownerDocument||document)&&B.defaultView||window,y.getSelection&&(y=y.getSelection(),g=h.textContent.length,Z=Math.min(r.start,g),r=r.end===void 0?Z:Math.min(r.end,g),!y.extend&&Z>r&&(g=r,r=Z,Z=g),g=FZ(h,Z),s=FZ(h,r),g&&s&&(y.rangeCount!==1||y.anchorNode!==g.node||y.anchorOffset!==g.offset||y.focusNode!==s.node||y.focusOffset!==s.offset)&&(B=B.createRange(),B.setStart(g.node,g.offset),y.removeAllRanges(),Z>r?(y.addRange(B),y.extend(s.node,s.offset)):(B.setEnd(s.node,s.offset),y.addRange(B)))))),B=[],y=h;y=y.parentNode;)y.nodeType===1&&B.push({element:y,left:y.scrollLeft,top:y.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<B.length;h++)y=B[h],y.element.scrollLeft=y.left,y.element.scrollTop=y.top}BA=!!af,lf=af=null,n.current=t,je=i;do try{for(h=n;je!==null;){var R=je.flags;if(R&36&&YF(h,je.alternate,je),R&128){B=void 0;var W=je.ref;if(W!==null){var x=je.stateNode;switch(je.tag){case 5:B=x;break;default:B=x}typeof W=="function"?W(B):W.current=B}}je=je.nextEffect}}catch(X){if(je===null)throw Error(Ne(330));Sr(je,X),je=je.nextEffect}while(je!==null);je=null,ZF(),dt=o}else n.current=t;if(Kr)Kr=!1,Tc=n,Rc=e;else for(je=i;je!==null;)e=je.nextEffect,je.nextEffect=null,je.flags&8&&(R=je,R.sibling=null,R.stateNode=null),je=e;if(i=n.pendingLanes,i===0&&(jo=null),i===1?n===r0?Ec++:(Ec=0,r0=n):Ec=0,t=t.stateNode,Fg&&typeof Fg.onCommitFiberRoot=="function")try{Fg.onCommitFiberRoot(kG,t,void 0,(t.current.flags&64)===64)}catch{}if(Co(n,di()),ch)throw ch=!1,n=i0,i0=null,n;return(dt&8)!==0||ls(),null}function _F(){for(;je!==null;){var n=je.alternate;SA||_c===null||((je.flags&8)!==0?BZ(je,_c)&&(SA=!0):je.tag===13&&NF(n,je)&&BZ(je,_c)&&(SA=!0));var e=je.flags;(e&256)!==0&&FF(n,je),(e&512)===0||Kr||(Kr=!0,IC(97,function(){return Ur(),null})),je=je.nextEffect}}function Ur(){if(Rc!==90){var n=97<Rc?97:Rc;return Rc=90,Jg(n,DF)}return!1}function JF(n,e){o0.push(e,n),Kr||(Kr=!0,IC(97,function(){return Ur(),null}))}function gV(n,e){s0.push(e,n),Kr||(Kr=!0,IC(97,function(){return Ur(),null}))}function DF(){if(Tc===null)return!1;var n=Tc;if(Tc=null,(dt&48)!==0)throw Error(Ne(331));var e=dt;dt|=32;var t=s0;s0=[];for(var i=0;i<t.length;i+=2){var o=t[i],s=t[i+1],r=o.destroy;if(o.destroy=void 0,typeof r=="function")try{r()}catch(a){if(s===null)throw Error(Ne(330));Sr(s,a)}}for(t=o0,o0=[],i=0;i<t.length;i+=2){o=t[i],s=t[i+1];try{var g=o.create;o.destroy=g()}catch(a){if(s===null)throw Error(Ne(330));Sr(s,a)}}for(g=n.current.firstEffect;g!==null;)n=g.nextEffect,g.nextEffect=null,g.flags&8&&(g.sibling=null,g.stateNode=null),g=n;return dt=e,ls(),!0}function vw(n,e,t){e=$G(t,e),e=jS(n,e,1),wr(n,e),e=Ui(),n=Fh(n,1),n!==null&&(Wh(n,1,e),Co(n,e))}function Sr(n,e){if(n.tag===3)vw(n,n,e);else for(var t=n.return;t!==null;){if(t.tag===3){vw(t,n,e);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(jo===null||!jo.has(i))){n=$G(e,n);var o=qS(t,n,1);if(wr(t,o),o=Ui(),t=Fh(t,1),t!==null)Wh(t,1,o),Co(t,o);else if(typeof i.componentDidCatch=="function"&&(jo===null||!jo.has(i)))try{i.componentDidCatch(e,n)}catch{}break}}t=t.return}}function UF(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Ui(),n.pingedLanes|=n.suspendedLanes&t,bi===n&&(hi&t)===t&&(ti===4||ti===3&&(hi&62914560)===hi&&500>di()-nB?vl(n,0):tB|=t),Co(n,e)}function PF(n,e){var t=n.stateNode;t!==null&&t.delete(e),e=0,e===0&&(e=n.mode,(e&2)===0?e=1:(e&4)===0?e=Ml()===99?1:2:(Ss===0&&(Ss=lI),e=tl(62914560&~Ss),e===0&&(e=4194304))),t=Ui(),n=Fh(n,e),n!==null&&(Wh(n,e,t),Co(n,t))}var aV;aV=function(n,e,t){var i=e.lanes;if(n!==null)if(n.memoizedProps!==e.pendingProps||Fi.current)xo=!0;else if((t&i)!==0)xo=(n.flags&16384)!==0;else{switch(xo=!1,e.tag){case 3:Iw(e),uf();break;case 5:tw(e);break;case 1:Yi(e.type)&&ZA(e);break;case 4:Jb(e,e.stateNode.containerInfo);break;case 10:i=e.memoizedProps.value;var o=e.type._context;Gn($A,o._currentValue),o._currentValue=i;break;case 13:if(e.memoizedState!==null)return(t&e.child.childLanes)!==0?cw(n,e,t):(Gn(bn,bn.current&1),e=xs(n,e,t),e!==null?e.sibling:null);Gn(bn,bn.current&1);break;case 19:if(i=(t&e.childLanes)!==0,(n.flags&64)!==0){if(i)return hw(n,e,t);e.flags|=64}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Gn(bn,bn.current),i)break;return null;case 23:case 24:return e.lanes=0,df(n,e,t)}return xs(n,e,t)}else xo=!1;switch(e.lanes=0,e.tag){case 2:if(i=e.type,n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),n=e.pendingProps,o=Xl(e,pi.current),Gl(e,t),o=QG(null,e,i,n,o,t),e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,Yi(i)){var s=!0;ZA(e)}else s=!1;e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,JG(e);var r=i.getDerivedStateFromProps;typeof r=="function"&&nh(e,i,r,n),o.updater=Mh,e.stateNode=o,o._reactInternals=e,_b(e,i,n,t),e=Qb(null,e,i,!0,s,t)}else e.tag=0,xi(null,e,o,t),e=e.child;return e;case 16:o=e.elementType;e:{switch(n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),n=e.pendingProps,s=o._init,o=s(o._payload),e.type=o,s=e.tag=OF(o),n=So(o,n),s){case 0:e=Pb(null,e,o,n,t);break e;case 1:e=lw(null,e,o,n,t);break e;case 11:e=gw(null,e,o,n,t);break e;case 14:e=aw(null,e,o,So(o.type,n),i,t);break e}throw Error(Ne(306,o,""))}return e;case 0:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:So(i,o),Pb(n,e,i,o,t);case 1:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:So(i,o),lw(n,e,i,o,t);case 3:if(Iw(e),i=e.updateQueue,n===null||i===null)throw Error(Ne(282));if(i=e.pendingProps,o=e.memoizedState,o=o!==null?o.element:null,XS(n,e),cC(e,i,null,t),i=e.memoizedState.element,i===o)uf(),e=xs(n,e,t);else{if(o=e.stateNode,(s=o.hydrate)&&(mr=bl(e.stateNode.containerInfo.firstChild),Vs=e,s=es=!0),s){if(n=o.mutableSourceEagerHydrationData,n!=null)for(o=0;o<n.length;o+=2)s=n[o],s._workInProgressVersionPrimary=n[o+1],Bl.push(s);for(t=YS(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|1024,t=t.sibling}else xi(n,e,i,t),uf();e=e.child}return e;case 5:return tw(e),n===null&&Db(e),i=e.type,o=e.pendingProps,s=n!==null?n.memoizedProps:null,r=o.children,zb(i,o)?r=null:s!==null&&zb(i,s)&&(e.flags|=16),US(n,e),xi(n,e,r,t),e.child;case 6:return n===null&&Db(e),null;case 13:return cw(n,e,t);case 4:return Jb(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=ih(e,null,i,t):xi(n,e,i,t),e.child;case 11:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:So(i,o),gw(n,e,i,o,t);case 7:return xi(n,e,e.pendingProps,t),e.child;case 8:return xi(n,e,e.pendingProps.children,t),e.child;case 12:return xi(n,e,e.pendingProps.children,t),e.child;case 10:e:{i=e.type._context,o=e.pendingProps,r=e.memoizedProps,s=o.value;var g=e.type._context;if(Gn($A,g._currentValue),g._currentValue=s,r!==null)if(g=r.value,s=ao(g,s)?0:(typeof i._calculateChangedBits=="function"?i._calculateChangedBits(g,s):1073741823)|0,s===0){if(r.children===o.children&&!Fi.current){e=xs(n,e,t);break e}}else for(g=e.child,g!==null&&(g.return=e);g!==null;){var a=g.dependencies;if(a!==null){r=g.child;for(var l=a.firstContext;l!==null;){if(l.context===i&&(l.observedBits&s)!==0){g.tag===1&&(l=Zr(-1,t&-t),l.tag=2,wr(g,l)),g.lanes|=t,l=g.alternate,l!==null&&(l.lanes|=t),HS(g.return,t),a.lanes|=t;break}l=l.next}}else r=g.tag===10&&g.type===e.type?null:g.child;if(r!==null)r.return=g;else for(r=g;r!==null;){if(r===e){r=null;break}if(g=r.sibling,g!==null){g.return=r.return,r=g;break}r=r.return}g=r}xi(n,e,o.children,t),e=e.child}return e;case 9:return o=e.type,s=e.pendingProps,i=s.children,Gl(e,t),o=co(o,s.unstable_observedBits),i=i(o),e.flags|=1,xi(n,e,i,t),e.child;case 14:return o=e.type,s=So(o,e.pendingProps),s=So(o.type,s),aw(n,e,o,s,i,t);case 15:return DS(n,e,e.type,e.pendingProps,i,t);case 17:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:So(i,o),n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,Yi(i)?(n=!0,ZA(e)):n=!1,Gl(e,t),KS(e,i,o),_b(e,i,o,t),Qb(null,e,i,!0,n,t);case 19:return hw(n,e,t);case 23:return df(n,e,t);case 24:return df(n,e,t)}throw Error(Ne(156,e.tag))};function QF(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function lo(n,e,t,i){return new QF(n,e,t,i)}function oB(n){return n=n.prototype,!(!n||!n.isReactComponent)}function OF(n){if(typeof n=="function")return oB(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Zh)return 11;if(n===wh)return 14}return 2}function Fr(n,e){var t=n.alternate;return t===null?(t=lo(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.nextEffect=null,t.firstEffect=null,t.lastEffect=null),t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function VA(n,e,t,i,o,s){var r=2;if(i=n,typeof n=="function")oB(n)&&(r=1);else if(typeof n=="string")r=5;else e:switch(n){case Ar:return Zl(t.children,o,s,e);case NW:r=8,o|=16;break;case bG:r=8,o|=1;break;case Xc:return n=lo(12,t,e,o|8),n.elementType=Xc,n.type=Xc,n.lanes=s,n;case Mc:return n=lo(13,t,e,o),n.type=Mc,n.elementType=Mc,n.lanes=s,n;case _A:return n=lo(19,t,e,o),n.elementType=_A,n.lanes=s,n;case wG:return sB(t,o,s,e);case Bb:return n=lo(24,t,e,o),n.elementType=Bb,n.lanes=s,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case GG:r=10;break e;case BG:r=9;break e;case Zh:r=11;break e;case wh:r=14;break e;case yG:r=16,i=null;break e;case vG:r=22;break e}throw Error(Ne(130,n==null?n:typeof n,""))}return e=lo(r,t,e,o),e.elementType=n,e.type=i,e.lanes=s,e}function Zl(n,e,t,i){return n=lo(7,n,i,e),n.lanes=t,n}function sB(n,e,t,i){return n=lo(23,n,i,e),n.elementType=wG,n.lanes=t,n}function pf(n,e,t){return n=lo(6,n,null,e),n.lanes=t,n}function mf(n,e,t){return e=lo(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function jF(n,e,t){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=t,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=ef(0),this.expirationTimes=ef(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ef(0),this.mutableSourceEagerHydrationData=null}function qF(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rg,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function Ch(n,e,t,i){var o=e.current,s=Ui(),r=Rr(o);e:if(t){t=t._reactInternals;t:{if(la(t)!==t||t.tag!==1)throw Error(Ne(170));var g=t;do{switch(g.tag){case 3:g=g.stateNode.context;break t;case 1:if(Yi(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break t}}g=g.return}while(g!==null);throw Error(Ne(171))}if(t.tag===1){var a=t.type;if(Yi(a)){t=ZS(t,a,g);break e}}t=g}else t=Mr;return e.context===null?e.context=t:e.pendingContext=t,e=Zr(s,r),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),wr(o,e),Wr(o,r,s),r}function ff(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Zw(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function rB(n,e){Zw(n,e),(n=n.alternate)&&Zw(n,e)}function $F(){return null}function gB(n,e,t){var i=t!=null&&t.hydrationOptions!=null&&t.hydrationOptions.mutableSources||null;if(t=new jF(n,e,t!=null&&t.hydrate===!0),e=lo(3,null,null,e===2?7:e===1?3:0),t.current=e,e.stateNode=t,JG(e),n[aI]=t.current,bS(n.nodeType===8?n.parentNode:n),i)for(n=0;n<i.length;n++){e=i[n];var o=e._getVersion;o=o(e._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[e,o]:t.mutableSourceEagerHydrationData.push(e,o)}this._internalRoot=t}gB.prototype.render=function(n){Ch(n,this._internalRoot,null,null)};gB.prototype.unmount=function(){var n=this._internalRoot,e=n.containerInfo;Ch(null,n,null,function(){e[aI]=null})};function kC(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function eY(n,e){if(e||(e=n?n.nodeType===9?n.documentElement:n.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var t;t=n.lastChild;)n.removeChild(t);return new gB(n,0,e?{hydrate:!0}:void 0)}function Yh(n,e,t,i,o){var s=t._reactRootContainer;if(s){var r=s._internalRoot;if(typeof o=="function"){var g=o;o=function(){var l=ff(r);g.call(l)}}Ch(e,r,n,o)}else{if(s=t._reactRootContainer=eY(t,i),r=s._internalRoot,typeof o=="function"){var a=o;o=function(){var l=ff(r);a.call(l)}}nV(function(){Ch(e,r,n,o)})}return ff(r)}$W=function(n){if(n.tag===13){var e=Ui();Wr(n,4,e),rB(n,4)}};xG=function(n){if(n.tag===13){var e=Ui();Wr(n,67108864,e),rB(n,67108864)}};eS=function(n){if(n.tag===13){var e=Ui(),t=Rr(n);Wr(n,t,e),rB(n,t)}};tS=function(n,e){return e()};Hb=function(n,e,t){switch(e){case"input":if(vb(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var o=Hh(i);if(!o)throw Error(Ne(90));zW(i),vb(i,o)}}}break;case"textarea":TW(n,t);break;case"select":e=t.value,e!=null&&pl(n,!!t.multiple,e,!1)}};WG=tV;QW=function(n,e,t,i,o){var s=dt;dt|=4;try{return Jg(98,n.bind(null,e,t,i,o))}finally{dt=s,dt===0&&(cI(),ls())}};SG=function(){(dt&49)===0&&(zF(),Ur())};OW=function(n,e){var t=dt;dt|=2;try{return n(e)}finally{dt=t,dt===0&&(cI(),ls())}};function lV(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!kC(e))throw Error(Ne(200));return qF(n,e,null,t)}var tY={Events:[NC,rl,Hh,UW,PW,Ur,{current:!1}]},tc={findFiberByHostInstance:Sg,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},nY={bundleType:tc.bundleType,version:tc.version,rendererPackageName:tc.rendererPackageName,rendererConfig:tc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:aa.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=qW(n),n===null?null:n.stateNode},findFiberByHostInstance:tc.findFiberByHostInstance||$F,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var pd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pd.isDisabled&&pd.supportsFiber)try{kG=pd.inject(nY),Fg=pd}catch{}}Ao.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tY;Ao.createPortal=lV;Ao.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Ne(188)):Error(Ne(268,Object.keys(n)));return n=qW(e),n=n===null?null:n.stateNode,n};Ao.flushSync=function(n,e){var t=dt;if((t&48)!==0)return n(e);dt|=1;try{if(n)return Jg(99,n.bind(null,e))}finally{dt=t,ls()}};Ao.hydrate=function(n,e,t){if(!kC(e))throw Error(Ne(200));return Yh(null,n,e,!0,t)};Ao.render=function(n,e,t){if(!kC(e))throw Error(Ne(200));return Yh(null,n,e,!1,t)};Ao.unmountComponentAtNode=function(n){if(!kC(n))throw Error(Ne(40));return n._reactRootContainer?(nV(function(){Yh(null,null,n,!1,function(){n._reactRootContainer=null,n[aI]=null})}),!0):!1};Ao.unstable_batchedUpdates=tV;Ao.unstable_createPortal=function(n,e){return lV(n,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Ao.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!kC(t))throw Error(Ne(200));if(n==null||n._reactInternals===void 0)throw Error(Ne(38));return Yh(n,e,t,!1,i)};Ao.version="17.0.2";function IV(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(IV)}catch(n){console.error(n)}}IV(),KW.exports=Ao;var iY=KW.exports;/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Nh="138",oY={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},sY={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},cV=0,a0=1,CV=2,rY=3,gY=0,aB=1,lB=2,ll=3,Yr=0,wn=1,Nr=2,IB=1,aY=2,Ms=0,Yg=1,l0=2,I0=3,c0=4,uV=5,Bg=100,dV=101,AV=102,C0=103,u0=104,hV=200,pV=201,mV=202,fV=203,cB=204,CB=205,bV=206,GV=207,BV=208,yV=209,vV=210,ZV=0,wV=1,RV=2,uh=3,WV=4,SV=5,VV=6,xV=7,TC=0,HV=1,XV=2,ts=0,MV=1,KV=2,FV=3,uB=4,YV=5,Lh=300,Lr=301,zr=302,AC=303,hC=304,CI=306,EC=307,kr=1e3,ui=1001,Fl=1002,Rn=1003,pC=1004,lY=1004,mC=1005,IY=1005,gn=1006,zh=1007,cY=1007,ks=1008,CY=1008,Tr=1009,NV=1010,LV=1011,Yl=1012,zV=1013,Jc=1014,Hs=1015,Ng=1016,kV=1017,TV=1018,Lg=1020,EV=1021,_V=1022,Ai=1023,JV=1024,DV=1025,Vr=1026,Ug=1027,UV=1028,PV=1029,QV=1030,OV=1031,jV=1033,xA=33776,HA=33777,XA=33778,MA=33779,d0=35840,A0=35841,h0=35842,p0=35843,qV=36196,m0=37492,f0=37496,b0=37808,G0=37809,B0=37810,y0=37811,v0=37812,Z0=37813,w0=37814,R0=37815,W0=37816,S0=37817,V0=37818,x0=37819,H0=37820,X0=37821,M0=36492,$V=2200,ex=2201,tx=2202,Nl=2300,Pg=2301,KA=2302,Hg=2400,Xg=2401,fC=2402,kh=2500,dB=2501,nx=0,ix=1,AB=2,Xo=3e3,Lt=3001,ox=3200,sx=3201,Pr=0,rx=1,uY=0,FA=7680,dY=7681,AY=7682,hY=7683,pY=34055,mY=34056,fY=5386,bY=512,GY=513,BY=514,yY=515,vY=516,ZY=517,wY=518,gx=519,Ll=35044,Qg=35048,RY=35040,WY=35045,SY=35049,VY=35041,xY=35046,HY=35050,XY=35042,MY="100",K0="300 es",dh=1035;class Qr{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const o=this._listeners[e];if(o!==void 0){const s=o.indexOf(t);s!==-1&&o.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const o=i.slice(0);for(let s=0,r=o.length;s<r;s++)o[s].call(this,e);e.target=null}}}const $n=[];for(let n=0;n<256;n++)$n[n]=(n<16?"0":"")+n.toString(16);let md=1234567;const zg=Math.PI/180,bC=180/Math.PI;function Pi(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return($n[n&255]+$n[n>>8&255]+$n[n>>16&255]+$n[n>>24&255]+"-"+$n[e&255]+$n[e>>8&255]+"-"+$n[e>>16&15|64]+$n[e>>24&255]+"-"+$n[t&63|128]+$n[t>>8&255]+"-"+$n[t>>16&255]+$n[t>>24&255]+$n[i&255]+$n[i>>8&255]+$n[i>>16&255]+$n[i>>24&255]).toUpperCase()}function ni(n,e,t){return Math.max(e,Math.min(t,n))}function hB(n,e){return(n%e+e)%e}function KY(n,e,t,i,o){return i+(n-e)*(o-i)/(t-e)}function FY(n,e,t){return n!==e?(t-n)/(e-n):0}function Dc(n,e,t){return(1-t)*n+t*e}function YY(n,e,t,i){return Dc(n,e,1-Math.exp(-t*i))}function NY(n,e=1){return e-Math.abs(hB(n,e*2)-e)}function LY(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function zY(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function kY(n,e){return n+Math.floor(Math.random()*(e-n+1))}function TY(n,e){return n+Math.random()*(e-n)}function EY(n){return n*(.5-Math.random())}function _Y(n){return n!==void 0&&(md=n%2147483647),md=md*16807%2147483647,(md-1)/2147483646}function JY(n){return n*zg}function DY(n){return n*bC}function F0(n){return(n&n-1)===0&&n!==0}function ax(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Ah(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function UY(n,e,t,i,o){const s=Math.cos,r=Math.sin,g=s(t/2),a=r(t/2),l=s((e+i)/2),u=r((e+i)/2),d=s((e-i)/2),C=r((e-i)/2),A=s((i-e)/2),f=r((i-e)/2);switch(o){case"XYX":n.set(g*u,a*d,a*C,g*l);break;case"YZY":n.set(a*C,g*u,a*d,g*l);break;case"ZXZ":n.set(a*d,a*C,g*u,g*l);break;case"XZX":n.set(g*u,a*f,a*A,g*l);break;case"YXY":n.set(a*A,g*u,a*f,g*l);break;case"ZYZ":n.set(a*f,a*A,g*u,g*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}var Y0=Object.freeze({__proto__:null,DEG2RAD:zg,RAD2DEG:bC,generateUUID:Pi,clamp:ni,euclideanModulo:hB,mapLinear:KY,inverseLerp:FY,lerp:Dc,damp:YY,pingpong:NY,smoothstep:LY,smootherstep:zY,randInt:kY,randFloat:TY,randFloatSpread:EY,seededRandom:_Y,degToRad:JY,radToDeg:DY,isPowerOfTwo:F0,ceilPowerOfTwo:ax,floorPowerOfTwo:Ah,setQuaternionFromProperEuler:UY});class Se{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6],this.y=o[1]*t+o[4]*i+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),o=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=s*i-r*o+e.x,this.y=s*o+r*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Se.prototype.isVector2=!0;class kn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,o,s,r,g,a,l){const u=this.elements;return u[0]=e,u[1]=o,u[2]=g,u[3]=t,u[4]=s,u[5]=a,u[6]=i,u[7]=r,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,s=this.elements,r=i[0],g=i[3],a=i[6],l=i[1],u=i[4],d=i[7],C=i[2],A=i[5],f=i[8],b=o[0],G=o[3],m=o[6],h=o[1],B=o[4],y=o[7],Z=o[2],R=o[5],W=o[8];return s[0]=r*b+g*h+a*Z,s[3]=r*G+g*B+a*R,s[6]=r*m+g*y+a*W,s[1]=l*b+u*h+d*Z,s[4]=l*G+u*B+d*R,s[7]=l*m+u*y+d*W,s[2]=C*b+A*h+f*Z,s[5]=C*G+A*B+f*R,s[8]=C*m+A*y+f*W,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],o=e[2],s=e[3],r=e[4],g=e[5],a=e[6],l=e[7],u=e[8];return t*r*u-t*g*l-i*s*u+i*g*a+o*s*l-o*r*a}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],s=e[3],r=e[4],g=e[5],a=e[6],l=e[7],u=e[8],d=u*r-g*l,C=g*a-u*s,A=l*s-r*a,f=t*d+i*C+o*A;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/f;return e[0]=d*b,e[1]=(o*l-u*i)*b,e[2]=(g*i-o*r)*b,e[3]=C*b,e[4]=(u*t-o*a)*b,e[5]=(o*s-g*t)*b,e[6]=A*b,e[7]=(i*a-l*t)*b,e[8]=(r*t-i*s)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,o,s,r,g){const a=Math.cos(s),l=Math.sin(s);return this.set(i*a,i*l,-i*(a*r+l*g)+r+e,-o*l,o*a,-o*(-l*r+a*g)+g+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),o=this.elements,s=o[0],r=o[3],g=o[6],a=o[1],l=o[4],u=o[7];return o[0]=t*s+i*a,o[3]=t*r+i*l,o[6]=t*g+i*u,o[1]=-i*s+t*a,o[4]=-i*r+t*l,o[7]=-i*g+t*u,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<9;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}kn.prototype.isMatrix3=!0;function lx(n){for(let e=n.length-1;e>=0;--e)if(n[e]>65535)return!0;return!1}const PY={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Il(n,e){return new PY[n](e)}function GC(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const Ix={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vo={h:0,s:0,l:0},fd={h:0,s:0,l:0};function bf(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}function wl(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Gf(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}class ze{constructor(e,t,i){return t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=hB(e,1),t=ni(t,0,1),i=ni(i,0,1),t===0)this.r=this.g=this.b=i;else{const o=i<=.5?i*(1+t):i+t-i*t,s=2*i-o;this.r=bf(s,o,e+1/3),this.g=bf(s,o,e),this.b=bf(s,o,e-1/3)}return this}setStyle(e){function t(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o;const s=i[1],r=i[2];switch(s){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,t(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,t(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const g=parseFloat(o[1])/360,a=parseInt(o[2],10)/100,l=parseInt(o[3],10)/100;return t(o[4]),this.setHSL(g,a,l)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],s=o.length;if(s===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,this;if(s===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Ix[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=wl(e.r),this.g=wl(e.g),this.b=wl(e.b),this}copyLinearToSRGB(e){return this.r=Gf(e.r),this.g=Gf(e.g),this.b=Gf(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,i=this.g,o=this.b,s=Math.max(t,i,o),r=Math.min(t,i,o);let g,a;const l=(r+s)/2;if(r===s)g=0,a=0;else{const u=s-r;switch(a=l<=.5?u/(s+r):u/(2-s-r),s){case t:g=(i-o)/u+(i<o?6:0);break;case i:g=(o-t)/u+2;break;case o:g=(t-i)/u+4;break}g/=6}return e.h=g,e.s=a,e.l=l,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,i){return this.getHSL(vo),vo.h+=e,vo.s+=t,vo.l+=i,this.setHSL(vo.h,vo.s,vo.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(vo),e.getHSL(fd);const i=Dc(vo.h,fd.h,t),o=Dc(vo.s,fd.s,t),s=Dc(vo.l,fd.l,t);return this.setHSL(i,o,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}ze.NAMES=Ix;ze.prototype.isColor=!0;ze.prototype.r=1;ze.prototype.g=1;ze.prototype.b=1;let Va;class Or{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Va===void 0&&(Va=GC("canvas")),Va.width=e.width,Va.height=e.height;const i=Va.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Va}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const t=GC("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const o=i.getImageData(0,0,e.width,e.height),s=o.data;for(let r=0;r<s.length;r++)s[r]=wl(s[r]/255)*255;return i.putImageData(o,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(wl(t[i]/255)*255):t[i]=wl(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class cl{constructor(e=null){this.uuid=Pi(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},o=this.data;if(o!==null){let s;if(Array.isArray(o)){s=[];for(let r=0,g=o.length;r<g;r++)o[r].isDataTexture?s.push(Bf(o[r].image)):s.push(Bf(o[r]))}else s=Bf(o);i.url=s}return t||(e.images[this.uuid]=i),i}}function Bf(n){return typeof HTMLImageElement!="undefined"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&n instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap?Or.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}cl.prototype.isSource=!0;let QY=0;class pn extends Qr{constructor(e=pn.DEFAULT_IMAGE,t=pn.DEFAULT_MAPPING,i=ui,o=ui,s=gn,r=ks,g=Ai,a=Tr,l=1,u=Xo){super();Object.defineProperty(this,"id",{value:QY++}),this.uuid=Pi(),this.name="",this.source=new cl(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=o,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=g,this.internalFormat=null,this.type=a,this.offset=new Se(0,0),this.repeat=new Se(1,1),this.center=new Se(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Lh)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case kr:e.x=e.x-Math.floor(e.x);break;case ui:e.x=e.x<0?0:1;break;case Fl:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case kr:e.y=e.y-Math.floor(e.y);break;case ui:e.y=e.y<0?0:1;break;case Fl:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}pn.DEFAULT_IMAGE=null;pn.DEFAULT_MAPPING=Lh;pn.prototype.isTexture=!0;class zt{constructor(e=0,t=0,i=0,o=1){this.x=e,this.y=t,this.z=i,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,o){return this.x=e,this.y=t,this.z=i,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,s=this.w,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*o+r[12]*s,this.y=r[1]*t+r[5]*i+r[9]*o+r[13]*s,this.z=r[2]*t+r[6]*i+r[10]*o+r[14]*s,this.w=r[3]*t+r[7]*i+r[11]*o+r[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,o,s;const a=e.elements,l=a[0],u=a[4],d=a[8],C=a[1],A=a[5],f=a[9],b=a[2],G=a[6],m=a[10];if(Math.abs(u-C)<.01&&Math.abs(d-b)<.01&&Math.abs(f-G)<.01){if(Math.abs(u+C)<.1&&Math.abs(d+b)<.1&&Math.abs(f+G)<.1&&Math.abs(l+A+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const B=(l+1)/2,y=(A+1)/2,Z=(m+1)/2,R=(u+C)/4,W=(d+b)/4,x=(f+G)/4;return B>y&&B>Z?B<.01?(i=0,o=.707106781,s=.707106781):(i=Math.sqrt(B),o=R/i,s=W/i):y>Z?y<.01?(i=.707106781,o=0,s=.707106781):(o=Math.sqrt(y),i=R/o,s=x/o):Z<.01?(i=.707106781,o=.707106781,s=0):(s=Math.sqrt(Z),i=W/s,o=x/s),this.set(i,o,s,t),this}let h=Math.sqrt((G-f)*(G-f)+(d-b)*(d-b)+(C-u)*(C-u));return Math.abs(h)<.001&&(h=1),this.x=(G-f)/h,this.y=(d-b)/h,this.z=(C-u)/h,this.w=Math.acos((l+A+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}zt.prototype.isVector4=!0;class Gi extends Qr{constructor(e,t,i={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new zt(0,0,e,t),this.scissorTest=!1,this.viewport=new zt(0,0,e,t);const o={width:e,height:t,depth:1};this.texture=new pn(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:gn,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Gi.prototype.isWebGLRenderTarget=!0;class uI extends pn{constructor(e=null,t=1,i=1,o=1){super(null);this.image={data:e,width:t,height:i,depth:o},this.magFilter=Rn,this.minFilter=Rn,this.wrapR=ui,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}uI.prototype.isDataArrayTexture=!0;class cx extends Gi{constructor(e,t,i){super(e,t);this.depth=i,this.texture=new uI(null,e,t,i),this.texture.isRenderTargetTexture=!0}}cx.prototype.isWebGLArrayRenderTarget=!0;class _C extends pn{constructor(e=null,t=1,i=1,o=1){super(null);this.image={data:e,width:t,height:i,depth:o},this.magFilter=Rn,this.minFilter=Rn,this.wrapR=ui,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}_C.prototype.isData3DTexture=!0;class Cx extends Gi{constructor(e,t,i){super(e,t);this.depth=i,this.texture=new _C(null,e,t,i),this.texture.isRenderTargetTexture=!0}}Cx.prototype.isWebGL3DRenderTarget=!0;class ux extends Gi{constructor(e,t,i,o={}){super(e,t,o);const s=this.texture;this.texture=[];for(let r=0;r<i;r++)this.texture[r]=s.clone(),this.texture[r].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let o=0,s=this.texture.length;o<s;o++)this.texture[o].image.width=e,this.texture[o].image.height=t,this.texture[o].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}ux.prototype.isWebGLMultipleRenderTargets=!0;class xn{constructor(e=0,t=0,i=0,o=1){this._x=e,this._y=t,this._z=i,this._w=o}static slerp(e,t,i,o){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,o)}static slerpFlat(e,t,i,o,s,r,g){let a=i[o+0],l=i[o+1],u=i[o+2],d=i[o+3];const C=s[r+0],A=s[r+1],f=s[r+2],b=s[r+3];if(g===0){e[t+0]=a,e[t+1]=l,e[t+2]=u,e[t+3]=d;return}if(g===1){e[t+0]=C,e[t+1]=A,e[t+2]=f,e[t+3]=b;return}if(d!==b||a!==C||l!==A||u!==f){let G=1-g;const m=a*C+l*A+u*f+d*b,h=m>=0?1:-1,B=1-m*m;if(B>Number.EPSILON){const Z=Math.sqrt(B),R=Math.atan2(Z,m*h);G=Math.sin(G*R)/Z,g=Math.sin(g*R)/Z}const y=g*h;if(a=a*G+C*y,l=l*G+A*y,u=u*G+f*y,d=d*G+b*y,G===1-g){const Z=1/Math.sqrt(a*a+l*l+u*u+d*d);a*=Z,l*=Z,u*=Z,d*=Z}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,o,s,r){const g=i[o],a=i[o+1],l=i[o+2],u=i[o+3],d=s[r],C=s[r+1],A=s[r+2],f=s[r+3];return e[t]=g*f+u*d+a*A-l*C,e[t+1]=a*f+u*C+l*d-g*A,e[t+2]=l*f+u*A+g*C-a*d,e[t+3]=u*f-g*d-a*C-l*A,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,o){return this._x=e,this._y=t,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,o=e._y,s=e._z,r=e._order,g=Math.cos,a=Math.sin,l=g(i/2),u=g(o/2),d=g(s/2),C=a(i/2),A=a(o/2),f=a(s/2);switch(r){case"XYZ":this._x=C*u*d+l*A*f,this._y=l*A*d-C*u*f,this._z=l*u*f+C*A*d,this._w=l*u*d-C*A*f;break;case"YXZ":this._x=C*u*d+l*A*f,this._y=l*A*d-C*u*f,this._z=l*u*f-C*A*d,this._w=l*u*d+C*A*f;break;case"ZXY":this._x=C*u*d-l*A*f,this._y=l*A*d+C*u*f,this._z=l*u*f+C*A*d,this._w=l*u*d-C*A*f;break;case"ZYX":this._x=C*u*d-l*A*f,this._y=l*A*d+C*u*f,this._z=l*u*f-C*A*d,this._w=l*u*d+C*A*f;break;case"YZX":this._x=C*u*d+l*A*f,this._y=l*A*d+C*u*f,this._z=l*u*f-C*A*d,this._w=l*u*d-C*A*f;break;case"XZY":this._x=C*u*d-l*A*f,this._y=l*A*d-C*u*f,this._z=l*u*f+C*A*d,this._w=l*u*d+C*A*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,o=Math.sin(i);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],o=t[4],s=t[8],r=t[1],g=t[5],a=t[9],l=t[2],u=t[6],d=t[10],C=i+g+d;if(C>0){const A=.5/Math.sqrt(C+1);this._w=.25/A,this._x=(u-a)*A,this._y=(s-l)*A,this._z=(r-o)*A}else if(i>g&&i>d){const A=2*Math.sqrt(1+i-g-d);this._w=(u-a)/A,this._x=.25*A,this._y=(o+r)/A,this._z=(s+l)/A}else if(g>d){const A=2*Math.sqrt(1+g-i-d);this._w=(s-l)/A,this._x=(o+r)/A,this._y=.25*A,this._z=(a+u)/A}else{const A=2*Math.sqrt(1+d-i-g);this._w=(r-o)/A,this._x=(s+l)/A,this._y=(a+u)/A,this._z=.25*A}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ni(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const o=Math.min(1,t/i);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,o=e._y,s=e._z,r=e._w,g=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+r*g+o*l-s*a,this._y=o*u+r*a+s*g-i*l,this._z=s*u+r*l+i*a-o*g,this._w=r*u-i*g-o*a-s*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,o=this._y,s=this._z,r=this._w;let g=r*e._w+i*e._x+o*e._y+s*e._z;if(g<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,g=-g):this.copy(e),g>=1)return this._w=r,this._x=i,this._y=o,this._z=s,this;const a=1-g*g;if(a<=Number.EPSILON){const A=1-t;return this._w=A*r+t*this._w,this._x=A*i+t*this._x,this._y=A*o+t*this._y,this._z=A*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),u=Math.atan2(l,g),d=Math.sin((1-t)*u)/l,C=Math.sin(t*u)/l;return this._w=r*d+this._w*C,this._x=i*d+this._x*C,this._y=o*d+this._y*C,this._z=s*d+this._z*C,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),o=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(o),i*Math.sin(s),i*Math.cos(s),t*Math.sin(o))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}xn.prototype.isQuaternion=!0;class K{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ww.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ww.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,o=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*o,this.y=s[1]*t+s[4]*i+s[7]*o,this.z=s[2]*t+s[5]*i+s[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,s=e.elements,r=1/(s[3]*t+s[7]*i+s[11]*o+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*o+s[12])*r,this.y=(s[1]*t+s[5]*i+s[9]*o+s[13])*r,this.z=(s[2]*t+s[6]*i+s[10]*o+s[14])*r,this}applyQuaternion(e){const t=this.x,i=this.y,o=this.z,s=e.x,r=e.y,g=e.z,a=e.w,l=a*t+r*o-g*i,u=a*i+g*t-s*o,d=a*o+s*i-r*t,C=-s*t-r*i-g*o;return this.x=l*a+C*-s+u*-g-d*-r,this.y=u*a+C*-r+d*-s-l*-g,this.z=d*a+C*-g+l*-r-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,o=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*o,this.y=s[1]*t+s[5]*i+s[9]*o,this.z=s[2]*t+s[6]*i+s[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,o=e.y,s=e.z,r=t.x,g=t.y,a=t.z;return this.x=o*a-s*g,this.y=s*r-i*a,this.z=i*g-o*r,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return yf.copy(this).projectOnVector(e),this.sub(yf)}reflect(e){return this.sub(yf.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ni(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,o=this.z-e.z;return t*t+i*i+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const o=Math.sin(t)*e;return this.x=o*Math.sin(i),this.y=Math.cos(t)*e,this.z=o*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=o,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}K.prototype.isVector3=!0;const yf=new K,ww=new xn;class ki{constructor(e=new K(1/0,1/0,1/0),t=new K(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,o=1/0,s=-1/0,r=-1/0,g=-1/0;for(let a=0,l=e.length;a<l;a+=3){const u=e[a],d=e[a+1],C=e[a+2];u<t&&(t=u),d<i&&(i=d),C<o&&(o=C),u>s&&(s=u),d>r&&(r=d),C>g&&(g=C)}return this.min.set(t,i,o),this.max.set(s,r,g),this}setFromBufferAttribute(e){let t=1/0,i=1/0,o=1/0,s=-1/0,r=-1/0,g=-1/0;for(let a=0,l=e.count;a<l;a++){const u=e.getX(a),d=e.getY(a),C=e.getZ(a);u<t&&(t=u),d<i&&(i=d),C<o&&(o=C),u>s&&(s=u),d>r&&(r=d),C>g&&(g=C)}return this.min.set(t,i,o),this.max.set(s,r,g),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=cg.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){const s=i.attributes.position;for(let r=0,g=s.count;r<g;r++)cg.fromBufferAttribute(s,r).applyMatrix4(e.matrixWorld),this.expandByPoint(cg)}else i.boundingBox===null&&i.computeBoundingBox(),vf.copy(i.boundingBox),vf.applyMatrix4(e.matrixWorld),this.union(vf);const o=e.children;for(let s=0,r=o.length;s<r;s++)this.expandByObject(o[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,cg),cg.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(nc),bd.subVectors(this.max,nc),xa.subVectors(e.a,nc),Ha.subVectors(e.b,nc),Xa.subVectors(e.c,nc),ir.subVectors(Ha,xa),or.subVectors(Xa,Ha),Cg.subVectors(xa,Xa);let t=[0,-ir.z,ir.y,0,-or.z,or.y,0,-Cg.z,Cg.y,ir.z,0,-ir.x,or.z,0,-or.x,Cg.z,0,-Cg.x,-ir.y,ir.x,0,-or.y,or.x,0,-Cg.y,Cg.x,0];return!Zf(t,xa,Ha,Xa,bd)||(t=[1,0,0,0,1,0,0,0,1],!Zf(t,xa,Ha,Xa,bd))?!1:(Gd.crossVectors(ir,or),t=[Gd.x,Gd.y,Gd.z],Zf(t,xa,Ha,Xa,bd))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return cg.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(cg).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Gs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gs),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ki.prototype.isBox3=!0;const Gs=[new K,new K,new K,new K,new K,new K,new K,new K],cg=new K,vf=new ki,xa=new K,Ha=new K,Xa=new K,ir=new K,or=new K,Cg=new K,nc=new K,bd=new K,Gd=new K,ug=new K;function Zf(n,e,t,i,o){for(let s=0,r=n.length-3;s<=r;s+=3){ug.fromArray(n,s);const g=o.x*Math.abs(ug.x)+o.y*Math.abs(ug.y)+o.z*Math.abs(ug.z),a=e.dot(ug),l=t.dot(ug),u=i.dot(ug);if(Math.max(-Math.max(a,l,u),Math.min(a,l,u))>g)return!1}return!0}const OY=new ki,Rw=new K,Bd=new K,wf=new K;class Ts{constructor(e=new K,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):OY.setFromPoints(e).getCenter(i);let o=0;for(let s=0,r=e.length;s<r;s++)o=Math.max(o,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){wf.subVectors(e,this.center);const t=wf.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),o=(i-this.radius)*.5;this.center.add(wf.multiplyScalar(o/i)),this.radius+=o}return this}union(e){return this.center.equals(e.center)===!0?Bd.set(0,0,1).multiplyScalar(e.radius):Bd.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Rw.copy(e.center).add(Bd)),this.expandByPoint(Rw.copy(e.center).sub(Bd)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Bs=new K,Rf=new K,yd=new K,sr=new K,Wf=new K,vd=new K,Sf=new K;class jr{constructor(e=new K,t=new K(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Bs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Bs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Bs.copy(this.direction).multiplyScalar(t).add(this.origin),Bs.distanceToSquared(e))}distanceSqToSegment(e,t,i,o){Rf.copy(e).add(t).multiplyScalar(.5),yd.copy(t).sub(e).normalize(),sr.copy(this.origin).sub(Rf);const s=e.distanceTo(t)*.5,r=-this.direction.dot(yd),g=sr.dot(this.direction),a=-sr.dot(yd),l=sr.lengthSq(),u=Math.abs(1-r*r);let d,C,A,f;if(u>0)if(d=r*a-g,C=r*g-a,f=s*u,d>=0)if(C>=-f)if(C<=f){const b=1/u;d*=b,C*=b,A=d*(d+r*C+2*g)+C*(r*d+C+2*a)+l}else C=s,d=Math.max(0,-(r*C+g)),A=-d*d+C*(C+2*a)+l;else C=-s,d=Math.max(0,-(r*C+g)),A=-d*d+C*(C+2*a)+l;else C<=-f?(d=Math.max(0,-(-r*s+g)),C=d>0?-s:Math.min(Math.max(-s,-a),s),A=-d*d+C*(C+2*a)+l):C<=f?(d=0,C=Math.min(Math.max(-s,-a),s),A=C*(C+2*a)+l):(d=Math.max(0,-(r*s+g)),C=d>0?s:Math.min(Math.max(-s,-a),s),A=-d*d+C*(C+2*a)+l);else C=r>0?-s:s,d=Math.max(0,-(r*C+g)),A=-d*d+C*(C+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(d).add(this.origin),o&&o.copy(yd).multiplyScalar(C).add(Rf),A}intersectSphere(e,t){Bs.subVectors(e.center,this.origin);const i=Bs.dot(this.direction),o=Bs.dot(Bs)-i*i,s=e.radius*e.radius;if(o>s)return null;const r=Math.sqrt(s-o),g=i-r,a=i+r;return g<0&&a<0?null:g<0?this.at(a,t):this.at(g,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,o,s,r,g,a;const l=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,C=this.origin;return l>=0?(i=(e.min.x-C.x)*l,o=(e.max.x-C.x)*l):(i=(e.max.x-C.x)*l,o=(e.min.x-C.x)*l),u>=0?(s=(e.min.y-C.y)*u,r=(e.max.y-C.y)*u):(s=(e.max.y-C.y)*u,r=(e.min.y-C.y)*u),i>r||s>o||((s>i||i!==i)&&(i=s),(r<o||o!==o)&&(o=r),d>=0?(g=(e.min.z-C.z)*d,a=(e.max.z-C.z)*d):(g=(e.max.z-C.z)*d,a=(e.min.z-C.z)*d),i>a||g>o)||((g>i||i!==i)&&(i=g),(a<o||o!==o)&&(o=a),o<0)?null:this.at(i>=0?i:o,t)}intersectsBox(e){return this.intersectBox(e,Bs)!==null}intersectTriangle(e,t,i,o,s){Wf.subVectors(t,e),vd.subVectors(i,e),Sf.crossVectors(Wf,vd);let r=this.direction.dot(Sf),g;if(r>0){if(o)return null;g=1}else if(r<0)g=-1,r=-r;else return null;sr.subVectors(this.origin,e);const a=g*this.direction.dot(vd.crossVectors(sr,vd));if(a<0)return null;const l=g*this.direction.dot(Wf.cross(sr));if(l<0||a+l>r)return null;const u=-g*sr.dot(Sf);return u<0?null:this.at(u/r,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class et{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,o,s,r,g,a,l,u,d,C,A,f,b,G){const m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=o,m[1]=s,m[5]=r,m[9]=g,m[13]=a,m[2]=l,m[6]=u,m[10]=d,m[14]=C,m[3]=A,m[7]=f,m[11]=b,m[15]=G,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new et().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,o=1/Ma.setFromMatrixColumn(e,0).length(),s=1/Ma.setFromMatrixColumn(e,1).length(),r=1/Ma.setFromMatrixColumn(e,2).length();return t[0]=i[0]*o,t[1]=i[1]*o,t[2]=i[2]*o,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*r,t[9]=i[9]*r,t[10]=i[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,o=e.y,s=e.z,r=Math.cos(i),g=Math.sin(i),a=Math.cos(o),l=Math.sin(o),u=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const C=r*u,A=r*d,f=g*u,b=g*d;t[0]=a*u,t[4]=-a*d,t[8]=l,t[1]=A+f*l,t[5]=C-b*l,t[9]=-g*a,t[2]=b-C*l,t[6]=f+A*l,t[10]=r*a}else if(e.order==="YXZ"){const C=a*u,A=a*d,f=l*u,b=l*d;t[0]=C+b*g,t[4]=f*g-A,t[8]=r*l,t[1]=r*d,t[5]=r*u,t[9]=-g,t[2]=A*g-f,t[6]=b+C*g,t[10]=r*a}else if(e.order==="ZXY"){const C=a*u,A=a*d,f=l*u,b=l*d;t[0]=C-b*g,t[4]=-r*d,t[8]=f+A*g,t[1]=A+f*g,t[5]=r*u,t[9]=b-C*g,t[2]=-r*l,t[6]=g,t[10]=r*a}else if(e.order==="ZYX"){const C=r*u,A=r*d,f=g*u,b=g*d;t[0]=a*u,t[4]=f*l-A,t[8]=C*l+b,t[1]=a*d,t[5]=b*l+C,t[9]=A*l-f,t[2]=-l,t[6]=g*a,t[10]=r*a}else if(e.order==="YZX"){const C=r*a,A=r*l,f=g*a,b=g*l;t[0]=a*u,t[4]=b-C*d,t[8]=f*d+A,t[1]=d,t[5]=r*u,t[9]=-g*u,t[2]=-l*u,t[6]=A*d+f,t[10]=C-b*d}else if(e.order==="XZY"){const C=r*a,A=r*l,f=g*a,b=g*l;t[0]=a*u,t[4]=-d,t[8]=l*u,t[1]=C*d+b,t[5]=r*u,t[9]=A*d-f,t[2]=f*d-A,t[6]=g*u,t[10]=b*d+C}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(jY,e,qY)}lookAt(e,t,i){const o=this.elements;return Ji.subVectors(e,t),Ji.lengthSq()===0&&(Ji.z=1),Ji.normalize(),rr.crossVectors(i,Ji),rr.lengthSq()===0&&(Math.abs(i.z)===1?Ji.x+=1e-4:Ji.z+=1e-4,Ji.normalize(),rr.crossVectors(i,Ji)),rr.normalize(),Zd.crossVectors(Ji,rr),o[0]=rr.x,o[4]=Zd.x,o[8]=Ji.x,o[1]=rr.y,o[5]=Zd.y,o[9]=Ji.y,o[2]=rr.z,o[6]=Zd.z,o[10]=Ji.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,s=this.elements,r=i[0],g=i[4],a=i[8],l=i[12],u=i[1],d=i[5],C=i[9],A=i[13],f=i[2],b=i[6],G=i[10],m=i[14],h=i[3],B=i[7],y=i[11],Z=i[15],R=o[0],W=o[4],x=o[8],X=o[12],Y=o[1],S=o[5],H=o[9],k=o[13],U=o[2],D=o[6],Q=o[10],$=o[14],j=o[3],oe=o[7],Ie=o[11],T=o[15];return s[0]=r*R+g*Y+a*U+l*j,s[4]=r*W+g*S+a*D+l*oe,s[8]=r*x+g*H+a*Q+l*Ie,s[12]=r*X+g*k+a*$+l*T,s[1]=u*R+d*Y+C*U+A*j,s[5]=u*W+d*S+C*D+A*oe,s[9]=u*x+d*H+C*Q+A*Ie,s[13]=u*X+d*k+C*$+A*T,s[2]=f*R+b*Y+G*U+m*j,s[6]=f*W+b*S+G*D+m*oe,s[10]=f*x+b*H+G*Q+m*Ie,s[14]=f*X+b*k+G*$+m*T,s[3]=h*R+B*Y+y*U+Z*j,s[7]=h*W+B*S+y*D+Z*oe,s[11]=h*x+B*H+y*Q+Z*Ie,s[15]=h*X+B*k+y*$+Z*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],o=e[8],s=e[12],r=e[1],g=e[5],a=e[9],l=e[13],u=e[2],d=e[6],C=e[10],A=e[14],f=e[3],b=e[7],G=e[11],m=e[15];return f*(+s*a*d-o*l*d-s*g*C+i*l*C+o*g*A-i*a*A)+b*(+t*a*A-t*l*C+s*r*C-o*r*A+o*l*u-s*a*u)+G*(+t*l*d-t*g*A-s*r*d+i*r*A+s*g*u-i*l*u)+m*(-o*g*u-t*a*d+t*g*C+o*r*d-i*r*C+i*a*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=t,o[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],s=e[3],r=e[4],g=e[5],a=e[6],l=e[7],u=e[8],d=e[9],C=e[10],A=e[11],f=e[12],b=e[13],G=e[14],m=e[15],h=d*G*l-b*C*l+b*a*A-g*G*A-d*a*m+g*C*m,B=f*C*l-u*G*l-f*a*A+r*G*A+u*a*m-r*C*m,y=u*b*l-f*d*l+f*g*A-r*b*A-u*g*m+r*d*m,Z=f*d*a-u*b*a-f*g*C+r*b*C+u*g*G-r*d*G,R=t*h+i*B+o*y+s*Z;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const W=1/R;return e[0]=h*W,e[1]=(b*C*s-d*G*s-b*o*A+i*G*A+d*o*m-i*C*m)*W,e[2]=(g*G*s-b*a*s+b*o*l-i*G*l-g*o*m+i*a*m)*W,e[3]=(d*a*s-g*C*s-d*o*l+i*C*l+g*o*A-i*a*A)*W,e[4]=B*W,e[5]=(u*G*s-f*C*s+f*o*A-t*G*A-u*o*m+t*C*m)*W,e[6]=(f*a*s-r*G*s-f*o*l+t*G*l+r*o*m-t*a*m)*W,e[7]=(r*C*s-u*a*s+u*o*l-t*C*l-r*o*A+t*a*A)*W,e[8]=y*W,e[9]=(f*d*s-u*b*s-f*i*A+t*b*A+u*i*m-t*d*m)*W,e[10]=(r*b*s-f*g*s+f*i*l-t*b*l-r*i*m+t*g*m)*W,e[11]=(u*g*s-r*d*s-u*i*l+t*d*l+r*i*A-t*g*A)*W,e[12]=Z*W,e[13]=(u*b*o-f*d*o+f*i*C-t*b*C-u*i*G+t*d*G)*W,e[14]=(f*g*o-r*b*o-f*i*a+t*b*a+r*i*G-t*g*G)*W,e[15]=(r*d*o-u*g*o+u*i*a-t*d*a-r*i*C+t*g*C)*W,this}scale(e){const t=this.elements,i=e.x,o=e.y,s=e.z;return t[0]*=i,t[4]*=o,t[8]*=s,t[1]*=i,t[5]*=o,t[9]*=s,t[2]*=i,t[6]*=o,t[10]*=s,t[3]*=i,t[7]*=o,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,o))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),o=Math.sin(t),s=1-i,r=e.x,g=e.y,a=e.z,l=s*r,u=s*g;return this.set(l*r+i,l*g-o*a,l*a+o*g,0,l*g+o*a,u*g+i,u*a-o*r,0,l*a-o*g,u*a+o*r,s*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,o,s,r){return this.set(1,i,s,0,e,1,r,0,t,o,1,0,0,0,0,1),this}compose(e,t,i){const o=this.elements,s=t._x,r=t._y,g=t._z,a=t._w,l=s+s,u=r+r,d=g+g,C=s*l,A=s*u,f=s*d,b=r*u,G=r*d,m=g*d,h=a*l,B=a*u,y=a*d,Z=i.x,R=i.y,W=i.z;return o[0]=(1-(b+m))*Z,o[1]=(A+y)*Z,o[2]=(f-B)*Z,o[3]=0,o[4]=(A-y)*R,o[5]=(1-(C+m))*R,o[6]=(G+h)*R,o[7]=0,o[8]=(f+B)*W,o[9]=(G-h)*W,o[10]=(1-(C+b))*W,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,t,i){const o=this.elements;let s=Ma.set(o[0],o[1],o[2]).length();const r=Ma.set(o[4],o[5],o[6]).length(),g=Ma.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),e.x=o[12],e.y=o[13],e.z=o[14],Zo.copy(this);const l=1/s,u=1/r,d=1/g;return Zo.elements[0]*=l,Zo.elements[1]*=l,Zo.elements[2]*=l,Zo.elements[4]*=u,Zo.elements[5]*=u,Zo.elements[6]*=u,Zo.elements[8]*=d,Zo.elements[9]*=d,Zo.elements[10]*=d,t.setFromRotationMatrix(Zo),i.x=s,i.y=r,i.z=g,this}makePerspective(e,t,i,o,s,r){r===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const g=this.elements,a=2*s/(t-e),l=2*s/(i-o),u=(t+e)/(t-e),d=(i+o)/(i-o),C=-(r+s)/(r-s),A=-2*r*s/(r-s);return g[0]=a,g[4]=0,g[8]=u,g[12]=0,g[1]=0,g[5]=l,g[9]=d,g[13]=0,g[2]=0,g[6]=0,g[10]=C,g[14]=A,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this}makeOrthographic(e,t,i,o,s,r){const g=this.elements,a=1/(t-e),l=1/(i-o),u=1/(r-s),d=(t+e)*a,C=(i+o)*l,A=(r+s)*u;return g[0]=2*a,g[4]=0,g[8]=0,g[12]=-d,g[1]=0,g[5]=2*l,g[9]=0,g[13]=-C,g[2]=0,g[6]=0,g[10]=-2*u,g[14]=-A,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<16;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}et.prototype.isMatrix4=!0;const Ma=new K,Zo=new et,jY=new K(0,0,0),qY=new K(1,1,1),rr=new K,Zd=new K,Ji=new K,Ww=new et,Sw=new xn;class Es{constructor(e=0,t=0,i=0,o=Es.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,o=this._order){return this._x=e,this._y=t,this._z=i,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const o=e.elements,s=o[0],r=o[4],g=o[8],a=o[1],l=o[5],u=o[9],d=o[2],C=o[6],A=o[10];switch(t){case"XYZ":this._y=Math.asin(ni(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-u,A),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(C,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ni(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(g,A),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(ni(C,-1,1)),Math.abs(C)<.9999999?(this._y=Math.atan2(-d,A),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(a,s));break;case"ZYX":this._y=Math.asin(-ni(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(C,A),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(ni(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(g,A));break;case"XZY":this._z=Math.asin(-ni(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(C,l),this._y=Math.atan2(g,s)):(this._x=Math.atan2(-u,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Ww.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ww,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Sw.setFromEuler(this),this.setFromQuaternion(Sw,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Es.prototype.isEuler=!0;Es.DefaultOrder="XYZ";Es.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class kg{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let $Y=0;const Vw=new K,Ka=new xn,ys=new et,wd=new K,ic=new K,e1=new K,t1=new xn,xw=new K(1,0,0),Hw=new K(0,1,0),Xw=new K(0,0,1),n1={type:"added"},Mw={type:"removed"};class Gt extends Qr{constructor(){super();Object.defineProperty(this,"id",{value:$Y++}),this.uuid=Pi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Gt.DefaultUp.clone();const e=new K,t=new Es,i=new xn,o=new K(1,1,1);function s(){i.setFromEuler(t,!1)}function r(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new et},normalMatrix:{value:new kn}}),this.matrix=new et,this.matrixWorld=new et,this.matrixAutoUpdate=Gt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new kg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ka.setFromAxisAngle(e,t),this.quaternion.multiply(Ka),this}rotateOnWorldAxis(e,t){return Ka.setFromAxisAngle(e,t),this.quaternion.premultiply(Ka),this}rotateX(e){return this.rotateOnAxis(xw,e)}rotateY(e){return this.rotateOnAxis(Hw,e)}rotateZ(e){return this.rotateOnAxis(Xw,e)}translateOnAxis(e,t){return Vw.copy(e).applyQuaternion(this.quaternion),this.position.add(Vw.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(xw,e)}translateY(e){return this.translateOnAxis(Hw,e)}translateZ(e){return this.translateOnAxis(Xw,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(ys.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?wd.copy(e):wd.set(e,t,i);const o=this.parent;this.updateWorldMatrix(!0,!1),ic.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ys.lookAt(ic,wd,this.up):ys.lookAt(wd,ic,this.up),this.quaternion.setFromRotationMatrix(ys),o&&(ys.extractRotation(o.matrixWorld),Ka.setFromRotationMatrix(ys),this.quaternion.premultiply(Ka.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(n1)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Mw)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Mw)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ys.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ys.multiply(e.parent.matrixWorld)),e.applyMatrix4(ys),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,o=this.children.length;i<o;i++){const r=this.children[i].getObjectByProperty(e,t);if(r!==void 0)return r}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ic,e,e1),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ic,t1,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const o=this.children;for(let s=0,r=o.length;s<r;s++)o[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON()));function s(g,a){return g[a.uuid]===void 0&&(g[a.uuid]=a.toJSON(e)),a.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=s(e.geometries,this.geometry);const g=this.geometry.parameters;if(g!==void 0&&g.shapes!==void 0){const a=g.shapes;if(Array.isArray(a))for(let l=0,u=a.length;l<u;l++){const d=a[l];s(e.shapes,d)}else s(e.shapes,a)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const g=[];for(let a=0,l=this.material.length;a<l;a++)g.push(s(e.materials,this.material[a]));o.material=g}else o.material=s(e.materials,this.material);if(this.children.length>0){o.children=[];for(let g=0;g<this.children.length;g++)o.children.push(this.children[g].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let g=0;g<this.animations.length;g++){const a=this.animations[g];o.animations.push(s(e.animations,a))}}if(t){const g=r(e.geometries),a=r(e.materials),l=r(e.textures),u=r(e.images),d=r(e.shapes),C=r(e.skeletons),A=r(e.animations),f=r(e.nodes);g.length>0&&(i.geometries=g),a.length>0&&(i.materials=a),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),d.length>0&&(i.shapes=d),C.length>0&&(i.skeletons=C),A.length>0&&(i.animations=A),f.length>0&&(i.nodes=f)}return i.object=o,i;function r(g){const a=[];for(const l in g){const u=g[l];delete u.metadata,a.push(u)}return a}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const o=e.children[i];this.add(o.clone())}return this}}Gt.DefaultUp=new K(0,1,0);Gt.DefaultMatrixAutoUpdate=!0;Gt.prototype.isObject3D=!0;const wo=new K,vs=new K,Vf=new K,Zs=new K,Fa=new K,Ya=new K,Kw=new K,xf=new K,Hf=new K,Xf=new K;class Wn{constructor(e=new K,t=new K,i=new K){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,o){o.subVectors(i,t),wo.subVectors(e,t),o.cross(wo);const s=o.lengthSq();return s>0?o.multiplyScalar(1/Math.sqrt(s)):o.set(0,0,0)}static getBarycoord(e,t,i,o,s){wo.subVectors(o,t),vs.subVectors(i,t),Vf.subVectors(e,t);const r=wo.dot(wo),g=wo.dot(vs),a=wo.dot(Vf),l=vs.dot(vs),u=vs.dot(Vf),d=r*l-g*g;if(d===0)return s.set(-2,-1,-1);const C=1/d,A=(l*a-g*u)*C,f=(r*u-g*a)*C;return s.set(1-A-f,f,A)}static containsPoint(e,t,i,o){return this.getBarycoord(e,t,i,o,Zs),Zs.x>=0&&Zs.y>=0&&Zs.x+Zs.y<=1}static getUV(e,t,i,o,s,r,g,a){return this.getBarycoord(e,t,i,o,Zs),a.set(0,0),a.addScaledVector(s,Zs.x),a.addScaledVector(r,Zs.y),a.addScaledVector(g,Zs.z),a}static isFrontFacing(e,t,i,o){return wo.subVectors(i,t),vs.subVectors(e,t),wo.cross(vs).dot(o)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,o){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,t,i,o){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,o),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return wo.subVectors(this.c,this.b),vs.subVectors(this.a,this.b),wo.cross(vs).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Wn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Wn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,o,s){return Wn.getUV(e,this.a,this.b,this.c,t,i,o,s)}containsPoint(e){return Wn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Wn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,o=this.b,s=this.c;let r,g;Fa.subVectors(o,i),Ya.subVectors(s,i),xf.subVectors(e,i);const a=Fa.dot(xf),l=Ya.dot(xf);if(a<=0&&l<=0)return t.copy(i);Hf.subVectors(e,o);const u=Fa.dot(Hf),d=Ya.dot(Hf);if(u>=0&&d<=u)return t.copy(o);const C=a*d-u*l;if(C<=0&&a>=0&&u<=0)return r=a/(a-u),t.copy(i).addScaledVector(Fa,r);Xf.subVectors(e,s);const A=Fa.dot(Xf),f=Ya.dot(Xf);if(f>=0&&A<=f)return t.copy(s);const b=A*l-a*f;if(b<=0&&l>=0&&f<=0)return g=l/(l-f),t.copy(i).addScaledVector(Ya,g);const G=u*f-A*d;if(G<=0&&d-u>=0&&A-f>=0)return Kw.subVectors(s,o),g=(d-u)/(d-u+(A-f)),t.copy(o).addScaledVector(Kw,g);const m=1/(G+b+C);return r=b*m,g=C*m,t.copy(i).addScaledVector(Fa,r).addScaledVector(Ya,g)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let i1=0;class cn extends Qr{constructor(){super();Object.defineProperty(this,"id",{value:i1++}),this.uuid=Pi(),this.name="",this.type="Material",this.fog=!0,this.blending=Yg,this.side=Yr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=cB,this.blendDst=CB,this.blendEquation=Bg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=uh,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=gx,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=FA,this.stencilZFail=FA,this.stencilZPass=FA,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===IB;continue}const o=this[t];if(o===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Yg&&(i.blending=this.blending),this.side!==Yr&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function o(s){const r=[];for(const g in s){const a=s[g];delete a.metadata,r.push(a)}return r}if(t){const s=o(e.textures),r=o(e.images);s.length>0&&(i.textures=s),r.length>0&&(i.images=r)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const o=t.length;i=new Array(o);for(let s=0;s!==o;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}cn.prototype.isMaterial=!0;cn.fromType=function(){return null};class Ki extends cn{constructor(e){super();this.type="MeshBasicMaterial",this.color=new ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=TC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Ki.prototype.isMeshBasicMaterial=!0;const qt=new K,Rd=new Se;class vt{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=Ll,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let o=0,s=this.itemSize;o<s;o++)this.array[e+o]=t.array[i+o];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let o=0,s=e.length;o<s;o++){let r=e[o];r===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",o),r=new ze),t[i++]=r.r,t[i++]=r.g,t[i++]=r.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let o=0,s=e.length;o<s;o++){let r=e[o];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",o),r=new Se),t[i++]=r.x,t[i++]=r.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let o=0,s=e.length;o<s;o++){let r=e[o];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",o),r=new K),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let o=0,s=e.length;o<s;o++){let r=e[o];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",o),r=new zt),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z,t[i++]=r.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Rd.fromBufferAttribute(this,t),Rd.applyMatrix3(e),this.setXY(t,Rd.x,Rd.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)qt.fromBufferAttribute(this,t),qt.applyMatrix3(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)qt.x=this.getX(t),qt.y=this.getY(t),qt.z=this.getZ(t),qt.applyMatrix4(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)qt.x=this.getX(t),qt.y=this.getY(t),qt.z=this.getZ(t),qt.applyNormalMatrix(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)qt.x=this.getX(t),qt.y=this.getY(t),qt.z=this.getZ(t),qt.transformDirection(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=o,this}setXYZW(e,t,i,o,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=o,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Ll&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}vt.prototype.isBufferAttribute=!0;class dx extends vt{constructor(e,t,i){super(new Int8Array(e),t,i)}}class Ax extends vt{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class hx extends vt{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class px extends vt{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Th extends vt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class mx extends vt{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Eh extends vt{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class fx extends vt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}fx.prototype.isFloat16BufferAttribute=!0;class tt extends vt{constructor(e,t,i){super(new Float32Array(e),t,i)}}class bx extends vt{constructor(e,t,i){super(new Float64Array(e),t,i)}}let o1=0;const ro=new et,Mf=new Gt,Na=new K,Di=new ki,oc=new ki,Jn=new K;class at extends Qr{constructor(){super();Object.defineProperty(this,"id",{value:o1++}),this.uuid=Pi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(lx(e)?Eh:Th)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new kn().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ro.makeRotationFromQuaternion(e),this.applyMatrix4(ro),this}rotateX(e){return ro.makeRotationX(e),this.applyMatrix4(ro),this}rotateY(e){return ro.makeRotationY(e),this.applyMatrix4(ro),this}rotateZ(e){return ro.makeRotationZ(e),this.applyMatrix4(ro),this}translate(e,t,i){return ro.makeTranslation(e,t,i),this.applyMatrix4(ro),this}scale(e,t,i){return ro.makeScale(e,t,i),this.applyMatrix4(ro),this}lookAt(e){return Mf.lookAt(e),Mf.updateMatrix(),this.applyMatrix4(Mf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Na).negate(),this.translate(Na.x,Na.y,Na.z),this}setFromPoints(e){const t=[];for(let i=0,o=e.length;i<o;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new tt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ki);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new K(-1/0,-1/0,-1/0),new K(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,o=t.length;i<o;i++){const s=t[i];Di.setFromBufferAttribute(s),this.morphTargetsRelative?(Jn.addVectors(this.boundingBox.min,Di.min),this.boundingBox.expandByPoint(Jn),Jn.addVectors(this.boundingBox.max,Di.max),this.boundingBox.expandByPoint(Jn)):(this.boundingBox.expandByPoint(Di.min),this.boundingBox.expandByPoint(Di.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ts);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new K,1/0);return}if(e){const i=this.boundingSphere.center;if(Di.setFromBufferAttribute(e),t)for(let s=0,r=t.length;s<r;s++){const g=t[s];oc.setFromBufferAttribute(g),this.morphTargetsRelative?(Jn.addVectors(Di.min,oc.min),Di.expandByPoint(Jn),Jn.addVectors(Di.max,oc.max),Di.expandByPoint(Jn)):(Di.expandByPoint(oc.min),Di.expandByPoint(oc.max))}Di.getCenter(i);let o=0;for(let s=0,r=e.count;s<r;s++)Jn.fromBufferAttribute(e,s),o=Math.max(o,i.distanceToSquared(Jn));if(t)for(let s=0,r=t.length;s<r;s++){const g=t[s],a=this.morphTargetsRelative;for(let l=0,u=g.count;l<u;l++)Jn.fromBufferAttribute(g,l),a&&(Na.fromBufferAttribute(e,l),Jn.add(Na)),o=Math.max(o,i.distanceToSquared(Jn))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,o=t.position.array,s=t.normal.array,r=t.uv.array,g=o.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new vt(new Float32Array(4*g),4));const a=this.getAttribute("tangent").array,l=[],u=[];for(let Y=0;Y<g;Y++)l[Y]=new K,u[Y]=new K;const d=new K,C=new K,A=new K,f=new Se,b=new Se,G=new Se,m=new K,h=new K;function B(Y,S,H){d.fromArray(o,Y*3),C.fromArray(o,S*3),A.fromArray(o,H*3),f.fromArray(r,Y*2),b.fromArray(r,S*2),G.fromArray(r,H*2),C.sub(d),A.sub(d),b.sub(f),G.sub(f);const k=1/(b.x*G.y-G.x*b.y);!isFinite(k)||(m.copy(C).multiplyScalar(G.y).addScaledVector(A,-b.y).multiplyScalar(k),h.copy(A).multiplyScalar(b.x).addScaledVector(C,-G.x).multiplyScalar(k),l[Y].add(m),l[S].add(m),l[H].add(m),u[Y].add(h),u[S].add(h),u[H].add(h))}let y=this.groups;y.length===0&&(y=[{start:0,count:i.length}]);for(let Y=0,S=y.length;Y<S;++Y){const H=y[Y],k=H.start,U=H.count;for(let D=k,Q=k+U;D<Q;D+=3)B(i[D+0],i[D+1],i[D+2])}const Z=new K,R=new K,W=new K,x=new K;function X(Y){W.fromArray(s,Y*3),x.copy(W);const S=l[Y];Z.copy(S),Z.sub(W.multiplyScalar(W.dot(S))).normalize(),R.crossVectors(x,S);const k=R.dot(u[Y])<0?-1:1;a[Y*4]=Z.x,a[Y*4+1]=Z.y,a[Y*4+2]=Z.z,a[Y*4+3]=k}for(let Y=0,S=y.length;Y<S;++Y){const H=y[Y],k=H.start,U=H.count;for(let D=k,Q=k+U;D<Q;D+=3)X(i[D+0]),X(i[D+1]),X(i[D+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new vt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let C=0,A=i.count;C<A;C++)i.setXYZ(C,0,0,0);const o=new K,s=new K,r=new K,g=new K,a=new K,l=new K,u=new K,d=new K;if(e)for(let C=0,A=e.count;C<A;C+=3){const f=e.getX(C+0),b=e.getX(C+1),G=e.getX(C+2);o.fromBufferAttribute(t,f),s.fromBufferAttribute(t,b),r.fromBufferAttribute(t,G),u.subVectors(r,s),d.subVectors(o,s),u.cross(d),g.fromBufferAttribute(i,f),a.fromBufferAttribute(i,b),l.fromBufferAttribute(i,G),g.add(u),a.add(u),l.add(u),i.setXYZ(f,g.x,g.y,g.z),i.setXYZ(b,a.x,a.y,a.z),i.setXYZ(G,l.x,l.y,l.z)}else for(let C=0,A=t.count;C<A;C+=3)o.fromBufferAttribute(t,C+0),s.fromBufferAttribute(t,C+1),r.fromBufferAttribute(t,C+2),u.subVectors(r,s),d.subVectors(o,s),u.cross(d),i.setXYZ(C+0,u.x,u.y,u.z),i.setXYZ(C+1,u.x,u.y,u.z),i.setXYZ(C+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const o in i){if(e.attributes[o]===void 0)continue;const r=i[o].array,g=e.attributes[o],a=g.array,l=g.itemSize*t,u=Math.min(a.length,r.length-l);for(let d=0,C=l;d<u;d++,C++)r[C]=a[d]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Jn.fromBufferAttribute(e,t),Jn.normalize(),e.setXYZ(t,Jn.x,Jn.y,Jn.z)}toNonIndexed(){function e(g,a){const l=g.array,u=g.itemSize,d=g.normalized,C=new l.constructor(a.length*u);let A=0,f=0;for(let b=0,G=a.length;b<G;b++){g.isInterleavedBufferAttribute?A=a[b]*g.data.stride+g.offset:A=a[b]*u;for(let m=0;m<u;m++)C[f++]=l[A++]}return new vt(C,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new at,i=this.index.array,o=this.attributes;for(const g in o){const a=o[g],l=e(a,i);t.setAttribute(g,l)}const s=this.morphAttributes;for(const g in s){const a=[],l=s[g];for(let u=0,d=l.length;u<d;u++){const C=l[u],A=e(C,i);a.push(A)}t.morphAttributes[g]=a}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let g=0,a=r.length;g<a;g++){const l=r[g];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const a=this.parameters;for(const l in a)a[l]!==void 0&&(e[l]=a[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const a in i){const l=i[a];e.data.attributes[a]=l.toJSON(e.data)}const o={};let s=!1;for(const a in this.morphAttributes){const l=this.morphAttributes[a],u=[];for(let d=0,C=l.length;d<C;d++){const A=l[d];u.push(A.toJSON(e.data))}u.length>0&&(o[a]=u,s=!0)}s&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const g=this.boundingSphere;return g!==null&&(e.data.boundingSphere={center:g.center.toArray(),radius:g.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const o=e.attributes;for(const l in o){const u=o[l];this.setAttribute(l,u.clone(t))}const s=e.morphAttributes;for(const l in s){const u=[],d=s[l];for(let C=0,A=d.length;C<A;C++)u.push(d[C].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let l=0,u=r.length;l<u;l++){const d=r[l];this.addGroup(d.start,d.count,d.materialIndex)}const g=e.boundingBox;g!==null&&(this.boundingBox=g.clone());const a=e.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}at.prototype.isBufferGeometry=!0;const Fw=new et,La=new jr,Kf=new Ts,gr=new K,ar=new K,lr=new K,Ff=new K,Yf=new K,Nf=new K,Wd=new K,Sd=new K,Vd=new K,xd=new Se,Hd=new Se,Xd=new Se,Lf=new K,Md=new K;class Sn extends Gt{constructor(e=new at,t=new Ki){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=o.length;s<r;s++){const g=o[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,o=this.material,s=this.matrixWorld;if(o===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),Kf.copy(i.boundingSphere),Kf.applyMatrix4(s),e.ray.intersectsSphere(Kf)===!1)||(Fw.copy(s).invert(),La.copy(e.ray).applyMatrix4(Fw),i.boundingBox!==null&&La.intersectsBox(i.boundingBox)===!1))return;let r;if(i.isBufferGeometry){const g=i.index,a=i.attributes.position,l=i.morphAttributes.position,u=i.morphTargetsRelative,d=i.attributes.uv,C=i.attributes.uv2,A=i.groups,f=i.drawRange;if(g!==null)if(Array.isArray(o))for(let b=0,G=A.length;b<G;b++){const m=A[b],h=o[m.materialIndex],B=Math.max(m.start,f.start),y=Math.min(g.count,Math.min(m.start+m.count,f.start+f.count));for(let Z=B,R=y;Z<R;Z+=3){const W=g.getX(Z),x=g.getX(Z+1),X=g.getX(Z+2);r=Kd(this,h,e,La,a,l,u,d,C,W,x,X),r&&(r.faceIndex=Math.floor(Z/3),r.face.materialIndex=m.materialIndex,t.push(r))}}else{const b=Math.max(0,f.start),G=Math.min(g.count,f.start+f.count);for(let m=b,h=G;m<h;m+=3){const B=g.getX(m),y=g.getX(m+1),Z=g.getX(m+2);r=Kd(this,o,e,La,a,l,u,d,C,B,y,Z),r&&(r.faceIndex=Math.floor(m/3),t.push(r))}}else if(a!==void 0)if(Array.isArray(o))for(let b=0,G=A.length;b<G;b++){const m=A[b],h=o[m.materialIndex],B=Math.max(m.start,f.start),y=Math.min(a.count,Math.min(m.start+m.count,f.start+f.count));for(let Z=B,R=y;Z<R;Z+=3){const W=Z,x=Z+1,X=Z+2;r=Kd(this,h,e,La,a,l,u,d,C,W,x,X),r&&(r.faceIndex=Math.floor(Z/3),r.face.materialIndex=m.materialIndex,t.push(r))}}else{const b=Math.max(0,f.start),G=Math.min(a.count,f.start+f.count);for(let m=b,h=G;m<h;m+=3){const B=m,y=m+1,Z=m+2;r=Kd(this,o,e,La,a,l,u,d,C,B,y,Z),r&&(r.faceIndex=Math.floor(m/3),t.push(r))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}Sn.prototype.isMesh=!0;function s1(n,e,t,i,o,s,r,g){let a;if(e.side===wn?a=i.intersectTriangle(r,s,o,!0,g):a=i.intersectTriangle(o,s,r,e.side!==Nr,g),a===null)return null;Md.copy(g),Md.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(Md);return l<t.near||l>t.far?null:{distance:l,point:Md.clone(),object:n}}function Kd(n,e,t,i,o,s,r,g,a,l,u,d){gr.fromBufferAttribute(o,l),ar.fromBufferAttribute(o,u),lr.fromBufferAttribute(o,d);const C=n.morphTargetInfluences;if(s&&C){Wd.set(0,0,0),Sd.set(0,0,0),Vd.set(0,0,0);for(let f=0,b=s.length;f<b;f++){const G=C[f],m=s[f];G!==0&&(Ff.fromBufferAttribute(m,l),Yf.fromBufferAttribute(m,u),Nf.fromBufferAttribute(m,d),r?(Wd.addScaledVector(Ff,G),Sd.addScaledVector(Yf,G),Vd.addScaledVector(Nf,G)):(Wd.addScaledVector(Ff.sub(gr),G),Sd.addScaledVector(Yf.sub(ar),G),Vd.addScaledVector(Nf.sub(lr),G)))}gr.add(Wd),ar.add(Sd),lr.add(Vd)}n.isSkinnedMesh&&(n.boneTransform(l,gr),n.boneTransform(u,ar),n.boneTransform(d,lr));const A=s1(n,e,t,i,gr,ar,lr,Lf);if(A){g&&(xd.fromBufferAttribute(g,l),Hd.fromBufferAttribute(g,u),Xd.fromBufferAttribute(g,d),A.uv=Wn.getUV(Lf,gr,ar,lr,xd,Hd,Xd,new Se)),a&&(xd.fromBufferAttribute(a,l),Hd.fromBufferAttribute(a,u),Xd.fromBufferAttribute(a,d),A.uv2=Wn.getUV(Lf,gr,ar,lr,xd,Hd,Xd,new Se));const f={a:l,b:u,c:d,normal:new K,materialIndex:0};Wn.getNormal(gr,ar,lr,f.normal),A.face=f}return A}class Ys extends at{constructor(e=1,t=1,i=1,o=1,s=1,r=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:o,heightSegments:s,depthSegments:r};const g=this;o=Math.floor(o),s=Math.floor(s),r=Math.floor(r);const a=[],l=[],u=[],d=[];let C=0,A=0;f("z","y","x",-1,-1,i,t,e,r,s,0),f("z","y","x",1,-1,i,t,-e,r,s,1),f("x","z","y",1,1,e,i,t,o,r,2),f("x","z","y",1,-1,e,i,-t,o,r,3),f("x","y","z",1,-1,e,t,i,o,s,4),f("x","y","z",-1,-1,e,t,-i,o,s,5),this.setIndex(a),this.setAttribute("position",new tt(l,3)),this.setAttribute("normal",new tt(u,3)),this.setAttribute("uv",new tt(d,2));function f(b,G,m,h,B,y,Z,R,W,x,X){const Y=y/W,S=Z/x,H=y/2,k=Z/2,U=R/2,D=W+1,Q=x+1;let $=0,j=0;const oe=new K;for(let Ie=0;Ie<Q;Ie++){const T=Ie*S-k;for(let P=0;P<D;P++){const Ce=P*Y-H;oe[b]=Ce*h,oe[G]=T*B,oe[m]=U,l.push(oe.x,oe.y,oe.z),oe[b]=0,oe[G]=0,oe[m]=R>0?1:-1,u.push(oe.x,oe.y,oe.z),d.push(P/W),d.push(1-Ie/x),$+=1}}for(let Ie=0;Ie<x;Ie++)for(let T=0;T<W;T++){const P=C+T+D*Ie,Ce=C+T+D*(Ie+1),Me=C+(T+1)+D*(Ie+1),ee=C+(T+1)+D*Ie;a.push(P,Ce,ee),a.push(Ce,Me,ee),j+=6}g.addGroup(A,j,X),A+=j,C+=$}}static fromJSON(e){return new Ys(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function zl(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const o=n[t][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?e[t][i]=o.clone():Array.isArray(o)?e[t][i]=o.slice():e[t][i]=o}}return e}function Ii(n){const e={};for(let t=0;t<n.length;t++){const i=zl(n[t]);for(const o in i)e[o]=i[o]}return e}const Gx={clone:zl,merge:Ii};var r1=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,g1=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class uo extends cn{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=r1,this.fragmentShader=g1,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zl(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const o in this.uniforms){const r=this.uniforms[o].value;r&&r.isTexture?t.uniforms[o]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[o]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[o]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[o]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[o]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[o]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[o]={type:"m4",value:r.toArray()}:t.uniforms[o]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const o in this.extensions)this.extensions[o]===!0&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}uo.prototype.isShaderMaterial=!0;class Og extends Gt{constructor(){super();this.type="Camera",this.matrixWorldInverse=new et,this.projectionMatrix=new et,this.projectionMatrixInverse=new et}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}Og.prototype.isCamera=!0;class Kn extends Og{constructor(e=50,t=1,i=.1,o=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=o,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=bC*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(zg*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return bC*2*Math.atan(Math.tan(zg*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,o,s,r){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=o,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(zg*.5*this.fov)/this.zoom,i=2*t,o=this.aspect*i,s=-.5*o;const r=this.view;if(this.view!==null&&this.view.enabled){const a=r.fullWidth,l=r.fullHeight;s+=r.offsetX*o/a,t-=r.offsetY*i/l,o*=r.width/a,i*=r.height/l}const g=this.filmOffset;g!==0&&(s+=e*g/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+o,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Kn.prototype.isPerspectiveCamera=!0;const za=90,ka=1;class _h extends Gt{constructor(e,t,i){super();if(this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const o=new Kn(za,ka,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new K(1,0,0)),this.add(o);const s=new Kn(za,ka,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new K(-1,0,0)),this.add(s);const r=new Kn(za,ka,e,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new K(0,1,0)),this.add(r);const g=new Kn(za,ka,e,t);g.layers=this.layers,g.up.set(0,0,-1),g.lookAt(new K(0,-1,0)),this.add(g);const a=new Kn(za,ka,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new K(0,0,1)),this.add(a);const l=new Kn(za,ka,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new K(0,0,-1)),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[o,s,r,g,a,l]=this.children,u=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;const C=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,o),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,r),e.setRenderTarget(i,3),e.render(t,g),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=C,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(d),e.xr.enabled=u,i.texture.needsPMREMUpdate=!0}}class dI extends pn{constructor(e,t,i,o,s,r,g,a,l,u){e=e!==void 0?e:[],t=t!==void 0?t:Lr;super(e,t,i,o,s,r,g,a,l,u);this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}dI.prototype.isCubeTexture=!0;class Jh extends Gi{constructor(e,t={}){super(e,e,t);const i={width:e,height:e,depth:1},o=[i,i,i,i,i,i];this.texture=new dI(o,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:gn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ai,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new Ys(5,5,5),s=new uo({name:"CubemapFromEquirect",uniforms:zl(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:wn,blending:Ms});s.uniforms.tEquirect.value=t;const r=new Sn(o,s),g=t.minFilter;return t.minFilter===ks&&(t.minFilter=gn),new _h(1,10,this).update(e,r),t.minFilter=g,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,i,o){const s=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,o);e.setRenderTarget(s)}}Jh.prototype.isWebGLCubeRenderTarget=!0;const zf=new K,a1=new K,l1=new kn;class Do{constructor(e=new K(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,o){return this.normal.set(e,t,i),this.constant=o,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const o=zf.subVectors(i,t).cross(a1.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(zf),o=this.normal.dot(i);if(o===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/o;return s<0||s>1?null:t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||l1.getNormalMatrix(e),o=this.coplanarPoint(zf).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}Do.prototype.isPlane=!0;const Ta=new Ts,Fd=new K;class JC{constructor(e=new Do,t=new Do,i=new Do,o=new Do,s=new Do,r=new Do){this.planes=[e,t,i,o,s,r]}set(e,t,i,o,s,r){const g=this.planes;return g[0].copy(e),g[1].copy(t),g[2].copy(i),g[3].copy(o),g[4].copy(s),g[5].copy(r),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,o=i[0],s=i[1],r=i[2],g=i[3],a=i[4],l=i[5],u=i[6],d=i[7],C=i[8],A=i[9],f=i[10],b=i[11],G=i[12],m=i[13],h=i[14],B=i[15];return t[0].setComponents(g-o,d-a,b-C,B-G).normalize(),t[1].setComponents(g+o,d+a,b+C,B+G).normalize(),t[2].setComponents(g+s,d+l,b+A,B+m).normalize(),t[3].setComponents(g-s,d-l,b-A,B-m).normalize(),t[4].setComponents(g-r,d-u,b-f,B-h).normalize(),t[5].setComponents(g+r,d+u,b+f,B+h).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Ta.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ta)}intersectsSprite(e){return Ta.center.set(0,0,0),Ta.radius=.7071067811865476,Ta.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ta)}intersectsSphere(e){const t=this.planes,i=e.center,o=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<o)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const o=t[i];if(Fd.x=o.normal.x>0?e.max.x:e.min.x,Fd.y=o.normal.y>0?e.max.y:e.min.y,Fd.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint(Fd)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Bx(){let n=null,e=!1,t=null,i=null;function o(s,r){t(s,r),i=n.requestAnimationFrame(o)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(o),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function I1(n,e){const t=e.isWebGL2,i=new WeakMap;function o(l,u){const d=l.array,C=l.usage,A=n.createBuffer();n.bindBuffer(u,A),n.bufferData(u,d,C),l.onUploadCallback();let f;if(d instanceof Float32Array)f=5126;else if(d instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(t)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(d instanceof Int16Array)f=5122;else if(d instanceof Uint32Array)f=5125;else if(d instanceof Int32Array)f=5124;else if(d instanceof Int8Array)f=5120;else if(d instanceof Uint8Array)f=5121;else if(d instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:A,type:f,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version}}function s(l,u,d){const C=u.array,A=u.updateRange;n.bindBuffer(d,l),A.count===-1?n.bufferSubData(d,0,C):(t?n.bufferSubData(d,A.offset*C.BYTES_PER_ELEMENT,C,A.offset,A.count):n.bufferSubData(d,A.offset*C.BYTES_PER_ELEMENT,C.subarray(A.offset,A.offset+A.count)),A.count=-1)}function r(l){return l.isInterleavedBufferAttribute&&(l=l.data),i.get(l)}function g(l){l.isInterleavedBufferAttribute&&(l=l.data);const u=i.get(l);u&&(n.deleteBuffer(u.buffer),i.delete(l))}function a(l,u){if(l.isGLBufferAttribute){const C=i.get(l);(!C||C.version<l.version)&&i.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const d=i.get(l);d===void 0?i.set(l,o(l,u)):d.version<l.version&&(s(d.buffer,l,u),d.version=l.version)}return{get:r,remove:g,update:a}}class jg extends at{constructor(e=1,t=1,i=1,o=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:o};const s=e/2,r=t/2,g=Math.floor(i),a=Math.floor(o),l=g+1,u=a+1,d=e/g,C=t/a,A=[],f=[],b=[],G=[];for(let m=0;m<u;m++){const h=m*C-r;for(let B=0;B<l;B++){const y=B*d-s;f.push(y,-h,0),b.push(0,0,1),G.push(B/g),G.push(1-m/a)}}for(let m=0;m<a;m++)for(let h=0;h<g;h++){const B=h+l*m,y=h+l*(m+1),Z=h+1+l*(m+1),R=h+1+l*m;A.push(B,y,R),A.push(y,Z,R)}this.setIndex(A),this.setAttribute("position",new tt(f,3)),this.setAttribute("normal",new tt(b,3)),this.setAttribute("uv",new tt(G,2))}static fromJSON(e){return new jg(e.width,e.height,e.widthSegments,e.heightSegments)}}var c1=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,C1=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,u1=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,d1=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,A1=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,h1=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,p1="vec3 transformed = vec3( position );",m1=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,f1=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,b1=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,G1=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,B1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,y1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,v1=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Z1=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,w1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,R1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,W1=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,S1=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,V1=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,x1=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,H1=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,X1=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,M1=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,K1=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,F1="gl_FragColor = linearToOutputTexel( gl_FragColor );",Y1=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,N1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,L1=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,z1=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,k1=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,T1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,E1=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,_1=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,J1=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,D1=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,U1=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,P1=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Q1=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,O1=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,j1=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,q1=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,$1=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,eN=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,tN=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,nN=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,iN=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,oN=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,sN=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,rN=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,gN=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,aN=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,lN=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,IN=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,cN=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,CN=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,uN=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,dN=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,AN=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hN=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,pN=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,mN=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]
		#endif
	}
#endif`,fN=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,bN=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			float texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,GN=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,BN=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,yN=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,vN=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ZN=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,wN=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,RN=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,WN=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,SN=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,VN=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,xN=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,HN=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,XN=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,MN=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,KN=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,FN=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,YN=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,NN=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,LN=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,zN=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,kN=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,TN=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,EN=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,_N=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,JN=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,DN=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,UN=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,PN=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,QN=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,ON=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,jN=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,qN=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,$N=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,e5=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,t5=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,n5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,i5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,o5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,s5=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const r5=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,g5=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,a5=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,l5=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,I5=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,c5=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,C5=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,u5=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,d5=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,A5=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,h5=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,p5=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,m5=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,f5=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,b5=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,G5=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,B5=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,y5=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,v5=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Z5=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,w5=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,R5=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,W5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,S5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,V5=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,x5=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,H5=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,X5=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,M5=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,K5=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,F5=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Y5=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,yt={alphamap_fragment:c1,alphamap_pars_fragment:C1,alphatest_fragment:u1,alphatest_pars_fragment:d1,aomap_fragment:A1,aomap_pars_fragment:h1,begin_vertex:p1,beginnormal_vertex:m1,bsdfs:f1,bumpmap_pars_fragment:b1,clipping_planes_fragment:G1,clipping_planes_pars_fragment:B1,clipping_planes_pars_vertex:y1,clipping_planes_vertex:v1,color_fragment:Z1,color_pars_fragment:w1,color_pars_vertex:R1,color_vertex:W1,common:S1,cube_uv_reflection_fragment:V1,defaultnormal_vertex:x1,displacementmap_pars_vertex:H1,displacementmap_vertex:X1,emissivemap_fragment:M1,emissivemap_pars_fragment:K1,encodings_fragment:F1,encodings_pars_fragment:Y1,envmap_fragment:N1,envmap_common_pars_fragment:L1,envmap_pars_fragment:z1,envmap_pars_vertex:k1,envmap_physical_pars_fragment:q1,envmap_vertex:T1,fog_vertex:E1,fog_pars_vertex:_1,fog_fragment:J1,fog_pars_fragment:D1,gradientmap_pars_fragment:U1,lightmap_fragment:P1,lightmap_pars_fragment:Q1,lights_lambert_vertex:O1,lights_pars_begin:j1,lights_toon_fragment:$1,lights_toon_pars_fragment:eN,lights_phong_fragment:tN,lights_phong_pars_fragment:nN,lights_physical_fragment:iN,lights_physical_pars_fragment:oN,lights_fragment_begin:sN,lights_fragment_maps:rN,lights_fragment_end:gN,logdepthbuf_fragment:aN,logdepthbuf_pars_fragment:lN,logdepthbuf_pars_vertex:IN,logdepthbuf_vertex:cN,map_fragment:CN,map_pars_fragment:uN,map_particle_fragment:dN,map_particle_pars_fragment:AN,metalnessmap_fragment:hN,metalnessmap_pars_fragment:pN,morphcolor_vertex:mN,morphnormal_vertex:fN,morphtarget_pars_vertex:bN,morphtarget_vertex:GN,normal_fragment_begin:BN,normal_fragment_maps:yN,normal_pars_fragment:vN,normal_pars_vertex:ZN,normal_vertex:wN,normalmap_pars_fragment:RN,clearcoat_normal_fragment_begin:WN,clearcoat_normal_fragment_maps:SN,clearcoat_pars_fragment:VN,output_fragment:xN,packing:HN,premultiplied_alpha_fragment:XN,project_vertex:MN,dithering_fragment:KN,dithering_pars_fragment:FN,roughnessmap_fragment:YN,roughnessmap_pars_fragment:NN,shadowmap_pars_fragment:LN,shadowmap_pars_vertex:zN,shadowmap_vertex:kN,shadowmask_pars_fragment:TN,skinbase_vertex:EN,skinning_pars_vertex:_N,skinning_vertex:JN,skinnormal_vertex:DN,specularmap_fragment:UN,specularmap_pars_fragment:PN,tonemapping_fragment:QN,tonemapping_pars_fragment:ON,transmission_fragment:jN,transmission_pars_fragment:qN,uv_pars_fragment:$N,uv_pars_vertex:e5,uv_vertex:t5,uv2_pars_fragment:n5,uv2_pars_vertex:i5,uv2_vertex:o5,worldpos_vertex:s5,background_vert:r5,background_frag:g5,cube_vert:a5,cube_frag:l5,depth_vert:I5,depth_frag:c5,distanceRGBA_vert:C5,distanceRGBA_frag:u5,equirect_vert:d5,equirect_frag:A5,linedashed_vert:h5,linedashed_frag:p5,meshbasic_vert:m5,meshbasic_frag:f5,meshlambert_vert:b5,meshlambert_frag:G5,meshmatcap_vert:B5,meshmatcap_frag:y5,meshnormal_vert:v5,meshnormal_frag:Z5,meshphong_vert:w5,meshphong_frag:R5,meshphysical_vert:W5,meshphysical_frag:S5,meshtoon_vert:V5,meshtoon_frag:x5,points_vert:H5,points_frag:X5,shadow_vert:M5,shadow_frag:K5,sprite_vert:F5,sprite_frag:Y5},_e={common:{diffuse:{value:new ze(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new kn},uv2Transform:{value:new kn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Se(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ze(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ze(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new kn}},sprite:{diffuse:{value:new ze(16777215)},opacity:{value:1},center:{value:new Se(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new kn}}},Vo={basic:{uniforms:Ii([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.fog]),vertexShader:yt.meshbasic_vert,fragmentShader:yt.meshbasic_frag},lambert:{uniforms:Ii([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.fog,_e.lights,{emissive:{value:new ze(0)}}]),vertexShader:yt.meshlambert_vert,fragmentShader:yt.meshlambert_frag},phong:{uniforms:Ii([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.fog,_e.lights,{emissive:{value:new ze(0)},specular:{value:new ze(1118481)},shininess:{value:30}}]),vertexShader:yt.meshphong_vert,fragmentShader:yt.meshphong_frag},standard:{uniforms:Ii([_e.common,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.roughnessmap,_e.metalnessmap,_e.fog,_e.lights,{emissive:{value:new ze(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yt.meshphysical_vert,fragmentShader:yt.meshphysical_frag},toon:{uniforms:Ii([_e.common,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.gradientmap,_e.fog,_e.lights,{emissive:{value:new ze(0)}}]),vertexShader:yt.meshtoon_vert,fragmentShader:yt.meshtoon_frag},matcap:{uniforms:Ii([_e.common,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.fog,{matcap:{value:null}}]),vertexShader:yt.meshmatcap_vert,fragmentShader:yt.meshmatcap_frag},points:{uniforms:Ii([_e.points,_e.fog]),vertexShader:yt.points_vert,fragmentShader:yt.points_frag},dashed:{uniforms:Ii([_e.common,_e.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yt.linedashed_vert,fragmentShader:yt.linedashed_frag},depth:{uniforms:Ii([_e.common,_e.displacementmap]),vertexShader:yt.depth_vert,fragmentShader:yt.depth_frag},normal:{uniforms:Ii([_e.common,_e.bumpmap,_e.normalmap,_e.displacementmap,{opacity:{value:1}}]),vertexShader:yt.meshnormal_vert,fragmentShader:yt.meshnormal_frag},sprite:{uniforms:Ii([_e.sprite,_e.fog]),vertexShader:yt.sprite_vert,fragmentShader:yt.sprite_frag},background:{uniforms:{uvTransform:{value:new kn},t2D:{value:null}},vertexShader:yt.background_vert,fragmentShader:yt.background_frag},cube:{uniforms:Ii([_e.envmap,{opacity:{value:1}}]),vertexShader:yt.cube_vert,fragmentShader:yt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yt.equirect_vert,fragmentShader:yt.equirect_frag},distanceRGBA:{uniforms:Ii([_e.common,_e.displacementmap,{referencePosition:{value:new K},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yt.distanceRGBA_vert,fragmentShader:yt.distanceRGBA_frag},shadow:{uniforms:Ii([_e.lights,_e.fog,{color:{value:new ze(0)},opacity:{value:1}}]),vertexShader:yt.shadow_vert,fragmentShader:yt.shadow_frag}};Vo.physical={uniforms:Ii([Vo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Se(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new ze(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Se},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ze(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ze(1,1,1)},specularColorMap:{value:null}}]),vertexShader:yt.meshphysical_vert,fragmentShader:yt.meshphysical_frag};function N5(n,e,t,i,o,s){const r=new ze(0);let g=o===!0?0:1,a,l,u=null,d=0,C=null;function A(b,G){let m=!1,h=G.isScene===!0?G.background:null;h&&h.isTexture&&(h=e.get(h));const B=n.xr,y=B.getSession&&B.getSession();y&&y.environmentBlendMode==="additive"&&(h=null),h===null?f(r,g):h&&h.isColor&&(f(h,1),m=!0),(n.autoClear||m)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),h&&(h.isCubeTexture||h.mapping===CI)?(l===void 0&&(l=new Sn(new Ys(1,1,1),new uo({name:"BackgroundCubeMaterial",uniforms:zl(Vo.cube.uniforms),vertexShader:Vo.cube.vertexShader,fragmentShader:Vo.cube.fragmentShader,side:wn,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(Z,R,W){this.matrixWorld.copyPosition(W.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),l.material.uniforms.envMap.value=h,l.material.uniforms.flipEnvMap.value=h.isCubeTexture&&h.isRenderTargetTexture===!1?-1:1,(u!==h||d!==h.version||C!==n.toneMapping)&&(l.material.needsUpdate=!0,u=h,d=h.version,C=n.toneMapping),b.unshift(l,l.geometry,l.material,0,0,null)):h&&h.isTexture&&(a===void 0&&(a=new Sn(new jg(2,2),new uo({name:"BackgroundMaterial",uniforms:zl(Vo.background.uniforms),vertexShader:Vo.background.vertexShader,fragmentShader:Vo.background.fragmentShader,side:Yr,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=h,h.matrixAutoUpdate===!0&&h.updateMatrix(),a.material.uniforms.uvTransform.value.copy(h.matrix),(u!==h||d!==h.version||C!==n.toneMapping)&&(a.material.needsUpdate=!0,u=h,d=h.version,C=n.toneMapping),b.unshift(a,a.geometry,a.material,0,0,null))}function f(b,G){t.buffers.color.setClear(b.r,b.g,b.b,G,s)}return{getClearColor:function(){return r},setClearColor:function(b,G=1){r.set(b),g=G,f(r,g)},getClearAlpha:function(){return g},setClearAlpha:function(b){g=b,f(r,g)},render:A}}function L5(n,e,t,i){const o=n.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),r=i.isWebGL2||s!==null,g={},a=b(null);let l=a;function u(k,U,D,Q,$){let j=!1;if(r){const oe=f(Q,D,U);l!==oe&&(l=oe,C(l.object)),j=G(Q,$),j&&m(Q,$)}else{const oe=U.wireframe===!0;(l.geometry!==Q.id||l.program!==D.id||l.wireframe!==oe)&&(l.geometry=Q.id,l.program=D.id,l.wireframe=oe,j=!0)}k.isInstancedMesh===!0&&(j=!0),$!==null&&t.update($,34963),j&&(W(k,U,D,Q),$!==null&&n.bindBuffer(34963,t.get($).buffer))}function d(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}function C(k){return i.isWebGL2?n.bindVertexArray(k):s.bindVertexArrayOES(k)}function A(k){return i.isWebGL2?n.deleteVertexArray(k):s.deleteVertexArrayOES(k)}function f(k,U,D){const Q=D.wireframe===!0;let $=g[k.id];$===void 0&&($={},g[k.id]=$);let j=$[U.id];j===void 0&&(j={},$[U.id]=j);let oe=j[Q];return oe===void 0&&(oe=b(d()),j[Q]=oe),oe}function b(k){const U=[],D=[],Q=[];for(let $=0;$<o;$++)U[$]=0,D[$]=0,Q[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:D,attributeDivisors:Q,object:k,attributes:{},index:null}}function G(k,U){const D=l.attributes,Q=k.attributes;let $=0;for(const j in Q){const oe=D[j],Ie=Q[j];if(oe===void 0||oe.attribute!==Ie||oe.data!==Ie.data)return!0;$++}return l.attributesNum!==$||l.index!==U}function m(k,U){const D={},Q=k.attributes;let $=0;for(const j in Q){const oe=Q[j],Ie={};Ie.attribute=oe,oe.data&&(Ie.data=oe.data),D[j]=Ie,$++}l.attributes=D,l.attributesNum=$,l.index=U}function h(){const k=l.newAttributes;for(let U=0,D=k.length;U<D;U++)k[U]=0}function B(k){y(k,0)}function y(k,U){const D=l.newAttributes,Q=l.enabledAttributes,$=l.attributeDivisors;D[k]=1,Q[k]===0&&(n.enableVertexAttribArray(k),Q[k]=1),$[k]!==U&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](k,U),$[k]=U)}function Z(){const k=l.newAttributes,U=l.enabledAttributes;for(let D=0,Q=U.length;D<Q;D++)U[D]!==k[D]&&(n.disableVertexAttribArray(D),U[D]=0)}function R(k,U,D,Q,$,j){i.isWebGL2===!0&&(D===5124||D===5125)?n.vertexAttribIPointer(k,U,D,$,j):n.vertexAttribPointer(k,U,D,Q,$,j)}function W(k,U,D,Q){if(i.isWebGL2===!1&&(k.isInstancedMesh||Q.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;h();const $=Q.attributes,j=D.getAttributes(),oe=U.defaultAttributeValues;for(const Ie in j){const T=j[Ie];if(T.location>=0){let P=$[Ie];if(P===void 0&&(Ie==="instanceMatrix"&&k.instanceMatrix&&(P=k.instanceMatrix),Ie==="instanceColor"&&k.instanceColor&&(P=k.instanceColor)),P!==void 0){const Ce=P.normalized,Me=P.itemSize,ee=t.get(P);if(ee===void 0)continue;const _=ee.buffer,Ae=ee.type,ye=ee.bytesPerElement;if(P.isInterleavedBufferAttribute){const ge=P.data,we=ge.stride,Ke=P.offset;if(ge.isInstancedInterleavedBuffer){for(let ie=0;ie<T.locationSize;ie++)y(T.location+ie,ge.meshPerAttribute);k.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=ge.meshPerAttribute*ge.count)}else for(let ie=0;ie<T.locationSize;ie++)B(T.location+ie);n.bindBuffer(34962,_);for(let ie=0;ie<T.locationSize;ie++)R(T.location+ie,Me/T.locationSize,Ae,Ce,we*ye,(Ke+Me/T.locationSize*ie)*ye)}else{if(P.isInstancedBufferAttribute){for(let ge=0;ge<T.locationSize;ge++)y(T.location+ge,P.meshPerAttribute);k.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=P.meshPerAttribute*P.count)}else for(let ge=0;ge<T.locationSize;ge++)B(T.location+ge);n.bindBuffer(34962,_);for(let ge=0;ge<T.locationSize;ge++)R(T.location+ge,Me/T.locationSize,Ae,Ce,Me*ye,Me/T.locationSize*ge*ye)}}else if(oe!==void 0){const Ce=oe[Ie];if(Ce!==void 0)switch(Ce.length){case 2:n.vertexAttrib2fv(T.location,Ce);break;case 3:n.vertexAttrib3fv(T.location,Ce);break;case 4:n.vertexAttrib4fv(T.location,Ce);break;default:n.vertexAttrib1fv(T.location,Ce)}}}}Z()}function x(){S();for(const k in g){const U=g[k];for(const D in U){const Q=U[D];for(const $ in Q)A(Q[$].object),delete Q[$];delete U[D]}delete g[k]}}function X(k){if(g[k.id]===void 0)return;const U=g[k.id];for(const D in U){const Q=U[D];for(const $ in Q)A(Q[$].object),delete Q[$];delete U[D]}delete g[k.id]}function Y(k){for(const U in g){const D=g[U];if(D[k.id]===void 0)continue;const Q=D[k.id];for(const $ in Q)A(Q[$].object),delete Q[$];delete D[k.id]}}function S(){H(),l!==a&&(l=a,C(l.object))}function H(){a.geometry=null,a.program=null,a.wireframe=!1}return{setup:u,reset:S,resetDefaultState:H,dispose:x,releaseStatesOfGeometry:X,releaseStatesOfProgram:Y,initAttributes:h,enableAttribute:B,disableUnusedAttributes:Z}}function z5(n,e,t,i){const o=i.isWebGL2;let s;function r(l){s=l}function g(l,u){n.drawArrays(s,l,u),t.update(u,s,1)}function a(l,u,d){if(d===0)return;let C,A;if(o)C=n,A="drawArraysInstanced";else if(C=e.get("ANGLE_instanced_arrays"),A="drawArraysInstancedANGLE",C===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}C[A](s,l,u,d),t.update(u,s,d)}this.setMode=r,this.render=g,this.renderInstances=a}function k5(n,e,t){let i;function o(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const W=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(W.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(W){if(W==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";W="mediump"}return W==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r=typeof WebGL2RenderingContext!="undefined"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&n instanceof WebGL2ComputeRenderingContext;let g=t.precision!==void 0?t.precision:"highp";const a=s(g);a!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",a,"instead."),g=a);const l=r||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,d=n.getParameter(34930),C=n.getParameter(35660),A=n.getParameter(3379),f=n.getParameter(34076),b=n.getParameter(34921),G=n.getParameter(36347),m=n.getParameter(36348),h=n.getParameter(36349),B=C>0,y=r||e.has("OES_texture_float"),Z=B&&y,R=r?n.getParameter(36183):0;return{isWebGL2:r,drawBuffers:l,getMaxAnisotropy:o,getMaxPrecision:s,precision:g,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:C,maxTextureSize:A,maxCubemapSize:f,maxAttributes:b,maxVertexUniforms:G,maxVaryings:m,maxFragmentUniforms:h,vertexTextures:B,floatFragmentTextures:y,floatVertexTextures:Z,maxSamples:R}}function T5(n){const e=this;let t=null,i=0,o=!1,s=!1;const r=new Do,g=new kn,a={value:null,needsUpdate:!1};this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(d,C,A){const f=d.length!==0||C||i!==0||o;return o=C,t=u(d,A,0),i=d.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,l()},this.setState=function(d,C,A){const f=d.clippingPlanes,b=d.clipIntersection,G=d.clipShadows,m=n.get(d);if(!o||f===null||f.length===0||s&&!G)s?u(null):l();else{const h=s?0:i,B=h*4;let y=m.clippingState||null;a.value=y,y=u(f,C,B,A);for(let Z=0;Z!==B;++Z)y[Z]=t[Z];m.clippingState=y,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=h}};function l(){a.value!==t&&(a.value=t,a.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(d,C,A,f){const b=d!==null?d.length:0;let G=null;if(b!==0){if(G=a.value,f!==!0||G===null){const m=A+b*4,h=C.matrixWorldInverse;g.getNormalMatrix(h),(G===null||G.length<m)&&(G=new Float32Array(m));for(let B=0,y=A;B!==b;++B,y+=4)r.copy(d[B]).applyMatrix4(h,g),r.normal.toArray(G,y),G[y+3]=r.constant}a.value=G,a.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,G}}function E5(n){let e=new WeakMap;function t(r,g){return g===AC?r.mapping=Lr:g===hC&&(r.mapping=zr),r}function i(r){if(r&&r.isTexture&&r.isRenderTargetTexture===!1){const g=r.mapping;if(g===AC||g===hC)if(e.has(r)){const a=e.get(r).texture;return t(a,r.mapping)}else{const a=r.image;if(a&&a.height>0){const l=new Jh(a.height/2);return l.fromEquirectangularTexture(n,r),e.set(r,l),r.addEventListener("dispose",o),t(l.texture,r.mapping)}else return null}}return r}function o(r){const g=r.target;g.removeEventListener("dispose",o);const a=e.get(g);a!==void 0&&(e.delete(g),a.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class ca extends Og{constructor(e=-1,t=1,i=1,o=-1,s=.1,r=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=o,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,o,s,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=o,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let s=i-e,r=i+e,g=o+t,a=o-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,r=s+l*this.view.width,g-=u*this.view.offsetY,a=g-u*this.view.height}this.projectionMatrix.makeOrthographic(s,r,g,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}ca.prototype.isOrthographicCamera=!0;const Cl=4,Yw=[.125,.215,.35,.446,.526,.582],yg=20,kf=new ca,Nw=new ze;let Tf=null;const bg=(1+Math.sqrt(5))/2,Ea=1/bg,Lw=[new K(1,1,1),new K(-1,1,1),new K(1,1,-1),new K(-1,1,-1),new K(0,bg,Ea),new K(0,bg,-Ea),new K(Ea,0,bg),new K(-Ea,0,bg),new K(bg,Ea,0),new K(-bg,Ea,0)];class N0{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,o=100){Tf=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,o,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Tw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=kw(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Tf),e.scissorTest=!1,Yd(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Lr||e.mapping===zr?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Tf=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize-32,i={magFilter:gn,minFilter:gn,generateMipmaps:!1,type:Ng,format:Ai,encoding:Xo,depthBuffer:!1},o=zw(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=zw(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_5(s)),this._blurMaterial=J5(s,e,t)}return o}_compileMaterial(e){const t=new Sn(this._lodPlanes[0],e);this._renderer.compile(t,kf)}_sceneToCubeUV(e,t,i,o){const g=new Kn(90,1,t,i),a=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,C=u.toneMapping;u.getClearColor(Nw),u.toneMapping=ts,u.autoClear=!1;const A=new Ki({name:"PMREM.Background",side:wn,depthWrite:!1,depthTest:!1}),f=new Sn(new Ys,A);let b=!1;const G=e.background;G?G.isColor&&(A.color.copy(G),e.background=null,b=!0):(A.color.copy(Nw),b=!0);for(let m=0;m<6;m++){const h=m%3;h===0?(g.up.set(0,a[m],0),g.lookAt(l[m],0,0)):h===1?(g.up.set(0,0,a[m]),g.lookAt(0,l[m],0)):(g.up.set(0,a[m],0),g.lookAt(0,0,l[m]));const B=this._cubeSize;Yd(o,h*B,m>2?B:0,B,B),u.setRenderTarget(o),b&&u.render(f,g),u.render(e,g)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=C,u.autoClear=d,e.background=G}_textureToCubeUV(e,t){const i=this._renderer,o=e.mapping===Lr||e.mapping===zr;o?(this._cubemapMaterial===null&&(this._cubemapMaterial=Tw()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=kw());const s=o?this._cubemapMaterial:this._equirectMaterial,r=new Sn(this._lodPlanes[0],s),g=s.uniforms;g.envMap.value=e;const a=this._cubeSize;Yd(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(r,kf)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let o=1;o<this._lodPlanes.length;o++){const s=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),r=Lw[(o-1)%Lw.length];this._blur(e,o-1,o,s,r)}t.autoClear=i}_blur(e,t,i,o,s){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,i,o,"latitudinal",s),this._halfBlur(r,e,i,i,o,"longitudinal",s)}_halfBlur(e,t,i,o,s,r,g){const a=this._renderer,l=this._blurMaterial;r!=="latitudinal"&&r!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new Sn(this._lodPlanes[o],l),C=l.uniforms,A=this._sizeLods[i]-1,f=isFinite(s)?Math.PI/(2*A):2*Math.PI/(2*yg-1),b=s/f,G=isFinite(s)?1+Math.floor(u*b):yg;G>yg&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${G} samples when the maximum is set to ${yg}`);const m=[];let h=0;for(let W=0;W<yg;++W){const x=W/b,X=Math.exp(-x*x/2);m.push(X),W===0?h+=X:W<G&&(h+=2*X)}for(let W=0;W<m.length;W++)m[W]=m[W]/h;C.envMap.value=e.texture,C.samples.value=G,C.weights.value=m,C.latitudinal.value=r==="latitudinal",g&&(C.poleAxis.value=g);const{_lodMax:B}=this;C.dTheta.value=f,C.mipInt.value=B-i;const y=this._sizeLods[o],Z=3*y*(o>B-Cl?o-B+Cl:0),R=4*(this._cubeSize-y);Yd(t,Z,R,3*y,2*y),a.setRenderTarget(t),a.render(d,kf)}}function _5(n){const e=[],t=[],i=[];let o=n;const s=n-Cl+1+Yw.length;for(let r=0;r<s;r++){const g=Math.pow(2,o);t.push(g);let a=1/g;r>n-Cl?a=Yw[r-n+Cl-1]:r===0&&(a=0),i.push(a);const l=1/(g-1),u=-l/2,d=1+l/2,C=[u,u,d,u,d,d,u,u,d,d,u,d],A=6,f=6,b=3,G=2,m=1,h=new Float32Array(b*f*A),B=new Float32Array(G*f*A),y=new Float32Array(m*f*A);for(let R=0;R<A;R++){const W=R%3*2/3-1,x=R>2?0:-1,X=[W,x,0,W+2/3,x,0,W+2/3,x+1,0,W,x,0,W+2/3,x+1,0,W,x+1,0];h.set(X,b*f*R),B.set(C,G*f*R);const Y=[R,R,R,R,R,R];y.set(Y,m*f*R)}const Z=new at;Z.setAttribute("position",new vt(h,b)),Z.setAttribute("uv",new vt(B,G)),Z.setAttribute("faceIndex",new vt(y,m)),e.push(Z),o>Cl&&o--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function zw(n,e,t){const i=new Gi(n,e,t);return i.texture.mapping=CI,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Yd(n,e,t,i,o){n.viewport.set(e,t,i,o),n.scissor.set(e,t,i,o)}function J5(n,e,t){const i=new Float32Array(yg),o=new K(0,1,0);return new uo({name:"SphericalGaussianBlur",defines:{n:yg,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:pB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function kw(){return new uo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:pB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function Tw(){return new uo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:pB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function pB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function D5(n){let e=new WeakMap,t=null;function i(g){if(g&&g.isTexture){const a=g.mapping,l=a===AC||a===hC,u=a===Lr||a===zr;if(l||u)if(g.isRenderTargetTexture&&g.needsPMREMUpdate===!0){g.needsPMREMUpdate=!1;let d=e.get(g);return t===null&&(t=new N0(n)),d=l?t.fromEquirectangular(g,d):t.fromCubemap(g,d),e.set(g,d),d.texture}else{if(e.has(g))return e.get(g).texture;{const d=g.image;if(l&&d&&d.height>0||u&&d&&o(d)){t===null&&(t=new N0(n));const C=l?t.fromEquirectangular(g):t.fromCubemap(g);return e.set(g,C),g.addEventListener("dispose",s),C.texture}else return null}}}return g}function o(g){let a=0;const l=6;for(let u=0;u<l;u++)g[u]!==void 0&&a++;return a===l}function s(g){const a=g.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:r}}function U5(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let o;switch(i){case"WEBGL_depth_texture":o=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=n.getExtension(i)}return e[i]=o,o}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const o=t(i);return o===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),o}}}function P5(n,e,t,i){const o={},s=new WeakMap;function r(d){const C=d.target;C.index!==null&&e.remove(C.index);for(const f in C.attributes)e.remove(C.attributes[f]);C.removeEventListener("dispose",r),delete o[C.id];const A=s.get(C);A&&(e.remove(A),s.delete(C)),i.releaseStatesOfGeometry(C),C.isInstancedBufferGeometry===!0&&delete C._maxInstanceCount,t.memory.geometries--}function g(d,C){return o[C.id]===!0||(C.addEventListener("dispose",r),o[C.id]=!0,t.memory.geometries++),C}function a(d){const C=d.attributes;for(const f in C)e.update(C[f],34962);const A=d.morphAttributes;for(const f in A){const b=A[f];for(let G=0,m=b.length;G<m;G++)e.update(b[G],34962)}}function l(d){const C=[],A=d.index,f=d.attributes.position;let b=0;if(A!==null){const h=A.array;b=A.version;for(let B=0,y=h.length;B<y;B+=3){const Z=h[B+0],R=h[B+1],W=h[B+2];C.push(Z,R,R,W,W,Z)}}else{const h=f.array;b=f.version;for(let B=0,y=h.length/3-1;B<y;B+=3){const Z=B+0,R=B+1,W=B+2;C.push(Z,R,R,W,W,Z)}}const G=new(lx(C)?Eh:Th)(C,1);G.version=b;const m=s.get(d);m&&e.remove(m),s.set(d,G)}function u(d){const C=s.get(d);if(C){const A=d.index;A!==null&&C.version<A.version&&l(d)}else l(d);return s.get(d)}return{get:g,update:a,getWireframeAttribute:u}}function Q5(n,e,t,i){const o=i.isWebGL2;let s;function r(C){s=C}let g,a;function l(C){g=C.type,a=C.bytesPerElement}function u(C,A){n.drawElements(s,A,g,C*a),t.update(A,s,1)}function d(C,A,f){if(f===0)return;let b,G;if(o)b=n,G="drawElementsInstanced";else if(b=e.get("ANGLE_instanced_arrays"),G="drawElementsInstancedANGLE",b===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}b[G](s,A,g,C*a,f),t.update(A,s,f)}this.setMode=r,this.setIndex=l,this.render=u,this.renderInstances=d}function O5(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,r,g){switch(t.calls++,r){case 4:t.triangles+=g*(s/3);break;case 1:t.lines+=g*(s/2);break;case 3:t.lines+=g*(s-1);break;case 2:t.lines+=g*s;break;case 0:t.points+=g*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);break}}function o(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:o,update:i}}function j5(n,e){return n[0]-e[0]}function q5(n,e){return Math.abs(e[1])-Math.abs(n[1])}function Ef(n,e){let t=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?t=127:i instanceof Int16Array?t=32767:i instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),n.divideScalar(t)}function $5(n,e,t){const i={},o=new Float32Array(8),s=new WeakMap,r=new zt,g=[];for(let l=0;l<8;l++)g[l]=[l,0];function a(l,u,d,C){const A=l.morphTargetInfluences;if(e.isWebGL2===!0){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,b=f!==void 0?f.length:0;let G=s.get(u);if(G===void 0||G.count!==b){let D=function(){k.dispose(),s.delete(u),u.removeEventListener("dispose",D)};G!==void 0&&G.texture.dispose();const B=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,Z=u.morphAttributes.color!==void 0,R=u.morphAttributes.position||[],W=u.morphAttributes.normal||[],x=u.morphAttributes.color||[];let X=0;B===!0&&(X=1),y===!0&&(X=2),Z===!0&&(X=3);let Y=u.attributes.position.count*X,S=1;Y>e.maxTextureSize&&(S=Math.ceil(Y/e.maxTextureSize),Y=e.maxTextureSize);const H=new Float32Array(Y*S*4*b),k=new uI(H,Y,S,b);k.format=Ai,k.type=Hs,k.needsUpdate=!0;const U=X*4;for(let Q=0;Q<b;Q++){const $=R[Q],j=W[Q],oe=x[Q],Ie=Y*S*4*Q;for(let T=0;T<$.count;T++){const P=T*U;B===!0&&(r.fromBufferAttribute($,T),$.normalized===!0&&Ef(r,$),H[Ie+P+0]=r.x,H[Ie+P+1]=r.y,H[Ie+P+2]=r.z,H[Ie+P+3]=0),y===!0&&(r.fromBufferAttribute(j,T),j.normalized===!0&&Ef(r,j),H[Ie+P+4]=r.x,H[Ie+P+5]=r.y,H[Ie+P+6]=r.z,H[Ie+P+7]=0),Z===!0&&(r.fromBufferAttribute(oe,T),oe.normalized===!0&&Ef(r,j),H[Ie+P+8]=r.x,H[Ie+P+9]=r.y,H[Ie+P+10]=r.z,H[Ie+P+11]=oe.itemSize===4?r.w:1)}}G={count:b,texture:k,size:new Se(Y,S)},s.set(u,G),u.addEventListener("dispose",D)}let m=0;for(let B=0;B<A.length;B++)m+=A[B];const h=u.morphTargetsRelative?1:1-m;C.getUniforms().setValue(n,"morphTargetBaseInfluence",h),C.getUniforms().setValue(n,"morphTargetInfluences",A),C.getUniforms().setValue(n,"morphTargetsTexture",G.texture,t),C.getUniforms().setValue(n,"morphTargetsTextureSize",G.size)}else{const f=A===void 0?0:A.length;let b=i[u.id];if(b===void 0||b.length!==f){b=[];for(let y=0;y<f;y++)b[y]=[y,0];i[u.id]=b}for(let y=0;y<f;y++){const Z=b[y];Z[0]=y,Z[1]=A[y]}b.sort(q5);for(let y=0;y<8;y++)y<f&&b[y][1]?(g[y][0]=b[y][0],g[y][1]=b[y][1]):(g[y][0]=Number.MAX_SAFE_INTEGER,g[y][1]=0);g.sort(j5);const G=u.morphAttributes.position,m=u.morphAttributes.normal;let h=0;for(let y=0;y<8;y++){const Z=g[y],R=Z[0],W=Z[1];R!==Number.MAX_SAFE_INTEGER&&W?(G&&u.getAttribute("morphTarget"+y)!==G[R]&&u.setAttribute("morphTarget"+y,G[R]),m&&u.getAttribute("morphNormal"+y)!==m[R]&&u.setAttribute("morphNormal"+y,m[R]),o[y]=W,h+=W):(G&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),m&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),o[y]=0)}const B=u.morphTargetsRelative?1:1-h;C.getUniforms().setValue(n,"morphTargetBaseInfluence",B),C.getUniforms().setValue(n,"morphTargetInfluences",o)}}return{update:a}}function e3(n,e,t,i){let o=new WeakMap;function s(a){const l=i.render.frame,u=a.geometry,d=e.get(a,u);return o.get(d)!==l&&(e.update(d),o.set(d,l)),a.isInstancedMesh&&(a.hasEventListener("dispose",g)===!1&&a.addEventListener("dispose",g),t.update(a.instanceMatrix,34962),a.instanceColor!==null&&t.update(a.instanceColor,34962)),d}function r(){o=new WeakMap}function g(a){const l=a.target;l.removeEventListener("dispose",g),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:s,dispose:r}}const yx=new pn,vx=new uI,Zx=new _C,wx=new dI,Ew=[],_w=[],Jw=new Float32Array(16),Dw=new Float32Array(9),Uw=new Float32Array(4);function AI(n,e,t){const i=n[0];if(i<=0||i>0)return n;const o=e*t;let s=Ew[o];if(s===void 0&&(s=new Float32Array(o),Ew[o]=s),e!==0){i.toArray(s,0);for(let r=1,g=0;r!==e;++r)g+=t,n[r].toArray(s,g)}return s}function Bi(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function mi(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Dh(n,e){let t=_w[e];t===void 0&&(t=new Int32Array(e),_w[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function t3(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function n3(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Bi(t,e))return;n.uniform2fv(this.addr,e),mi(t,e)}}function i3(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Bi(t,e))return;n.uniform3fv(this.addr,e),mi(t,e)}}function o3(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Bi(t,e))return;n.uniform4fv(this.addr,e),mi(t,e)}}function s3(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Bi(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),mi(t,e)}else{if(Bi(t,i))return;Uw.set(i),n.uniformMatrix2fv(this.addr,!1,Uw),mi(t,i)}}function r3(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Bi(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),mi(t,e)}else{if(Bi(t,i))return;Dw.set(i),n.uniformMatrix3fv(this.addr,!1,Dw),mi(t,i)}}function g3(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Bi(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),mi(t,e)}else{if(Bi(t,i))return;Jw.set(i),n.uniformMatrix4fv(this.addr,!1,Jw),mi(t,i)}}function a3(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function l3(n,e){const t=this.cache;Bi(t,e)||(n.uniform2iv(this.addr,e),mi(t,e))}function I3(n,e){const t=this.cache;Bi(t,e)||(n.uniform3iv(this.addr,e),mi(t,e))}function c3(n,e){const t=this.cache;Bi(t,e)||(n.uniform4iv(this.addr,e),mi(t,e))}function C3(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function u3(n,e){const t=this.cache;Bi(t,e)||(n.uniform2uiv(this.addr,e),mi(t,e))}function d3(n,e){const t=this.cache;Bi(t,e)||(n.uniform3uiv(this.addr,e),mi(t,e))}function A3(n,e){const t=this.cache;Bi(t,e)||(n.uniform4uiv(this.addr,e),mi(t,e))}function h3(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTexture2D(e||yx,o)}function p3(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTexture3D(e||Zx,o)}function m3(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTextureCube(e||wx,o)}function f3(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTexture2DArray(e||vx,o)}function b3(n){switch(n){case 5126:return t3;case 35664:return n3;case 35665:return i3;case 35666:return o3;case 35674:return s3;case 35675:return r3;case 35676:return g3;case 5124:case 35670:return a3;case 35667:case 35671:return l3;case 35668:case 35672:return I3;case 35669:case 35673:return c3;case 5125:return C3;case 36294:return u3;case 36295:return d3;case 36296:return A3;case 35678:case 36198:case 36298:case 36306:case 35682:return h3;case 35679:case 36299:case 36307:return p3;case 35680:case 36300:case 36308:case 36293:return m3;case 36289:case 36303:case 36311:case 36292:return f3}}function G3(n,e){n.uniform1fv(this.addr,e)}function B3(n,e){const t=AI(e,this.size,2);n.uniform2fv(this.addr,t)}function y3(n,e){const t=AI(e,this.size,3);n.uniform3fv(this.addr,t)}function v3(n,e){const t=AI(e,this.size,4);n.uniform4fv(this.addr,t)}function Z3(n,e){const t=AI(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function w3(n,e){const t=AI(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function R3(n,e){const t=AI(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function W3(n,e){n.uniform1iv(this.addr,e)}function S3(n,e){n.uniform2iv(this.addr,e)}function V3(n,e){n.uniform3iv(this.addr,e)}function x3(n,e){n.uniform4iv(this.addr,e)}function H3(n,e){n.uniform1uiv(this.addr,e)}function X3(n,e){n.uniform2uiv(this.addr,e)}function M3(n,e){n.uniform3uiv(this.addr,e)}function K3(n,e){n.uniform4uiv(this.addr,e)}function F3(n,e,t){const i=e.length,o=Dh(t,i);n.uniform1iv(this.addr,o);for(let s=0;s!==i;++s)t.setTexture2D(e[s]||yx,o[s])}function Y3(n,e,t){const i=e.length,o=Dh(t,i);n.uniform1iv(this.addr,o);for(let s=0;s!==i;++s)t.setTexture3D(e[s]||Zx,o[s])}function N3(n,e,t){const i=e.length,o=Dh(t,i);n.uniform1iv(this.addr,o);for(let s=0;s!==i;++s)t.setTextureCube(e[s]||wx,o[s])}function L3(n,e,t){const i=e.length,o=Dh(t,i);n.uniform1iv(this.addr,o);for(let s=0;s!==i;++s)t.setTexture2DArray(e[s]||vx,o[s])}function z3(n){switch(n){case 5126:return G3;case 35664:return B3;case 35665:return y3;case 35666:return v3;case 35674:return Z3;case 35675:return w3;case 35676:return R3;case 5124:case 35670:return W3;case 35667:case 35671:return S3;case 35668:case 35672:return V3;case 35669:case 35673:return x3;case 5125:return H3;case 36294:return X3;case 36295:return M3;case 36296:return K3;case 35678:case 36198:case 36298:case 36306:case 35682:return F3;case 35679:case 36299:case 36307:return Y3;case 35680:case 36300:case 36308:case 36293:return N3;case 36289:case 36303:case 36311:case 36292:return L3}}function k3(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=b3(e.type)}function Rx(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=z3(e.type)}Rx.prototype.updateCache=function(n){const e=this.cache;n instanceof Float32Array&&e.length!==n.length&&(this.cache=new Float32Array(n.length)),mi(e,n)};function Wx(n){this.id=n,this.seq=[],this.map={}}Wx.prototype.setValue=function(n,e,t){const i=this.seq;for(let o=0,s=i.length;o!==s;++o){const r=i[o];r.setValue(n,e[r.id],t)}};const _f=/(\w+)(\])?(\[|\.)?/g;function Pw(n,e){n.seq.push(e),n.map[e.id]=e}function T3(n,e,t){const i=n.name,o=i.length;for(_f.lastIndex=0;;){const s=_f.exec(i),r=_f.lastIndex;let g=s[1];const a=s[2]==="]",l=s[3];if(a&&(g=g|0),l===void 0||l==="["&&r+2===o){Pw(t,l===void 0?new k3(g,n,e):new Rx(g,n,e));break}else{let d=t.map[g];d===void 0&&(d=new Wx(g),Pw(t,d)),t=d}}}function xr(n,e){this.seq=[],this.map={};const t=n.getProgramParameter(e,35718);for(let i=0;i<t;++i){const o=n.getActiveUniform(e,i),s=n.getUniformLocation(e,o.name);T3(o,s,this)}}xr.prototype.setValue=function(n,e,t,i){const o=this.map[e];o!==void 0&&o.setValue(n,t,i)};xr.prototype.setOptional=function(n,e,t){const i=e[t];i!==void 0&&this.setValue(n,t,i)};xr.upload=function(n,e,t,i){for(let o=0,s=e.length;o!==s;++o){const r=e[o],g=t[r.id];g.needsUpdate!==!1&&r.setValue(n,g.value,i)}};xr.seqWithValue=function(n,e){const t=[];for(let i=0,o=n.length;i!==o;++i){const s=n[i];s.id in e&&t.push(s)}return t};function Qw(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let E3=0;function _3(n){const e=n.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function J3(n){switch(n){case Xo:return["Linear","( value )"];case Lt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function Ow(n,e,t){const i=n.getShaderParameter(e,35713),o=n.getShaderInfoLog(e).trim();return i&&o===""?"":t.toUpperCase()+`

`+o+`

`+_3(n.getShaderSource(e))}function D3(n,e){const t=J3(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function U3(n,e){let t;switch(e){case MV:t="Linear";break;case KV:t="Reinhard";break;case FV:t="OptimizedCineon";break;case uB:t="ACESFilmic";break;case YV:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function P3(n){return[n.extensionDerivatives||!!n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Sc).join(`
`)}function Q3(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function O3(n,e){const t={},i=n.getProgramParameter(e,35721);for(let o=0;o<i;o++){const s=n.getActiveAttrib(e,o),r=s.name;let g=1;s.type===35674&&(g=2),s.type===35675&&(g=3),s.type===35676&&(g=4),t[r]={type:s.type,location:n.getAttribLocation(e,r),locationSize:g}}return t}function Sc(n){return n!==""}function jw(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function qw(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const j3=/^[ \t]*#include +<([\w\d./]+)>/gm;function L0(n){return n.replace(j3,q3)}function q3(n,e){const t=yt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return L0(t)}const $3=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,eL=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function $w(n){return n.replace(eL,Sx).replace($3,tL)}function tL(n,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Sx(n,e,t,i)}function Sx(n,e,t,i){let o="";for(let s=parseInt(e);s<parseInt(t);s++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return o}function e2(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function nL(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===aB?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===lB?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===ll&&(e="SHADOWMAP_TYPE_VSM"),e}function iL(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Lr:case zr:e="ENVMAP_TYPE_CUBE";break;case CI:case EC:e="ENVMAP_TYPE_CUBE_UV";break}return e}function oL(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case zr:case EC:e="ENVMAP_MODE_REFRACTION";break}return e}function sL(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case TC:e="ENVMAP_BLENDING_MULTIPLY";break;case HV:e="ENVMAP_BLENDING_MIX";break;case XV:e="ENVMAP_BLENDING_ADD";break}return e}function rL(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e/32+1)+3,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function gL(n,e,t,i){const o=n.getContext(),s=t.defines;let r=t.vertexShader,g=t.fragmentShader;const a=nL(t),l=iL(t),u=oL(t),d=sL(t),C=rL(t),A=t.isWebGL2?"":P3(t),f=Q3(s),b=o.createProgram();let G,m,h=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(G=[f].filter(Sc).join(`
`),G.length>0&&(G+=`
`),m=[A,f].filter(Sc).join(`
`),m.length>0&&(m+=`
`)):(G=[e2(t),"#define SHADER_NAME "+t.shaderName,f,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+a:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Sc).join(`
`),m=[A,e2(t),"#define SHADER_NAME "+t.shaderName,f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",C?"#define CUBEUV_TEXEL_WIDTH "+C.texelWidth:"",C?"#define CUBEUV_TEXEL_HEIGHT "+C.texelHeight:"",C?"#define CUBEUV_MAX_MIP "+C.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+a:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ts?"#define TONE_MAPPING":"",t.toneMapping!==ts?yt.tonemapping_pars_fragment:"",t.toneMapping!==ts?U3("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",yt.encodings_pars_fragment,D3("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Sc).join(`
`)),r=L0(r),r=jw(r,t),r=qw(r,t),g=L0(g),g=jw(g,t),g=qw(g,t),r=$w(r),g=$w(g),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(h=`#version 300 es
`,G=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+G,m=["#define varying in",t.glslVersion===K0?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===K0?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const B=h+G+r,y=h+m+g,Z=Qw(o,35633,B),R=Qw(o,35632,y);if(o.attachShader(b,Z),o.attachShader(b,R),t.index0AttributeName!==void 0?o.bindAttribLocation(b,0,t.index0AttributeName):t.morphTargets===!0&&o.bindAttribLocation(b,0,"position"),o.linkProgram(b),n.debug.checkShaderErrors){const X=o.getProgramInfoLog(b).trim(),Y=o.getShaderInfoLog(Z).trim(),S=o.getShaderInfoLog(R).trim();let H=!0,k=!0;if(o.getProgramParameter(b,35714)===!1){H=!1;const U=Ow(o,Z,"vertex"),D=Ow(o,R,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(b,35715)+`

Program Info Log: `+X+`
`+U+`
`+D)}else X!==""?console.warn("THREE.WebGLProgram: Program Info Log:",X):(Y===""||S==="")&&(k=!1);k&&(this.diagnostics={runnable:H,programLog:X,vertexShader:{log:Y,prefix:G},fragmentShader:{log:S,prefix:m}})}o.deleteShader(Z),o.deleteShader(R);let W;this.getUniforms=function(){return W===void 0&&(W=new xr(o,b)),W};let x;return this.getAttributes=function(){return x===void 0&&(x=O3(o,b)),x},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(b),this.program=void 0},this.name=t.shaderName,this.id=E3++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=Z,this.fragmentShader=R,this}let aL=0;class lL{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,o=this._getShaderStage(t),s=this._getShaderStage(i),r=this._getShaderCacheForMaterial(e);return r.has(o)===!1&&(r.add(o),o.usedTimes++),r.has(s)===!1&&(r.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return t.has(e)===!1&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(t.has(e)===!1){const i=new IL;t.set(e,i)}return t.get(e)}}class IL{constructor(){this.id=aL++,this.usedTimes=0}}function cL(n,e,t,i,o,s,r){const g=new kg,a=new lL,l=[],u=o.isWebGL2,d=o.logarithmicDepthBuffer,C=o.floatVertexTextures,A=o.maxVertexUniforms,f=o.vertexTextures;let b=o.precision;const G={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(S){const k=S.skeleton.bones;if(C)return 1024;{const D=Math.floor((A-20)/4),Q=Math.min(D,k.length);return Q<k.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+k.length+" bones. This GPU supports "+Q+"."),0):Q}}function h(S,H,k,U,D){const Q=U.fog,$=D.geometry,j=S.isMeshStandardMaterial?U.environment:null,oe=(S.isMeshStandardMaterial?t:e).get(S.envMap||j),Ie=!!oe&&(oe.mapping===CI||oe.mapping===EC)?oe.image.height:null,T=G[S.type],P=D.isSkinnedMesh?m(D):0;S.precision!==null&&(b=o.getMaxPrecision(S.precision),b!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",b,"instead."));const Ce=$.morphAttributes.position||$.morphAttributes.normal||$.morphAttributes.color,Me=Ce!==void 0?Ce.length:0;let ee=0;$.morphAttributes.position!==void 0&&(ee=1),$.morphAttributes.normal!==void 0&&(ee=2),$.morphAttributes.color!==void 0&&(ee=3);let _,Ae,ye,ge;if(T){const Ge=Vo[T];_=Ge.vertexShader,Ae=Ge.fragmentShader}else _=S.vertexShader,Ae=S.fragmentShader,a.update(S),ye=a.getVertexShaderID(S),ge=a.getFragmentShaderID(S);const we=n.getRenderTarget(),Ke=S.alphaTest>0,ie=S.clearcoat>0;return{isWebGL2:u,shaderID:T,shaderName:S.type,vertexShader:_,fragmentShader:Ae,defines:S.defines,customVertexShaderID:ye,customFragmentShaderID:ge,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:b,instancing:D.isInstancedMesh===!0,instancingColor:D.isInstancedMesh===!0&&D.instanceColor!==null,supportsVertexTextures:f,outputEncoding:we===null?n.outputEncoding:we.isXRRenderTarget===!0?we.texture.encoding:Xo,map:!!S.map,matcap:!!S.matcap,envMap:!!oe,envMapMode:oe&&oe.mapping,envMapCubeUVHeight:Ie,lightMap:!!S.lightMap,aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:S.normalMapType===rx,tangentSpaceNormalMap:S.normalMapType===Pr,decodeVideoTexture:!!S.map&&S.map.isVideoTexture===!0&&S.map.encoding===Lt,clearcoat:ie,clearcoatMap:ie&&!!S.clearcoatMap,clearcoatRoughnessMap:ie&&!!S.clearcoatRoughnessMap,clearcoatNormalMap:ie&&!!S.clearcoatNormalMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,specularIntensityMap:!!S.specularIntensityMap,specularColorMap:!!S.specularColorMap,opaque:S.transparent===!1&&S.blending===Yg,alphaMap:!!S.alphaMap,alphaTest:Ke,gradientMap:!!S.gradientMap,sheen:S.sheen>0,sheenColorMap:!!S.sheenColorMap,sheenRoughnessMap:!!S.sheenRoughnessMap,transmission:S.transmission>0,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:!!S.normalMap&&!!$.attributes.tangent,vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,vertexUvs:!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatMap||!!S.clearcoatRoughnessMap||!!S.clearcoatNormalMap||!!S.displacementMap||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||!!S.sheenColorMap||!!S.sheenRoughnessMap,uvsVertexOnly:!(!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatNormalMap||S.transmission>0||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||S.sheen>0||!!S.sheenColorMap||!!S.sheenRoughnessMap)&&!!S.displacementMap,fog:!!Q,useFog:S.fog,fogExp2:Q&&Q.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:d,skinning:D.isSkinnedMesh===!0&&P>0,maxBones:P,useVertexTexture:C,morphTargets:$.morphAttributes.position!==void 0,morphNormals:$.morphAttributes.normal!==void 0,morphColors:$.morphAttributes.color!==void 0,morphTargetsCount:Me,morphTextureStride:ee,numDirLights:H.directional.length,numPointLights:H.point.length,numSpotLights:H.spot.length,numRectAreaLights:H.rectArea.length,numHemiLights:H.hemi.length,numDirLightShadows:H.directionalShadowMap.length,numPointLightShadows:H.pointShadowMap.length,numSpotLightShadows:H.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:S.dithering,shadowMapEnabled:n.shadowMap.enabled&&k.length>0,shadowMapType:n.shadowMap.type,toneMapping:S.toneMapped?n.toneMapping:ts,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===Nr,flipSided:S.side===wn,depthPacking:S.depthPacking!==void 0?S.depthPacking:!1,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}}function B(S){const H=[];if(S.shaderID?H.push(S.shaderID):(H.push(S.customVertexShaderID),H.push(S.customFragmentShaderID)),S.defines!==void 0)for(const k in S.defines)H.push(k),H.push(S.defines[k]);return S.isRawShaderMaterial===!1&&(y(H,S),Z(H,S),H.push(n.outputEncoding)),H.push(S.customProgramCacheKey),H.join()}function y(S,H){S.push(H.precision),S.push(H.outputEncoding),S.push(H.envMapMode),S.push(H.envMapCubeUVHeight),S.push(H.combine),S.push(H.vertexUvs),S.push(H.fogExp2),S.push(H.sizeAttenuation),S.push(H.maxBones),S.push(H.morphTargetsCount),S.push(H.morphAttributeCount),S.push(H.numDirLights),S.push(H.numPointLights),S.push(H.numSpotLights),S.push(H.numHemiLights),S.push(H.numRectAreaLights),S.push(H.numDirLightShadows),S.push(H.numPointLightShadows),S.push(H.numSpotLightShadows),S.push(H.shadowMapType),S.push(H.toneMapping),S.push(H.numClippingPlanes),S.push(H.numClipIntersection)}function Z(S,H){g.disableAll(),H.isWebGL2&&g.enable(0),H.supportsVertexTextures&&g.enable(1),H.instancing&&g.enable(2),H.instancingColor&&g.enable(3),H.map&&g.enable(4),H.matcap&&g.enable(5),H.envMap&&g.enable(6),H.lightMap&&g.enable(7),H.aoMap&&g.enable(8),H.emissiveMap&&g.enable(9),H.bumpMap&&g.enable(10),H.normalMap&&g.enable(11),H.objectSpaceNormalMap&&g.enable(12),H.tangentSpaceNormalMap&&g.enable(13),H.clearcoat&&g.enable(14),H.clearcoatMap&&g.enable(15),H.clearcoatRoughnessMap&&g.enable(16),H.clearcoatNormalMap&&g.enable(17),H.displacementMap&&g.enable(18),H.specularMap&&g.enable(19),H.roughnessMap&&g.enable(20),H.metalnessMap&&g.enable(21),H.gradientMap&&g.enable(22),H.alphaMap&&g.enable(23),H.alphaTest&&g.enable(24),H.vertexColors&&g.enable(25),H.vertexAlphas&&g.enable(26),H.vertexUvs&&g.enable(27),H.vertexTangents&&g.enable(28),H.uvsVertexOnly&&g.enable(29),H.fog&&g.enable(30),S.push(g.mask),g.disableAll(),H.useFog&&g.enable(0),H.flatShading&&g.enable(1),H.logarithmicDepthBuffer&&g.enable(2),H.skinning&&g.enable(3),H.useVertexTexture&&g.enable(4),H.morphTargets&&g.enable(5),H.morphNormals&&g.enable(6),H.morphColors&&g.enable(7),H.premultipliedAlpha&&g.enable(8),H.shadowMapEnabled&&g.enable(9),H.physicallyCorrectLights&&g.enable(10),H.doubleSided&&g.enable(11),H.flipSided&&g.enable(12),H.depthPacking&&g.enable(13),H.dithering&&g.enable(14),H.specularIntensityMap&&g.enable(15),H.specularColorMap&&g.enable(16),H.transmission&&g.enable(17),H.transmissionMap&&g.enable(18),H.thicknessMap&&g.enable(19),H.sheen&&g.enable(20),H.sheenColorMap&&g.enable(21),H.sheenRoughnessMap&&g.enable(22),H.decodeVideoTexture&&g.enable(23),H.opaque&&g.enable(24),S.push(g.mask)}function R(S){const H=G[S.type];let k;if(H){const U=Vo[H];k=Gx.clone(U.uniforms)}else k=S.uniforms;return k}function W(S,H){let k;for(let U=0,D=l.length;U<D;U++){const Q=l[U];if(Q.cacheKey===H){k=Q,++k.usedTimes;break}}return k===void 0&&(k=new gL(n,H,S,s),l.push(k)),k}function x(S){if(--S.usedTimes===0){const H=l.indexOf(S);l[H]=l[l.length-1],l.pop(),S.destroy()}}function X(S){a.remove(S)}function Y(){a.dispose()}return{getParameters:h,getProgramCacheKey:B,getUniforms:R,acquireProgram:W,releaseProgram:x,releaseShaderCache:X,programs:l,dispose:Y}}function CL(){let n=new WeakMap;function e(s){let r=n.get(s);return r===void 0&&(r={},n.set(s,r)),r}function t(s){n.delete(s)}function i(s,r,g){n.get(s)[r]=g}function o(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:o}}function uL(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function t2(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function n2(){const n=[];let e=0;const t=[],i=[],o=[];function s(){e=0,t.length=0,i.length=0,o.length=0}function r(d,C,A,f,b,G){let m=n[e];return m===void 0?(m={id:d.id,object:d,geometry:C,material:A,groupOrder:f,renderOrder:d.renderOrder,z:b,group:G},n[e]=m):(m.id=d.id,m.object=d,m.geometry=C,m.material=A,m.groupOrder=f,m.renderOrder=d.renderOrder,m.z=b,m.group=G),e++,m}function g(d,C,A,f,b,G){const m=r(d,C,A,f,b,G);A.transmission>0?i.push(m):A.transparent===!0?o.push(m):t.push(m)}function a(d,C,A,f,b,G){const m=r(d,C,A,f,b,G);A.transmission>0?i.unshift(m):A.transparent===!0?o.unshift(m):t.unshift(m)}function l(d,C){t.length>1&&t.sort(d||uL),i.length>1&&i.sort(C||t2),o.length>1&&o.sort(C||t2)}function u(){for(let d=e,C=n.length;d<C;d++){const A=n[d];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.group=null}}return{opaque:t,transmissive:i,transparent:o,init:s,push:g,unshift:a,finish:u,sort:l}}function dL(){let n=new WeakMap;function e(i,o){let s;return n.has(i)===!1?(s=new n2,n.set(i,[s])):o>=n.get(i).length?(s=new n2,n.get(i).push(s)):s=n.get(i)[o],s}function t(){n=new WeakMap}return{get:e,dispose:t}}function AL(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new K,color:new ze};break;case"SpotLight":t={position:new K,direction:new K,color:new ze,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new K,color:new ze,distance:0,decay:0};break;case"HemisphereLight":t={direction:new K,skyColor:new ze,groundColor:new ze};break;case"RectAreaLight":t={color:new ze,position:new K,halfWidth:new K,halfHeight:new K};break}return n[e.id]=t,t}}}function hL(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let pL=0;function mL(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function fL(n,e){const t=new AL,i=hL(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)o.probe.push(new K);const s=new K,r=new et,g=new et;function a(u,d){let C=0,A=0,f=0;for(let X=0;X<9;X++)o.probe[X].set(0,0,0);let b=0,G=0,m=0,h=0,B=0,y=0,Z=0,R=0;u.sort(mL);const W=d!==!0?Math.PI:1;for(let X=0,Y=u.length;X<Y;X++){const S=u[X],H=S.color,k=S.intensity,U=S.distance,D=S.shadow&&S.shadow.map?S.shadow.map.texture:null;if(S.isAmbientLight)C+=H.r*k*W,A+=H.g*k*W,f+=H.b*k*W;else if(S.isLightProbe)for(let Q=0;Q<9;Q++)o.probe[Q].addScaledVector(S.sh.coefficients[Q],k);else if(S.isDirectionalLight){const Q=t.get(S);if(Q.color.copy(S.color).multiplyScalar(S.intensity*W),S.castShadow){const $=S.shadow,j=i.get(S);j.shadowBias=$.bias,j.shadowNormalBias=$.normalBias,j.shadowRadius=$.radius,j.shadowMapSize=$.mapSize,o.directionalShadow[b]=j,o.directionalShadowMap[b]=D,o.directionalShadowMatrix[b]=S.shadow.matrix,y++}o.directional[b]=Q,b++}else if(S.isSpotLight){const Q=t.get(S);if(Q.position.setFromMatrixPosition(S.matrixWorld),Q.color.copy(H).multiplyScalar(k*W),Q.distance=U,Q.coneCos=Math.cos(S.angle),Q.penumbraCos=Math.cos(S.angle*(1-S.penumbra)),Q.decay=S.decay,S.castShadow){const $=S.shadow,j=i.get(S);j.shadowBias=$.bias,j.shadowNormalBias=$.normalBias,j.shadowRadius=$.radius,j.shadowMapSize=$.mapSize,o.spotShadow[m]=j,o.spotShadowMap[m]=D,o.spotShadowMatrix[m]=S.shadow.matrix,R++}o.spot[m]=Q,m++}else if(S.isRectAreaLight){const Q=t.get(S);Q.color.copy(H).multiplyScalar(k),Q.halfWidth.set(S.width*.5,0,0),Q.halfHeight.set(0,S.height*.5,0),o.rectArea[h]=Q,h++}else if(S.isPointLight){const Q=t.get(S);if(Q.color.copy(S.color).multiplyScalar(S.intensity*W),Q.distance=S.distance,Q.decay=S.decay,S.castShadow){const $=S.shadow,j=i.get(S);j.shadowBias=$.bias,j.shadowNormalBias=$.normalBias,j.shadowRadius=$.radius,j.shadowMapSize=$.mapSize,j.shadowCameraNear=$.camera.near,j.shadowCameraFar=$.camera.far,o.pointShadow[G]=j,o.pointShadowMap[G]=D,o.pointShadowMatrix[G]=S.shadow.matrix,Z++}o.point[G]=Q,G++}else if(S.isHemisphereLight){const Q=t.get(S);Q.skyColor.copy(S.color).multiplyScalar(k*W),Q.groundColor.copy(S.groundColor).multiplyScalar(k*W),o.hemi[B]=Q,B++}}h>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=_e.LTC_FLOAT_1,o.rectAreaLTC2=_e.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(o.rectAreaLTC1=_e.LTC_HALF_1,o.rectAreaLTC2=_e.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=C,o.ambient[1]=A,o.ambient[2]=f;const x=o.hash;(x.directionalLength!==b||x.pointLength!==G||x.spotLength!==m||x.rectAreaLength!==h||x.hemiLength!==B||x.numDirectionalShadows!==y||x.numPointShadows!==Z||x.numSpotShadows!==R)&&(o.directional.length=b,o.spot.length=m,o.rectArea.length=h,o.point.length=G,o.hemi.length=B,o.directionalShadow.length=y,o.directionalShadowMap.length=y,o.pointShadow.length=Z,o.pointShadowMap.length=Z,o.spotShadow.length=R,o.spotShadowMap.length=R,o.directionalShadowMatrix.length=y,o.pointShadowMatrix.length=Z,o.spotShadowMatrix.length=R,x.directionalLength=b,x.pointLength=G,x.spotLength=m,x.rectAreaLength=h,x.hemiLength=B,x.numDirectionalShadows=y,x.numPointShadows=Z,x.numSpotShadows=R,o.version=pL++)}function l(u,d){let C=0,A=0,f=0,b=0,G=0;const m=d.matrixWorldInverse;for(let h=0,B=u.length;h<B;h++){const y=u[h];if(y.isDirectionalLight){const Z=o.directional[C];Z.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),Z.direction.sub(s),Z.direction.transformDirection(m),C++}else if(y.isSpotLight){const Z=o.spot[f];Z.position.setFromMatrixPosition(y.matrixWorld),Z.position.applyMatrix4(m),Z.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),Z.direction.sub(s),Z.direction.transformDirection(m),f++}else if(y.isRectAreaLight){const Z=o.rectArea[b];Z.position.setFromMatrixPosition(y.matrixWorld),Z.position.applyMatrix4(m),g.identity(),r.copy(y.matrixWorld),r.premultiply(m),g.extractRotation(r),Z.halfWidth.set(y.width*.5,0,0),Z.halfHeight.set(0,y.height*.5,0),Z.halfWidth.applyMatrix4(g),Z.halfHeight.applyMatrix4(g),b++}else if(y.isPointLight){const Z=o.point[A];Z.position.setFromMatrixPosition(y.matrixWorld),Z.position.applyMatrix4(m),A++}else if(y.isHemisphereLight){const Z=o.hemi[G];Z.direction.setFromMatrixPosition(y.matrixWorld),Z.direction.transformDirection(m),Z.direction.normalize(),G++}}}return{setup:a,setupView:l,state:o}}function i2(n,e){const t=new fL(n,e),i=[],o=[];function s(){i.length=0,o.length=0}function r(d){i.push(d)}function g(d){o.push(d)}function a(d){t.setup(i,d)}function l(d){t.setupView(i,d)}return{init:s,state:{lightsArray:i,shadowsArray:o,lights:t},setupLights:a,setupLightsView:l,pushLight:r,pushShadow:g}}function bL(n,e){let t=new WeakMap;function i(s,r=0){let g;return t.has(s)===!1?(g=new i2(n,e),t.set(s,[g])):r>=t.get(s).length?(g=new i2(n,e),t.get(s).push(g)):g=t.get(s)[r],g}function o(){t=new WeakMap}return{get:i,dispose:o}}class Uh extends cn{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=ox,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Uh.prototype.isMeshDepthMaterial=!0;class Ph extends cn{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new K,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Ph.prototype.isMeshDistanceMaterial=!0;const GL=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,BL=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Vx(n,e,t){let i=new JC;const o=new Se,s=new Se,r=new zt,g=new Uh({depthPacking:sx}),a=new Ph,l={},u=t.maxTextureSize,d={0:wn,1:Yr,2:Nr},C=new uo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Se},radius:{value:4}},vertexShader:GL,fragmentShader:BL}),A=C.clone();A.defines.HORIZONTAL_PASS=1;const f=new at;f.setAttribute("position",new vt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new Sn(f,C),G=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=aB,this.render=function(y,Z,R){if(G.enabled===!1||G.autoUpdate===!1&&G.needsUpdate===!1||y.length===0)return;const W=n.getRenderTarget(),x=n.getActiveCubeFace(),X=n.getActiveMipmapLevel(),Y=n.state;Y.setBlending(Ms),Y.buffers.color.setClear(1,1,1,1),Y.buffers.depth.setTest(!0),Y.setScissorTest(!1);for(let S=0,H=y.length;S<H;S++){const k=y[S],U=k.shadow;if(U===void 0){console.warn("THREE.WebGLShadowMap:",k,"has no shadow.");continue}if(U.autoUpdate===!1&&U.needsUpdate===!1)continue;o.copy(U.mapSize);const D=U.getFrameExtents();if(o.multiply(D),s.copy(U.mapSize),(o.x>u||o.y>u)&&(o.x>u&&(s.x=Math.floor(u/D.x),o.x=s.x*D.x,U.mapSize.x=s.x),o.y>u&&(s.y=Math.floor(u/D.y),o.y=s.y*D.y,U.mapSize.y=s.y)),U.map===null&&!U.isPointLightShadow&&this.type===ll){const $={minFilter:gn,magFilter:gn,format:Ai};U.map=new Gi(o.x,o.y,$),U.map.texture.name=k.name+".shadowMap",U.mapPass=new Gi(o.x,o.y,$),U.camera.updateProjectionMatrix()}if(U.map===null){const $={minFilter:Rn,magFilter:Rn,format:Ai};U.map=new Gi(o.x,o.y,$),U.map.texture.name=k.name+".shadowMap",U.camera.updateProjectionMatrix()}n.setRenderTarget(U.map),n.clear();const Q=U.getViewportCount();for(let $=0;$<Q;$++){const j=U.getViewport($);r.set(s.x*j.x,s.y*j.y,s.x*j.z,s.y*j.w),Y.viewport(r),U.updateMatrices(k,$),i=U.getFrustum(),B(Z,R,U.camera,k,this.type)}!U.isPointLightShadow&&this.type===ll&&m(U,R),U.needsUpdate=!1}G.needsUpdate=!1,n.setRenderTarget(W,x,X)};function m(y,Z){const R=e.update(b);C.defines.VSM_SAMPLES!==y.blurSamples&&(C.defines.VSM_SAMPLES=y.blurSamples,A.defines.VSM_SAMPLES=y.blurSamples,C.needsUpdate=!0,A.needsUpdate=!0),C.uniforms.shadow_pass.value=y.map.texture,C.uniforms.resolution.value=y.mapSize,C.uniforms.radius.value=y.radius,n.setRenderTarget(y.mapPass),n.clear(),n.renderBufferDirect(Z,null,R,C,b,null),A.uniforms.shadow_pass.value=y.mapPass.texture,A.uniforms.resolution.value=y.mapSize,A.uniforms.radius.value=y.radius,n.setRenderTarget(y.map),n.clear(),n.renderBufferDirect(Z,null,R,A,b,null)}function h(y,Z,R,W,x,X){let Y=null;const S=R.isPointLight===!0?y.customDistanceMaterial:y.customDepthMaterial;if(S!==void 0?Y=S:Y=R.isPointLight===!0?a:g,n.localClippingEnabled&&Z.clipShadows===!0&&Z.clippingPlanes.length!==0||Z.displacementMap&&Z.displacementScale!==0||Z.alphaMap&&Z.alphaTest>0){const H=Y.uuid,k=Z.uuid;let U=l[H];U===void 0&&(U={},l[H]=U);let D=U[k];D===void 0&&(D=Y.clone(),U[k]=D),Y=D}return Y.visible=Z.visible,Y.wireframe=Z.wireframe,X===ll?Y.side=Z.shadowSide!==null?Z.shadowSide:Z.side:Y.side=Z.shadowSide!==null?Z.shadowSide:d[Z.side],Y.alphaMap=Z.alphaMap,Y.alphaTest=Z.alphaTest,Y.clipShadows=Z.clipShadows,Y.clippingPlanes=Z.clippingPlanes,Y.clipIntersection=Z.clipIntersection,Y.displacementMap=Z.displacementMap,Y.displacementScale=Z.displacementScale,Y.displacementBias=Z.displacementBias,Y.wireframeLinewidth=Z.wireframeLinewidth,Y.linewidth=Z.linewidth,R.isPointLight===!0&&Y.isMeshDistanceMaterial===!0&&(Y.referencePosition.setFromMatrixPosition(R.matrixWorld),Y.nearDistance=W,Y.farDistance=x),Y}function B(y,Z,R,W,x){if(y.visible===!1)return;if(y.layers.test(Z.layers)&&(y.isMesh||y.isLine||y.isPoints)&&(y.castShadow||y.receiveShadow&&x===ll)&&(!y.frustumCulled||i.intersectsObject(y))){y.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,y.matrixWorld);const S=e.update(y),H=y.material;if(Array.isArray(H)){const k=S.groups;for(let U=0,D=k.length;U<D;U++){const Q=k[U],$=H[Q.materialIndex];if($&&$.visible){const j=h(y,$,W,R.near,R.far,x);n.renderBufferDirect(R,null,S,j,y,Q)}}}else if(H.visible){const k=h(y,H,W,R.near,R.far,x);n.renderBufferDirect(R,null,S,k,y,null)}}const Y=y.children;for(let S=0,H=Y.length;S<H;S++)B(Y[S],Z,R,W,x)}}function yL(n,e,t){const i=t.isWebGL2;function o(){let O=!1;const ke=new zt;let E=null;const J=new zt(0,0,0,0);return{setMask:function(se){E!==se&&!O&&(n.colorMask(se,se,se,se),E=se)},setLocked:function(se){O=se},setClear:function(se,re,Ze,He,Qe){Qe===!0&&(se*=He,re*=He,Ze*=He),ke.set(se,re,Ze,He),J.equals(ke)===!1&&(n.clearColor(se,re,Ze,He),J.copy(ke))},reset:function(){O=!1,E=null,J.set(-1,0,0,0)}}}function s(){let O=!1,ke=null,E=null,J=null;return{setTest:function(se){se?ee(2929):_(2929)},setMask:function(se){ke!==se&&!O&&(n.depthMask(se),ke=se)},setFunc:function(se){if(E!==se){if(se)switch(se){case ZV:n.depthFunc(512);break;case wV:n.depthFunc(519);break;case RV:n.depthFunc(513);break;case uh:n.depthFunc(515);break;case WV:n.depthFunc(514);break;case SV:n.depthFunc(518);break;case VV:n.depthFunc(516);break;case xV:n.depthFunc(517);break;default:n.depthFunc(515)}else n.depthFunc(515);E=se}},setLocked:function(se){O=se},setClear:function(se){J!==se&&(n.clearDepth(se),J=se)},reset:function(){O=!1,ke=null,E=null,J=null}}}function r(){let O=!1,ke=null,E=null,J=null,se=null,re=null,Ze=null,He=null,Qe=null;return{setTest:function(Te){O||(Te?ee(2960):_(2960))},setMask:function(Te){ke!==Te&&!O&&(n.stencilMask(Te),ke=Te)},setFunc:function(Te,it,lt){(E!==Te||J!==it||se!==lt)&&(n.stencilFunc(Te,it,lt),E=Te,J=it,se=lt)},setOp:function(Te,it,lt){(re!==Te||Ze!==it||He!==lt)&&(n.stencilOp(Te,it,lt),re=Te,Ze=it,He=lt)},setLocked:function(Te){O=Te},setClear:function(Te){Qe!==Te&&(n.clearStencil(Te),Qe=Te)},reset:function(){O=!1,ke=null,E=null,J=null,se=null,re=null,Ze=null,He=null,Qe=null}}}const g=new o,a=new s,l=new r;let u={},d={},C=new WeakMap,A=[],f=null,b=!1,G=null,m=null,h=null,B=null,y=null,Z=null,R=null,W=!1,x=null,X=null,Y=null,S=null,H=null;const k=n.getParameter(35661);let U=!1,D=0;const Q=n.getParameter(7938);Q.indexOf("WebGL")!==-1?(D=parseFloat(/^WebGL (\d)/.exec(Q)[1]),U=D>=1):Q.indexOf("OpenGL ES")!==-1&&(D=parseFloat(/^OpenGL ES (\d)/.exec(Q)[1]),U=D>=2);let $=null,j={};const oe=n.getParameter(3088),Ie=n.getParameter(2978),T=new zt().fromArray(oe),P=new zt().fromArray(Ie);function Ce(O,ke,E){const J=new Uint8Array(4),se=n.createTexture();n.bindTexture(O,se),n.texParameteri(O,10241,9728),n.texParameteri(O,10240,9728);for(let re=0;re<E;re++)n.texImage2D(ke+re,0,6408,1,1,0,6408,5121,J);return se}const Me={};Me[3553]=Ce(3553,3553,1),Me[34067]=Ce(34067,34069,6),g.setClear(0,0,0,1),a.setClear(1),l.setClear(0),ee(2929),a.setFunc(uh),Ge(!1),Ve(a0),ee(2884),ie(Ms);function ee(O){u[O]!==!0&&(n.enable(O),u[O]=!0)}function _(O){u[O]!==!1&&(n.disable(O),u[O]=!1)}function Ae(O,ke){return d[O]!==ke?(n.bindFramebuffer(O,ke),d[O]=ke,i&&(O===36009&&(d[36160]=ke),O===36160&&(d[36009]=ke)),!0):!1}function ye(O,ke){let E=A,J=!1;if(O)if(E=C.get(ke),E===void 0&&(E=[],C.set(ke,E)),O.isWebGLMultipleRenderTargets){const se=O.texture;if(E.length!==se.length||E[0]!==36064){for(let re=0,Ze=se.length;re<Ze;re++)E[re]=36064+re;E.length=se.length,J=!0}}else E[0]!==36064&&(E[0]=36064,J=!0);else E[0]!==1029&&(E[0]=1029,J=!0);J&&(t.isWebGL2?n.drawBuffers(E):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(E))}function ge(O){return f!==O?(n.useProgram(O),f=O,!0):!1}const we={[Bg]:32774,[dV]:32778,[AV]:32779};if(i)we[C0]=32775,we[u0]=32776;else{const O=e.get("EXT_blend_minmax");O!==null&&(we[C0]=O.MIN_EXT,we[u0]=O.MAX_EXT)}const Ke={[hV]:0,[pV]:1,[mV]:768,[cB]:770,[vV]:776,[BV]:774,[bV]:772,[fV]:769,[CB]:771,[yV]:775,[GV]:773};function ie(O,ke,E,J,se,re,Ze,He){if(O===Ms){b===!0&&(_(3042),b=!1);return}if(b===!1&&(ee(3042),b=!0),O!==uV){if(O!==G||He!==W){if((m!==Bg||y!==Bg)&&(n.blendEquation(32774),m=Bg,y=Bg),He)switch(O){case Yg:n.blendFuncSeparate(1,771,1,771);break;case l0:n.blendFunc(1,1);break;case I0:n.blendFuncSeparate(0,769,0,1);break;case c0:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",O);break}else switch(O){case Yg:n.blendFuncSeparate(770,771,1,771);break;case l0:n.blendFunc(770,1);break;case I0:n.blendFuncSeparate(0,769,0,1);break;case c0:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",O);break}h=null,B=null,Z=null,R=null,G=O,W=He}return}se=se||ke,re=re||E,Ze=Ze||J,(ke!==m||se!==y)&&(n.blendEquationSeparate(we[ke],we[se]),m=ke,y=se),(E!==h||J!==B||re!==Z||Ze!==R)&&(n.blendFuncSeparate(Ke[E],Ke[J],Ke[re],Ke[Ze]),h=E,B=J,Z=re,R=Ze),G=O,W=null}function de(O,ke){O.side===Nr?_(2884):ee(2884);let E=O.side===wn;ke&&(E=!E),Ge(E),O.blending===Yg&&O.transparent===!1?ie(Ms):ie(O.blending,O.blendEquation,O.blendSrc,O.blendDst,O.blendEquationAlpha,O.blendSrcAlpha,O.blendDstAlpha,O.premultipliedAlpha),a.setFunc(O.depthFunc),a.setTest(O.depthTest),a.setMask(O.depthWrite),g.setMask(O.colorWrite);const J=O.stencilWrite;l.setTest(J),J&&(l.setMask(O.stencilWriteMask),l.setFunc(O.stencilFunc,O.stencilRef,O.stencilFuncMask),l.setOp(O.stencilFail,O.stencilZFail,O.stencilZPass)),Pe(O.polygonOffset,O.polygonOffsetFactor,O.polygonOffsetUnits),O.alphaToCoverage===!0?ee(32926):_(32926)}function Ge(O){x!==O&&(O?n.frontFace(2304):n.frontFace(2305),x=O)}function Ve(O){O!==cV?(ee(2884),O!==X&&(O===a0?n.cullFace(1029):O===CV?n.cullFace(1028):n.cullFace(1032))):_(2884),X=O}function xe(O){O!==Y&&(U&&n.lineWidth(O),Y=O)}function Pe(O,ke,E){O?(ee(32823),(S!==ke||H!==E)&&(n.polygonOffset(ke,E),S=ke,H=E)):_(32823)}function Ue(O){O?ee(3089):_(3089)}function nt(O){O===void 0&&(O=33984+k-1),$!==O&&(n.activeTexture(O),$=O)}function ct(O,ke){$===null&&nt();let E=j[$];E===void 0&&(E={type:void 0,texture:void 0},j[$]=E),(E.type!==O||E.texture!==ke)&&(n.bindTexture(O,ke||Me[O]),E.type=O,E.texture=ke)}function F(){const O=j[$];O!==void 0&&O.type!==void 0&&(n.bindTexture(O.type,null),O.type=void 0,O.texture=void 0)}function M(){try{n.compressedTexImage2D.apply(n,arguments)}catch(O){console.error("THREE.WebGLState:",O)}}function me(){try{n.texSubImage2D.apply(n,arguments)}catch(O){console.error("THREE.WebGLState:",O)}}function te(){try{n.texSubImage3D.apply(n,arguments)}catch(O){console.error("THREE.WebGLState:",O)}}function he(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(O){console.error("THREE.WebGLState:",O)}}function Re(){try{n.texStorage2D.apply(n,arguments)}catch(O){console.error("THREE.WebGLState:",O)}}function Fe(){try{n.texStorage3D.apply(n,arguments)}catch(O){console.error("THREE.WebGLState:",O)}}function pe(){try{n.texImage2D.apply(n,arguments)}catch(O){console.error("THREE.WebGLState:",O)}}function $e(){try{n.texImage3D.apply(n,arguments)}catch(O){console.error("THREE.WebGLState:",O)}}function ve(O){T.equals(O)===!1&&(n.scissor(O.x,O.y,O.z,O.w),T.copy(O))}function Le(O){P.equals(O)===!1&&(n.viewport(O.x,O.y,O.z,O.w),P.copy(O))}function Ye(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},$=null,j={},d={},C=new WeakMap,A=[],f=null,b=!1,G=null,m=null,h=null,B=null,y=null,Z=null,R=null,W=!1,x=null,X=null,Y=null,S=null,H=null,T.set(0,0,n.canvas.width,n.canvas.height),P.set(0,0,n.canvas.width,n.canvas.height),g.reset(),a.reset(),l.reset()}return{buffers:{color:g,depth:a,stencil:l},enable:ee,disable:_,bindFramebuffer:Ae,drawBuffers:ye,useProgram:ge,setBlending:ie,setMaterial:de,setFlipSided:Ge,setCullFace:Ve,setLineWidth:xe,setPolygonOffset:Pe,setScissorTest:Ue,activeTexture:nt,bindTexture:ct,unbindTexture:F,compressedTexImage2D:M,texImage2D:pe,texImage3D:$e,texStorage2D:Re,texStorage3D:Fe,texSubImage2D:me,texSubImage3D:te,compressedTexSubImage2D:he,scissor:ve,viewport:Le,reset:Ye}}function vL(n,e,t,i,o,s,r){const g=o.isWebGL2,a=o.maxTextures,l=o.maxCubemapSize,u=o.maxTextureSize,d=o.maxSamples,C=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,A=new WeakMap;let f;const b=new WeakMap;let G=!1;try{G=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(F,M){return G?new OffscreenCanvas(F,M):GC("canvas")}function h(F,M,me,te){let he=1;if((F.width>te||F.height>te)&&(he=te/Math.max(F.width,F.height)),he<1||M===!0)if(typeof HTMLImageElement!="undefined"&&F instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&F instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&F instanceof ImageBitmap){const Re=M?Ah:Math.floor,Fe=Re(he*F.width),pe=Re(he*F.height);f===void 0&&(f=m(Fe,pe));const $e=me?m(Fe,pe):f;return $e.width=Fe,$e.height=pe,$e.getContext("2d").drawImage(F,0,0,Fe,pe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+F.width+"x"+F.height+") to ("+Fe+"x"+pe+")."),$e}else return"data"in F&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+F.width+"x"+F.height+")."),F;return F}function B(F){return F0(F.width)&&F0(F.height)}function y(F){return g?!1:F.wrapS!==ui||F.wrapT!==ui||F.minFilter!==Rn&&F.minFilter!==gn}function Z(F,M){return F.generateMipmaps&&M&&F.minFilter!==Rn&&F.minFilter!==gn}function R(F){n.generateMipmap(F)}function W(F,M,me,te,he=!1){if(g===!1)return M;if(F!==null){if(n[F]!==void 0)return n[F];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+F+"'")}let Re=M;return M===6403&&(me===5126&&(Re=33326),me===5131&&(Re=33325),me===5121&&(Re=33321)),M===33319&&(me===5126&&(Re=33328),me===5131&&(Re=33327),me===5121&&(Re=33323)),M===6408&&(me===5126&&(Re=34836),me===5131&&(Re=34842),me===5121&&(Re=te===Lt&&he===!1?35907:32856),me===32819&&(Re=32854),me===32820&&(Re=32855)),(Re===33325||Re===33326||Re===33327||Re===33328||Re===34842||Re===34836)&&e.get("EXT_color_buffer_float"),Re}function x(F,M,me){return Z(F,me)===!0||F.isFramebufferTexture&&F.minFilter!==Rn&&F.minFilter!==gn?Math.log2(Math.max(M.width,M.height))+1:F.mipmaps!==void 0&&F.mipmaps.length>0?F.mipmaps.length:F.isCompressedTexture&&Array.isArray(F.image)?M.mipmaps.length:1}function X(F){return F===Rn||F===pC||F===mC?9728:9729}function Y(F){const M=F.target;M.removeEventListener("dispose",Y),H(M),M.isVideoTexture&&A.delete(M)}function S(F){const M=F.target;M.removeEventListener("dispose",S),U(M)}function H(F){const M=i.get(F);if(M.__webglInit===void 0)return;const me=F.source,te=b.get(me);if(te){const he=te[M.__cacheKey];he.usedTimes--,he.usedTimes===0&&k(F),Object.keys(te).length===0&&b.delete(me)}i.remove(F)}function k(F){const M=i.get(F);n.deleteTexture(M.__webglTexture);const me=F.source,te=b.get(me);delete te[M.__cacheKey],r.memory.textures--}function U(F){const M=F.texture,me=i.get(F),te=i.get(M);if(te.__webglTexture!==void 0&&(n.deleteTexture(te.__webglTexture),r.memory.textures--),F.depthTexture&&F.depthTexture.dispose(),F.isWebGLCubeRenderTarget)for(let he=0;he<6;he++)n.deleteFramebuffer(me.__webglFramebuffer[he]),me.__webglDepthbuffer&&n.deleteRenderbuffer(me.__webglDepthbuffer[he]);else n.deleteFramebuffer(me.__webglFramebuffer),me.__webglDepthbuffer&&n.deleteRenderbuffer(me.__webglDepthbuffer),me.__webglMultisampledFramebuffer&&n.deleteFramebuffer(me.__webglMultisampledFramebuffer),me.__webglColorRenderbuffer&&n.deleteRenderbuffer(me.__webglColorRenderbuffer),me.__webglDepthRenderbuffer&&n.deleteRenderbuffer(me.__webglDepthRenderbuffer);if(F.isWebGLMultipleRenderTargets)for(let he=0,Re=M.length;he<Re;he++){const Fe=i.get(M[he]);Fe.__webglTexture&&(n.deleteTexture(Fe.__webglTexture),r.memory.textures--),i.remove(M[he])}i.remove(M),i.remove(F)}let D=0;function Q(){D=0}function $(){const F=D;return F>=a&&console.warn("THREE.WebGLTextures: Trying to use "+F+" texture units while this GPU supports only "+a),D+=1,F}function j(F){const M=[];return M.push(F.wrapS),M.push(F.wrapT),M.push(F.magFilter),M.push(F.minFilter),M.push(F.anisotropy),M.push(F.internalFormat),M.push(F.format),M.push(F.type),M.push(F.generateMipmaps),M.push(F.premultiplyAlpha),M.push(F.flipY),M.push(F.unpackAlignment),M.push(F.encoding),M.join()}function oe(F,M){const me=i.get(F);if(F.isVideoTexture&&nt(F),F.isRenderTargetTexture===!1&&F.version>0&&me.__version!==F.version){const te=F.image;if(te===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(te.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ae(me,F,M);return}}t.activeTexture(33984+M),t.bindTexture(3553,me.__webglTexture)}function Ie(F,M){const me=i.get(F);if(F.version>0&&me.__version!==F.version){Ae(me,F,M);return}t.activeTexture(33984+M),t.bindTexture(35866,me.__webglTexture)}function T(F,M){const me=i.get(F);if(F.version>0&&me.__version!==F.version){Ae(me,F,M);return}t.activeTexture(33984+M),t.bindTexture(32879,me.__webglTexture)}function P(F,M){const me=i.get(F);if(F.version>0&&me.__version!==F.version){ye(me,F,M);return}t.activeTexture(33984+M),t.bindTexture(34067,me.__webglTexture)}const Ce={[kr]:10497,[ui]:33071,[Fl]:33648},Me={[Rn]:9728,[pC]:9984,[mC]:9986,[gn]:9729,[zh]:9985,[ks]:9987};function ee(F,M,me){if(me?(n.texParameteri(F,10242,Ce[M.wrapS]),n.texParameteri(F,10243,Ce[M.wrapT]),(F===32879||F===35866)&&n.texParameteri(F,32882,Ce[M.wrapR]),n.texParameteri(F,10240,Me[M.magFilter]),n.texParameteri(F,10241,Me[M.minFilter])):(n.texParameteri(F,10242,33071),n.texParameteri(F,10243,33071),(F===32879||F===35866)&&n.texParameteri(F,32882,33071),(M.wrapS!==ui||M.wrapT!==ui)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(F,10240,X(M.magFilter)),n.texParameteri(F,10241,X(M.minFilter)),M.minFilter!==Rn&&M.minFilter!==gn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const te=e.get("EXT_texture_filter_anisotropic");if(M.type===Hs&&e.has("OES_texture_float_linear")===!1||g===!1&&M.type===Ng&&e.has("OES_texture_half_float_linear")===!1)return;(M.anisotropy>1||i.get(M).__currentAnisotropy)&&(n.texParameterf(F,te.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(M.anisotropy,o.getMaxAnisotropy())),i.get(M).__currentAnisotropy=M.anisotropy)}}function _(F,M){let me=!1;F.__webglInit===void 0&&(F.__webglInit=!0,M.addEventListener("dispose",Y));const te=M.source;let he=b.get(te);he===void 0&&(he={},b.set(te,he));const Re=j(M);if(Re!==F.__cacheKey){he[Re]===void 0&&(he[Re]={texture:n.createTexture(),usedTimes:0},r.memory.textures++,me=!0),he[Re].usedTimes++;const Fe=he[F.__cacheKey];Fe!==void 0&&(he[F.__cacheKey].usedTimes--,Fe.usedTimes===0&&k(M)),F.__cacheKey=Re,F.__webglTexture=he[Re].texture}return me}function Ae(F,M,me){let te=3553;M.isDataArrayTexture&&(te=35866),M.isData3DTexture&&(te=32879);const he=_(F,M),Re=M.source;if(t.activeTexture(33984+me),t.bindTexture(te,F.__webglTexture),Re.version!==Re.__currentVersion||he===!0){n.pixelStorei(37440,M.flipY),n.pixelStorei(37441,M.premultiplyAlpha),n.pixelStorei(3317,M.unpackAlignment),n.pixelStorei(37443,0);const Fe=y(M)&&B(M.image)===!1;let pe=h(M.image,Fe,!1,u);pe=ct(M,pe);const $e=B(pe)||g,ve=s.convert(M.format,M.encoding);let Le=s.convert(M.type),Ye=W(M.internalFormat,ve,Le,M.encoding,M.isVideoTexture);ee(te,M,$e);let O;const ke=M.mipmaps,E=g&&M.isVideoTexture!==!0,J=F.__version===void 0,se=x(M,pe,$e);if(M.isDepthTexture)Ye=6402,g?M.type===Hs?Ye=36012:M.type===Jc?Ye=33190:M.type===Lg?Ye=35056:Ye=33189:M.type===Hs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),M.format===Vr&&Ye===6402&&M.type!==Yl&&M.type!==Jc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),M.type=Yl,Le=s.convert(M.type)),M.format===Ug&&Ye===6402&&(Ye=34041,M.type!==Lg&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),M.type=Lg,Le=s.convert(M.type))),E&&J?t.texStorage2D(3553,1,Ye,pe.width,pe.height):t.texImage2D(3553,0,Ye,pe.width,pe.height,0,ve,Le,null);else if(M.isDataTexture)if(ke.length>0&&$e){E&&J&&t.texStorage2D(3553,se,Ye,ke[0].width,ke[0].height);for(let re=0,Ze=ke.length;re<Ze;re++)O=ke[re],E?t.texSubImage2D(3553,re,0,0,O.width,O.height,ve,Le,O.data):t.texImage2D(3553,re,Ye,O.width,O.height,0,ve,Le,O.data);M.generateMipmaps=!1}else E?(J&&t.texStorage2D(3553,se,Ye,pe.width,pe.height),t.texSubImage2D(3553,0,0,0,pe.width,pe.height,ve,Le,pe.data)):t.texImage2D(3553,0,Ye,pe.width,pe.height,0,ve,Le,pe.data);else if(M.isCompressedTexture){E&&J&&t.texStorage2D(3553,se,Ye,ke[0].width,ke[0].height);for(let re=0,Ze=ke.length;re<Ze;re++)O=ke[re],M.format!==Ai?ve!==null?E?t.compressedTexSubImage2D(3553,re,0,0,O.width,O.height,ve,O.data):t.compressedTexImage2D(3553,re,Ye,O.width,O.height,0,O.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?t.texSubImage2D(3553,re,0,0,O.width,O.height,ve,Le,O.data):t.texImage2D(3553,re,Ye,O.width,O.height,0,ve,Le,O.data)}else if(M.isDataArrayTexture)E?(J&&t.texStorage3D(35866,se,Ye,pe.width,pe.height,pe.depth),t.texSubImage3D(35866,0,0,0,0,pe.width,pe.height,pe.depth,ve,Le,pe.data)):t.texImage3D(35866,0,Ye,pe.width,pe.height,pe.depth,0,ve,Le,pe.data);else if(M.isData3DTexture)E?(J&&t.texStorage3D(32879,se,Ye,pe.width,pe.height,pe.depth),t.texSubImage3D(32879,0,0,0,0,pe.width,pe.height,pe.depth,ve,Le,pe.data)):t.texImage3D(32879,0,Ye,pe.width,pe.height,pe.depth,0,ve,Le,pe.data);else if(M.isFramebufferTexture)E&&J?t.texStorage2D(3553,se,Ye,pe.width,pe.height):t.texImage2D(3553,0,Ye,pe.width,pe.height,0,ve,Le,null);else if(ke.length>0&&$e){E&&J&&t.texStorage2D(3553,se,Ye,ke[0].width,ke[0].height);for(let re=0,Ze=ke.length;re<Ze;re++)O=ke[re],E?t.texSubImage2D(3553,re,0,0,ve,Le,O):t.texImage2D(3553,re,Ye,ve,Le,O);M.generateMipmaps=!1}else E?(J&&t.texStorage2D(3553,se,Ye,pe.width,pe.height),t.texSubImage2D(3553,0,0,0,ve,Le,pe)):t.texImage2D(3553,0,Ye,ve,Le,pe);Z(M,$e)&&R(te),Re.__currentVersion=Re.version,M.onUpdate&&M.onUpdate(M)}F.__version=M.version}function ye(F,M,me){if(M.image.length!==6)return;const te=_(F,M),he=M.source;if(t.activeTexture(33984+me),t.bindTexture(34067,F.__webglTexture),he.version!==he.__currentVersion||te===!0){n.pixelStorei(37440,M.flipY),n.pixelStorei(37441,M.premultiplyAlpha),n.pixelStorei(3317,M.unpackAlignment),n.pixelStorei(37443,0);const Re=M.isCompressedTexture||M.image[0].isCompressedTexture,Fe=M.image[0]&&M.image[0].isDataTexture,pe=[];for(let re=0;re<6;re++)!Re&&!Fe?pe[re]=h(M.image[re],!1,!0,l):pe[re]=Fe?M.image[re].image:M.image[re],pe[re]=ct(M,pe[re]);const $e=pe[0],ve=B($e)||g,Le=s.convert(M.format,M.encoding),Ye=s.convert(M.type),O=W(M.internalFormat,Le,Ye,M.encoding),ke=g&&M.isVideoTexture!==!0,E=F.__version===void 0;let J=x(M,$e,ve);ee(34067,M,ve);let se;if(Re){ke&&E&&t.texStorage2D(34067,J,O,$e.width,$e.height);for(let re=0;re<6;re++){se=pe[re].mipmaps;for(let Ze=0;Ze<se.length;Ze++){const He=se[Ze];M.format!==Ai?Le!==null?ke?t.compressedTexSubImage2D(34069+re,Ze,0,0,He.width,He.height,Le,He.data):t.compressedTexImage2D(34069+re,Ze,O,He.width,He.height,0,He.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ke?t.texSubImage2D(34069+re,Ze,0,0,He.width,He.height,Le,Ye,He.data):t.texImage2D(34069+re,Ze,O,He.width,He.height,0,Le,Ye,He.data)}}}else{se=M.mipmaps,ke&&E&&(se.length>0&&J++,t.texStorage2D(34067,J,O,pe[0].width,pe[0].height));for(let re=0;re<6;re++)if(Fe){ke?t.texSubImage2D(34069+re,0,0,0,pe[re].width,pe[re].height,Le,Ye,pe[re].data):t.texImage2D(34069+re,0,O,pe[re].width,pe[re].height,0,Le,Ye,pe[re].data);for(let Ze=0;Ze<se.length;Ze++){const Qe=se[Ze].image[re].image;ke?t.texSubImage2D(34069+re,Ze+1,0,0,Qe.width,Qe.height,Le,Ye,Qe.data):t.texImage2D(34069+re,Ze+1,O,Qe.width,Qe.height,0,Le,Ye,Qe.data)}}else{ke?t.texSubImage2D(34069+re,0,0,0,Le,Ye,pe[re]):t.texImage2D(34069+re,0,O,Le,Ye,pe[re]);for(let Ze=0;Ze<se.length;Ze++){const He=se[Ze];ke?t.texSubImage2D(34069+re,Ze+1,0,0,Le,Ye,He.image[re]):t.texImage2D(34069+re,Ze+1,O,Le,Ye,He.image[re])}}}Z(M,ve)&&R(34067),he.__currentVersion=he.version,M.onUpdate&&M.onUpdate(M)}F.__version=M.version}function ge(F,M,me,te,he){const Re=s.convert(me.format,me.encoding),Fe=s.convert(me.type),pe=W(me.internalFormat,Re,Fe,me.encoding);i.get(M).__hasExternalTextures||(he===32879||he===35866?t.texImage3D(he,0,pe,M.width,M.height,M.depth,0,Re,Fe,null):t.texImage2D(he,0,pe,M.width,M.height,0,Re,Fe,null)),t.bindFramebuffer(36160,F),Ue(M)?C.framebufferTexture2DMultisampleEXT(36160,te,he,i.get(me).__webglTexture,0,Pe(M)):n.framebufferTexture2D(36160,te,he,i.get(me).__webglTexture,0),t.bindFramebuffer(36160,null)}function we(F,M,me){if(n.bindRenderbuffer(36161,F),M.depthBuffer&&!M.stencilBuffer){let te=33189;if(me||Ue(M)){const he=M.depthTexture;he&&he.isDepthTexture&&(he.type===Hs?te=36012:he.type===Jc&&(te=33190));const Re=Pe(M);Ue(M)?C.renderbufferStorageMultisampleEXT(36161,Re,te,M.width,M.height):n.renderbufferStorageMultisample(36161,Re,te,M.width,M.height)}else n.renderbufferStorage(36161,te,M.width,M.height);n.framebufferRenderbuffer(36160,36096,36161,F)}else if(M.depthBuffer&&M.stencilBuffer){const te=Pe(M);me&&Ue(M)===!1?n.renderbufferStorageMultisample(36161,te,35056,M.width,M.height):Ue(M)?C.renderbufferStorageMultisampleEXT(36161,te,35056,M.width,M.height):n.renderbufferStorage(36161,34041,M.width,M.height),n.framebufferRenderbuffer(36160,33306,36161,F)}else{const te=M.isWebGLMultipleRenderTargets===!0?M.texture[0]:M.texture,he=s.convert(te.format,te.encoding),Re=s.convert(te.type),Fe=W(te.internalFormat,he,Re,te.encoding),pe=Pe(M);me&&Ue(M)===!1?n.renderbufferStorageMultisample(36161,pe,Fe,M.width,M.height):Ue(M)?C.renderbufferStorageMultisampleEXT(36161,pe,Fe,M.width,M.height):n.renderbufferStorage(36161,Fe,M.width,M.height)}n.bindRenderbuffer(36161,null)}function Ke(F,M){if(M&&M.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,F),!(M.depthTexture&&M.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(M.depthTexture).__webglTexture||M.depthTexture.image.width!==M.width||M.depthTexture.image.height!==M.height)&&(M.depthTexture.image.width=M.width,M.depthTexture.image.height=M.height,M.depthTexture.needsUpdate=!0),oe(M.depthTexture,0);const te=i.get(M.depthTexture).__webglTexture,he=Pe(M);if(M.depthTexture.format===Vr)Ue(M)?C.framebufferTexture2DMultisampleEXT(36160,36096,3553,te,0,he):n.framebufferTexture2D(36160,36096,3553,te,0);else if(M.depthTexture.format===Ug)Ue(M)?C.framebufferTexture2DMultisampleEXT(36160,33306,3553,te,0,he):n.framebufferTexture2D(36160,33306,3553,te,0);else throw new Error("Unknown depthTexture format")}function ie(F){const M=i.get(F),me=F.isWebGLCubeRenderTarget===!0;if(F.depthTexture&&!M.__autoAllocateDepthBuffer){if(me)throw new Error("target.depthTexture not supported in Cube render targets");Ke(M.__webglFramebuffer,F)}else if(me){M.__webglDepthbuffer=[];for(let te=0;te<6;te++)t.bindFramebuffer(36160,M.__webglFramebuffer[te]),M.__webglDepthbuffer[te]=n.createRenderbuffer(),we(M.__webglDepthbuffer[te],F,!1)}else t.bindFramebuffer(36160,M.__webglFramebuffer),M.__webglDepthbuffer=n.createRenderbuffer(),we(M.__webglDepthbuffer,F,!1);t.bindFramebuffer(36160,null)}function de(F,M,me){const te=i.get(F);M!==void 0&&ge(te.__webglFramebuffer,F,F.texture,36064,3553),me!==void 0&&ie(F)}function Ge(F){const M=F.texture,me=i.get(F),te=i.get(M);F.addEventListener("dispose",S),F.isWebGLMultipleRenderTargets!==!0&&(te.__webglTexture===void 0&&(te.__webglTexture=n.createTexture()),te.__version=M.version,r.memory.textures++);const he=F.isWebGLCubeRenderTarget===!0,Re=F.isWebGLMultipleRenderTargets===!0,Fe=B(F)||g;if(he){me.__webglFramebuffer=[];for(let pe=0;pe<6;pe++)me.__webglFramebuffer[pe]=n.createFramebuffer()}else if(me.__webglFramebuffer=n.createFramebuffer(),Re)if(o.drawBuffers){const pe=F.texture;for(let $e=0,ve=pe.length;$e<ve;$e++){const Le=i.get(pe[$e]);Le.__webglTexture===void 0&&(Le.__webglTexture=n.createTexture(),r.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(g&&F.samples>0&&Ue(F)===!1){me.__webglMultisampledFramebuffer=n.createFramebuffer(),me.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,me.__webglColorRenderbuffer);const pe=s.convert(M.format,M.encoding),$e=s.convert(M.type),ve=W(M.internalFormat,pe,$e,M.encoding),Le=Pe(F);n.renderbufferStorageMultisample(36161,Le,ve,F.width,F.height),t.bindFramebuffer(36160,me.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,me.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),F.depthBuffer&&(me.__webglDepthRenderbuffer=n.createRenderbuffer(),we(me.__webglDepthRenderbuffer,F,!0)),t.bindFramebuffer(36160,null)}if(he){t.bindTexture(34067,te.__webglTexture),ee(34067,M,Fe);for(let pe=0;pe<6;pe++)ge(me.__webglFramebuffer[pe],F,M,36064,34069+pe);Z(M,Fe)&&R(34067),t.unbindTexture()}else if(Re){const pe=F.texture;for(let $e=0,ve=pe.length;$e<ve;$e++){const Le=pe[$e],Ye=i.get(Le);t.bindTexture(3553,Ye.__webglTexture),ee(3553,Le,Fe),ge(me.__webglFramebuffer,F,Le,36064+$e,3553),Z(Le,Fe)&&R(3553)}t.unbindTexture()}else{let pe=3553;(F.isWebGL3DRenderTarget||F.isWebGLArrayRenderTarget)&&(g?pe=F.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(pe,te.__webglTexture),ee(pe,M,Fe),ge(me.__webglFramebuffer,F,M,36064,pe),Z(M,Fe)&&R(pe),t.unbindTexture()}F.depthBuffer&&ie(F)}function Ve(F){const M=B(F)||g,me=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let te=0,he=me.length;te<he;te++){const Re=me[te];if(Z(Re,M)){const Fe=F.isWebGLCubeRenderTarget?34067:3553,pe=i.get(Re).__webglTexture;t.bindTexture(Fe,pe),R(Fe),t.unbindTexture()}}}function xe(F){if(g&&F.samples>0&&Ue(F)===!1){const M=F.width,me=F.height;let te=16384;const he=[36064],Re=F.stencilBuffer?33306:36096;F.depthBuffer&&he.push(Re);const Fe=i.get(F),pe=Fe.__ignoreDepthValues!==void 0?Fe.__ignoreDepthValues:!1;pe===!1&&(F.depthBuffer&&(te|=256),F.stencilBuffer&&(te|=1024)),t.bindFramebuffer(36008,Fe.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Fe.__webglFramebuffer),pe===!0&&(n.invalidateFramebuffer(36008,[Re]),n.invalidateFramebuffer(36009,[Re])),n.blitFramebuffer(0,0,M,me,0,0,M,me,te,9728),n.invalidateFramebuffer(36008,he),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,Fe.__webglMultisampledFramebuffer)}}function Pe(F){return Math.min(d,F.samples)}function Ue(F){const M=i.get(F);return g&&F.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&M.__useRenderToTexture!==!1}function nt(F){const M=r.render.frame;A.get(F)!==M&&(A.set(F,M),F.update())}function ct(F,M){const me=F.encoding,te=F.format,he=F.type;return F.isCompressedTexture===!0||F.isVideoTexture===!0||F.format===dh||me!==Xo&&(me===Lt?g===!1?e.has("EXT_sRGB")===!0&&te===Ai?(F.format=dh,F.minFilter=gn,F.generateMipmaps=!1):M=Or.sRGBToLinear(M):(te!==Ai||he!==Tr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",me)),M}this.allocateTextureUnit=$,this.resetTextureUnits=Q,this.setTexture2D=oe,this.setTexture2DArray=Ie,this.setTexture3D=T,this.setTextureCube=P,this.rebindTextures=de,this.setupRenderTarget=Ge,this.updateRenderTargetMipmap=Ve,this.updateMultisampleRenderTarget=xe,this.setupDepthRenderbuffer=ie,this.setupFrameBufferTexture=ge,this.useMultisampledRTT=Ue}function xx(n,e,t){const i=t.isWebGL2;function o(s,r=null){let g;if(s===Tr)return 5121;if(s===kV)return 32819;if(s===TV)return 32820;if(s===NV)return 5120;if(s===LV)return 5122;if(s===Yl)return 5123;if(s===zV)return 5124;if(s===Jc)return 5125;if(s===Hs)return 5126;if(s===Ng)return i?5131:(g=e.get("OES_texture_half_float"),g!==null?g.HALF_FLOAT_OES:null);if(s===EV)return 6406;if(s===Ai)return 6408;if(s===JV)return 6409;if(s===DV)return 6410;if(s===Vr)return 6402;if(s===Ug)return 34041;if(s===UV)return 6403;if(s===_V)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===dh)return g=e.get("EXT_sRGB"),g!==null?g.SRGB_ALPHA_EXT:null;if(s===PV)return 36244;if(s===QV)return 33319;if(s===OV)return 33320;if(s===jV)return 36249;if(s===xA||s===HA||s===XA||s===MA)if(r===Lt)if(g=e.get("WEBGL_compressed_texture_s3tc_srgb"),g!==null){if(s===xA)return g.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===HA)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===XA)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===MA)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(g=e.get("WEBGL_compressed_texture_s3tc"),g!==null){if(s===xA)return g.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===HA)return g.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===XA)return g.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===MA)return g.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===d0||s===A0||s===h0||s===p0)if(g=e.get("WEBGL_compressed_texture_pvrtc"),g!==null){if(s===d0)return g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===A0)return g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===h0)return g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===p0)return g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===qV)return g=e.get("WEBGL_compressed_texture_etc1"),g!==null?g.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===m0||s===f0)if(g=e.get("WEBGL_compressed_texture_etc"),g!==null){if(s===m0)return r===Lt?g.COMPRESSED_SRGB8_ETC2:g.COMPRESSED_RGB8_ETC2;if(s===f0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===b0||s===G0||s===B0||s===y0||s===v0||s===Z0||s===w0||s===R0||s===W0||s===S0||s===V0||s===x0||s===H0||s===X0)if(g=e.get("WEBGL_compressed_texture_astc"),g!==null){if(s===b0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:g.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===G0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:g.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===B0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:g.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===y0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:g.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===v0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:g.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===Z0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:g.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===w0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:g.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===R0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:g.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===W0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:g.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===S0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:g.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===V0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:g.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===x0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:g.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===H0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:g.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===X0)return r===Lt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:g.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===M0)if(g=e.get("EXT_texture_compression_bptc"),g!==null){if(s===M0)return r===Lt?g.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:g.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===Lg)return i?34042:(g=e.get("WEBGL_depth_texture"),g!==null?g.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:o}}class mB extends Kn{constructor(e=[]){super();this.cameras=e}}mB.prototype.isArrayCamera=!0;class qo extends Gt{constructor(){super();this.type="Group"}}qo.prototype.isGroup=!0;const ZL={type:"move"};class Jf{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new qo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new qo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new K,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new K),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new qo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new K,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new K),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let o=null,s=null,r=null;const g=this._targetRay,a=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(g!==null&&(o=t.getPose(e.targetRaySpace,i),o!==null&&(g.matrix.fromArray(o.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),o.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(o.linearVelocity)):g.hasLinearVelocity=!1,o.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(o.angularVelocity)):g.hasAngularVelocity=!1,this.dispatchEvent(ZL))),l&&e.hand){r=!0;for(const b of e.hand.values()){const G=t.getJointPose(b,i);if(l.joints[b.jointName]===void 0){const h=new qo;h.matrixAutoUpdate=!1,h.visible=!1,l.joints[b.jointName]=h,l.add(h)}const m=l.joints[b.jointName];G!==null&&(m.matrix.fromArray(G.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=G.radius),m.visible=G!==null}const u=l.joints["index-finger-tip"],d=l.joints["thumb-tip"],C=u.position.distanceTo(d.position),A=.02,f=.005;l.inputState.pinching&&C>A+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&C<=A-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else a!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1));return g!==null&&(g.visible=o!==null),a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),this}}class fB extends pn{constructor(e,t,i,o,s,r,g,a,l,u){if(u=u!==void 0?u:Vr,u!==Vr&&u!==Ug)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===Vr&&(i=Yl),i===void 0&&u===Ug&&(i=Lg);super(null,o,s,r,g,a,u,i,l);this.image={width:e,height:t},this.magFilter=g!==void 0?g:Rn,this.minFilter=a!==void 0?a:Rn,this.flipY=!1,this.generateMipmaps=!1}}fB.prototype.isDepthTexture=!0;class wL extends Qr{constructor(e,t){super();const i=this;let o=null,s=1,r=null,g="local-floor",a=null,l=null,u=null,d=null,C=null;const A=t.getContextAttributes();let f=null,b=null;const G=[],m=new Map,h=new Kn;h.layers.enable(1),h.viewport=new zt;const B=new Kn;B.layers.enable(2),B.viewport=new zt;const y=[h,B],Z=new mB;Z.layers.enable(1),Z.layers.enable(2);let R=null,W=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let oe=G[j];return oe===void 0&&(oe=new Jf,G[j]=oe),oe.getTargetRaySpace()},this.getControllerGrip=function(j){let oe=G[j];return oe===void 0&&(oe=new Jf,G[j]=oe),oe.getGripSpace()},this.getHand=function(j){let oe=G[j];return oe===void 0&&(oe=new Jf,G[j]=oe),oe.getHandSpace()};function x(j){const oe=m.get(j.inputSource);oe&&oe.dispatchEvent({type:j.type,data:j.inputSource})}function X(){m.forEach(function(j,oe){j.disconnect(oe)}),m.clear(),R=null,W=null,e.setRenderTarget(f),d=null,u=null,l=null,o=null,b=null,$.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){s=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){g=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return r},this.getBaseLayer=function(){return u!==null?u:d},this.getBinding=function(){return l},this.getFrame=function(){return C},this.getSession=function(){return o},this.setSession=async function(j){if(o=j,o!==null){if(f=e.getRenderTarget(),o.addEventListener("select",x),o.addEventListener("selectstart",x),o.addEventListener("selectend",x),o.addEventListener("squeeze",x),o.addEventListener("squeezestart",x),o.addEventListener("squeezeend",x),o.addEventListener("end",X),o.addEventListener("inputsourceschange",Y),A.xrCompatible!==!0&&await t.makeXRCompatible(),o.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const oe={antialias:o.renderState.layers===void 0?A.antialias:!0,alpha:A.alpha,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(o,t,oe),o.updateRenderState({baseLayer:d}),b=new Gi(d.framebufferWidth,d.framebufferHeight,{format:Ai,type:Tr,encoding:e.outputEncoding})}else{let oe=null,Ie=null,T=null;A.depth&&(T=A.stencil?35056:33190,oe=A.stencil?Ug:Vr,Ie=A.stencil?Lg:Yl);const P={colorFormat:e.outputEncoding===Lt?35907:32856,depthFormat:T,scaleFactor:s};l=new XRWebGLBinding(o,t),u=l.createProjectionLayer(P),o.updateRenderState({layers:[u]}),b=new Gi(u.textureWidth,u.textureHeight,{format:Ai,type:Tr,depthTexture:new fB(u.textureWidth,u.textureHeight,Ie,void 0,void 0,void 0,void 0,void 0,void 0,oe),stencilBuffer:A.stencil,encoding:e.outputEncoding,samples:A.antialias?4:0});const Ce=e.properties.get(b);Ce.__ignoreDepthValues=u.ignoreDepthValues}b.isXRRenderTarget=!0,this.setFoveation(1),r=await o.requestReferenceSpace(g),$.setContext(o),$.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function Y(j){const oe=o.inputSources;for(let Ie=0;Ie<G.length;Ie++)m.set(oe[Ie],G[Ie]);for(let Ie=0;Ie<j.removed.length;Ie++){const T=j.removed[Ie],P=m.get(T);P&&(P.dispatchEvent({type:"disconnected",data:T}),m.delete(T))}for(let Ie=0;Ie<j.added.length;Ie++){const T=j.added[Ie],P=m.get(T);P&&P.dispatchEvent({type:"connected",data:T})}}const S=new K,H=new K;function k(j,oe,Ie){S.setFromMatrixPosition(oe.matrixWorld),H.setFromMatrixPosition(Ie.matrixWorld);const T=S.distanceTo(H),P=oe.projectionMatrix.elements,Ce=Ie.projectionMatrix.elements,Me=P[14]/(P[10]-1),ee=P[14]/(P[10]+1),_=(P[9]+1)/P[5],Ae=(P[9]-1)/P[5],ye=(P[8]-1)/P[0],ge=(Ce[8]+1)/Ce[0],we=Me*ye,Ke=Me*ge,ie=T/(-ye+ge),de=ie*-ye;oe.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(de),j.translateZ(ie),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert();const Ge=Me+ie,Ve=ee+ie,xe=we-de,Pe=Ke+(T-de),Ue=_*ee/Ve*Ge,nt=Ae*ee/Ve*Ge;j.projectionMatrix.makePerspective(xe,Pe,Ue,nt,Ge,Ve)}function U(j,oe){oe===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(oe.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(o===null)return;Z.near=B.near=h.near=j.near,Z.far=B.far=h.far=j.far,(R!==Z.near||W!==Z.far)&&(o.updateRenderState({depthNear:Z.near,depthFar:Z.far}),R=Z.near,W=Z.far);const oe=j.parent,Ie=Z.cameras;U(Z,oe);for(let P=0;P<Ie.length;P++)U(Ie[P],oe);Z.matrixWorld.decompose(Z.position,Z.quaternion,Z.scale),j.position.copy(Z.position),j.quaternion.copy(Z.quaternion),j.scale.copy(Z.scale),j.matrix.copy(Z.matrix),j.matrixWorld.copy(Z.matrixWorld);const T=j.children;for(let P=0,Ce=T.length;P<Ce;P++)T[P].updateMatrixWorld(!0);Ie.length===2?k(Z,h,B):Z.projectionMatrix.copy(h.projectionMatrix)},this.getCamera=function(){return Z},this.getFoveation=function(){if(u!==null)return u.fixedFoveation;if(d!==null)return d.fixedFoveation},this.setFoveation=function(j){u!==null&&(u.fixedFoveation=j),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=j)};let D=null;function Q(j,oe){if(a=oe.getViewerPose(r),C=oe,a!==null){const T=a.views;d!==null&&(e.setRenderTargetFramebuffer(b,d.framebuffer),e.setRenderTarget(b));let P=!1;T.length!==Z.cameras.length&&(Z.cameras.length=0,P=!0);for(let Ce=0;Ce<T.length;Ce++){const Me=T[Ce];let ee=null;if(d!==null)ee=d.getViewport(Me);else{const Ae=l.getViewSubImage(u,Me);ee=Ae.viewport,Ce===0&&(e.setRenderTargetTextures(b,Ae.colorTexture,u.ignoreDepthValues?void 0:Ae.depthStencilTexture),e.setRenderTarget(b))}const _=y[Ce];_.matrix.fromArray(Me.transform.matrix),_.projectionMatrix.fromArray(Me.projectionMatrix),_.viewport.set(ee.x,ee.y,ee.width,ee.height),Ce===0&&Z.matrix.copy(_.matrix),P===!0&&Z.cameras.push(_)}}const Ie=o.inputSources;for(let T=0;T<G.length;T++){const P=G[T],Ce=Ie[T];P.update(Ce,oe,r)}D&&D(j,oe),C=null}const $=new Bx;$.setAnimationLoop(Q),this.setAnimationLoop=function(j){D=j},this.dispose=function(){}}}function RL(n){function e(m,h){m.fogColor.value.copy(h.color),h.isFog?(m.fogNear.value=h.near,m.fogFar.value=h.far):h.isFogExp2&&(m.fogDensity.value=h.density)}function t(m,h,B,y,Z){h.isMeshBasicMaterial?i(m,h):h.isMeshLambertMaterial?(i(m,h),a(m,h)):h.isMeshToonMaterial?(i(m,h),u(m,h)):h.isMeshPhongMaterial?(i(m,h),l(m,h)):h.isMeshStandardMaterial?(i(m,h),h.isMeshPhysicalMaterial?C(m,h,Z):d(m,h)):h.isMeshMatcapMaterial?(i(m,h),A(m,h)):h.isMeshDepthMaterial?(i(m,h),f(m,h)):h.isMeshDistanceMaterial?(i(m,h),b(m,h)):h.isMeshNormalMaterial?(i(m,h),G(m,h)):h.isLineBasicMaterial?(o(m,h),h.isLineDashedMaterial&&s(m,h)):h.isPointsMaterial?r(m,h,B,y):h.isSpriteMaterial?g(m,h):h.isShadowMaterial?(m.color.value.copy(h.color),m.opacity.value=h.opacity):h.isShaderMaterial&&(h.uniformsNeedUpdate=!1)}function i(m,h){m.opacity.value=h.opacity,h.color&&m.diffuse.value.copy(h.color),h.emissive&&m.emissive.value.copy(h.emissive).multiplyScalar(h.emissiveIntensity),h.map&&(m.map.value=h.map),h.alphaMap&&(m.alphaMap.value=h.alphaMap),h.specularMap&&(m.specularMap.value=h.specularMap),h.alphaTest>0&&(m.alphaTest.value=h.alphaTest);const B=n.get(h).envMap;B&&(m.envMap.value=B,m.flipEnvMap.value=B.isCubeTexture&&B.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=h.reflectivity,m.ior.value=h.ior,m.refractionRatio.value=h.refractionRatio),h.lightMap&&(m.lightMap.value=h.lightMap,m.lightMapIntensity.value=h.lightMapIntensity),h.aoMap&&(m.aoMap.value=h.aoMap,m.aoMapIntensity.value=h.aoMapIntensity);let y;h.map?y=h.map:h.specularMap?y=h.specularMap:h.displacementMap?y=h.displacementMap:h.normalMap?y=h.normalMap:h.bumpMap?y=h.bumpMap:h.roughnessMap?y=h.roughnessMap:h.metalnessMap?y=h.metalnessMap:h.alphaMap?y=h.alphaMap:h.emissiveMap?y=h.emissiveMap:h.clearcoatMap?y=h.clearcoatMap:h.clearcoatNormalMap?y=h.clearcoatNormalMap:h.clearcoatRoughnessMap?y=h.clearcoatRoughnessMap:h.specularIntensityMap?y=h.specularIntensityMap:h.specularColorMap?y=h.specularColorMap:h.transmissionMap?y=h.transmissionMap:h.thicknessMap?y=h.thicknessMap:h.sheenColorMap?y=h.sheenColorMap:h.sheenRoughnessMap&&(y=h.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix));let Z;h.aoMap?Z=h.aoMap:h.lightMap&&(Z=h.lightMap),Z!==void 0&&(Z.isWebGLRenderTarget&&(Z=Z.texture),Z.matrixAutoUpdate===!0&&Z.updateMatrix(),m.uv2Transform.value.copy(Z.matrix))}function o(m,h){m.diffuse.value.copy(h.color),m.opacity.value=h.opacity}function s(m,h){m.dashSize.value=h.dashSize,m.totalSize.value=h.dashSize+h.gapSize,m.scale.value=h.scale}function r(m,h,B,y){m.diffuse.value.copy(h.color),m.opacity.value=h.opacity,m.size.value=h.size*B,m.scale.value=y*.5,h.map&&(m.map.value=h.map),h.alphaMap&&(m.alphaMap.value=h.alphaMap),h.alphaTest>0&&(m.alphaTest.value=h.alphaTest);let Z;h.map?Z=h.map:h.alphaMap&&(Z=h.alphaMap),Z!==void 0&&(Z.matrixAutoUpdate===!0&&Z.updateMatrix(),m.uvTransform.value.copy(Z.matrix))}function g(m,h){m.diffuse.value.copy(h.color),m.opacity.value=h.opacity,m.rotation.value=h.rotation,h.map&&(m.map.value=h.map),h.alphaMap&&(m.alphaMap.value=h.alphaMap),h.alphaTest>0&&(m.alphaTest.value=h.alphaTest);let B;h.map?B=h.map:h.alphaMap&&(B=h.alphaMap),B!==void 0&&(B.matrixAutoUpdate===!0&&B.updateMatrix(),m.uvTransform.value.copy(B.matrix))}function a(m,h){h.emissiveMap&&(m.emissiveMap.value=h.emissiveMap)}function l(m,h){m.specular.value.copy(h.specular),m.shininess.value=Math.max(h.shininess,1e-4),h.emissiveMap&&(m.emissiveMap.value=h.emissiveMap),h.bumpMap&&(m.bumpMap.value=h.bumpMap,m.bumpScale.value=h.bumpScale,h.side===wn&&(m.bumpScale.value*=-1)),h.normalMap&&(m.normalMap.value=h.normalMap,m.normalScale.value.copy(h.normalScale),h.side===wn&&m.normalScale.value.negate()),h.displacementMap&&(m.displacementMap.value=h.displacementMap,m.displacementScale.value=h.displacementScale,m.displacementBias.value=h.displacementBias)}function u(m,h){h.gradientMap&&(m.gradientMap.value=h.gradientMap),h.emissiveMap&&(m.emissiveMap.value=h.emissiveMap),h.bumpMap&&(m.bumpMap.value=h.bumpMap,m.bumpScale.value=h.bumpScale,h.side===wn&&(m.bumpScale.value*=-1)),h.normalMap&&(m.normalMap.value=h.normalMap,m.normalScale.value.copy(h.normalScale),h.side===wn&&m.normalScale.value.negate()),h.displacementMap&&(m.displacementMap.value=h.displacementMap,m.displacementScale.value=h.displacementScale,m.displacementBias.value=h.displacementBias)}function d(m,h){m.roughness.value=h.roughness,m.metalness.value=h.metalness,h.roughnessMap&&(m.roughnessMap.value=h.roughnessMap),h.metalnessMap&&(m.metalnessMap.value=h.metalnessMap),h.emissiveMap&&(m.emissiveMap.value=h.emissiveMap),h.bumpMap&&(m.bumpMap.value=h.bumpMap,m.bumpScale.value=h.bumpScale,h.side===wn&&(m.bumpScale.value*=-1)),h.normalMap&&(m.normalMap.value=h.normalMap,m.normalScale.value.copy(h.normalScale),h.side===wn&&m.normalScale.value.negate()),h.displacementMap&&(m.displacementMap.value=h.displacementMap,m.displacementScale.value=h.displacementScale,m.displacementBias.value=h.displacementBias),n.get(h).envMap&&(m.envMapIntensity.value=h.envMapIntensity)}function C(m,h,B){d(m,h),m.ior.value=h.ior,h.sheen>0&&(m.sheenColor.value.copy(h.sheenColor).multiplyScalar(h.sheen),m.sheenRoughness.value=h.sheenRoughness,h.sheenColorMap&&(m.sheenColorMap.value=h.sheenColorMap),h.sheenRoughnessMap&&(m.sheenRoughnessMap.value=h.sheenRoughnessMap)),h.clearcoat>0&&(m.clearcoat.value=h.clearcoat,m.clearcoatRoughness.value=h.clearcoatRoughness,h.clearcoatMap&&(m.clearcoatMap.value=h.clearcoatMap),h.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=h.clearcoatRoughnessMap),h.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(h.clearcoatNormalScale),m.clearcoatNormalMap.value=h.clearcoatNormalMap,h.side===wn&&m.clearcoatNormalScale.value.negate())),h.transmission>0&&(m.transmission.value=h.transmission,m.transmissionSamplerMap.value=B.texture,m.transmissionSamplerSize.value.set(B.width,B.height),h.transmissionMap&&(m.transmissionMap.value=h.transmissionMap),m.thickness.value=h.thickness,h.thicknessMap&&(m.thicknessMap.value=h.thicknessMap),m.attenuationDistance.value=h.attenuationDistance,m.attenuationColor.value.copy(h.attenuationColor)),m.specularIntensity.value=h.specularIntensity,m.specularColor.value.copy(h.specularColor),h.specularIntensityMap&&(m.specularIntensityMap.value=h.specularIntensityMap),h.specularColorMap&&(m.specularColorMap.value=h.specularColorMap)}function A(m,h){h.matcap&&(m.matcap.value=h.matcap),h.bumpMap&&(m.bumpMap.value=h.bumpMap,m.bumpScale.value=h.bumpScale,h.side===wn&&(m.bumpScale.value*=-1)),h.normalMap&&(m.normalMap.value=h.normalMap,m.normalScale.value.copy(h.normalScale),h.side===wn&&m.normalScale.value.negate()),h.displacementMap&&(m.displacementMap.value=h.displacementMap,m.displacementScale.value=h.displacementScale,m.displacementBias.value=h.displacementBias)}function f(m,h){h.displacementMap&&(m.displacementMap.value=h.displacementMap,m.displacementScale.value=h.displacementScale,m.displacementBias.value=h.displacementBias)}function b(m,h){h.displacementMap&&(m.displacementMap.value=h.displacementMap,m.displacementScale.value=h.displacementScale,m.displacementBias.value=h.displacementBias),m.referencePosition.value.copy(h.referencePosition),m.nearDistance.value=h.nearDistance,m.farDistance.value=h.farDistance}function G(m,h){h.bumpMap&&(m.bumpMap.value=h.bumpMap,m.bumpScale.value=h.bumpScale,h.side===wn&&(m.bumpScale.value*=-1)),h.normalMap&&(m.normalMap.value=h.normalMap,m.normalScale.value.copy(h.normalScale),h.side===wn&&m.normalScale.value.negate()),h.displacementMap&&(m.displacementMap.value=h.displacementMap,m.displacementScale.value=h.displacementScale,m.displacementBias.value=h.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function WL(){const n=GC("canvas");return n.style.display="block",n}function Tt(n={}){const e=n.canvas!==void 0?n.canvas:WL(),t=n.context!==void 0?n.context:null,i=n.depth!==void 0?n.depth:!0,o=n.stencil!==void 0?n.stencil:!0,s=n.antialias!==void 0?n.antialias:!1,r=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,g=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,a=n.powerPreference!==void 0?n.powerPreference:"default",l=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let u;n.context!==void 0?u=t.getContextAttributes().alpha:u=n.alpha!==void 0?n.alpha:!1;let d=null,C=null;const A=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Xo,this.physicallyCorrectLights=!1,this.toneMapping=ts,this.toneMappingExposure=1;const b=this;let G=!1,m=0,h=0,B=null,y=-1,Z=null;const R=new zt,W=new zt;let x=null,X=e.width,Y=e.height,S=1,H=null,k=null;const U=new zt(0,0,X,Y),D=new zt(0,0,X,Y);let Q=!1;const $=new JC;let j=!1,oe=!1,Ie=null;const T=new et,P=new Se,Ce=new K,Me={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ee(){return B===null?S:1}let _=t;function Ae(N,le){for(let fe=0;fe<N.length;fe++){const ue=N[fe],We=e.getContext(ue,le);if(We!==null)return We}return null}try{const N={alpha:!0,depth:i,stencil:o,antialias:s,premultipliedAlpha:r,preserveDrawingBuffer:g,powerPreference:a,failIfMajorPerformanceCaveat:l};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Nh}`),e.addEventListener("webglcontextlost",O,!1),e.addEventListener("webglcontextrestored",ke,!1),_===null){const le=["webgl2","webgl","experimental-webgl"];if(b.isWebGL1Renderer===!0&&le.shift(),_=Ae(le,N),_===null)throw Ae(le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}_.getShaderPrecisionFormat===void 0&&(_.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(N){throw console.error("THREE.WebGLRenderer: "+N.message),N}let ye,ge,we,Ke,ie,de,Ge,Ve,xe,Pe,Ue,nt,ct,F,M,me,te,he,Re,Fe,pe,$e,ve;function Le(){ye=new U5(_),ge=new k5(_,ye,n),ye.init(ge),$e=new xx(_,ye,ge),we=new yL(_,ye,ge),Ke=new O5(_),ie=new CL,de=new vL(_,ye,we,ie,ge,$e,Ke),Ge=new E5(b),Ve=new D5(b),xe=new I1(_,ge),ve=new L5(_,ye,xe,ge),Pe=new P5(_,xe,Ke,ve),Ue=new e3(_,Pe,xe,Ke),Re=new $5(_,ge,de),me=new T5(ie),nt=new cL(b,Ge,Ve,ye,ge,ve,me),ct=new RL(ie),F=new dL,M=new bL(ye,ge),he=new N5(b,Ge,we,Ue,u,r),te=new Vx(b,Ue,ge),Fe=new z5(_,ye,Ke,ge),pe=new Q5(_,ye,Ke,ge),Ke.programs=nt.programs,b.capabilities=ge,b.extensions=ye,b.properties=ie,b.renderLists=F,b.shadowMap=te,b.state=we,b.info=Ke}Le();const Ye=new wL(b,_);this.xr=Ye,this.getContext=function(){return _},this.getContextAttributes=function(){return _.getContextAttributes()},this.forceContextLoss=function(){const N=ye.get("WEBGL_lose_context");N&&N.loseContext()},this.forceContextRestore=function(){const N=ye.get("WEBGL_lose_context");N&&N.restoreContext()},this.getPixelRatio=function(){return S},this.setPixelRatio=function(N){N!==void 0&&(S=N,this.setSize(X,Y,!1))},this.getSize=function(N){return N.set(X,Y)},this.setSize=function(N,le,fe){if(Ye.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}X=N,Y=le,e.width=Math.floor(N*S),e.height=Math.floor(le*S),fe!==!1&&(e.style.width=N+"px",e.style.height=le+"px"),this.setViewport(0,0,N,le)},this.getDrawingBufferSize=function(N){return N.set(X*S,Y*S).floor()},this.setDrawingBufferSize=function(N,le,fe){X=N,Y=le,S=fe,e.width=Math.floor(N*fe),e.height=Math.floor(le*fe),this.setViewport(0,0,N,le)},this.getCurrentViewport=function(N){return N.copy(R)},this.getViewport=function(N){return N.copy(U)},this.setViewport=function(N,le,fe,ue){N.isVector4?U.set(N.x,N.y,N.z,N.w):U.set(N,le,fe,ue),we.viewport(R.copy(U).multiplyScalar(S).floor())},this.getScissor=function(N){return N.copy(D)},this.setScissor=function(N,le,fe,ue){N.isVector4?D.set(N.x,N.y,N.z,N.w):D.set(N,le,fe,ue),we.scissor(W.copy(D).multiplyScalar(S).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(N){we.setScissorTest(Q=N)},this.setOpaqueSort=function(N){H=N},this.setTransparentSort=function(N){k=N},this.getClearColor=function(N){return N.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor.apply(he,arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha.apply(he,arguments)},this.clear=function(N=!0,le=!0,fe=!0){let ue=0;N&&(ue|=16384),le&&(ue|=256),fe&&(ue|=1024),_.clear(ue)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",O,!1),e.removeEventListener("webglcontextrestored",ke,!1),F.dispose(),M.dispose(),ie.dispose(),Ge.dispose(),Ve.dispose(),Ue.dispose(),ve.dispose(),nt.dispose(),Ye.dispose(),Ye.removeEventListener("sessionstart",He),Ye.removeEventListener("sessionend",Qe),Ie&&(Ie.dispose(),Ie=null),Te.stop()};function O(N){N.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),G=!0}function ke(){console.log("THREE.WebGLRenderer: Context Restored."),G=!1;const N=Ke.autoReset,le=te.enabled,fe=te.autoUpdate,ue=te.needsUpdate,We=te.type;Le(),Ke.autoReset=N,te.enabled=le,te.autoUpdate=fe,te.needsUpdate=ue,te.type=We}function E(N){const le=N.target;le.removeEventListener("dispose",E),J(le)}function J(N){se(N),ie.remove(N)}function se(N){const le=ie.get(N).programs;le!==void 0&&(le.forEach(function(fe){nt.releaseProgram(fe)}),N.isShaderMaterial&&nt.releaseShaderCache(N))}this.renderBufferDirect=function(N,le,fe,ue,We,Ct){le===null&&(le=Me);const ht=We.isMesh&&We.matrixWorld.determinant()<0,ft=po(N,le,fe,ue,We);we.setMaterial(ue,ht);let mt=fe.index;const Ht=fe.attributes.position;if(mt===null){if(Ht===void 0||Ht.count===0)return}else if(mt.count===0)return;let Rt=1;ue.wireframe===!0&&(mt=Pe.getWireframeAttribute(fe),Rt=2),ve.setup(We,ue,ft,fe,mt);let Zt,Jt=Fe;mt!==null&&(Zt=xe.get(mt),Jt=pe,Jt.setIndex(Zt));const mo=mt!==null?mt.count:Ht.count,fo=fe.drawRange.start*Rt,No=fe.drawRange.count*Rt,Pn=Ct!==null?Ct.start*Rt:0,Bt=Ct!==null?Ct.count*Rt:1/0,Xt=Math.max(fo,Pn),pt=Math.min(mo,fo+No,Pn+Bt)-1,Nn=Math.max(0,pt-Xt+1);if(Nn!==0){if(We.isMesh)ue.wireframe===!0?(we.setLineWidth(ue.wireframeLinewidth*ee()),Jt.setMode(1)):Jt.setMode(4);else if(We.isLine){let on=ue.linewidth;on===void 0&&(on=1),we.setLineWidth(on*ee()),We.isLineSegments?Jt.setMode(1):We.isLineLoop?Jt.setMode(2):Jt.setMode(3)}else We.isPoints?Jt.setMode(0):We.isSprite&&Jt.setMode(4);if(We.isInstancedMesh)Jt.renderInstances(Xt,Nn,We.count);else if(fe.isInstancedBufferGeometry){const on=Math.min(fe.instanceCount,fe._maxInstanceCount);Jt.renderInstances(Xt,Nn,on)}else Jt.render(Xt,Nn)}},this.compile=function(N,le){C=M.get(N),C.init(),f.push(C),N.traverseVisible(function(fe){fe.isLight&&fe.layers.test(le.layers)&&(C.pushLight(fe),fe.castShadow&&C.pushShadow(fe))}),C.setupLights(b.physicallyCorrectLights),N.traverse(function(fe){const ue=fe.material;if(ue)if(Array.isArray(ue))for(let We=0;We<ue.length;We++){const Ct=ue[We];Yn(Ct,N,fe)}else Yn(ue,N,fe)}),f.pop(),C=null};let re=null;function Ze(N){re&&re(N)}function He(){Te.stop()}function Qe(){Te.start()}const Te=new Bx;Te.setAnimationLoop(Ze),typeof window!="undefined"&&Te.setContext(window),this.setAnimationLoop=function(N){re=N,Ye.setAnimationLoop(N),N===null?Te.stop():Te.start()},Ye.addEventListener("sessionstart",He),Ye.addEventListener("sessionend",Qe),this.render=function(N,le){if(le!==void 0&&le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(G===!0)return;N.autoUpdate===!0&&N.updateMatrixWorld(),le.parent===null&&le.updateMatrixWorld(),Ye.enabled===!0&&Ye.isPresenting===!0&&(Ye.cameraAutoUpdate===!0&&Ye.updateCamera(le),le=Ye.getCamera()),N.isScene===!0&&N.onBeforeRender(b,N,le,B),C=M.get(N,f.length),C.init(),f.push(C),T.multiplyMatrices(le.projectionMatrix,le.matrixWorldInverse),$.setFromProjectionMatrix(T),oe=this.localClippingEnabled,j=me.init(this.clippingPlanes,oe,le),d=F.get(N,A.length),d.init(),A.push(d),it(N,le,0,b.sortObjects),d.finish(),b.sortObjects===!0&&d.sort(H,k),j===!0&&me.beginShadows();const fe=C.state.shadowsArray;if(te.render(fe,N,le),j===!0&&me.endShadows(),this.info.autoReset===!0&&this.info.reset(),he.render(d,N),C.setupLights(b.physicallyCorrectLights),le.isArrayCamera){const ue=le.cameras;for(let We=0,Ct=ue.length;We<Ct;We++){const ht=ue[We];lt(d,N,ht,ht.viewport)}}else lt(d,N,le);B!==null&&(de.updateMultisampleRenderTarget(B),de.updateRenderTargetMipmap(B)),N.isScene===!0&&N.onAfterRender(b,N,le),ve.resetDefaultState(),y=-1,Z=null,f.pop(),f.length>0?C=f[f.length-1]:C=null,A.pop(),A.length>0?d=A[A.length-1]:d=null};function it(N,le,fe,ue){if(N.visible===!1)return;if(N.layers.test(le.layers)){if(N.isGroup)fe=N.renderOrder;else if(N.isLOD)N.autoUpdate===!0&&N.update(le);else if(N.isLight)C.pushLight(N),N.castShadow&&C.pushShadow(N);else if(N.isSprite){if(!N.frustumCulled||$.intersectsSprite(N)){ue&&Ce.setFromMatrixPosition(N.matrixWorld).applyMatrix4(T);const ht=Ue.update(N),ft=N.material;ft.visible&&d.push(N,ht,ft,fe,Ce.z,null)}}else if((N.isMesh||N.isLine||N.isPoints)&&(N.isSkinnedMesh&&N.skeleton.frame!==Ke.render.frame&&(N.skeleton.update(),N.skeleton.frame=Ke.render.frame),!N.frustumCulled||$.intersectsObject(N))){ue&&Ce.setFromMatrixPosition(N.matrixWorld).applyMatrix4(T);const ht=Ue.update(N),ft=N.material;if(Array.isArray(ft)){const mt=ht.groups;for(let Ht=0,Rt=mt.length;Ht<Rt;Ht++){const Zt=mt[Ht],Jt=ft[Zt.materialIndex];Jt&&Jt.visible&&d.push(N,ht,Jt,fe,Ce.z,Zt)}}else ft.visible&&d.push(N,ht,ft,fe,Ce.z,null)}}const Ct=N.children;for(let ht=0,ft=Ct.length;ht<ft;ht++)it(Ct[ht],le,fe,ue)}function lt(N,le,fe,ue){const We=N.opaque,Ct=N.transmissive,ht=N.transparent;C.setupLightsView(fe),Ct.length>0&&Ft(We,le,fe),ue&&we.viewport(R.copy(ue)),We.length>0&&Bn(We,le,fe),Ct.length>0&&Bn(Ct,le,fe),ht.length>0&&Bn(ht,le,fe),we.buffers.depth.setTest(!0),we.buffers.depth.setMask(!0),we.buffers.color.setMask(!0),we.setPolygonOffset(!1)}function Ft(N,le,fe){const ue=ge.isWebGL2;Ie===null&&(Ie=new Gi(1,1,{generateMipmaps:!0,type:$e.convert(Ng)!==null?Ng:Tr,minFilter:ks,samples:ue&&s===!0?4:0})),b.getDrawingBufferSize(P),ue?Ie.setSize(P.x,P.y):Ie.setSize(Ah(P.x),Ah(P.y));const We=b.getRenderTarget();b.setRenderTarget(Ie),b.clear();const Ct=b.toneMapping;b.toneMapping=ts,Bn(N,le,fe),b.toneMapping=Ct,de.updateMultisampleRenderTarget(Ie),de.updateRenderTargetMipmap(Ie),b.setRenderTarget(We)}function Bn(N,le,fe){const ue=le.isScene===!0?le.overrideMaterial:null;for(let We=0,Ct=N.length;We<Ct;We++){const ht=N[We],ft=ht.object,mt=ht.geometry,Ht=ue===null?ht.material:ue,Rt=ht.group;ft.layers.test(fe.layers)&&un(ft,le,fe,mt,Ht,Rt)}}function un(N,le,fe,ue,We,Ct){N.onBeforeRender(b,le,fe,ue,We,Ct),N.modelViewMatrix.multiplyMatrices(fe.matrixWorldInverse,N.matrixWorld),N.normalMatrix.getNormalMatrix(N.modelViewMatrix),We.onBeforeRender(b,le,fe,ue,N,Ct),We.transparent===!0&&We.side===Nr?(We.side=wn,We.needsUpdate=!0,b.renderBufferDirect(fe,le,ue,We,N,Ct),We.side=Yr,We.needsUpdate=!0,b.renderBufferDirect(fe,le,ue,We,N,Ct),We.side=Nr):b.renderBufferDirect(fe,le,ue,We,N,Ct),N.onAfterRender(b,le,fe,ue,We,Ct)}function Yn(N,le,fe){le.isScene!==!0&&(le=Me);const ue=ie.get(N),We=C.state.lights,Ct=C.state.shadowsArray,ht=We.state.version,ft=nt.getParameters(N,We.state,Ct,le,fe),mt=nt.getProgramCacheKey(ft);let Ht=ue.programs;ue.environment=N.isMeshStandardMaterial?le.environment:null,ue.fog=le.fog,ue.envMap=(N.isMeshStandardMaterial?Ve:Ge).get(N.envMap||ue.environment),Ht===void 0&&(N.addEventListener("dispose",E),Ht=new Map,ue.programs=Ht);let Rt=Ht.get(mt);if(Rt!==void 0){if(ue.currentProgram===Rt&&ue.lightsStateVersion===ht)return si(N,ft),Rt}else ft.uniforms=nt.getUniforms(N),N.onBuild(fe,ft,b),N.onBeforeCompile(ft,b),Rt=nt.acquireProgram(ft,mt),Ht.set(mt,Rt),ue.uniforms=ft.uniforms;const Zt=ue.uniforms;(!N.isShaderMaterial&&!N.isRawShaderMaterial||N.clipping===!0)&&(Zt.clippingPlanes=me.uniform),si(N,ft),ue.needsLights=Yo(N),ue.lightsStateVersion=ht,ue.needsLights&&(Zt.ambientLightColor.value=We.state.ambient,Zt.lightProbe.value=We.state.probe,Zt.directionalLights.value=We.state.directional,Zt.directionalLightShadows.value=We.state.directionalShadow,Zt.spotLights.value=We.state.spot,Zt.spotLightShadows.value=We.state.spotShadow,Zt.rectAreaLights.value=We.state.rectArea,Zt.ltc_1.value=We.state.rectAreaLTC1,Zt.ltc_2.value=We.state.rectAreaLTC2,Zt.pointLights.value=We.state.point,Zt.pointLightShadows.value=We.state.pointShadow,Zt.hemisphereLights.value=We.state.hemi,Zt.directionalShadowMap.value=We.state.directionalShadowMap,Zt.directionalShadowMatrix.value=We.state.directionalShadowMatrix,Zt.spotShadowMap.value=We.state.spotShadowMap,Zt.spotShadowMatrix.value=We.state.spotShadowMatrix,Zt.pointShadowMap.value=We.state.pointShadowMap,Zt.pointShadowMatrix.value=We.state.pointShadowMatrix);const Jt=Rt.getUniforms(),mo=xr.seqWithValue(Jt.seq,Zt);return ue.currentProgram=Rt,ue.uniformsList=mo,Rt}function si(N,le){const fe=ie.get(N);fe.outputEncoding=le.outputEncoding,fe.instancing=le.instancing,fe.skinning=le.skinning,fe.morphTargets=le.morphTargets,fe.morphNormals=le.morphNormals,fe.morphColors=le.morphColors,fe.morphTargetsCount=le.morphTargetsCount,fe.numClippingPlanes=le.numClippingPlanes,fe.numIntersection=le.numClipIntersection,fe.vertexAlphas=le.vertexAlphas,fe.vertexTangents=le.vertexTangents,fe.toneMapping=le.toneMapping}function po(N,le,fe,ue,We){le.isScene!==!0&&(le=Me),de.resetTextureUnits();const Ct=le.fog,ht=ue.isMeshStandardMaterial?le.environment:null,ft=B===null?b.outputEncoding:B.isXRRenderTarget===!0?B.texture.encoding:Xo,mt=(ue.isMeshStandardMaterial?Ve:Ge).get(ue.envMap||ht),Ht=ue.vertexColors===!0&&!!fe.attributes.color&&fe.attributes.color.itemSize===4,Rt=!!ue.normalMap&&!!fe.attributes.tangent,Zt=!!fe.morphAttributes.position,Jt=!!fe.morphAttributes.normal,mo=!!fe.morphAttributes.color,fo=ue.toneMapped?b.toneMapping:ts,No=fe.morphAttributes.position||fe.morphAttributes.normal||fe.morphAttributes.color,Pn=No!==void 0?No.length:0,Bt=ie.get(ue),Xt=C.state.lights;if(j===!0&&(oe===!0||N!==Z)){const Zi=N===Z&&ue.id===y;me.setState(ue,N,Zi)}let pt=!1;ue.version===Bt.__version?(Bt.needsLights&&Bt.lightsStateVersion!==Xt.state.version||Bt.outputEncoding!==ft||We.isInstancedMesh&&Bt.instancing===!1||!We.isInstancedMesh&&Bt.instancing===!0||We.isSkinnedMesh&&Bt.skinning===!1||!We.isSkinnedMesh&&Bt.skinning===!0||Bt.envMap!==mt||ue.fog&&Bt.fog!==Ct||Bt.numClippingPlanes!==void 0&&(Bt.numClippingPlanes!==me.numPlanes||Bt.numIntersection!==me.numIntersection)||Bt.vertexAlphas!==Ht||Bt.vertexTangents!==Rt||Bt.morphTargets!==Zt||Bt.morphNormals!==Jt||Bt.morphColors!==mo||Bt.toneMapping!==fo||ge.isWebGL2===!0&&Bt.morphTargetsCount!==Pn)&&(pt=!0):(pt=!0,Bt.__version=ue.version);let Nn=Bt.currentProgram;pt===!0&&(Nn=Yn(ue,le,We));let on=!1,Hn=!1,bo=!1;const dn=Nn.getUniforms(),Xn=Bt.uniforms;if(we.useProgram(Nn.program)&&(on=!0,Hn=!0,bo=!0),ue.id!==y&&(y=ue.id,Hn=!0),on||Z!==N){if(dn.setValue(_,"projectionMatrix",N.projectionMatrix),ge.logarithmicDepthBuffer&&dn.setValue(_,"logDepthBufFC",2/(Math.log(N.far+1)/Math.LN2)),Z!==N&&(Z=N,Hn=!0,bo=!0),ue.isShaderMaterial||ue.isMeshPhongMaterial||ue.isMeshToonMaterial||ue.isMeshStandardMaterial||ue.envMap){const Zi=dn.map.cameraPosition;Zi!==void 0&&Zi.setValue(_,Ce.setFromMatrixPosition(N.matrixWorld))}(ue.isMeshPhongMaterial||ue.isMeshToonMaterial||ue.isMeshLambertMaterial||ue.isMeshBasicMaterial||ue.isMeshStandardMaterial||ue.isShaderMaterial)&&dn.setValue(_,"isOrthographic",N.isOrthographicCamera===!0),(ue.isMeshPhongMaterial||ue.isMeshToonMaterial||ue.isMeshLambertMaterial||ue.isMeshBasicMaterial||ue.isMeshStandardMaterial||ue.isShaderMaterial||ue.isShadowMaterial||We.isSkinnedMesh)&&dn.setValue(_,"viewMatrix",N.matrixWorldInverse)}if(We.isSkinnedMesh){dn.setOptional(_,We,"bindMatrix"),dn.setOptional(_,We,"bindMatrixInverse");const Zi=We.skeleton;Zi&&(ge.floatVertexTextures?(Zi.boneTexture===null&&Zi.computeBoneTexture(),dn.setValue(_,"boneTexture",Zi.boneTexture,de),dn.setValue(_,"boneTextureSize",Zi.boneTextureSize)):dn.setOptional(_,Zi,"boneMatrices"))}const Ds=fe.morphAttributes;return(Ds.position!==void 0||Ds.normal!==void 0||Ds.color!==void 0&&ge.isWebGL2===!0)&&Re.update(We,fe,ue,Nn),(Hn||Bt.receiveShadow!==We.receiveShadow)&&(Bt.receiveShadow=We.receiveShadow,dn.setValue(_,"receiveShadow",We.receiveShadow)),Hn&&(dn.setValue(_,"toneMappingExposure",b.toneMappingExposure),Bt.needsLights&&Cs(Xn,bo),Ct&&ue.fog&&ct.refreshFogUniforms(Xn,Ct),ct.refreshMaterialUniforms(Xn,ue,S,Y,Ie),xr.upload(_,Bt.uniformsList,Xn,de)),ue.isShaderMaterial&&ue.uniformsNeedUpdate===!0&&(xr.upload(_,Bt.uniformsList,Xn,de),ue.uniformsNeedUpdate=!1),ue.isSpriteMaterial&&dn.setValue(_,"center",We.center),dn.setValue(_,"modelViewMatrix",We.modelViewMatrix),dn.setValue(_,"normalMatrix",We.normalMatrix),dn.setValue(_,"modelMatrix",We.matrixWorld),Nn}function Cs(N,le){N.ambientLightColor.needsUpdate=le,N.lightProbe.needsUpdate=le,N.directionalLights.needsUpdate=le,N.directionalLightShadows.needsUpdate=le,N.pointLights.needsUpdate=le,N.pointLightShadows.needsUpdate=le,N.spotLights.needsUpdate=le,N.spotLightShadows.needsUpdate=le,N.rectAreaLights.needsUpdate=le,N.hemisphereLights.needsUpdate=le}function Yo(N){return N.isMeshLambertMaterial||N.isMeshToonMaterial||N.isMeshPhongMaterial||N.isMeshStandardMaterial||N.isShadowMaterial||N.isShaderMaterial&&N.lights===!0}this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return h},this.getRenderTarget=function(){return B},this.setRenderTargetTextures=function(N,le,fe){ie.get(N.texture).__webglTexture=le,ie.get(N.depthTexture).__webglTexture=fe;const ue=ie.get(N);ue.__hasExternalTextures=!0,ue.__hasExternalTextures&&(ue.__autoAllocateDepthBuffer=fe===void 0,ue.__autoAllocateDepthBuffer||ye.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ue.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(N,le){const fe=ie.get(N);fe.__webglFramebuffer=le,fe.__useDefaultFramebuffer=le===void 0},this.setRenderTarget=function(N,le=0,fe=0){B=N,m=le,h=fe;let ue=!0;if(N){const mt=ie.get(N);mt.__useDefaultFramebuffer!==void 0?(we.bindFramebuffer(36160,null),ue=!1):mt.__webglFramebuffer===void 0?de.setupRenderTarget(N):mt.__hasExternalTextures&&de.rebindTextures(N,ie.get(N.texture).__webglTexture,ie.get(N.depthTexture).__webglTexture)}let We=null,Ct=!1,ht=!1;if(N){const mt=N.texture;(mt.isData3DTexture||mt.isDataArrayTexture)&&(ht=!0);const Ht=ie.get(N).__webglFramebuffer;N.isWebGLCubeRenderTarget?(We=Ht[le],Ct=!0):ge.isWebGL2&&N.samples>0&&de.useMultisampledRTT(N)===!1?We=ie.get(N).__webglMultisampledFramebuffer:We=Ht,R.copy(N.viewport),W.copy(N.scissor),x=N.scissorTest}else R.copy(U).multiplyScalar(S).floor(),W.copy(D).multiplyScalar(S).floor(),x=Q;if(we.bindFramebuffer(36160,We)&&ge.drawBuffers&&ue&&we.drawBuffers(N,We),we.viewport(R),we.scissor(W),we.setScissorTest(x),Ct){const mt=ie.get(N.texture);_.framebufferTexture2D(36160,36064,34069+le,mt.__webglTexture,fe)}else if(ht){const mt=ie.get(N.texture),Ht=le||0;_.framebufferTextureLayer(36160,36064,mt.__webglTexture,fe||0,Ht)}y=-1},this.readRenderTargetPixels=function(N,le,fe,ue,We,Ct,ht){if(!(N&&N.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ft=ie.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&ht!==void 0&&(ft=ft[ht]),ft){we.bindFramebuffer(36160,ft);try{const mt=N.texture,Ht=mt.format,Rt=mt.type;if(Ht!==Ai&&$e.convert(Ht)!==_.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Zt=Rt===Ng&&(ye.has("EXT_color_buffer_half_float")||ge.isWebGL2&&ye.has("EXT_color_buffer_float"));if(Rt!==Tr&&$e.convert(Rt)!==_.getParameter(35738)&&!(Rt===Hs&&(ge.isWebGL2||ye.has("OES_texture_float")||ye.has("WEBGL_color_buffer_float")))&&!Zt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}_.checkFramebufferStatus(36160)===36053?le>=0&&le<=N.width-ue&&fe>=0&&fe<=N.height-We&&_.readPixels(le,fe,ue,We,$e.convert(Ht),$e.convert(Rt),Ct):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const mt=B!==null?ie.get(B).__webglFramebuffer:null;we.bindFramebuffer(36160,mt)}}},this.copyFramebufferToTexture=function(N,le,fe=0){if(le.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}const ue=Math.pow(2,-fe),We=Math.floor(le.image.width*ue),Ct=Math.floor(le.image.height*ue);de.setTexture2D(le,0),_.copyTexSubImage2D(3553,fe,0,0,N.x,N.y,We,Ct),we.unbindTexture()},this.copyTextureToTexture=function(N,le,fe,ue=0){const We=le.image.width,Ct=le.image.height,ht=$e.convert(fe.format),ft=$e.convert(fe.type);de.setTexture2D(fe,0),_.pixelStorei(37440,fe.flipY),_.pixelStorei(37441,fe.premultiplyAlpha),_.pixelStorei(3317,fe.unpackAlignment),le.isDataTexture?_.texSubImage2D(3553,ue,N.x,N.y,We,Ct,ht,ft,le.image.data):le.isCompressedTexture?_.compressedTexSubImage2D(3553,ue,N.x,N.y,le.mipmaps[0].width,le.mipmaps[0].height,ht,le.mipmaps[0].data):_.texSubImage2D(3553,ue,N.x,N.y,ht,ft,le.image),ue===0&&fe.generateMipmaps&&_.generateMipmap(3553),we.unbindTexture()},this.copyTextureToTexture3D=function(N,le,fe,ue,We=0){if(b.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Ct=N.max.x-N.min.x+1,ht=N.max.y-N.min.y+1,ft=N.max.z-N.min.z+1,mt=$e.convert(ue.format),Ht=$e.convert(ue.type);let Rt;if(ue.isData3DTexture)de.setTexture3D(ue,0),Rt=32879;else if(ue.isDataArrayTexture)de.setTexture2DArray(ue,0),Rt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}_.pixelStorei(37440,ue.flipY),_.pixelStorei(37441,ue.premultiplyAlpha),_.pixelStorei(3317,ue.unpackAlignment);const Zt=_.getParameter(3314),Jt=_.getParameter(32878),mo=_.getParameter(3316),fo=_.getParameter(3315),No=_.getParameter(32877),Pn=fe.isCompressedTexture?fe.mipmaps[0]:fe.image;_.pixelStorei(3314,Pn.width),_.pixelStorei(32878,Pn.height),_.pixelStorei(3316,N.min.x),_.pixelStorei(3315,N.min.y),_.pixelStorei(32877,N.min.z),fe.isDataTexture||fe.isData3DTexture?_.texSubImage3D(Rt,We,le.x,le.y,le.z,Ct,ht,ft,mt,Ht,Pn.data):fe.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_.compressedTexSubImage3D(Rt,We,le.x,le.y,le.z,Ct,ht,ft,mt,Pn.data)):_.texSubImage3D(Rt,We,le.x,le.y,le.z,Ct,ht,ft,mt,Ht,Pn),_.pixelStorei(3314,Zt),_.pixelStorei(32878,Jt),_.pixelStorei(3316,mo),_.pixelStorei(3315,fo),_.pixelStorei(32877,No),We===0&&ue.generateMipmaps&&_.generateMipmap(Rt),we.unbindTexture()},this.initTexture=function(N){de.setTexture2D(N,0),we.unbindTexture()},this.resetState=function(){m=0,h=0,B=null,we.reset(),ve.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Tt.prototype.isWebGLRenderer=!0;class Hx extends Tt{}Hx.prototype.isWebGL1Renderer=!0;class DC{constructor(e,t=25e-5){this.name="",this.color=new ze(e),this.density=t}clone(){return new DC(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}DC.prototype.isFogExp2=!0;class UC{constructor(e,t=1,i=1e3){this.name="",this.color=new ze(e),this.near=t,this.far=i}clone(){return new UC(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}UC.prototype.isFog=!0;class PC extends Gt{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}PC.prototype.isScene=!0;class qr{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Ll,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Pi()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let o=0,s=this.stride;o<s;o++)this.array[e+o]=t.array[i+o];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Pi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Pi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}qr.prototype.isInterleavedBuffer=!0;const vn=new K;class Ns{constructor(e,t,i,o=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=o===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.applyMatrix4(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.applyNormalMatrix(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.transformDirection(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=o,this}setXYZW(e,t,i,o,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=o,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const o=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[o+s])}return new vt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ns(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const o=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[o+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Ns.prototype.isInterleavedBufferAttribute=!0;class Qh extends cn{constructor(e){super();this.type="SpriteMaterial",this.color=new ze(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}Qh.prototype.isSpriteMaterial=!0;let _a;const sc=new K,Ja=new K,Da=new K,Ua=new Se,rc=new Se,Xx=new et,Nd=new K,gc=new K,Ld=new K,o2=new Se,Df=new Se,s2=new Se;class Oh extends Gt{constructor(e){super();if(this.type="Sprite",_a===void 0){_a=new at;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new qr(t,5);_a.setIndex([0,1,2,0,2,3]),_a.setAttribute("position",new Ns(i,3,0,!1)),_a.setAttribute("uv",new Ns(i,2,3,!1))}this.geometry=_a,this.material=e!==void 0?e:new Qh,this.center=new Se(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ja.setFromMatrixScale(this.matrixWorld),Xx.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Da.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ja.multiplyScalar(-Da.z);const i=this.material.rotation;let o,s;i!==0&&(s=Math.cos(i),o=Math.sin(i));const r=this.center;zd(Nd.set(-.5,-.5,0),Da,r,Ja,o,s),zd(gc.set(.5,-.5,0),Da,r,Ja,o,s),zd(Ld.set(.5,.5,0),Da,r,Ja,o,s),o2.set(0,0),Df.set(1,0),s2.set(1,1);let g=e.ray.intersectTriangle(Nd,gc,Ld,!1,sc);if(g===null&&(zd(gc.set(-.5,.5,0),Da,r,Ja,o,s),Df.set(0,1),g=e.ray.intersectTriangle(Nd,Ld,gc,!1,sc),g===null))return;const a=e.ray.origin.distanceTo(sc);a<e.near||a>e.far||t.push({distance:a,point:sc.clone(),uv:Wn.getUV(sc,Nd,gc,Ld,o2,Df,s2,new Se),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}Oh.prototype.isSprite=!0;function zd(n,e,t,i,o,s){Ua.subVectors(n,t).addScalar(.5).multiply(i),o!==void 0?(rc.x=s*Ua.x-o*Ua.y,rc.y=o*Ua.x+s*Ua.y):rc.copy(Ua),n.copy(e),n.x+=rc.x,n.y+=rc.y,n.applyMatrix4(Xx)}const kd=new K,r2=new K;class Mx extends Gt{constructor(){super();this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,o=t.length;i<o;i++){const s=t[i];this.addLevel(s.object.clone(),s.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const i=this.levels;let o;for(o=0;o<i.length&&!(t<i[o].distance);o++);return i.splice(o,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,o;for(i=1,o=t.length;i<o&&!(e<t[i].distance);i++);return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){kd.setFromMatrixPosition(this.matrixWorld);const o=e.ray.origin.distanceTo(kd);this.getObjectForDistance(o).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){kd.setFromMatrixPosition(e.matrixWorld),r2.setFromMatrixPosition(this.matrixWorld);const i=kd.distanceTo(r2)/e.zoom;t[0].object.visible=!0;let o,s;for(o=1,s=t.length;o<s&&i>=t[o].distance;o++)t[o-1].object.visible=!1,t[o].object.visible=!0;for(this._currentLevel=o-1;o<s;o++)t[o].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let o=0,s=i.length;o<s;o++){const r=i[o];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const g2=new K,a2=new zt,l2=new zt,SL=new K,I2=new et;class QC extends Sn{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new et,this.bindMatrixInverse=new et}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new zt,t=this.geometry.attributes.skinWeight;for(let i=0,o=t.count;i<o;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,o=this.geometry;a2.fromBufferAttribute(o.attributes.skinIndex,e),l2.fromBufferAttribute(o.attributes.skinWeight,e),g2.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const r=l2.getComponent(s);if(r!==0){const g=a2.getComponent(s);I2.multiplyMatrices(i.bones[g].matrixWorld,i.boneInverses[g]),t.addScaledVector(SL.copy(g2).applyMatrix4(I2),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}QC.prototype.isSkinnedMesh=!0;class OC extends Gt{constructor(){super();this.type="Bone"}}OC.prototype.isBone=!0;class Tg extends pn{constructor(e=null,t=1,i=1,o,s,r,g,a,l=Rn,u=Rn,d,C){super(null,r,g,a,l,u,o,s,d,C);this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Tg.prototype.isDataTexture=!0;const c2=new et,VL=new et;class jC{constructor(e=[],t=[]){this.uuid=Pi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,o=this.bones.length;i<o;i++)this.boneInverses.push(new et)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new et;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,o=this.boneTexture;for(let s=0,r=e.length;s<r;s++){const g=e[s]?e[s].matrixWorld:VL;c2.multiplyMatrices(g,t[s]),c2.toArray(i,s*16)}o!==null&&(o.needsUpdate=!0)}clone(){return new jC(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=ax(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Tg(t,e,e,Ai,Hs);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const o=this.bones[t];if(o.name===e)return o}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,o=e.bones.length;i<o;i++){const s=e.bones[i];let r=t[s];r===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),r=new OC),this.bones.push(r),this.boneInverses.push(new et().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let o=0,s=t.length;o<s;o++){const r=t[o];e.bones.push(r.uuid);const g=i[o];e.boneInverses.push(g.toArray())}return e}}class qg extends vt{constructor(e,t,i,o=1){typeof i=="number"&&(o=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,i);this.meshPerAttribute=o}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}qg.prototype.isInstancedBufferAttribute=!0;const C2=new et,u2=new et,Td=[],ac=new Sn;class Eg extends Sn{constructor(e,t,i){super(e,t);this.instanceMatrix=new qg(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,o=this.count;if(ac.geometry=this.geometry,ac.material=this.material,ac.material!==void 0)for(let s=0;s<o;s++){this.getMatrixAt(s,C2),u2.multiplyMatrices(i,C2),ac.matrixWorld=u2,ac.raycast(e,Td);for(let r=0,g=Td.length;r<g;r++){const a=Td[r];a.instanceId=s,a.object=this,t.push(a)}Td.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new qg(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Eg.prototype.isInstancedMesh=!0;class En extends cn{constructor(e){super();this.type="LineBasicMaterial",this.color=new ze(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}En.prototype.isLineBasicMaterial=!0;const d2=new K,A2=new K,h2=new et,Uf=new jr,Ed=new Ts;class ss extends Gt{constructor(e=new at,t=new En){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[0];for(let o=1,s=t.count;o<s;o++)d2.fromBufferAttribute(t,o-1),A2.fromBufferAttribute(t,o),i[o]=i[o-1],i[o]+=d2.distanceTo(A2);e.setAttribute("lineDistance",new tt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,o=this.matrixWorld,s=e.params.Line.threshold,r=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Ed.copy(i.boundingSphere),Ed.applyMatrix4(o),Ed.radius+=s,e.ray.intersectsSphere(Ed)===!1)return;h2.copy(o).invert(),Uf.copy(e.ray).applyMatrix4(h2);const g=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=g*g,l=new K,u=new K,d=new K,C=new K,A=this.isLineSegments?2:1;if(i.isBufferGeometry){const f=i.index,G=i.attributes.position;if(f!==null){const m=Math.max(0,r.start),h=Math.min(f.count,r.start+r.count);for(let B=m,y=h-1;B<y;B+=A){const Z=f.getX(B),R=f.getX(B+1);if(l.fromBufferAttribute(G,Z),u.fromBufferAttribute(G,R),Uf.distanceSqToSegment(l,u,C,d)>a)continue;C.applyMatrix4(this.matrixWorld);const x=e.ray.origin.distanceTo(C);x<e.near||x>e.far||t.push({distance:x,point:d.clone().applyMatrix4(this.matrixWorld),index:B,face:null,faceIndex:null,object:this})}}else{const m=Math.max(0,r.start),h=Math.min(G.count,r.start+r.count);for(let B=m,y=h-1;B<y;B+=A){if(l.fromBufferAttribute(G,B),u.fromBufferAttribute(G,B+1),Uf.distanceSqToSegment(l,u,C,d)>a)continue;C.applyMatrix4(this.matrixWorld);const R=e.ray.origin.distanceTo(C);R<e.near||R>e.far||t.push({distance:R,point:d.clone().applyMatrix4(this.matrixWorld),index:B,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=o.length;s<r;s++){const g=o[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}ss.prototype.isLine=!0;const p2=new K,m2=new K;class yi extends ss{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[];for(let o=0,s=t.count;o<s;o+=2)p2.fromBufferAttribute(t,o),m2.fromBufferAttribute(t,o+1),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+p2.distanceTo(m2);e.setAttribute("lineDistance",new tt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}yi.prototype.isLineSegments=!0;class jh extends ss{constructor(e,t){super(e,t);this.type="LineLoop"}}jh.prototype.isLineLoop=!0;class $r extends cn{constructor(e){super();this.type="PointsMaterial",this.color=new ze(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}$r.prototype.isPointsMaterial=!0;const f2=new et,z0=new jr,_d=new Ts,Jd=new K;class hI extends Gt{constructor(e=new at,t=new $r){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,o=this.matrixWorld,s=e.params.Points.threshold,r=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),_d.copy(i.boundingSphere),_d.applyMatrix4(o),_d.radius+=s,e.ray.intersectsSphere(_d)===!1)return;f2.copy(o).invert(),z0.copy(e.ray).applyMatrix4(f2);const g=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=g*g;if(i.isBufferGeometry){const l=i.index,d=i.attributes.position;if(l!==null){const C=Math.max(0,r.start),A=Math.min(l.count,r.start+r.count);for(let f=C,b=A;f<b;f++){const G=l.getX(f);Jd.fromBufferAttribute(d,G),b2(Jd,G,a,o,e,t,this)}}else{const C=Math.max(0,r.start),A=Math.min(d.count,r.start+r.count);for(let f=C,b=A;f<b;f++)Jd.fromBufferAttribute(d,f),b2(Jd,f,a,o,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=o.length;s<r;s++){const g=o[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}hI.prototype.isPoints=!0;function b2(n,e,t,i,o,s,r){const g=z0.distanceSqToPoint(n);if(g<t){const a=new K;z0.closestPointToPoint(n,a),a.applyMatrix4(i);const l=o.ray.origin.distanceTo(a);if(l<o.near||l>o.far)return;s.push({distance:l,distanceToRay:Math.sqrt(g),point:a,index:e,face:null,object:r})}}class Kx extends pn{constructor(e,t,i,o,s,r,g,a,l){super(e,t,i,o,s,r,g,a,l);this.minFilter=r!==void 0?r:gn,this.magFilter=s!==void 0?s:gn,this.generateMipmaps=!1;const u=this;function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Kx.prototype.isVideoTexture=!0;class Fx extends pn{constructor(e,t,i){super({width:e,height:t});this.format=i,this.magFilter=Rn,this.minFilter=Rn,this.generateMipmaps=!1,this.needsUpdate=!0}}Fx.prototype.isFramebufferTexture=!0;class bB extends pn{constructor(e,t,i,o,s,r,g,a,l,u,d,C){super(null,r,g,a,l,u,o,s,d,C);this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}bB.prototype.isCompressedTexture=!0;class Yx extends pn{constructor(e,t,i,o,s,r,g,a,l){super(e,t,i,o,s,r,g,a,l);this.needsUpdate=!0}}Yx.prototype.isCanvasTexture=!0;class kl extends at{constructor(e=1,t=8,i=0,o=Math.PI*2){super();this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:o},t=Math.max(3,t);const s=[],r=[],g=[],a=[],l=new K,u=new Se;r.push(0,0,0),g.push(0,0,1),a.push(.5,.5);for(let d=0,C=3;d<=t;d++,C+=3){const A=i+d/t*o;l.x=e*Math.cos(A),l.y=e*Math.sin(A),r.push(l.x,l.y,l.z),g.push(0,0,1),u.x=(r[C]/e+1)/2,u.y=(r[C+1]/e+1)/2,a.push(u.x,u.y)}for(let d=1;d<=t;d++)s.push(d,d+1,0);this.setIndex(s),this.setAttribute("position",new tt(r,3)),this.setAttribute("normal",new tt(g,3)),this.setAttribute("uv",new tt(a,2))}static fromJSON(e){return new kl(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Er extends at{constructor(e=1,t=1,i=1,o=8,s=1,r=!1,g=0,a=Math.PI*2){super();this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:o,heightSegments:s,openEnded:r,thetaStart:g,thetaLength:a};const l=this;o=Math.floor(o),s=Math.floor(s);const u=[],d=[],C=[],A=[];let f=0;const b=[],G=i/2;let m=0;h(),r===!1&&(e>0&&B(!0),t>0&&B(!1)),this.setIndex(u),this.setAttribute("position",new tt(d,3)),this.setAttribute("normal",new tt(C,3)),this.setAttribute("uv",new tt(A,2));function h(){const y=new K,Z=new K;let R=0;const W=(t-e)/i;for(let x=0;x<=s;x++){const X=[],Y=x/s,S=Y*(t-e)+e;for(let H=0;H<=o;H++){const k=H/o,U=k*a+g,D=Math.sin(U),Q=Math.cos(U);Z.x=S*D,Z.y=-Y*i+G,Z.z=S*Q,d.push(Z.x,Z.y,Z.z),y.set(D,W,Q).normalize(),C.push(y.x,y.y,y.z),A.push(k,1-Y),X.push(f++)}b.push(X)}for(let x=0;x<o;x++)for(let X=0;X<s;X++){const Y=b[X][x],S=b[X+1][x],H=b[X+1][x+1],k=b[X][x+1];u.push(Y,S,k),u.push(S,H,k),R+=6}l.addGroup(m,R,0),m+=R}function B(y){const Z=f,R=new Se,W=new K;let x=0;const X=y===!0?e:t,Y=y===!0?1:-1;for(let H=1;H<=o;H++)d.push(0,G*Y,0),C.push(0,Y,0),A.push(.5,.5),f++;const S=f;for(let H=0;H<=o;H++){const U=H/o*a+g,D=Math.cos(U),Q=Math.sin(U);W.x=X*Q,W.y=G*Y,W.z=X*D,d.push(W.x,W.y,W.z),C.push(0,Y,0),R.x=D*.5+.5,R.y=Q*.5*Y+.5,A.push(R.x,R.y),f++}for(let H=0;H<o;H++){const k=Z+H,U=S+H;y===!0?u.push(U,U+1,k):u.push(U+1,U,k),x+=3}l.addGroup(m,x,y===!0?1:2),m+=x}}static fromJSON(e){return new Er(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Tl extends Er{constructor(e=1,t=1,i=8,o=1,s=!1,r=0,g=Math.PI*2){super(0,e,t,i,o,s,r,g);this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:r,thetaLength:g}}static fromJSON(e){return new Tl(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class rs extends at{constructor(e=[],t=[],i=1,o=0){super();this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:o};const s=[],r=[];g(o),l(i),u(),this.setAttribute("position",new tt(s,3)),this.setAttribute("normal",new tt(s.slice(),3)),this.setAttribute("uv",new tt(r,2)),o===0?this.computeVertexNormals():this.normalizeNormals();function g(h){const B=new K,y=new K,Z=new K;for(let R=0;R<t.length;R+=3)A(t[R+0],B),A(t[R+1],y),A(t[R+2],Z),a(B,y,Z,h)}function a(h,B,y,Z){const R=Z+1,W=[];for(let x=0;x<=R;x++){W[x]=[];const X=h.clone().lerp(y,x/R),Y=B.clone().lerp(y,x/R),S=R-x;for(let H=0;H<=S;H++)H===0&&x===R?W[x][H]=X:W[x][H]=X.clone().lerp(Y,H/S)}for(let x=0;x<R;x++)for(let X=0;X<2*(R-x)-1;X++){const Y=Math.floor(X/2);X%2===0?(C(W[x][Y+1]),C(W[x+1][Y]),C(W[x][Y])):(C(W[x][Y+1]),C(W[x+1][Y+1]),C(W[x+1][Y]))}}function l(h){const B=new K;for(let y=0;y<s.length;y+=3)B.x=s[y+0],B.y=s[y+1],B.z=s[y+2],B.normalize().multiplyScalar(h),s[y+0]=B.x,s[y+1]=B.y,s[y+2]=B.z}function u(){const h=new K;for(let B=0;B<s.length;B+=3){h.x=s[B+0],h.y=s[B+1],h.z=s[B+2];const y=G(h)/2/Math.PI+.5,Z=m(h)/Math.PI+.5;r.push(y,1-Z)}f(),d()}function d(){for(let h=0;h<r.length;h+=6){const B=r[h+0],y=r[h+2],Z=r[h+4],R=Math.max(B,y,Z),W=Math.min(B,y,Z);R>.9&&W<.1&&(B<.2&&(r[h+0]+=1),y<.2&&(r[h+2]+=1),Z<.2&&(r[h+4]+=1))}}function C(h){s.push(h.x,h.y,h.z)}function A(h,B){const y=h*3;B.x=e[y+0],B.y=e[y+1],B.z=e[y+2]}function f(){const h=new K,B=new K,y=new K,Z=new K,R=new Se,W=new Se,x=new Se;for(let X=0,Y=0;X<s.length;X+=9,Y+=6){h.set(s[X+0],s[X+1],s[X+2]),B.set(s[X+3],s[X+4],s[X+5]),y.set(s[X+6],s[X+7],s[X+8]),R.set(r[Y+0],r[Y+1]),W.set(r[Y+2],r[Y+3]),x.set(r[Y+4],r[Y+5]),Z.copy(h).add(B).add(y).divideScalar(3);const S=G(Z);b(R,Y+0,h,S),b(W,Y+2,B,S),b(x,Y+4,y,S)}}function b(h,B,y,Z){Z<0&&h.x===1&&(r[B]=h.x-1),y.x===0&&y.z===0&&(r[B]=Z/2/Math.PI+.5)}function G(h){return Math.atan2(h.z,-h.x)}function m(h){return Math.atan2(-h.y,Math.sqrt(h.x*h.x+h.z*h.z))}}static fromJSON(e){return new rs(e.vertices,e.indices,e.radius,e.details)}}class El extends rs{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,o=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o],r=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,r,e,t);this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new El(e.radius,e.detail)}}const Dd=new K,Ud=new K,Pf=new K,Pd=new Wn;class GB extends at{constructor(e=null,t=1){super();if(this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const o=Math.pow(10,4),s=Math.cos(zg*t),r=e.getIndex(),g=e.getAttribute("position"),a=r?r.count:g.count,l=[0,0,0],u=["a","b","c"],d=new Array(3),C={},A=[];for(let f=0;f<a;f+=3){r?(l[0]=r.getX(f),l[1]=r.getX(f+1),l[2]=r.getX(f+2)):(l[0]=f,l[1]=f+1,l[2]=f+2);const{a:b,b:G,c:m}=Pd;if(b.fromBufferAttribute(g,l[0]),G.fromBufferAttribute(g,l[1]),m.fromBufferAttribute(g,l[2]),Pd.getNormal(Pf),d[0]=`${Math.round(b.x*o)},${Math.round(b.y*o)},${Math.round(b.z*o)}`,d[1]=`${Math.round(G.x*o)},${Math.round(G.y*o)},${Math.round(G.z*o)}`,d[2]=`${Math.round(m.x*o)},${Math.round(m.y*o)},${Math.round(m.z*o)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let h=0;h<3;h++){const B=(h+1)%3,y=d[h],Z=d[B],R=Pd[u[h]],W=Pd[u[B]],x=`${y}_${Z}`,X=`${Z}_${y}`;X in C&&C[X]?(Pf.dot(C[X].normal)<=s&&(A.push(R.x,R.y,R.z),A.push(W.x,W.y,W.z)),C[X]=null):x in C||(C[x]={index0:l[h],index1:l[B],normal:Pf.clone()})}}for(const f in C)if(C[f]){const{index0:b,index1:G}=C[f];Dd.fromBufferAttribute(g,b),Ud.fromBufferAttribute(g,G),A.push(Dd.x,Dd.y,Dd.z),A.push(Ud.x,Ud.y,Ud.z)}this.setAttribute("position",new tt(A,3))}}}class Oi{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,o=this.getPoint(0),s=0;t.push(0);for(let r=1;r<=e;r++)i=this.getPoint(r/e),s+=i.distanceTo(o),t.push(s),o=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let o=0;const s=i.length;let r;t?r=t:r=e*i[s-1];let g=0,a=s-1,l;for(;g<=a;)if(o=Math.floor(g+(a-g)/2),l=i[o]-r,l<0)g=o+1;else if(l>0)a=o-1;else{a=o;break}if(o=a,i[o]===r)return o/(s-1);const u=i[o],C=i[o+1]-u,A=(r-u)/C;return(o+A)/(s-1)}getTangent(e,t){let o=e-1e-4,s=e+1e-4;o<0&&(o=0),s>1&&(s=1);const r=this.getPoint(o),g=this.getPoint(s),a=t||(r.isVector2?new Se:new K);return a.copy(g).sub(r).normalize(),a}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new K,o=[],s=[],r=[],g=new K,a=new et;for(let A=0;A<=e;A++){const f=A/e;o[A]=this.getTangentAt(f,new K)}s[0]=new K,r[0]=new K;let l=Number.MAX_VALUE;const u=Math.abs(o[0].x),d=Math.abs(o[0].y),C=Math.abs(o[0].z);u<=l&&(l=u,i.set(1,0,0)),d<=l&&(l=d,i.set(0,1,0)),C<=l&&i.set(0,0,1),g.crossVectors(o[0],i).normalize(),s[0].crossVectors(o[0],g),r[0].crossVectors(o[0],s[0]);for(let A=1;A<=e;A++){if(s[A]=s[A-1].clone(),r[A]=r[A-1].clone(),g.crossVectors(o[A-1],o[A]),g.length()>Number.EPSILON){g.normalize();const f=Math.acos(ni(o[A-1].dot(o[A]),-1,1));s[A].applyMatrix4(a.makeRotationAxis(g,f))}r[A].crossVectors(o[A],s[A])}if(t===!0){let A=Math.acos(ni(s[0].dot(s[e]),-1,1));A/=e,o[0].dot(g.crossVectors(s[0],s[e]))>0&&(A=-A);for(let f=1;f<=e;f++)s[f].applyMatrix4(a.makeRotationAxis(o[f],A*f)),r[f].crossVectors(o[f],s[f])}return{tangents:o,normals:s,binormals:r}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class qC extends Oi{constructor(e=0,t=0,i=1,o=1,s=0,r=Math.PI*2,g=!1,a=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=o,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=g,this.aRotation=a}getPoint(e,t){const i=t||new Se,o=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=o;for(;s>o;)s-=o;s<Number.EPSILON&&(r?s=0:s=o),this.aClockwise===!0&&!r&&(s===o?s=-o:s=s-o);const g=this.aStartAngle+e*s;let a=this.aX+this.xRadius*Math.cos(g),l=this.aY+this.yRadius*Math.sin(g);if(this.aRotation!==0){const u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),C=a-this.aX,A=l-this.aY;a=C*u-A*d+this.aX,l=C*d+A*u+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}qC.prototype.isEllipseCurve=!0;class BB extends qC{constructor(e,t,i,o,s,r){super(e,t,i,i,o,s,r);this.type="ArcCurve"}}BB.prototype.isArcCurve=!0;function yB(){let n=0,e=0,t=0,i=0;function o(s,r,g,a){n=s,e=g,t=-3*s+3*r-2*g-a,i=2*s-2*r+g+a}return{initCatmullRom:function(s,r,g,a,l){o(r,g,l*(g-s),l*(a-r))},initNonuniformCatmullRom:function(s,r,g,a,l,u,d){let C=(r-s)/l-(g-s)/(l+u)+(g-r)/u,A=(g-r)/u-(a-r)/(u+d)+(a-g)/d;C*=u,A*=u,o(r,g,C,A)},calc:function(s){const r=s*s,g=r*s;return n+e*s+t*r+i*g}}}const Qd=new K,Qf=new yB,Of=new yB,jf=new yB;class vB extends Oi{constructor(e=[],t=!1,i="centripetal",o=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=o}getPoint(e,t=new K){const i=t,o=this.points,s=o.length,r=(s-(this.closed?0:1))*e;let g=Math.floor(r),a=r-g;this.closed?g+=g>0?0:(Math.floor(Math.abs(g)/s)+1)*s:a===0&&g===s-1&&(g=s-2,a=1);let l,u;this.closed||g>0?l=o[(g-1)%s]:(Qd.subVectors(o[0],o[1]).add(o[0]),l=Qd);const d=o[g%s],C=o[(g+1)%s];if(this.closed||g+2<s?u=o[(g+2)%s]:(Qd.subVectors(o[s-1],o[s-2]).add(o[s-1]),u=Qd),this.curveType==="centripetal"||this.curveType==="chordal"){const A=this.curveType==="chordal"?.5:.25;let f=Math.pow(l.distanceToSquared(d),A),b=Math.pow(d.distanceToSquared(C),A),G=Math.pow(C.distanceToSquared(u),A);b<1e-4&&(b=1),f<1e-4&&(f=b),G<1e-4&&(G=b),Qf.initNonuniformCatmullRom(l.x,d.x,C.x,u.x,f,b,G),Of.initNonuniformCatmullRom(l.y,d.y,C.y,u.y,f,b,G),jf.initNonuniformCatmullRom(l.z,d.z,C.z,u.z,f,b,G)}else this.curveType==="catmullrom"&&(Qf.initCatmullRom(l.x,d.x,C.x,u.x,this.tension),Of.initCatmullRom(l.y,d.y,C.y,u.y,this.tension),jf.initCatmullRom(l.z,d.z,C.z,u.z,this.tension));return i.set(Qf.calc(a),Of.calc(a),jf.calc(a)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const o=e.points[t];this.points.push(o.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const o=this.points[t];e.points.push(o.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const o=e.points[t];this.points.push(new K().fromArray(o))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}vB.prototype.isCatmullRomCurve3=!0;function G2(n,e,t,i,o){const s=(i-e)*.5,r=(o-t)*.5,g=n*n,a=n*g;return(2*t-2*i+s+r)*a+(-3*t+3*i-2*s-r)*g+s*n+t}function xL(n,e){const t=1-n;return t*t*e}function HL(n,e){return 2*(1-n)*n*e}function XL(n,e){return n*n*e}function Uc(n,e,t,i){return xL(n,e)+HL(n,t)+XL(n,i)}function ML(n,e){const t=1-n;return t*t*t*e}function KL(n,e){const t=1-n;return 3*t*t*n*e}function FL(n,e){return 3*(1-n)*n*n*e}function YL(n,e){return n*n*n*e}function Pc(n,e,t,i,o){return ML(n,e)+KL(n,t)+FL(n,i)+YL(n,o)}class qh extends Oi{constructor(e=new Se,t=new Se,i=new Se,o=new Se){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=o}getPoint(e,t=new Se){const i=t,o=this.v0,s=this.v1,r=this.v2,g=this.v3;return i.set(Pc(e,o.x,s.x,r.x,g.x),Pc(e,o.y,s.y,r.y,g.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}qh.prototype.isCubicBezierCurve=!0;class ZB extends Oi{constructor(e=new K,t=new K,i=new K,o=new K){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=o}getPoint(e,t=new K){const i=t,o=this.v0,s=this.v1,r=this.v2,g=this.v3;return i.set(Pc(e,o.x,s.x,r.x,g.x),Pc(e,o.y,s.y,r.y,g.y),Pc(e,o.z,s.z,r.z,g.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ZB.prototype.isCubicBezierCurve3=!0;class $C extends Oi{constructor(e=new Se,t=new Se){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Se){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new Se;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}$C.prototype.isLineCurve=!0;class Nx extends Oi{constructor(e=new K,t=new K){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new K){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class $h extends Oi{constructor(e=new Se,t=new Se,i=new Se){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Se){const i=t,o=this.v0,s=this.v1,r=this.v2;return i.set(Uc(e,o.x,s.x,r.x),Uc(e,o.y,s.y,r.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}$h.prototype.isQuadraticBezierCurve=!0;class ep extends Oi{constructor(e=new K,t=new K,i=new K){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new K){const i=t,o=this.v0,s=this.v1,r=this.v2;return i.set(Uc(e,o.x,s.x,r.x),Uc(e,o.y,s.y,r.y),Uc(e,o.z,s.z,r.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ep.prototype.isQuadraticBezierCurve3=!0;class tp extends Oi{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new Se){const i=t,o=this.points,s=(o.length-1)*e,r=Math.floor(s),g=s-r,a=o[r===0?r:r-1],l=o[r],u=o[r>o.length-2?o.length-1:r+1],d=o[r>o.length-3?o.length-1:r+2];return i.set(G2(g,a.x,l.x,u.x,d.x),G2(g,a.y,l.y,u.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const o=e.points[t];this.points.push(o.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const o=this.points[t];e.points.push(o.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const o=e.points[t];this.points.push(new Se().fromArray(o))}return this}}tp.prototype.isSplineCurve=!0;var wB=Object.freeze({__proto__:null,ArcCurve:BB,CatmullRomCurve3:vB,CubicBezierCurve:qh,CubicBezierCurve3:ZB,EllipseCurve:qC,LineCurve:$C,LineCurve3:Nx,QuadraticBezierCurve:$h,QuadraticBezierCurve3:ep,SplineCurve:tp});class Lx extends Oi{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new $C(t,e))}getPoint(e,t){const i=e*this.getLength(),o=this.getCurveLengths();let s=0;for(;s<o.length;){if(o[s]>=i){const r=o[s]-i,g=this.curves[s],a=g.getLength(),l=a===0?0:1-r/a;return g.getPointAt(l,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,o=this.curves.length;i<o;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let o=0,s=this.curves;o<s.length;o++){const r=s[o],g=r.isEllipseCurve?e*2:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?e*r.points.length:e,a=r.getPoints(g);for(let l=0;l<a.length;l++){const u=a[l];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const o=e.curves[t];this.curves.push(o.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const o=this.curves[t];e.curves.push(o.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const o=e.curves[t];this.curves.push(new wB[o.type]().fromJSON(o))}return this}}class BC extends Lx{constructor(e){super();this.type="Path",this.currentPoint=new Se,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new $C(this.currentPoint.clone(),new Se(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,o){const s=new $h(this.currentPoint.clone(),new Se(e,t),new Se(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this}bezierCurveTo(e,t,i,o,s,r){const g=new qh(this.currentPoint.clone(),new Se(e,t),new Se(i,o),new Se(s,r));return this.curves.push(g),this.currentPoint.set(s,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new tp(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,o,s,r){const g=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+g,t+a,i,o,s,r),this}absarc(e,t,i,o,s,r){return this.absellipse(e,t,i,i,o,s,r),this}ellipse(e,t,i,o,s,r,g,a){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,i,o,s,r,g,a),this}absellipse(e,t,i,o,s,r,g,a){const l=new qC(e,t,i,o,s,r,g,a);if(this.curves.length>0){const d=l.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class ns extends BC{constructor(e){super(e);this.uuid=Pi(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,o=this.holes.length;i<o;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const o=e.holes[t];this.holes.push(o.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const o=this.holes[t];e.holes.push(o.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const o=e.holes[t];this.holes.push(new BC().fromJSON(o))}return this}}const NL={triangulate:function(n,e,t=2){const i=e&&e.length,o=i?e[0]*t:n.length;let s=zx(n,0,o,t,!0);const r=[];if(!s||s.next===s.prev)return r;let g,a,l,u,d,C,A;if(i&&(s=EL(n,e,s,t)),n.length>80*t){g=l=n[0],a=u=n[1];for(let f=t;f<o;f+=t)d=n[f],C=n[f+1],d<g&&(g=d),C<a&&(a=C),d>l&&(l=d),C>u&&(u=C);A=Math.max(l-g,u-a),A=A!==0?1/A:0}return yC(s,r,t,g,a,A),r}};function zx(n,e,t,i,o){let s,r;if(o===ez(n,e,t,i)>0)for(s=e;s<t;s+=i)r=B2(s,n[s],n[s+1],r);else for(s=t-i;s>=e;s-=i)r=B2(s,n[s],n[s+1],r);return r&&np(r,r.next)&&(ZC(r),r=r.next),r}function _r(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(np(t,t.next)||An(t.prev,t,t.next)===0)){if(ZC(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function yC(n,e,t,i,o,s,r){if(!n)return;!r&&s&&PL(n,i,o,s);let g=n,a,l;for(;n.prev!==n.next;){if(a=n.prev,l=n.next,s?zL(n,i,o,s):LL(n)){e.push(a.i/t),e.push(n.i/t),e.push(l.i/t),ZC(n),n=l.next,g=l.next;continue}if(n=l,n===g){r?r===1?(n=kL(_r(n),e,t),yC(n,e,t,i,o,s,2)):r===2&&TL(n,e,t,i,o,s):yC(_r(n),e,t,i,o,s,1);break}}}function LL(n){const e=n.prev,t=n,i=n.next;if(An(e,t,i)>=0)return!1;let o=n.next.next;for(;o!==n.prev;){if(ul(e.x,e.y,t.x,t.y,i.x,i.y,o.x,o.y)&&An(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function zL(n,e,t,i){const o=n.prev,s=n,r=n.next;if(An(o,s,r)>=0)return!1;const g=o.x<s.x?o.x<r.x?o.x:r.x:s.x<r.x?s.x:r.x,a=o.y<s.y?o.y<r.y?o.y:r.y:s.y<r.y?s.y:r.y,l=o.x>s.x?o.x>r.x?o.x:r.x:s.x>r.x?s.x:r.x,u=o.y>s.y?o.y>r.y?o.y:r.y:s.y>r.y?s.y:r.y,d=k0(g,a,e,t,i),C=k0(l,u,e,t,i);let A=n.prevZ,f=n.nextZ;for(;A&&A.z>=d&&f&&f.z<=C;){if(A!==n.prev&&A!==n.next&&ul(o.x,o.y,s.x,s.y,r.x,r.y,A.x,A.y)&&An(A.prev,A,A.next)>=0||(A=A.prevZ,f!==n.prev&&f!==n.next&&ul(o.x,o.y,s.x,s.y,r.x,r.y,f.x,f.y)&&An(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;A&&A.z>=d;){if(A!==n.prev&&A!==n.next&&ul(o.x,o.y,s.x,s.y,r.x,r.y,A.x,A.y)&&An(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;f&&f.z<=C;){if(f!==n.prev&&f!==n.next&&ul(o.x,o.y,s.x,s.y,r.x,r.y,f.x,f.y)&&An(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function kL(n,e,t){let i=n;do{const o=i.prev,s=i.next.next;!np(o,s)&&kx(o,i,i.next,s)&&vC(o,s)&&vC(s,o)&&(e.push(o.i/t),e.push(i.i/t),e.push(s.i/t),ZC(i),ZC(i.next),i=n=s),i=i.next}while(i!==n);return _r(i)}function TL(n,e,t,i,o,s){let r=n;do{let g=r.next.next;for(;g!==r.prev;){if(r.i!==g.i&&jL(r,g)){let a=Tx(r,g);r=_r(r,r.next),a=_r(a,a.next),yC(r,e,t,i,o,s),yC(a,e,t,i,o,s);return}g=g.next}r=r.next}while(r!==n)}function EL(n,e,t,i){const o=[];let s,r,g,a,l;for(s=0,r=e.length;s<r;s++)g=e[s]*i,a=s<r-1?e[s+1]*i:n.length,l=zx(n,g,a,i,!1),l===l.next&&(l.steiner=!0),o.push(OL(l));for(o.sort(_L),s=0;s<o.length;s++)JL(o[s],t),t=_r(t,t.next);return t}function _L(n,e){return n.x-e.x}function JL(n,e){if(e=DL(n,e),e){const t=Tx(e,n);_r(e,e.next),_r(t,t.next)}}function DL(n,e){let t=e;const i=n.x,o=n.y;let s=-1/0,r;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const C=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(C<=i&&C>s){if(s=C,C===i){if(o===t.y)return t;if(o===t.next.y)return t.next}r=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!r)return null;if(i===s)return r;const g=r,a=r.x,l=r.y;let u=1/0,d;t=r;do i>=t.x&&t.x>=a&&i!==t.x&&ul(o<l?i:s,o,a,l,o<l?s:i,o,t.x,t.y)&&(d=Math.abs(o-t.y)/(i-t.x),vC(t,n)&&(d<u||d===u&&(t.x>r.x||t.x===r.x&&UL(r,t)))&&(r=t,u=d)),t=t.next;while(t!==g);return r}function UL(n,e){return An(n.prev,n,e.prev)<0&&An(e.next,n,n.next)<0}function PL(n,e,t,i){let o=n;do o.z===null&&(o.z=k0(o.x,o.y,e,t,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==n);o.prevZ.nextZ=null,o.prevZ=null,QL(o)}function QL(n){let e,t,i,o,s,r,g,a,l=1;do{for(t=n,n=null,s=null,r=0;t;){for(r++,i=t,g=0,e=0;e<l&&(g++,i=i.nextZ,!!i);e++);for(a=l;g>0||a>0&&i;)g!==0&&(a===0||!i||t.z<=i.z)?(o=t,t=t.nextZ,g--):(o=i,i=i.nextZ,a--),s?s.nextZ=o:n=o,o.prevZ=s,s=o;t=i}s.nextZ=null,l*=2}while(r>1);return n}function k0(n,e,t,i,o){return n=32767*(n-t)*o,e=32767*(e-i)*o,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function OL(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function ul(n,e,t,i,o,s,r,g){return(o-r)*(e-g)-(n-r)*(s-g)>=0&&(n-r)*(i-g)-(t-r)*(e-g)>=0&&(t-r)*(s-g)-(o-r)*(i-g)>=0}function jL(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!qL(n,e)&&(vC(n,e)&&vC(e,n)&&$L(n,e)&&(An(n.prev,n,e.prev)||An(n,e.prev,e))||np(n,e)&&An(n.prev,n,n.next)>0&&An(e.prev,e,e.next)>0)}function An(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function np(n,e){return n.x===e.x&&n.y===e.y}function kx(n,e,t,i){const o=jd(An(n,e,t)),s=jd(An(n,e,i)),r=jd(An(t,i,n)),g=jd(An(t,i,e));return!!(o!==s&&r!==g||o===0&&Od(n,t,e)||s===0&&Od(n,i,e)||r===0&&Od(t,n,i)||g===0&&Od(t,e,i))}function Od(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function jd(n){return n>0?1:n<0?-1:0}function qL(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&kx(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function vC(n,e){return An(n.prev,n,n.next)<0?An(n,e,n.next)>=0&&An(n,n.prev,e)>=0:An(n,e,n.prev)<0||An(n,n.next,e)<0}function $L(n,e){let t=n,i=!1;const o=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&o<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function Tx(n,e){const t=new T0(n.i,n.x,n.y),i=new T0(e.i,e.x,e.y),o=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=o,o.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function B2(n,e,t,i){const o=new T0(n,e,t);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function ZC(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function T0(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ez(n,e,t,i){let o=0;for(let s=e,r=t-i;s<t;s+=i)o+=(n[r]-n[s])*(n[s+1]+n[r+1]),r=s;return o}class is{static area(e){const t=e.length;let i=0;for(let o=t-1,s=0;s<t;o=s++)i+=e[o].x*e[s].y-e[s].x*e[o].y;return i*.5}static isClockWise(e){return is.area(e)<0}static triangulateShape(e,t){const i=[],o=[],s=[];y2(e),v2(i,e);let r=e.length;t.forEach(y2);for(let a=0;a<t.length;a++)o.push(r),r+=t[a].length,v2(i,t[a]);const g=NL.triangulate(i,o);for(let a=0;a<g.length;a+=3)s.push(g.slice(a,a+3));return s}}function y2(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function v2(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class gs extends at{constructor(e=new ns([new Se(.5,.5),new Se(-.5,.5),new Se(-.5,-.5),new Se(.5,-.5)]),t={}){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,o=[],s=[];for(let g=0,a=e.length;g<a;g++){const l=e[g];r(l)}this.setAttribute("position",new tt(o,3)),this.setAttribute("uv",new tt(s,2)),this.computeVertexNormals();function r(g){const a=[],l=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1;let d=t.depth!==void 0?t.depth:1,C=t.bevelEnabled!==void 0?t.bevelEnabled:!0,A=t.bevelThickness!==void 0?t.bevelThickness:.2,f=t.bevelSize!==void 0?t.bevelSize:A-.1,b=t.bevelOffset!==void 0?t.bevelOffset:0,G=t.bevelSegments!==void 0?t.bevelSegments:3;const m=t.extrudePath,h=t.UVGenerator!==void 0?t.UVGenerator:tz;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let B,y=!1,Z,R,W,x;m&&(B=m.getSpacedPoints(u),y=!0,C=!1,Z=m.computeFrenetFrames(u,!1),R=new K,W=new K,x=new K),C||(G=0,A=0,f=0,b=0);const X=g.extractPoints(l);let Y=X.shape;const S=X.holes;if(!is.isClockWise(Y)){Y=Y.reverse();for(let ie=0,de=S.length;ie<de;ie++){const Ge=S[ie];is.isClockWise(Ge)&&(S[ie]=Ge.reverse())}}const k=is.triangulateShape(Y,S),U=Y;for(let ie=0,de=S.length;ie<de;ie++){const Ge=S[ie];Y=Y.concat(Ge)}function D(ie,de,Ge){return de||console.error("THREE.ExtrudeGeometry: vec does not exist"),de.clone().multiplyScalar(Ge).add(ie)}const Q=Y.length,$=k.length;function j(ie,de,Ge){let Ve,xe,Pe;const Ue=ie.x-de.x,nt=ie.y-de.y,ct=Ge.x-ie.x,F=Ge.y-ie.y,M=Ue*Ue+nt*nt,me=Ue*F-nt*ct;if(Math.abs(me)>Number.EPSILON){const te=Math.sqrt(M),he=Math.sqrt(ct*ct+F*F),Re=de.x-nt/te,Fe=de.y+Ue/te,pe=Ge.x-F/he,$e=Ge.y+ct/he,ve=((pe-Re)*F-($e-Fe)*ct)/(Ue*F-nt*ct);Ve=Re+Ue*ve-ie.x,xe=Fe+nt*ve-ie.y;const Le=Ve*Ve+xe*xe;if(Le<=2)return new Se(Ve,xe);Pe=Math.sqrt(Le/2)}else{let te=!1;Ue>Number.EPSILON?ct>Number.EPSILON&&(te=!0):Ue<-Number.EPSILON?ct<-Number.EPSILON&&(te=!0):Math.sign(nt)===Math.sign(F)&&(te=!0),te?(Ve=-nt,xe=Ue,Pe=Math.sqrt(M)):(Ve=Ue,xe=nt,Pe=Math.sqrt(M/2))}return new Se(Ve/Pe,xe/Pe)}const oe=[];for(let ie=0,de=U.length,Ge=de-1,Ve=ie+1;ie<de;ie++,Ge++,Ve++)Ge===de&&(Ge=0),Ve===de&&(Ve=0),oe[ie]=j(U[ie],U[Ge],U[Ve]);const Ie=[];let T,P=oe.concat();for(let ie=0,de=S.length;ie<de;ie++){const Ge=S[ie];T=[];for(let Ve=0,xe=Ge.length,Pe=xe-1,Ue=Ve+1;Ve<xe;Ve++,Pe++,Ue++)Pe===xe&&(Pe=0),Ue===xe&&(Ue=0),T[Ve]=j(Ge[Ve],Ge[Pe],Ge[Ue]);Ie.push(T),P=P.concat(T)}for(let ie=0;ie<G;ie++){const de=ie/G,Ge=A*Math.cos(de*Math.PI/2),Ve=f*Math.sin(de*Math.PI/2)+b;for(let xe=0,Pe=U.length;xe<Pe;xe++){const Ue=D(U[xe],oe[xe],Ve);Ae(Ue.x,Ue.y,-Ge)}for(let xe=0,Pe=S.length;xe<Pe;xe++){const Ue=S[xe];T=Ie[xe];for(let nt=0,ct=Ue.length;nt<ct;nt++){const F=D(Ue[nt],T[nt],Ve);Ae(F.x,F.y,-Ge)}}}const Ce=f+b;for(let ie=0;ie<Q;ie++){const de=C?D(Y[ie],P[ie],Ce):Y[ie];y?(W.copy(Z.normals[0]).multiplyScalar(de.x),R.copy(Z.binormals[0]).multiplyScalar(de.y),x.copy(B[0]).add(W).add(R),Ae(x.x,x.y,x.z)):Ae(de.x,de.y,0)}for(let ie=1;ie<=u;ie++)for(let de=0;de<Q;de++){const Ge=C?D(Y[de],P[de],Ce):Y[de];y?(W.copy(Z.normals[ie]).multiplyScalar(Ge.x),R.copy(Z.binormals[ie]).multiplyScalar(Ge.y),x.copy(B[ie]).add(W).add(R),Ae(x.x,x.y,x.z)):Ae(Ge.x,Ge.y,d/u*ie)}for(let ie=G-1;ie>=0;ie--){const de=ie/G,Ge=A*Math.cos(de*Math.PI/2),Ve=f*Math.sin(de*Math.PI/2)+b;for(let xe=0,Pe=U.length;xe<Pe;xe++){const Ue=D(U[xe],oe[xe],Ve);Ae(Ue.x,Ue.y,d+Ge)}for(let xe=0,Pe=S.length;xe<Pe;xe++){const Ue=S[xe];T=Ie[xe];for(let nt=0,ct=Ue.length;nt<ct;nt++){const F=D(Ue[nt],T[nt],Ve);y?Ae(F.x,F.y+B[u-1].y,B[u-1].x+Ge):Ae(F.x,F.y,d+Ge)}}}Me(),ee();function Me(){const ie=o.length/3;if(C){let de=0,Ge=Q*de;for(let Ve=0;Ve<$;Ve++){const xe=k[Ve];ye(xe[2]+Ge,xe[1]+Ge,xe[0]+Ge)}de=u+G*2,Ge=Q*de;for(let Ve=0;Ve<$;Ve++){const xe=k[Ve];ye(xe[0]+Ge,xe[1]+Ge,xe[2]+Ge)}}else{for(let de=0;de<$;de++){const Ge=k[de];ye(Ge[2],Ge[1],Ge[0])}for(let de=0;de<$;de++){const Ge=k[de];ye(Ge[0]+Q*u,Ge[1]+Q*u,Ge[2]+Q*u)}}i.addGroup(ie,o.length/3-ie,0)}function ee(){const ie=o.length/3;let de=0;_(U,de),de+=U.length;for(let Ge=0,Ve=S.length;Ge<Ve;Ge++){const xe=S[Ge];_(xe,de),de+=xe.length}i.addGroup(ie,o.length/3-ie,1)}function _(ie,de){let Ge=ie.length;for(;--Ge>=0;){const Ve=Ge;let xe=Ge-1;xe<0&&(xe=ie.length-1);for(let Pe=0,Ue=u+G*2;Pe<Ue;Pe++){const nt=Q*Pe,ct=Q*(Pe+1),F=de+Ve+nt,M=de+xe+nt,me=de+xe+ct,te=de+Ve+ct;ge(F,M,me,te)}}}function Ae(ie,de,Ge){a.push(ie),a.push(de),a.push(Ge)}function ye(ie,de,Ge){we(ie),we(de),we(Ge);const Ve=o.length/3,xe=h.generateTopUV(i,o,Ve-3,Ve-2,Ve-1);Ke(xe[0]),Ke(xe[1]),Ke(xe[2])}function ge(ie,de,Ge,Ve){we(ie),we(de),we(Ve),we(de),we(Ge),we(Ve);const xe=o.length/3,Pe=h.generateSideWallUV(i,o,xe-6,xe-3,xe-2,xe-1);Ke(Pe[0]),Ke(Pe[1]),Ke(Pe[3]),Ke(Pe[1]),Ke(Pe[2]),Ke(Pe[3])}function we(ie){o.push(a[ie*3+0]),o.push(a[ie*3+1]),o.push(a[ie*3+2])}function Ke(ie){s.push(ie.x),s.push(ie.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return nz(t,i,e)}static fromJSON(e,t){const i=[];for(let s=0,r=e.shapes.length;s<r;s++){const g=t[e.shapes[s]];i.push(g)}const o=e.options.extrudePath;return o!==void 0&&(e.options.extrudePath=new wB[o.type]().fromJSON(o)),new gs(i,e.options)}}const tz={generateTopUV:function(n,e,t,i,o){const s=e[t*3],r=e[t*3+1],g=e[i*3],a=e[i*3+1],l=e[o*3],u=e[o*3+1];return[new Se(s,r),new Se(g,a),new Se(l,u)]},generateSideWallUV:function(n,e,t,i,o,s){const r=e[t*3],g=e[t*3+1],a=e[t*3+2],l=e[i*3],u=e[i*3+1],d=e[i*3+2],C=e[o*3],A=e[o*3+1],f=e[o*3+2],b=e[s*3],G=e[s*3+1],m=e[s*3+2];return Math.abs(g-u)<Math.abs(r-l)?[new Se(r,1-a),new Se(l,1-d),new Se(C,1-f),new Se(b,1-m)]:[new Se(g,1-a),new Se(u,1-d),new Se(A,1-f),new Se(G,1-m)]}};function nz(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,o=n.length;i<o;i++){const s=n[i];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class _l extends rs{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,o=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(o,s,e,t);this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _l(e.radius,e.detail)}}class Jl extends at{constructor(e=[new Se(0,.5),new Se(.5,0),new Se(0,-.5)],t=12,i=0,o=Math.PI*2){super();this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:o},t=Math.floor(t),o=ni(o,0,Math.PI*2);const s=[],r=[],g=[],a=[],l=[],u=1/t,d=new K,C=new Se,A=new K,f=new K,b=new K;let G=0,m=0;for(let h=0;h<=e.length-1;h++)switch(h){case 0:G=e[h+1].x-e[h].x,m=e[h+1].y-e[h].y,A.x=m*1,A.y=-G,A.z=m*0,b.copy(A),A.normalize(),a.push(A.x,A.y,A.z);break;case e.length-1:a.push(b.x,b.y,b.z);break;default:G=e[h+1].x-e[h].x,m=e[h+1].y-e[h].y,A.x=m*1,A.y=-G,A.z=m*0,f.copy(A),A.x+=b.x,A.y+=b.y,A.z+=b.z,A.normalize(),a.push(A.x,A.y,A.z),b.copy(f)}for(let h=0;h<=t;h++){const B=i+h*u*o,y=Math.sin(B),Z=Math.cos(B);for(let R=0;R<=e.length-1;R++){d.x=e[R].x*y,d.y=e[R].y,d.z=e[R].x*Z,r.push(d.x,d.y,d.z),C.x=h/t,C.y=R/(e.length-1),g.push(C.x,C.y);const W=a[3*R+0]*y,x=a[3*R+1],X=a[3*R+0]*Z;l.push(W,x,X)}}for(let h=0;h<t;h++)for(let B=0;B<e.length-1;B++){const y=B+h*e.length,Z=y,R=y+e.length,W=y+e.length+1,x=y+1;s.push(Z,R,x),s.push(W,x,R)}this.setIndex(s),this.setAttribute("position",new tt(r,3)),this.setAttribute("uv",new tt(g,2)),this.setAttribute("normal",new tt(l,3))}static fromJSON(e){return new Jl(e.points,e.segments,e.phiStart,e.phiLength)}}class $g extends rs{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,o,e,t);this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $g(e.radius,e.detail)}}class Dl extends at{constructor(e=.5,t=1,i=8,o=1,s=0,r=Math.PI*2){super();this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:o,thetaStart:s,thetaLength:r},i=Math.max(3,i),o=Math.max(1,o);const g=[],a=[],l=[],u=[];let d=e;const C=(t-e)/o,A=new K,f=new Se;for(let b=0;b<=o;b++){for(let G=0;G<=i;G++){const m=s+G/i*r;A.x=d*Math.cos(m),A.y=d*Math.sin(m),a.push(A.x,A.y,A.z),l.push(0,0,1),f.x=(A.x/t+1)/2,f.y=(A.y/t+1)/2,u.push(f.x,f.y)}d+=C}for(let b=0;b<o;b++){const G=b*(i+1);for(let m=0;m<i;m++){const h=m+G,B=h,y=h+i+1,Z=h+i+2,R=h+1;g.push(B,y,R),g.push(y,Z,R)}}this.setIndex(g),this.setAttribute("position",new tt(a,3)),this.setAttribute("normal",new tt(l,3)),this.setAttribute("uv",new tt(u,2))}static fromJSON(e){return new Dl(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ea extends at{constructor(e=new ns([new Se(0,.5),new Se(-.5,-.5),new Se(.5,-.5)]),t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],o=[],s=[],r=[];let g=0,a=0;if(Array.isArray(e)===!1)l(e);else for(let u=0;u<e.length;u++)l(e[u]),this.addGroup(g,a,u),g+=a,a=0;this.setIndex(i),this.setAttribute("position",new tt(o,3)),this.setAttribute("normal",new tt(s,3)),this.setAttribute("uv",new tt(r,2));function l(u){const d=o.length/3,C=u.extractPoints(t);let A=C.shape;const f=C.holes;is.isClockWise(A)===!1&&(A=A.reverse());for(let G=0,m=f.length;G<m;G++){const h=f[G];is.isClockWise(h)===!0&&(f[G]=h.reverse())}const b=is.triangulateShape(A,f);for(let G=0,m=f.length;G<m;G++){const h=f[G];A=A.concat(h)}for(let G=0,m=A.length;G<m;G++){const h=A[G];o.push(h.x,h.y,0),s.push(0,0,1),r.push(h.x,h.y)}for(let G=0,m=b.length;G<m;G++){const h=b[G],B=h[0]+d,y=h[1]+d,Z=h[2]+d;i.push(B,y,Z),a+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return iz(t,e)}static fromJSON(e,t){const i=[];for(let o=0,s=e.shapes.length;o<s;o++){const r=t[e.shapes[o]];i.push(r)}return new ea(i,e.curveSegments)}}function iz(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const o=n[t];e.shapes.push(o.uuid)}else e.shapes.push(n.uuid);return e}class ta extends at{constructor(e=1,t=32,i=16,o=0,s=Math.PI*2,r=0,g=Math.PI){super();this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:o,phiLength:s,thetaStart:r,thetaLength:g},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const a=Math.min(r+g,Math.PI);let l=0;const u=[],d=new K,C=new K,A=[],f=[],b=[],G=[];for(let m=0;m<=i;m++){const h=[],B=m/i;let y=0;m==0&&r==0?y=.5/t:m==i&&a==Math.PI&&(y=-.5/t);for(let Z=0;Z<=t;Z++){const R=Z/t;d.x=-e*Math.cos(o+R*s)*Math.sin(r+B*g),d.y=e*Math.cos(r+B*g),d.z=e*Math.sin(o+R*s)*Math.sin(r+B*g),f.push(d.x,d.y,d.z),C.copy(d).normalize(),b.push(C.x,C.y,C.z),G.push(R+y,1-B),h.push(l++)}u.push(h)}for(let m=0;m<i;m++)for(let h=0;h<t;h++){const B=u[m][h+1],y=u[m][h],Z=u[m+1][h],R=u[m+1][h+1];(m!==0||r>0)&&A.push(B,y,R),(m!==i-1||a<Math.PI)&&A.push(y,Z,R)}this.setIndex(A),this.setAttribute("position",new tt(f,3)),this.setAttribute("normal",new tt(b,3)),this.setAttribute("uv",new tt(G,2))}static fromJSON(e){return new ta(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ul extends rs{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],o=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,o,e,t);this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ul(e.radius,e.detail)}}class Pl extends at{constructor(e=1,t=.4,i=8,o=6,s=Math.PI*2){super();this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:o,arc:s},i=Math.floor(i),o=Math.floor(o);const r=[],g=[],a=[],l=[],u=new K,d=new K,C=new K;for(let A=0;A<=i;A++)for(let f=0;f<=o;f++){const b=f/o*s,G=A/i*Math.PI*2;d.x=(e+t*Math.cos(G))*Math.cos(b),d.y=(e+t*Math.cos(G))*Math.sin(b),d.z=t*Math.sin(G),g.push(d.x,d.y,d.z),u.x=e*Math.cos(b),u.y=e*Math.sin(b),C.subVectors(d,u).normalize(),a.push(C.x,C.y,C.z),l.push(f/o),l.push(A/i)}for(let A=1;A<=i;A++)for(let f=1;f<=o;f++){const b=(o+1)*A+f-1,G=(o+1)*(A-1)+f-1,m=(o+1)*(A-1)+f,h=(o+1)*A+f;r.push(b,G,h),r.push(G,m,h)}this.setIndex(r),this.setAttribute("position",new tt(g,3)),this.setAttribute("normal",new tt(a,3)),this.setAttribute("uv",new tt(l,2))}static fromJSON(e){return new Pl(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ql extends at{constructor(e=1,t=.4,i=64,o=8,s=2,r=3){super();this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:o,p:s,q:r},i=Math.floor(i),o=Math.floor(o);const g=[],a=[],l=[],u=[],d=new K,C=new K,A=new K,f=new K,b=new K,G=new K,m=new K;for(let B=0;B<=i;++B){const y=B/i*s*Math.PI*2;h(y,s,r,e,A),h(y+.01,s,r,e,f),G.subVectors(f,A),m.addVectors(f,A),b.crossVectors(G,m),m.crossVectors(b,G),b.normalize(),m.normalize();for(let Z=0;Z<=o;++Z){const R=Z/o*Math.PI*2,W=-t*Math.cos(R),x=t*Math.sin(R);d.x=A.x+(W*m.x+x*b.x),d.y=A.y+(W*m.y+x*b.y),d.z=A.z+(W*m.z+x*b.z),a.push(d.x,d.y,d.z),C.subVectors(d,A).normalize(),l.push(C.x,C.y,C.z),u.push(B/i),u.push(Z/o)}}for(let B=1;B<=i;B++)for(let y=1;y<=o;y++){const Z=(o+1)*(B-1)+(y-1),R=(o+1)*B+(y-1),W=(o+1)*B+y,x=(o+1)*(B-1)+y;g.push(Z,R,x),g.push(R,W,x)}this.setIndex(g),this.setAttribute("position",new tt(a,3)),this.setAttribute("normal",new tt(l,3)),this.setAttribute("uv",new tt(u,2));function h(B,y,Z,R,W){const x=Math.cos(B),X=Math.sin(B),Y=Z/y*B,S=Math.cos(Y);W.x=R*(2+S)*.5*x,W.y=R*(2+S)*X*.5,W.z=R*Math.sin(Y)*.5}}static fromJSON(e){return new Ql(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ol extends at{constructor(e=new ep(new K(-1,-1,0),new K(-1,1,0),new K(1,1,0)),t=64,i=1,o=8,s=!1){super();this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:o,closed:s};const r=e.computeFrenetFrames(t,s);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const g=new K,a=new K,l=new Se;let u=new K;const d=[],C=[],A=[],f=[];b(),this.setIndex(f),this.setAttribute("position",new tt(d,3)),this.setAttribute("normal",new tt(C,3)),this.setAttribute("uv",new tt(A,2));function b(){for(let B=0;B<t;B++)G(B);G(s===!1?t:0),h(),m()}function G(B){u=e.getPointAt(B/t,u);const y=r.normals[B],Z=r.binormals[B];for(let R=0;R<=o;R++){const W=R/o*Math.PI*2,x=Math.sin(W),X=-Math.cos(W);a.x=X*y.x+x*Z.x,a.y=X*y.y+x*Z.y,a.z=X*y.z+x*Z.z,a.normalize(),C.push(a.x,a.y,a.z),g.x=u.x+i*a.x,g.y=u.y+i*a.y,g.z=u.z+i*a.z,d.push(g.x,g.y,g.z)}}function m(){for(let B=1;B<=t;B++)for(let y=1;y<=o;y++){const Z=(o+1)*(B-1)+(y-1),R=(o+1)*B+(y-1),W=(o+1)*B+y,x=(o+1)*(B-1)+y;f.push(Z,R,x),f.push(R,W,x)}}function h(){for(let B=0;B<=t;B++)for(let y=0;y<=o;y++)l.x=B/t,l.y=y/o,A.push(l.x,l.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ol(new wB[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class RB extends at{constructor(e=null){super();if(this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,o=new K,s=new K;if(e.index!==null){const r=e.attributes.position,g=e.index;let a=e.groups;a.length===0&&(a=[{start:0,count:g.count,materialIndex:0}]);for(let l=0,u=a.length;l<u;++l){const d=a[l],C=d.start,A=d.count;for(let f=C,b=C+A;f<b;f+=3)for(let G=0;G<3;G++){const m=g.getX(f+G),h=g.getX(f+(G+1)%3);o.fromBufferAttribute(r,m),s.fromBufferAttribute(r,h),Z2(o,s,i)===!0&&(t.push(o.x,o.y,o.z),t.push(s.x,s.y,s.z))}}}else{const r=e.attributes.position;for(let g=0,a=r.count/3;g<a;g++)for(let l=0;l<3;l++){const u=3*g+l,d=3*g+(l+1)%3;o.fromBufferAttribute(r,u),s.fromBufferAttribute(r,d),Z2(o,s,i)===!0&&(t.push(o.x,o.y,o.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new tt(t,3))}}}function Z2(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,o=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(o)===!0?!1:(t.add(i),t.add(o),!0)}var w2=Object.freeze({__proto__:null,BoxGeometry:Ys,BoxBufferGeometry:Ys,CircleGeometry:kl,CircleBufferGeometry:kl,ConeGeometry:Tl,ConeBufferGeometry:Tl,CylinderGeometry:Er,CylinderBufferGeometry:Er,DodecahedronGeometry:El,DodecahedronBufferGeometry:El,EdgesGeometry:GB,ExtrudeGeometry:gs,ExtrudeBufferGeometry:gs,IcosahedronGeometry:_l,IcosahedronBufferGeometry:_l,LatheGeometry:Jl,LatheBufferGeometry:Jl,OctahedronGeometry:$g,OctahedronBufferGeometry:$g,PlaneGeometry:jg,PlaneBufferGeometry:jg,PolyhedronGeometry:rs,PolyhedronBufferGeometry:rs,RingGeometry:Dl,RingBufferGeometry:Dl,ShapeGeometry:ea,ShapeBufferGeometry:ea,SphereGeometry:ta,SphereBufferGeometry:ta,TetrahedronGeometry:Ul,TetrahedronBufferGeometry:Ul,TorusGeometry:Pl,TorusBufferGeometry:Pl,TorusKnotGeometry:Ql,TorusKnotBufferGeometry:Ql,TubeGeometry:Ol,TubeBufferGeometry:Ol,WireframeGeometry:RB});class WB extends cn{constructor(e){super();this.type="ShadowMaterial",this.color=new ze(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}WB.prototype.isShadowMaterial=!0;class SB extends uo{constructor(e){super(e);this.type="RawShaderMaterial"}}SB.prototype.isRawShaderMaterial=!0;class Ca extends cn{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ze(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pr,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Ca.prototype.isMeshStandardMaterial=!0;class _s extends Ca{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Se(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ni(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new ze(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ze(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ze(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}_s.prototype.isMeshPhysicalMaterial=!0;class VB extends cn{constructor(e){super();this.type="MeshPhongMaterial",this.color=new ze(16777215),this.specular=new ze(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pr,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=TC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}VB.prototype.isMeshPhongMaterial=!0;class xB extends cn{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ze(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pr,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}xB.prototype.isMeshToonMaterial=!0;class HB extends cn{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pr,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}HB.prototype.isMeshNormalMaterial=!0;class XB extends cn{constructor(e){super();this.type="MeshLambertMaterial",this.color=new ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=TC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}XB.prototype.isMeshLambertMaterial=!0;class MB extends cn{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ze(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pr,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}MB.prototype.isMeshMatcapMaterial=!0;class KB extends En{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}KB.prototype.isLineDashedMaterial=!0;const oz={ShadowMaterial:WB,SpriteMaterial:Qh,RawShaderMaterial:SB,ShaderMaterial:uo,PointsMaterial:$r,MeshPhysicalMaterial:_s,MeshStandardMaterial:Ca,MeshPhongMaterial:VB,MeshToonMaterial:xB,MeshNormalMaterial:HB,MeshLambertMaterial:XB,MeshDepthMaterial:Uh,MeshDistanceMaterial:Ph,MeshBasicMaterial:Ki,MeshMatcapMaterial:MB,LineDashedMaterial:KB,LineBasicMaterial:En,Material:cn};cn.fromType=function(n){return new oz[n]};const rn={arraySlice:function(n,e,t){return rn.isTypedArray(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){function e(o,s){return n[o]-n[s]}const t=n.length,i=new Array(t);for(let o=0;o!==t;++o)i[o]=o;return i.sort(e),i},sortedArray:function(n,e,t){const i=n.length,o=new n.constructor(i);for(let s=0,r=0;r!==i;++s){const g=t[s]*e;for(let a=0;a!==e;++a)o[r++]=n[g+a]}return o},flattenJSON:function(n,e,t,i){let o=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[o++];if(s===void 0)return;let r=s[i];if(r!==void 0)if(Array.isArray(r))do r=s[i],r!==void 0&&(e.push(s.time),t.push.apply(t,r)),s=n[o++];while(s!==void 0);else if(r.toArray!==void 0)do r=s[i],r!==void 0&&(e.push(s.time),r.toArray(t,t.length)),s=n[o++];while(s!==void 0);else do r=s[i],r!==void 0&&(e.push(s.time),t.push(r)),s=n[o++];while(s!==void 0)},subclip:function(n,e,t,i,o=30){const s=n.clone();s.name=e;const r=[];for(let a=0;a<s.tracks.length;++a){const l=s.tracks[a],u=l.getValueSize(),d=[],C=[];for(let A=0;A<l.times.length;++A){const f=l.times[A]*o;if(!(f<t||f>=i)){d.push(l.times[A]);for(let b=0;b<u;++b)C.push(l.values[A*u+b])}}d.length!==0&&(l.times=rn.convertArray(d,l.times.constructor),l.values=rn.convertArray(C,l.values.constructor),r.push(l))}s.tracks=r;let g=1/0;for(let a=0;a<s.tracks.length;++a)g>s.tracks[a].times[0]&&(g=s.tracks[a].times[0]);for(let a=0;a<s.tracks.length;++a)s.tracks[a].shift(-1*g);return s.resetDuration(),s},makeClipAdditive:function(n,e=0,t=n,i=30){i<=0&&(i=30);const o=t.tracks.length,s=e/i;for(let r=0;r<o;++r){const g=t.tracks[r],a=g.ValueTypeName;if(a==="bool"||a==="string")continue;const l=n.tracks.find(function(m){return m.name===g.name&&m.ValueTypeName===a});if(l===void 0)continue;let u=0;const d=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let C=0;const A=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(C=A/3);const f=g.times.length-1;let b;if(s<=g.times[0]){const m=u,h=d-u;b=rn.arraySlice(g.values,m,h)}else if(s>=g.times[f]){const m=f*d+u,h=m+d-u;b=rn.arraySlice(g.values,m,h)}else{const m=g.createInterpolant(),h=u,B=d-u;m.evaluate(s),b=rn.arraySlice(m.resultBuffer,h,B)}a==="quaternion"&&new xn().fromArray(b).normalize().conjugate().toArray(b);const G=l.times.length;for(let m=0;m<G;++m){const h=m*A+C;if(a==="quaternion")xn.multiplyQuaternionsFlat(l.values,h,b,0,l.values,h);else{const B=A-C*2;for(let y=0;y<B;++y)l.values[h+y]-=b[y]}}}return n.blendMode=dB,n}};class as{constructor(e,t,i,o){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=o!==void 0?o:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,o=t[i],s=t[i-1];e:{t:{let r;n:{i:if(!(e<o)){for(let g=i+2;;){if(o===void 0){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,s)}if(i===g)break;if(s=o,o=t[++i],e<o)break t}r=t.length;break n}if(!(e>=s)){const g=t[1];e<g&&(i=2,s=g);for(let a=i-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,o);if(i===a)break;if(o=s,s=t[--i-1],e>=s)break t}r=i,i=0;break n}break e}for(;i<r;){const g=i+r>>>1;e<t[g]?r=g:i=g+1}if(o=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,o);if(o===void 0)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,s,e)}this._cachedIndex=i,this.intervalChanged_(i,s,o)}return this.interpolate_(i,s,e,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o;for(let r=0;r!==o;++r)t[r]=i[s+r];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}as.prototype.beforeStart_=as.prototype.copySampleValue_;as.prototype.afterEnd_=as.prototype.copySampleValue_;class Ex extends as{constructor(e,t,i,o){super(e,t,i,o);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Hg,endingEnd:Hg}}intervalChanged_(e,t,i){const o=this.parameterPositions;let s=e-2,r=e+1,g=o[s],a=o[r];if(g===void 0)switch(this.getSettings_().endingStart){case Xg:s=e,g=2*t-i;break;case fC:s=o.length-2,g=t+o[s]-o[s+1];break;default:s=e,g=i}if(a===void 0)switch(this.getSettings_().endingEnd){case Xg:r=e,a=2*i-t;break;case fC:r=1,a=i+o[1]-o[0];break;default:r=e-1,a=t}const l=(i-t)*.5,u=this.valueSize;this._weightPrev=l/(t-g),this._weightNext=l/(a-i),this._offsetPrev=s*u,this._offsetNext=r*u}interpolate_(e,t,i,o){const s=this.resultBuffer,r=this.sampleValues,g=this.valueSize,a=e*g,l=a-g,u=this._offsetPrev,d=this._offsetNext,C=this._weightPrev,A=this._weightNext,f=(i-t)/(o-t),b=f*f,G=b*f,m=-C*G+2*C*b-C*f,h=(1+C)*G+(-1.5-2*C)*b+(-.5+C)*f+1,B=(-1-A)*G+(1.5+A)*b+.5*f,y=A*G-A*b;for(let Z=0;Z!==g;++Z)s[Z]=m*r[u+Z]+h*r[l+Z]+B*r[a+Z]+y*r[d+Z];return s}}class FB extends as{constructor(e,t,i,o){super(e,t,i,o)}interpolate_(e,t,i,o){const s=this.resultBuffer,r=this.sampleValues,g=this.valueSize,a=e*g,l=a-g,u=(i-t)/(o-t),d=1-u;for(let C=0;C!==g;++C)s[C]=r[l+C]*d+r[a+C]*u;return s}}class _x extends as{constructor(e,t,i,o){super(e,t,i,o)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ko{constructor(e,t,i,o){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=rn.convertArray(t,this.TimeBufferType),this.values=rn.convertArray(i,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:rn.convertArray(e.times,Array),values:rn.convertArray(e.values,Array)};const o=e.getInterpolation();o!==e.DefaultInterpolation&&(i.interpolation=o)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new _x(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new FB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Ex(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Nl:t=this.InterpolantFactoryMethodDiscrete;break;case Pg:t=this.InterpolantFactoryMethodLinear;break;case KA:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Nl;case this.InterpolantFactoryMethodLinear:return Pg;case this.InterpolantFactoryMethodSmooth:return KA}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,o=t.length;i!==o;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,o=t.length;i!==o;++i)t[i]*=e}return this}trim(e,t){const i=this.times,o=i.length;let s=0,r=o-1;for(;s!==o&&i[s]<e;)++s;for(;r!==-1&&i[r]>t;)--r;if(++r,s!==0||r!==o){s>=r&&(r=Math.max(r,1),s=r-1);const g=this.getValueSize();this.times=rn.arraySlice(i,s,r),this.values=rn.arraySlice(this.values,s*g,r*g)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,o=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let g=0;g!==s;g++){const a=i[g];if(typeof a=="number"&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,g,a),e=!1;break}if(r!==null&&r>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,g,a,r),e=!1;break}r=a}if(o!==void 0&&rn.isTypedArray(o))for(let g=0,a=o.length;g!==a;++g){const l=o[g];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,g,l),e=!1;break}}return e}optimize(){const e=rn.arraySlice(this.times),t=rn.arraySlice(this.values),i=this.getValueSize(),o=this.getInterpolation()===KA,s=e.length-1;let r=1;for(let g=1;g<s;++g){let a=!1;const l=e[g],u=e[g+1];if(l!==u&&(g!==1||l!==e[0]))if(o)a=!0;else{const d=g*i,C=d-i,A=d+i;for(let f=0;f!==i;++f){const b=t[d+f];if(b!==t[C+f]||b!==t[A+f]){a=!0;break}}}if(a){if(g!==r){e[r]=e[g];const d=g*i,C=r*i;for(let A=0;A!==i;++A)t[C+A]=t[d+A]}++r}}if(s>0){e[r]=e[s];for(let g=s*i,a=r*i,l=0;l!==i;++l)t[a+l]=t[g+l];++r}return r!==e.length?(this.times=rn.arraySlice(e,0,r),this.values=rn.arraySlice(t,0,r*i)):(this.times=e,this.values=t),this}clone(){const e=rn.arraySlice(this.times,0),t=rn.arraySlice(this.values,0),i=this.constructor,o=new i(this.name,e,t);return o.createInterpolant=this.createInterpolant,o}}Ko.prototype.TimeBufferType=Float32Array;Ko.prototype.ValueBufferType=Float32Array;Ko.prototype.DefaultInterpolation=Pg;class ua extends Ko{}ua.prototype.ValueTypeName="bool";ua.prototype.ValueBufferType=Array;ua.prototype.DefaultInterpolation=Nl;ua.prototype.InterpolantFactoryMethodLinear=void 0;ua.prototype.InterpolantFactoryMethodSmooth=void 0;class YB extends Ko{}YB.prototype.ValueTypeName="color";class jl extends Ko{}jl.prototype.ValueTypeName="number";class Jx extends as{constructor(e,t,i,o){super(e,t,i,o)}interpolate_(e,t,i,o){const s=this.resultBuffer,r=this.sampleValues,g=this.valueSize,a=(i-t)/(o-t);let l=e*g;for(let u=l+g;l!==u;l+=4)xn.slerpFlat(s,0,r,l-g,r,l,a);return s}}class Jr extends Ko{InterpolantFactoryMethodLinear(e){return new Jx(this.times,this.values,this.getValueSize(),e)}}Jr.prototype.ValueTypeName="quaternion";Jr.prototype.DefaultInterpolation=Pg;Jr.prototype.InterpolantFactoryMethodSmooth=void 0;class da extends Ko{}da.prototype.ValueTypeName="string";da.prototype.ValueBufferType=Array;da.prototype.DefaultInterpolation=Nl;da.prototype.InterpolantFactoryMethodLinear=void 0;da.prototype.InterpolantFactoryMethodSmooth=void 0;class ql extends Ko{}ql.prototype.ValueTypeName="vector";class $l{constructor(e,t=-1,i,o=kh){this.name=e,this.tracks=i,this.duration=t,this.blendMode=o,this.uuid=Pi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,o=1/(e.fps||1);for(let r=0,g=i.length;r!==g;++r)t.push(rz(i[r]).scale(o));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,o={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,r=i.length;s!==r;++s)t.push(Ko.toJSON(i[s]));return o}static CreateFromMorphTargetSequence(e,t,i,o){const s=t.length,r=[];for(let g=0;g<s;g++){let a=[],l=[];a.push((g+s-1)%s,g,(g+1)%s),l.push(0,1,0);const u=rn.getKeyframeOrder(a);a=rn.sortedArray(a,1,u),l=rn.sortedArray(l,1,u),!o&&a[0]===0&&(a.push(s),l.push(l[0])),r.push(new jl(".morphTargetInfluences["+t[g].name+"]",a,l).scale(1/i))}return new this(e,-1,r)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const o=e;i=o.geometry&&o.geometry.animations||o.animations}for(let o=0;o<i.length;o++)if(i[o].name===t)return i[o];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const o={},s=/^([\w-]*?)([\d]+)$/;for(let g=0,a=e.length;g<a;g++){const l=e[g],u=l.name.match(s);if(u&&u.length>1){const d=u[1];let C=o[d];C||(o[d]=C=[]),C.push(l)}}const r=[];for(const g in o)r.push(this.CreateFromMorphTargetSequence(g,o[g],t,i));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,C,A,f,b){if(A.length!==0){const G=[],m=[];rn.flattenJSON(A,G,m,f),G.length!==0&&b.push(new d(C,G,m))}},o=[],s=e.name||"default",r=e.fps||30,g=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let d=0;d<l.length;d++){const C=l[d].keys;if(!(!C||C.length===0))if(C[0].morphTargets){const A={};let f;for(f=0;f<C.length;f++)if(C[f].morphTargets)for(let b=0;b<C[f].morphTargets.length;b++)A[C[f].morphTargets[b]]=-1;for(const b in A){const G=[],m=[];for(let h=0;h!==C[f].morphTargets.length;++h){const B=C[f];G.push(B.time),m.push(B.morphTarget===b?1:0)}o.push(new jl(".morphTargetInfluence["+b+"]",G,m))}a=A.length*r}else{const A=".bones["+t[d].name+"]";i(ql,A+".position",C,"pos",o),i(Jr,A+".quaternion",C,"rot",o),i(ql,A+".scale",C,"scl",o)}}return o.length===0?null:new this(s,a,o,g)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,o=e.length;i!==o;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function sz(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return jl;case"vector":case"vector2":case"vector3":case"vector4":return ql;case"color":return YB;case"quaternion":return Jr;case"bool":case"boolean":return ua;case"string":return da}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function rz(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=sz(n.type);if(n.times===void 0){const t=[],i=[];rn.flattenJSON(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const na={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class NB{constructor(e,t,i){const o=this;let s=!1,r=0,g=0,a;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){g++,s===!1&&o.onStart!==void 0&&o.onStart(u,r,g),s=!0},this.itemEnd=function(u){r++,o.onProgress!==void 0&&o.onProgress(u,r,g),r===g&&(s=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(u){o.onError!==void 0&&o.onError(u)},this.resolveURL=function(u){return a?a(u):u},this.setURLModifier=function(u){return a=u,this},this.addHandler=function(u,d){return l.push(u,d),this},this.removeHandler=function(u){const d=l.indexOf(u);return d!==-1&&l.splice(d,2),this},this.getHandler=function(u){for(let d=0,C=l.length;d<C;d+=2){const A=l[d],f=l[d+1];if(A.global&&(A.lastIndex=0),A.test(u))return f}return null}}}const Dx=new NB;class oi{constructor(e){this.manager=e!==void 0?e:Dx,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(o,s){i.load(e,o,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const ws={};class Li extends oi{constructor(e){super(e)}load(e,t,i,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=na.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(ws[e]!==void 0){ws[e].push({onLoad:t,onProgress:i,onError:o});return}ws[e]=[],ws[e].push({onLoad:t,onProgress:i,onError:o});const r=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),g=this.mimeType,a=this.responseType;fetch(r).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||l.body===void 0||l.body.getReader===void 0)return l;const u=ws[e],d=l.body.getReader(),C=l.headers.get("Content-Length"),A=C?parseInt(C):0,f=A!==0;let b=0;const G=new ReadableStream({start(m){h();function h(){d.read().then(({done:B,value:y})=>{if(B)m.close();else{b+=y.byteLength;const Z=new ProgressEvent("progress",{lengthComputable:f,loaded:b,total:A});for(let R=0,W=u.length;R<W;R++){const x=u[R];x.onProgress&&x.onProgress(Z)}m.enqueue(y),h()}})}}});return new Response(G)}else throw Error(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`)}).then(l=>{switch(a){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,g));case"json":return l.json();default:if(g===void 0)return l.text();{const d=/charset="?([^;"\s]*)"?/i.exec(g),C=d&&d[1]?d[1].toLowerCase():void 0,A=new TextDecoder(C);return l.arrayBuffer().then(f=>A.decode(f))}}}).then(l=>{na.add(e,l);const u=ws[e];delete ws[e];for(let d=0,C=u.length;d<C;d++){const A=u[d];A.onLoad&&A.onLoad(l)}}).catch(l=>{const u=ws[e];if(u===void 0)throw this.manager.itemError(e),l;delete ws[e];for(let d=0,C=u.length;d<C;d++){const A=u[d];A.onError&&A.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class gz extends oi{constructor(e){super(e)}load(e,t,i,o){const s=this,r=new Li(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(g){try{t(s.parse(JSON.parse(g)))}catch(a){o?o(a):console.error(a),s.manager.itemError(e)}},i,o)}parse(e){const t=[];for(let i=0;i<e.length;i++){const o=$l.parse(e[i]);t.push(o)}return t}}class az extends oi{constructor(e){super(e)}load(e,t,i,o){const s=this,r=[],g=new bB,a=new Li(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(s.withCredentials);let l=0;function u(d){a.load(e[d],function(C){const A=s.parse(C,!0);r[d]={width:A.width,height:A.height,format:A.format,mipmaps:A.mipmaps},l+=1,l===6&&(A.mipmapCount===1&&(g.minFilter=gn),g.image=r,g.format=A.format,g.needsUpdate=!0,t&&t(g))},i,o)}if(Array.isArray(e))for(let d=0,C=e.length;d<C;++d)u(d);else a.load(e,function(d){const C=s.parse(d,!0);if(C.isCubemap){const A=C.mipmaps.length/C.mipmapCount;for(let f=0;f<A;f++){r[f]={mipmaps:[]};for(let b=0;b<C.mipmapCount;b++)r[f].mipmaps.push(C.mipmaps[f*C.mipmapCount+b]),r[f].format=C.format,r[f].width=C.width,r[f].height=C.height}g.image=r}else g.image.width=C.width,g.image.height=C.height,g.mipmaps=C.mipmaps;C.mipmapCount===1&&(g.minFilter=gn),g.format=C.format,g.needsUpdate=!0,t&&t(g)},i,o);return g}}class wC extends oi{constructor(e){super(e)}load(e,t,i,o){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=na.get(e);if(r!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(r),s.manager.itemEnd(e)},0),r;const g=GC("img");function a(){u(),na.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(d){u(),o&&o(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){g.removeEventListener("load",a,!1),g.removeEventListener("error",l,!1)}return g.addEventListener("load",a,!1),g.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(g.crossOrigin=this.crossOrigin),s.manager.itemStart(e),g.src=e,g}}class Ux extends oi{constructor(e){super(e)}load(e,t,i,o){const s=new dI,r=new wC(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let g=0;function a(l){r.load(e[l],function(u){s.images[l]=u,g++,g===6&&(s.needsUpdate=!0,t&&t(s))},void 0,o)}for(let l=0;l<e.length;++l)a(l);return s}}class Px extends oi{constructor(e){super(e)}load(e,t,i,o){const s=this,r=new Tg,g=new Li(this.manager);return g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setPath(this.path),g.setWithCredentials(s.withCredentials),g.load(e,function(a){const l=s.parse(a);!l||(l.image!==void 0?r.image=l.image:l.data!==void 0&&(r.image.width=l.width,r.image.height=l.height,r.image.data=l.data),r.wrapS=l.wrapS!==void 0?l.wrapS:ui,r.wrapT=l.wrapT!==void 0?l.wrapT:ui,r.magFilter=l.magFilter!==void 0?l.magFilter:gn,r.minFilter=l.minFilter!==void 0?l.minFilter:gn,r.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.encoding!==void 0&&(r.encoding=l.encoding),l.flipY!==void 0&&(r.flipY=l.flipY),l.format!==void 0&&(r.format=l.format),l.type!==void 0&&(r.type=l.type),l.mipmaps!==void 0&&(r.mipmaps=l.mipmaps,r.minFilter=ks),l.mipmapCount===1&&(r.minFilter=gn),l.generateMipmaps!==void 0&&(r.generateMipmaps=l.generateMipmaps),r.needsUpdate=!0,t&&t(r,l))},i,o),r}}class LB extends oi{constructor(e){super(e)}load(e,t,i,o){const s=new pn,r=new wC(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,function(g){s.image=g,s.needsUpdate=!0,t!==void 0&&t(s)},i,o),s}}class Mo extends Gt{constructor(e,t=1){super();this.type="Light",this.color=new ze(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}Mo.prototype.isLight=!0;class zB extends Mo{constructor(e,t,i){super(e,i);this.type="HemisphereLight",this.position.copy(Gt.DefaultUp),this.updateMatrix(),this.groundColor=new ze(t)}copy(e){return Mo.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}zB.prototype.isHemisphereLight=!0;const R2=new et,W2=new K,S2=new K;class kB{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Se(512,512),this.map=null,this.mapPass=null,this.matrix=new et,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new JC,this._frameExtents=new Se(1,1),this._viewportCount=1,this._viewports=[new zt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;W2.setFromMatrixPosition(e.matrixWorld),t.position.copy(W2),S2.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(S2),t.updateMatrixWorld(),R2.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(R2),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Qx extends kB{constructor(){super(new Kn(50,1,.5,500));this.focus=1}updateMatrices(e){const t=this.camera,i=bC*2*e.angle*this.focus,o=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||o!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=o,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Qx.prototype.isSpotLightShadow=!0;class ip extends Mo{constructor(e,t,i=0,o=Math.PI/3,s=0,r=1){super(e,t);this.type="SpotLight",this.position.copy(Gt.DefaultUp),this.updateMatrix(),this.target=new Gt,this.distance=i,this.angle=o,this.penumbra=s,this.decay=r,this.shadow=new Qx}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}ip.prototype.isSpotLight=!0;const V2=new et,lc=new K,qf=new K;class Ox extends kB{constructor(){super(new Kn(90,1,.5,500));this._frameExtents=new Se(4,2),this._viewportCount=6,this._viewports=[new zt(2,1,1,1),new zt(0,1,1,1),new zt(3,1,1,1),new zt(1,1,1,1),new zt(3,0,1,1),new zt(1,0,1,1)],this._cubeDirections=[new K(1,0,0),new K(-1,0,0),new K(0,0,1),new K(0,0,-1),new K(0,1,0),new K(0,-1,0)],this._cubeUps=[new K(0,1,0),new K(0,1,0),new K(0,1,0),new K(0,1,0),new K(0,0,1),new K(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,o=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),lc.setFromMatrixPosition(e.matrixWorld),i.position.copy(lc),qf.copy(i.position),qf.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(qf),i.updateMatrixWorld(),o.makeTranslation(-lc.x,-lc.y,-lc.z),V2.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(V2)}}Ox.prototype.isPointLightShadow=!0;class op extends Mo{constructor(e,t,i=0,o=1){super(e,t);this.type="PointLight",this.distance=i,this.decay=o,this.shadow=new Ox}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}op.prototype.isPointLight=!0;class jx extends kB{constructor(){super(new ca(-5,5,5,-5,.5,500))}}jx.prototype.isDirectionalLightShadow=!0;class sp extends Mo{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(Gt.DefaultUp),this.updateMatrix(),this.target=new Gt,this.shadow=new jx}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}sp.prototype.isDirectionalLight=!0;class TB extends Mo{constructor(e,t){super(e,t);this.type="AmbientLight"}}TB.prototype.isAmbientLight=!0;class EB extends Mo{constructor(e,t,i=10,o=10){super(e,t);this.type="RectAreaLight",this.width=i,this.height=o}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}EB.prototype.isRectAreaLight=!0;class _B{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new K)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,o=e.y,s=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*o),t.addScaledVector(r[2],.488603*s),t.addScaledVector(r[3],.488603*i),t.addScaledVector(r[4],1.092548*(i*o)),t.addScaledVector(r[5],1.092548*(o*s)),t.addScaledVector(r[6],.315392*(3*s*s-1)),t.addScaledVector(r[7],1.092548*(i*s)),t.addScaledVector(r[8],.546274*(i*i-o*o)),t}getIrradianceAt(e,t){const i=e.x,o=e.y,s=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],2*.511664*o),t.addScaledVector(r[2],2*.511664*s),t.addScaledVector(r[3],2*.511664*i),t.addScaledVector(r[4],2*.429043*i*o),t.addScaledVector(r[5],2*.429043*o*s),t.addScaledVector(r[6],.743125*s*s-.247708),t.addScaledVector(r[7],2*.429043*i*s),t.addScaledVector(r[8],.429043*(i*i-o*o)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let o=0;o<9;o++)i[o].fromArray(e,t+o*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let o=0;o<9;o++)i[o].toArray(e,t+o*3);return e}static getBasisAt(e,t){const i=e.x,o=e.y,s=e.z;t[0]=.282095,t[1]=.488603*o,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*o,t[5]=1.092548*o*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-o*o)}}_B.prototype.isSphericalHarmonics3=!0;class eu extends Mo{constructor(e=new _B,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}eu.prototype.isLightProbe=!0;class qx extends oi{constructor(e){super(e);this.textures={}}load(e,t,i,o){const s=this,r=new Li(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,function(g){try{t(s.parse(JSON.parse(g)))}catch(a){o?o(a):console.error(a),s.manager.itemError(e)}},i,o)}parse(e){const t=this.textures;function i(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const o=cn.fromType(e.type);if(e.uuid!==void 0&&(o.uuid=e.uuid),e.name!==void 0&&(o.name=e.name),e.color!==void 0&&o.color!==void 0&&o.color.setHex(e.color),e.roughness!==void 0&&(o.roughness=e.roughness),e.metalness!==void 0&&(o.metalness=e.metalness),e.sheen!==void 0&&(o.sheen=e.sheen),e.sheenColor!==void 0&&(o.sheenColor=new ze().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(o.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&o.emissive!==void 0&&o.emissive.setHex(e.emissive),e.specular!==void 0&&o.specular!==void 0&&o.specular.setHex(e.specular),e.specularIntensity!==void 0&&(o.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&o.specularColor!==void 0&&o.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(o.shininess=e.shininess),e.clearcoat!==void 0&&(o.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=e.clearcoatRoughness),e.transmission!==void 0&&(o.transmission=e.transmission),e.thickness!==void 0&&(o.thickness=e.thickness),e.attenuationDistance!==void 0&&(o.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&o.attenuationColor!==void 0&&o.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(o.fog=e.fog),e.flatShading!==void 0&&(o.flatShading=e.flatShading),e.blending!==void 0&&(o.blending=e.blending),e.combine!==void 0&&(o.combine=e.combine),e.side!==void 0&&(o.side=e.side),e.shadowSide!==void 0&&(o.shadowSide=e.shadowSide),e.opacity!==void 0&&(o.opacity=e.opacity),e.transparent!==void 0&&(o.transparent=e.transparent),e.alphaTest!==void 0&&(o.alphaTest=e.alphaTest),e.depthTest!==void 0&&(o.depthTest=e.depthTest),e.depthWrite!==void 0&&(o.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(o.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(o.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(o.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(o.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(o.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(o.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(o.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(o.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(o.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(o.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(o.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(o.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(o.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(o.rotation=e.rotation),e.linewidth!==1&&(o.linewidth=e.linewidth),e.dashSize!==void 0&&(o.dashSize=e.dashSize),e.gapSize!==void 0&&(o.gapSize=e.gapSize),e.scale!==void 0&&(o.scale=e.scale),e.polygonOffset!==void 0&&(o.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(o.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(o.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(o.dithering=e.dithering),e.alphaToCoverage!==void 0&&(o.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(o.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(o.visible=e.visible),e.toneMapped!==void 0&&(o.toneMapped=e.toneMapped),e.userData!==void 0&&(o.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?o.vertexColors=e.vertexColors>0:o.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const r=e.uniforms[s];switch(o.uniforms[s]={},r.type){case"t":o.uniforms[s].value=i(r.value);break;case"c":o.uniforms[s].value=new ze().setHex(r.value);break;case"v2":o.uniforms[s].value=new Se().fromArray(r.value);break;case"v3":o.uniforms[s].value=new K().fromArray(r.value);break;case"v4":o.uniforms[s].value=new zt().fromArray(r.value);break;case"m3":o.uniforms[s].value=new kn().fromArray(r.value);break;case"m4":o.uniforms[s].value=new et().fromArray(r.value);break;default:o.uniforms[s].value=r.value}}if(e.defines!==void 0&&(o.defines=e.defines),e.vertexShader!==void 0&&(o.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(o.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(const s in e.extensions)o.extensions[s]=e.extensions[s];if(e.shading!==void 0&&(o.flatShading=e.shading===1),e.size!==void 0&&(o.size=e.size),e.sizeAttenuation!==void 0&&(o.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(o.map=i(e.map)),e.matcap!==void 0&&(o.matcap=i(e.matcap)),e.alphaMap!==void 0&&(o.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(o.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(o.bumpScale=e.bumpScale),e.normalMap!==void 0&&(o.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(o.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),o.normalScale=new Se().fromArray(s)}return e.displacementMap!==void 0&&(o.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(o.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(o.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(o.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(o.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(o.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(o.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(o.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(o.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(o.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(o.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(o.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(o.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(o.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(o.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(o.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(o.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(o.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(o.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(o.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(o.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(o.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(o.clearcoatNormalScale=new Se().fromArray(e.clearcoatNormalScale)),e.transmissionMap!==void 0&&(o.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(o.thicknessMap=i(e.thicknessMap)),e.sheenColorMap!==void 0&&(o.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(o.sheenRoughnessMap=i(e.sheenRoughnessMap)),o}setTextures(e){return this.textures=e,this}}class Ho{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let i=0,o=e.length;i<o;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class JB extends at{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}JB.prototype.isInstancedBufferGeometry=!0;class $x extends oi{constructor(e){super(e)}load(e,t,i,o){const s=this,r=new Li(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,function(g){try{t(s.parse(JSON.parse(g)))}catch(a){o?o(a):console.error(a),s.manager.itemError(e)}},i,o)}parse(e){const t={},i={};function o(A,f){if(t[f]!==void 0)return t[f];const G=A.interleavedBuffers[f],m=s(A,G.buffer),h=Il(G.type,m),B=new qr(h,G.stride);return B.uuid=G.uuid,t[f]=B,B}function s(A,f){if(i[f]!==void 0)return i[f];const G=A.arrayBuffers[f],m=new Uint32Array(G).buffer;return i[f]=m,m}const r=e.isInstancedBufferGeometry?new JB:new at,g=e.data.index;if(g!==void 0){const A=Il(g.type,g.array);r.setIndex(new vt(A,1))}const a=e.data.attributes;for(const A in a){const f=a[A];let b;if(f.isInterleavedBufferAttribute){const G=o(e.data,f.data);b=new Ns(G,f.itemSize,f.offset,f.normalized)}else{const G=Il(f.type,f.array),m=f.isInstancedBufferAttribute?qg:vt;b=new m(G,f.itemSize,f.normalized)}f.name!==void 0&&(b.name=f.name),f.usage!==void 0&&b.setUsage(f.usage),f.updateRange!==void 0&&(b.updateRange.offset=f.updateRange.offset,b.updateRange.count=f.updateRange.count),r.setAttribute(A,b)}const l=e.data.morphAttributes;if(l)for(const A in l){const f=l[A],b=[];for(let G=0,m=f.length;G<m;G++){const h=f[G];let B;if(h.isInterleavedBufferAttribute){const y=o(e.data,h.data);B=new Ns(y,h.itemSize,h.offset,h.normalized)}else{const y=Il(h.type,h.array);B=new vt(y,h.itemSize,h.normalized)}h.name!==void 0&&(B.name=h.name),b.push(B)}r.morphAttributes[A]=b}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let A=0,f=d.length;A!==f;++A){const b=d[A];r.addGroup(b.start,b.count,b.materialIndex)}const C=e.data.boundingSphere;if(C!==void 0){const A=new K;C.center!==void 0&&A.fromArray(C.center),r.boundingSphere=new Ts(A,C.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class lz extends oi{constructor(e){super(e)}load(e,t,i,o){const s=this,r=this.path===""?Ho.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const g=new Li(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,function(a){let l=null;try{l=JSON.parse(a)}catch(d){o!==void 0&&o(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const u=l.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(l,t)},i,o)}async loadAsync(e,t){const i=this,o=this.path===""?Ho.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new Li(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const r=await s.loadAsync(e,t),g=JSON.parse(r),a=g.metadata;if(a===void 0||a.type===void 0||a.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(g)}parse(e,t){const i=this.parseAnimations(e.animations),o=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,o),r=this.parseImages(e.images,function(){t!==void 0&&t(l)}),g=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,g),l=this.parseObject(e.object,s,a,g,i),u=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,u),t!==void 0){let d=!1;for(const C in r)if(r[C]instanceof HTMLImageElement){d=!0;break}d===!1&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),r=this.parseTextures(e.textures,s),g=this.parseMaterials(e.materials,r),a=this.parseObject(e.object,o,g,r,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(e!==void 0)for(let i=0,o=e.length;i<o;i++){const s=new ns().fromJSON(e[i]);t[s.uuid]=s}return t}parseSkeletons(e,t){const i={},o={};if(t.traverse(function(s){s.isBone&&(o[s.uuid]=s)}),e!==void 0)for(let s=0,r=e.length;s<r;s++){const g=new jC().fromJSON(e[s],o);i[g.uuid]=g}return i}parseGeometries(e,t){const i={};if(e!==void 0){const o=new $x;for(let s=0,r=e.length;s<r;s++){let g;const a=e[s];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":g=o.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in w2?g=w2[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}g.uuid=a.uuid,a.name!==void 0&&(g.name=a.name),g.isBufferGeometry===!0&&a.userData!==void 0&&(g.userData=a.userData),i[a.uuid]=g}}return i}parseMaterials(e,t){const i={},o={};if(e!==void 0){const s=new qx;s.setTextures(t);for(let r=0,g=e.length;r<g;r++){const a=e[r];if(a.type==="MultiMaterial"){const l=[];for(let u=0;u<a.materials.length;u++){const d=a.materials[u];i[d.uuid]===void 0&&(i[d.uuid]=s.parse(d)),l.push(i[d.uuid])}o[a.uuid]=l}else i[a.uuid]===void 0&&(i[a.uuid]=s.parse(a)),o[a.uuid]=i[a.uuid]}}return o}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const o=e[i],s=$l.parse(o);t[s.uuid]=s}return t}parseImages(e,t){const i=this,o={};let s;function r(a){return i.manager.itemStart(a),s.load(a,function(){i.manager.itemEnd(a)},void 0,function(){i.manager.itemError(a),i.manager.itemEnd(a)})}function g(a){if(typeof a=="string"){const l=a,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:i.resourcePath+l;return r(u)}else return a.data?{data:Il(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){const a=new NB(t);s=new wC(a),s.setCrossOrigin(this.crossOrigin);for(let l=0,u=e.length;l<u;l++){const d=e[l],C=d.url;if(Array.isArray(C)){const A=[];for(let f=0,b=C.length;f<b;f++){const G=C[f],m=g(G);m!==null&&(m instanceof HTMLImageElement?A.push(m):A.push(new Tg(m.data,m.width,m.height)))}o[d.uuid]=new cl(A)}else{const A=g(d.url);o[d.uuid]=new cl(A)}}}return o}async parseImagesAsync(e){const t=this,i={};let o;async function s(r){if(typeof r=="string"){const g=r,a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(g)?g:t.resourcePath+g;return await o.loadAsync(a)}else return r.data?{data:Il(r.type,r.data),width:r.width,height:r.height}:null}if(e!==void 0&&e.length>0){o=new wC(this.manager),o.setCrossOrigin(this.crossOrigin);for(let r=0,g=e.length;r<g;r++){const a=e[r],l=a.url;if(Array.isArray(l)){const u=[];for(let d=0,C=l.length;d<C;d++){const A=l[d],f=await s(A);f!==null&&(f instanceof HTMLImageElement?u.push(f):u.push(new Tg(f.data,f.width,f.height)))}i[a.uuid]=new cl(u)}else{const u=await s(a.url);i[a.uuid]=new cl(u)}}}return i}parseTextures(e,t){function i(s,r){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),r[s])}const o={};if(e!==void 0)for(let s=0,r=e.length;s<r;s++){const g=e[s];g.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid),t[g.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",g.image);const a=t[g.image],l=a.data;let u;Array.isArray(l)?(u=new dI,l.length===6&&(u.needsUpdate=!0)):(l&&l.data?u=new Tg:u=new pn,l&&(u.needsUpdate=!0)),u.source=a,u.uuid=g.uuid,g.name!==void 0&&(u.name=g.name),g.mapping!==void 0&&(u.mapping=i(g.mapping,Iz)),g.offset!==void 0&&u.offset.fromArray(g.offset),g.repeat!==void 0&&u.repeat.fromArray(g.repeat),g.center!==void 0&&u.center.fromArray(g.center),g.rotation!==void 0&&(u.rotation=g.rotation),g.wrap!==void 0&&(u.wrapS=i(g.wrap[0],x2),u.wrapT=i(g.wrap[1],x2)),g.format!==void 0&&(u.format=g.format),g.type!==void 0&&(u.type=g.type),g.encoding!==void 0&&(u.encoding=g.encoding),g.minFilter!==void 0&&(u.minFilter=i(g.minFilter,H2)),g.magFilter!==void 0&&(u.magFilter=i(g.magFilter,H2)),g.anisotropy!==void 0&&(u.anisotropy=g.anisotropy),g.flipY!==void 0&&(u.flipY=g.flipY),g.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=g.premultiplyAlpha),g.unpackAlignment!==void 0&&(u.unpackAlignment=g.unpackAlignment),g.userData!==void 0&&(u.userData=g.userData),o[g.uuid]=u}return o}parseObject(e,t,i,o,s){let r;function g(C){return t[C]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",C),t[C]}function a(C){if(C!==void 0){if(Array.isArray(C)){const A=[];for(let f=0,b=C.length;f<b;f++){const G=C[f];i[G]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",G),A.push(i[G])}return A}return i[C]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",C),i[C]}}function l(C){return o[C]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",C),o[C]}let u,d;switch(e.type){case"Scene":r=new PC,e.background!==void 0&&(Number.isInteger(e.background)?r.background=new ze(e.background):r.background=l(e.background)),e.environment!==void 0&&(r.environment=l(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?r.fog=new UC(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(r.fog=new DC(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new Kn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(r.focus=e.focus),e.zoom!==void 0&&(r.zoom=e.zoom),e.filmGauge!==void 0&&(r.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(r.filmOffset=e.filmOffset),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new ca(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(r.zoom=e.zoom),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new TB(e.color,e.intensity);break;case"DirectionalLight":r=new sp(e.color,e.intensity);break;case"PointLight":r=new op(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new EB(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new ip(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new zB(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=new eu().fromJSON(e);break;case"SkinnedMesh":u=g(e.geometry),d=a(e.material),r=new QC(u,d),e.bindMode!==void 0&&(r.bindMode=e.bindMode),e.bindMatrix!==void 0&&r.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(r.skeleton=e.skeleton);break;case"Mesh":u=g(e.geometry),d=a(e.material),r=new Sn(u,d);break;case"InstancedMesh":u=g(e.geometry),d=a(e.material);const C=e.count,A=e.instanceMatrix,f=e.instanceColor;r=new Eg(u,d,C),r.instanceMatrix=new qg(new Float32Array(A.array),16),f!==void 0&&(r.instanceColor=new qg(new Float32Array(f.array),f.itemSize));break;case"LOD":r=new Mx;break;case"Line":r=new ss(g(e.geometry),a(e.material));break;case"LineLoop":r=new jh(g(e.geometry),a(e.material));break;case"LineSegments":r=new yi(g(e.geometry),a(e.material));break;case"PointCloud":case"Points":r=new hI(g(e.geometry),a(e.material));break;case"Sprite":r=new Oh(a(e.material));break;case"Group":r=new qo;break;case"Bone":r=new OC;break;default:r=new Gt}if(r.uuid=e.uuid,e.name!==void 0&&(r.name=e.name),e.matrix!==void 0?(r.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(e.position!==void 0&&r.position.fromArray(e.position),e.rotation!==void 0&&r.rotation.fromArray(e.rotation),e.quaternion!==void 0&&r.quaternion.fromArray(e.quaternion),e.scale!==void 0&&r.scale.fromArray(e.scale)),e.castShadow!==void 0&&(r.castShadow=e.castShadow),e.receiveShadow!==void 0&&(r.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(r.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(r.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(r.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(r.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(r.visible=e.visible),e.frustumCulled!==void 0&&(r.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(r.renderOrder=e.renderOrder),e.userData!==void 0&&(r.userData=e.userData),e.layers!==void 0&&(r.layers.mask=e.layers),e.children!==void 0){const C=e.children;for(let A=0;A<C.length;A++)r.add(this.parseObject(C[A],t,i,o,s))}if(e.animations!==void 0){const C=e.animations;for(let A=0;A<C.length;A++){const f=C[A];r.animations.push(s[f])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(r.autoUpdate=e.autoUpdate);const C=e.levels;for(let A=0;A<C.length;A++){const f=C[A],b=r.getObjectByProperty("uuid",f.object);b!==void 0&&r.addLevel(b,f.distance)}}return r}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const o=t[i.skeleton];o===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(o,i.bindMatrix)}})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const Iz={UVMapping:Lh,CubeReflectionMapping:Lr,CubeRefractionMapping:zr,EquirectangularReflectionMapping:AC,EquirectangularRefractionMapping:hC,CubeUVReflectionMapping:CI,CubeUVRefractionMapping:EC},x2={RepeatWrapping:kr,ClampToEdgeWrapping:ui,MirroredRepeatWrapping:Fl},H2={NearestFilter:Rn,NearestMipmapNearestFilter:pC,NearestMipmapLinearFilter:mC,LinearFilter:gn,LinearMipmapNearestFilter:zh,LinearMipmapLinearFilter:ks};class DB extends oi{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=na.get(e);if(r!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(r),s.manager.itemEnd(e)},0),r;const g={};g.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",g.headers=this.requestHeader,fetch(e,g).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(a){na.add(e,a),t&&t(a),s.manager.itemEnd(e)}).catch(function(a){o&&o(a),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}DB.prototype.isImageBitmapLoader=!0;let qd;const UB={getContext:function(){return qd===void 0&&(qd=new(window.AudioContext||window.webkitAudioContext)),qd},setContext:function(n){qd=n}};class eH extends oi{constructor(e){super(e)}load(e,t,i,o){const s=this,r=new Li(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(g){try{const a=g.slice(0);UB.getContext().decodeAudioData(a,function(u){t(u)})}catch(a){o?o(a):console.error(a),s.manager.itemError(e)}},i,o)}}class tH extends eu{constructor(e,t,i=1){super(void 0,i);const o=new ze().set(e),s=new ze().set(t),r=new K(o.r,o.g,o.b),g=new K(s.r,s.g,s.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(g).multiplyScalar(a),this.sh.coefficients[1].copy(r).sub(g).multiplyScalar(l)}}tH.prototype.isHemisphereLightProbe=!0;class nH extends eu{constructor(e,t=1){super(void 0,t);const i=new ze().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}nH.prototype.isAmbientLightProbe=!0;const X2=new et,M2=new et,dg=new et;class cz{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Kn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Kn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,dg.copy(e.projectionMatrix);const o=t.eyeSep/2,s=o*t.near/t.focus,r=t.near*Math.tan(zg*t.fov*.5)/t.zoom;let g,a;M2.elements[12]=-o,X2.elements[12]=o,g=-r*t.aspect+s,a=r*t.aspect+s,dg.elements[0]=2*t.near/(a-g),dg.elements[8]=(a+g)/(a-g),this.cameraL.projectionMatrix.copy(dg),g=-r*t.aspect-s,a=r*t.aspect-s,dg.elements[0]=2*t.near/(a-g),dg.elements[8]=(a+g)/(a-g),this.cameraR.projectionMatrix.copy(dg)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(M2),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(X2)}}class PB{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=K2(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=K2();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function K2(){return(typeof performance=="undefined"?Date:performance).now()}const Ag=new K,F2=new xn,Cz=new K,hg=new K;class uz extends Gt{constructor(){super();this.type="AudioListener",this.context=UB.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new PB}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ag,F2,Cz),hg.set(0,0,-1).applyQuaternion(F2),t.positionX){const o=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Ag.x,o),t.positionY.linearRampToValueAtTime(Ag.y,o),t.positionZ.linearRampToValueAtTime(Ag.z,o),t.forwardX.linearRampToValueAtTime(hg.x,o),t.forwardY.linearRampToValueAtTime(hg.y,o),t.forwardZ.linearRampToValueAtTime(hg.z,o),t.upX.linearRampToValueAtTime(i.x,o),t.upY.linearRampToValueAtTime(i.y,o),t.upZ.linearRampToValueAtTime(i.z,o)}else t.setPosition(Ag.x,Ag.y,Ag.z),t.setOrientation(hg.x,hg.y,hg.z,i.x,i.y,i.z)}}class QB extends Gt{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const pg=new K,Y2=new xn,dz=new K,mg=new K;class Az extends QB{constructor(e){super(e);this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(pg,Y2,dz),mg.set(0,0,1).applyQuaternion(Y2);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(pg.x,i),t.positionY.linearRampToValueAtTime(pg.y,i),t.positionZ.linearRampToValueAtTime(pg.z,i),t.orientationX.linearRampToValueAtTime(mg.x,i),t.orientationY.linearRampToValueAtTime(mg.y,i),t.orientationZ.linearRampToValueAtTime(mg.z,i)}else t.setPosition(pg.x,pg.y,pg.z),t.setOrientation(mg.x,mg.y,mg.z)}}class iH{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class oH{constructor(e,t,i){this.binding=e,this.valueSize=i;let o,s,r;switch(t){case"quaternion":o=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":o=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:o=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=o,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,o=this.valueSize,s=e*o+o;let r=this.cumulativeWeight;if(r===0){for(let g=0;g!==o;++g)i[s+g]=i[g];r=t}else{r+=t;const g=t/r;this._mixBufferRegion(i,s,0,g,o)}this.cumulativeWeight=r}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,o=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,o,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,o=e*t+t,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,g=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const a=t*this._origIndex;this._mixBufferRegion(i,o,a,1-s,t)}r>0&&this._mixBufferRegionAdditive(i,o,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(i[a]!==i[a+t]){g.setValue(i,o);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,o=i*this._origIndex;e.getValue(t,o);for(let s=i,r=o;s!==r;++s)t[s]=t[o+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,o,s){if(o>=.5)for(let r=0;r!==s;++r)e[t+r]=e[i+r]}_slerp(e,t,i,o){xn.slerpFlat(e,t,e,t,e,i,o)}_slerpAdditive(e,t,i,o,s){const r=this._workIndex*s;xn.multiplyQuaternionsFlat(e,r,e,t,e,i),xn.slerpFlat(e,t,e,t,e,r,o)}_lerp(e,t,i,o,s){const r=1-o;for(let g=0;g!==s;++g){const a=t+g;e[a]=e[a]*r+e[i+g]*o}}_lerpAdditive(e,t,i,o,s){for(let r=0;r!==s;++r){const g=t+r;e[g]=e[g]+e[i+r]*o}}}const OB="\\[\\]\\.:\\/",hz=new RegExp("["+OB+"]","g"),jB="[^"+OB+"]",pz="[^"+OB.replace("\\.","")+"]",mz=/((?:WC+[\/:])*)/.source.replace("WC",jB),fz=/(WCOD+)?/.source.replace("WCOD",pz),bz=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",jB),Gz=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",jB),Bz=new RegExp("^"+mz+fz+bz+Gz+"$"),yz=["material","materials","bones"];class vz{constructor(e,t,i){const o=i||Vt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,o)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,o=this._bindings[i];o!==void 0&&o.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let o=this._targetGroup.nCachedObjects_,s=i.length;o!==s;++o)i[o].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Vt{constructor(e,t,i){this.path=t,this.parsedPath=i||Vt.parseTrackName(t),this.node=Vt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Vt.Composite(e,t,i):new Vt(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(hz,"")}static parseTrackName(e){const t=Bz.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},o=i.nodeName&&i.nodeName.lastIndexOf(".");if(o!==void 0&&o!==-1){const s=i.nodeName.substring(o+1);yz.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,o),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let r=0;r<s.length;r++){const g=s[r];if(g.name===t||g.uuid===t)return g;const a=i(g.children);if(a)return a}return null},o=i(e.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let o=0,s=i.length;o!==s;++o)e[t++]=i[o]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let o=0,s=i.length;o!==s;++o)i[o]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let o=0,s=i.length;o!==s;++o)i[o]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let o=0,s=i.length;o!==s;++o)i[o]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,o=t.propertyName;let s=t.propertyIndex;if(e||(e=Vt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===l){l=u;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}const r=e[o];if(r===void 0){const l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+o+" but it wasn't found.",e);return}let g=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?g=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(g=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(s!==void 0){if(o==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else r.fromArray!==void 0&&r.toArray!==void 0?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=o;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][g]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Vt.Composite=vz;Vt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Vt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Vt.prototype.GetterByBindingType=[Vt.prototype._getValue_direct,Vt.prototype._getValue_array,Vt.prototype._getValue_arrayElement,Vt.prototype._getValue_toArray];Vt.prototype.SetterByBindingTypeAndVersioning=[[Vt.prototype._setValue_direct,Vt.prototype._setValue_direct_setNeedsUpdate,Vt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_array,Vt.prototype._setValue_array_setNeedsUpdate,Vt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_arrayElement,Vt.prototype._setValue_arrayElement_setNeedsUpdate,Vt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_fromArray,Vt.prototype._setValue_fromArray_setNeedsUpdate,Vt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class sH{constructor(){this.uuid=Pi(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,o=arguments.length;i!==o;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,o=this._parsedPaths,s=this._bindings,r=s.length;let g,a=e.length,l=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){const C=arguments[u],A=C.uuid;let f=t[A];if(f===void 0){f=a++,t[A]=f,e.push(C);for(let b=0,G=r;b!==G;++b)s[b].push(new Vt(C,i[b],o[b]))}else if(f<l){g=e[f];const b=--l,G=e[b];t[G.uuid]=f,e[f]=G,t[A]=b,e[b]=C;for(let m=0,h=r;m!==h;++m){const B=s[m],y=B[b];let Z=B[f];B[f]=y,Z===void 0&&(Z=new Vt(C,i[m],o[m])),B[b]=Z}}else e[f]!==g&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,o=i.length;let s=this.nCachedObjects_;for(let r=0,g=arguments.length;r!==g;++r){const a=arguments[r],l=a.uuid,u=t[l];if(u!==void 0&&u>=s){const d=s++,C=e[d];t[C.uuid]=u,e[u]=C,t[l]=d,e[d]=a;for(let A=0,f=o;A!==f;++A){const b=i[A],G=b[d],m=b[u];b[u]=G,b[d]=m}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,o=i.length;let s=this.nCachedObjects_,r=e.length;for(let g=0,a=arguments.length;g!==a;++g){const l=arguments[g],u=l.uuid,d=t[u];if(d!==void 0)if(delete t[u],d<s){const C=--s,A=e[C],f=--r,b=e[f];t[A.uuid]=d,e[d]=A,t[b.uuid]=C,e[C]=b,e.pop();for(let G=0,m=o;G!==m;++G){const h=i[G],B=h[C],y=h[f];h[d]=B,h[C]=y,h.pop()}}else{const C=--r,A=e[C];C>0&&(t[A.uuid]=d),e[d]=A,e.pop();for(let f=0,b=o;f!==b;++f){const G=i[f];G[d]=G[C],G.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let o=i[e];const s=this._bindings;if(o!==void 0)return s[o];const r=this._paths,g=this._parsedPaths,a=this._objects,l=a.length,u=this.nCachedObjects_,d=new Array(l);o=s.length,i[e]=o,r.push(e),g.push(t),s.push(d);for(let C=u,A=a.length;C!==A;++C){const f=a[C];d[C]=new Vt(f,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const o=this._paths,s=this._parsedPaths,r=this._bindings,g=r.length-1,a=r[g],l=e[g];t[l]=i,r[i]=a,r.pop(),s[i]=s[g],s.pop(),o[i]=o[g],o.pop()}}}sH.prototype.isAnimationObjectGroup=!0;class Zz{constructor(e,t,i=null,o=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=o;const s=t.tracks,r=s.length,g=new Array(r),a={endingStart:Hg,endingEnd:Hg};for(let l=0;l!==r;++l){const u=s[l].createInterpolant(null);g[l]=u,u.settings=a}this._interpolantSettings=a,this._interpolants=g,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ex,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const o=this._clip.duration,s=e._clip.duration,r=s/o,g=o/s;e.warp(1,r,t),this.warp(g,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const o=this._mixer,s=o.time,r=this.timeScale;let g=this._timeScaleInterpolant;g===null&&(g=o._lendControlInterpolant(),this._timeScaleInterpolant=g);const a=g.parameterPositions,l=g.sampleValues;return a[0]=s,a[1]=s+i,l[0]=e/r,l[1]=t/r,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,o){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const a=(e-s)*i;if(a<0||i===0)return;this._startTime=null,t=i*a}t*=this._updateTimeScale(e);const r=this._updateTime(t),g=this._updateWeight(e);if(g>0){const a=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case dB:for(let u=0,d=a.length;u!==d;++u)a[u].evaluate(r),l[u].accumulateAdditive(g);break;case kh:default:for(let u=0,d=a.length;u!==d;++u)a[u].evaluate(r),l[u].accumulate(o,g)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const o=i.evaluate(e)[0];t*=o,e>i.parameterPositions[1]&&(this.stopFading(),o===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;i!==null&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let o=this.time+e,s=this._loopCount;const r=i===tx;if(e===0)return s===-1?o:r&&(s&1)===1?t-o:o;if(i===$V){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(o>=t)o=t;else if(o<0)o=0;else{this.time=o;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,r)):this._setEndings(this.repetitions===0,!0,r)),o>=t||o<0){const g=Math.floor(o/t);o-=t*g,s+=Math.abs(g);const a=this.repetitions-s;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o=e>0?t:0,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(a===1){const l=e<0;this._setEndings(l,!l,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:g})}}else this.time=o;if(r&&(s&1)===1)return t-o}return o}_setEndings(e,t,i){const o=this._interpolantSettings;i?(o.endingStart=Xg,o.endingEnd=Xg):(e?o.endingStart=this.zeroSlopeAtStart?Xg:Hg:o.endingStart=fC,t?o.endingEnd=this.zeroSlopeAtEnd?Xg:Hg:o.endingEnd=fC)}_scheduleFading(e,t,i){const o=this._mixer,s=o.time;let r=this._weightInterpolant;r===null&&(r=o._lendControlInterpolant(),this._weightInterpolant=r);const g=r.parameterPositions,a=r.sampleValues;return g[0]=s,a[0]=t,g[1]=s+e,a[1]=i,this}}class rH extends Qr{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,o=e._clip.tracks,s=o.length,r=e._propertyBindings,g=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let u=l[a];u===void 0&&(u={},l[a]=u);for(let d=0;d!==s;++d){const C=o[d],A=C.name;let f=u[A];if(f!==void 0)++f.referenceCount,r[d]=f;else{if(f=r[d],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,a,A));continue}const b=t&&t._propertyBindings[d].binding.parsedPath;f=new oH(Vt.create(i,A,b),C.ValueTypeName,C.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,a,A),r[d]=f}g[d].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,o=e._clip.uuid,s=this._actionsByClip[o];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,o,i)}const t=e._propertyBindings;for(let i=0,o=t.length;i!==o;++i){const s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,o=t.length;i!==o;++i){const s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const o=this._actions,s=this._actionsByClip;let r=s[t];if(r===void 0)r={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=r;else{const g=r.knownActions;e._byClipCacheIndex=g.length,g.push(e)}e._cacheIndex=o.length,o.push(e),r.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],o=e._cacheIndex;i._cacheIndex=o,t[o]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,r=this._actionsByClip,g=r[s],a=g.knownActions,l=a[a.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,a[u]=l,a.pop(),e._byClipCacheIndex=null;const d=g.actionByRoot,C=(e._localRoot||this._root).uuid;delete d[C],a.length===0&&delete r[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,o=t.length;i!==o;++i){const s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,o=this._nActiveActions++,s=t[o];e._cacheIndex=o,t[o]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,o=--this._nActiveActions,s=t[o];e._cacheIndex=o,t[o]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const o=this._bindingsByRootAndName,s=this._bindings;let r=o[t];r===void 0&&(r={},o[t]=r),r[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,o=i.rootNode.uuid,s=i.path,r=this._bindingsByRootAndName,g=r[o],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete g[s],Object.keys(g).length===0&&delete r[o]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,o=this._nActiveBindings++,s=t[o];e._cacheIndex=o,t[o]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,o=--this._nActiveBindings,s=t[o];e._cacheIndex=o,t[o]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new FB(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,o=--this._nActiveControlInterpolants,s=t[o];e.__cacheIndex=o,t[o]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const o=t||this._root,s=o.uuid;let r=typeof e=="string"?$l.findByName(o,e):e;const g=r!==null?r.uuid:e,a=this._actionsByClip[g];let l=null;if(i===void 0&&(r!==null?i=r.blendMode:i=kh),a!==void 0){const d=a.actionByRoot[s];if(d!==void 0&&d.blendMode===i)return d;l=a.knownActions[0],r===null&&(r=l._clip)}if(r===null)return null;const u=new Zz(this,r,t,i);return this._bindAction(u,l),this._addInactiveAction(u,g,s),u}existingAction(e,t){const i=t||this._root,o=i.uuid,s=typeof e=="string"?$l.findByName(i,e):e,r=s?s.uuid:e,g=this._actionsByClip[r];return g!==void 0&&g.actionByRoot[o]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,o=this.time+=e,s=Math.sign(e),r=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(o,e,s,r);const g=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)g[l].apply(r);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,o=this._actionsByClip,s=o[i];if(s!==void 0){const r=s.knownActions;for(let g=0,a=r.length;g!==a;++g){const l=r[g];this._deactivateAction(l);const u=l._cacheIndex,d=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(l)}delete o[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const r in i){const g=i[r].actionByRoot,a=g[t];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}const o=this._bindingsByRootAndName,s=o[t];if(s!==void 0)for(const r in s){const g=s[r];g.restoreOriginalState(),this._removeInactiveBinding(g)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}rH.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class rp{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new rp(this.value.clone===void 0?this.value:this.value.clone())}}class gH extends qr{constructor(e,t,i=1){super(e,t);this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}gH.prototype.isInstancedInterleavedBuffer=!0;class aH{constructor(e,t,i,o,s){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=o,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}aH.prototype.isGLBufferAttribute=!0;class lH{constructor(e,t,i=0,o=1/0){this.ray=new jr(e,t),this.near=i,this.far=o,this.camera=null,this.layers=new kg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return E0(e,this,i,t),i.sort(N2),i}intersectObjects(e,t=!0,i=[]){for(let o=0,s=e.length;o<s;o++)E0(e[o],this,i,t);return i.sort(N2),i}}function N2(n,e){return n.distance-e.distance}function E0(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const o=n.children;for(let s=0,r=o.length;s<r;s++)E0(o[s],e,t,!0)}}class wz{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ni(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Rz{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const L2=new Se;class pI{constructor(e=new Se(1/0,1/0),t=new Se(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=L2.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return L2.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}pI.prototype.isBox2=!0;const z2=new K,$d=new K;class IH{constructor(e=new K,t=new K){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){z2.subVectors(e,this.start),$d.subVectors(this.end,this.start);const i=$d.dot($d);let s=$d.dot(z2)/i;return t&&(s=ni(s,0,1)),s}closestPointToPoint(e,t,i){const o=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(o).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const k2=new K;class Wz extends Gt{constructor(e,t){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new at,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let r=0,g=1,a=32;r<a;r++,g++){const l=r/a*Math.PI*2,u=g/a*Math.PI*2;o.push(Math.cos(l),Math.sin(l),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new tt(o,3));const s=new En({fog:!1,toneMapped:!1});this.cone=new yi(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),k2.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(k2),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ir=new K,eA=new et,$f=new et;class cH extends yi{constructor(e){const t=CH(e),i=new at,o=[],s=[],r=new ze(0,0,1),g=new ze(0,1,0);for(let l=0;l<t.length;l++){const u=t[l];u.parent&&u.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(r.r,r.g,r.b),s.push(g.r,g.g,g.b))}i.setAttribute("position",new tt(o,3)),i.setAttribute("color",new tt(s,3));const a=new En({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,a);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,o=i.getAttribute("position");$f.copy(this.root.matrixWorld).invert();for(let s=0,r=0;s<t.length;s++){const g=t[s];g.parent&&g.parent.isBone&&(eA.multiplyMatrices($f,g.matrixWorld),Ir.setFromMatrixPosition(eA),o.setXYZ(r,Ir.x,Ir.y,Ir.z),eA.multiplyMatrices($f,g.parent.matrixWorld),Ir.setFromMatrixPosition(eA),o.setXYZ(r+1,Ir.x,Ir.y,Ir.z),r+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function CH(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,CH(n.children[t]));return e}class Sz extends Sn{constructor(e,t,i){const o=new ta(t,4,2),s=new Ki({wireframe:!0,fog:!1,toneMapped:!1});super(o,s);this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Vz=new K,T2=new ze,E2=new ze;class xz extends Gt{constructor(e,t,i){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const o=new $g(t);o.rotateY(Math.PI*.5),this.material=new Ki({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=o.getAttribute("position"),r=new Float32Array(s.count*3);o.setAttribute("color",new vt(r,3)),this.add(new Sn(o,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");T2.copy(this.light.color),E2.copy(this.light.groundColor);for(let i=0,o=t.count;i<o;i++){const s=i<o/2?T2:E2;t.setXYZ(i,s.r,s.g,s.b)}t.needsUpdate=!0}e.lookAt(Vz.setFromMatrixPosition(this.light.matrixWorld).negate())}}class uH extends yi{constructor(e=10,t=10,i=4473924,o=8947848){i=new ze(i),o=new ze(o);const s=t/2,r=e/t,g=e/2,a=[],l=[];for(let C=0,A=0,f=-g;C<=t;C++,f+=r){a.push(-g,0,f,g,0,f),a.push(f,0,-g,f,0,g);const b=C===s?i:o;b.toArray(l,A),A+=3,b.toArray(l,A),A+=3,b.toArray(l,A),A+=3,b.toArray(l,A),A+=3}const u=new at;u.setAttribute("position",new tt(a,3)),u.setAttribute("color",new tt(l,3));const d=new En({vertexColors:!0,toneMapped:!1});super(u,d);this.type="GridHelper"}}class Hz extends yi{constructor(e=10,t=16,i=8,o=64,s=4473924,r=8947848){s=new ze(s),r=new ze(r);const g=[],a=[];for(let d=0;d<=t;d++){const C=d/t*(Math.PI*2),A=Math.sin(C)*e,f=Math.cos(C)*e;g.push(0,0,0),g.push(A,0,f);const b=d&1?s:r;a.push(b.r,b.g,b.b),a.push(b.r,b.g,b.b)}for(let d=0;d<=i;d++){const C=d&1?s:r,A=e-e/i*d;for(let f=0;f<o;f++){let b=f/o*(Math.PI*2),G=Math.sin(b)*A,m=Math.cos(b)*A;g.push(G,0,m),a.push(C.r,C.g,C.b),b=(f+1)/o*(Math.PI*2),G=Math.sin(b)*A,m=Math.cos(b)*A,g.push(G,0,m),a.push(C.r,C.g,C.b)}}const l=new at;l.setAttribute("position",new tt(g,3)),l.setAttribute("color",new tt(a,3));const u=new En({vertexColors:!0,toneMapped:!1});super(l,u);this.type="PolarGridHelper"}}const _2=new K,tA=new K,J2=new K;class Xz extends Gt{constructor(e,t,i){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,t===void 0&&(t=1);let o=new at;o.setAttribute("position",new tt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new En({fog:!1,toneMapped:!1});this.lightPlane=new ss(o,s),this.add(this.lightPlane),o=new at,o.setAttribute("position",new tt([0,0,0,0,0,1],3)),this.targetLine=new ss(o,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){_2.setFromMatrixPosition(this.light.matrixWorld),tA.setFromMatrixPosition(this.light.target.matrixWorld),J2.subVectors(tA,_2),this.lightPlane.lookAt(tA),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(tA),this.targetLine.scale.z=J2.length()}}const nA=new K,fn=new Og;class Mz extends yi{constructor(e){const t=new at,i=new En({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],r={},g=new ze(16755200),a=new ze(16711680),l=new ze(43775),u=new ze(16777215),d=new ze(3355443);C("n1","n2",g),C("n2","n4",g),C("n4","n3",g),C("n3","n1",g),C("f1","f2",g),C("f2","f4",g),C("f4","f3",g),C("f3","f1",g),C("n1","f1",g),C("n2","f2",g),C("n3","f3",g),C("n4","f4",g),C("p","n1",a),C("p","n2",a),C("p","n3",a),C("p","n4",a),C("u1","u2",l),C("u2","u3",l),C("u3","u1",l),C("c","t",u),C("p","c",d),C("cn1","cn2",d),C("cn3","cn4",d),C("cf1","cf2",d),C("cf3","cf4",d);function C(f,b,G){A(f,G),A(b,G)}function A(f,b){o.push(0,0,0),s.push(b.r,b.g,b.b),r[f]===void 0&&(r[f]=[]),r[f].push(o.length/3-1)}t.setAttribute("position",new tt(o,3)),t.setAttribute("color",new tt(s,3));super(t,i);this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()}update(){const e=this.geometry,t=this.pointMap,i=1,o=1;fn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Zn("c",t,e,fn,0,0,-1),Zn("t",t,e,fn,0,0,1),Zn("n1",t,e,fn,-i,-o,-1),Zn("n2",t,e,fn,i,-o,-1),Zn("n3",t,e,fn,-i,o,-1),Zn("n4",t,e,fn,i,o,-1),Zn("f1",t,e,fn,-i,-o,1),Zn("f2",t,e,fn,i,-o,1),Zn("f3",t,e,fn,-i,o,1),Zn("f4",t,e,fn,i,o,1),Zn("u1",t,e,fn,i*.7,o*1.1,-1),Zn("u2",t,e,fn,-i*.7,o*1.1,-1),Zn("u3",t,e,fn,0,o*2,-1),Zn("cf1",t,e,fn,-i,0,1),Zn("cf2",t,e,fn,i,0,1),Zn("cf3",t,e,fn,0,-o,1),Zn("cf4",t,e,fn,0,o,1),Zn("cn1",t,e,fn,-i,0,-1),Zn("cn2",t,e,fn,i,0,-1),Zn("cn3",t,e,fn,0,-o,-1),Zn("cn4",t,e,fn,0,o,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Zn(n,e,t,i,o,s,r){nA.set(o,s,r).unproject(i);const g=e[n];if(g!==void 0){const a=t.getAttribute("position");for(let l=0,u=g.length;l<u;l++)a.setXYZ(g[l],nA.x,nA.y,nA.z)}}const iA=new ki;class dH extends yi{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(8*3),s=new at;s.setIndex(new vt(i,1)),s.setAttribute("position",new vt(o,3));super(s,new En({color:t,toneMapped:!1}));this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&iA.setFromObject(this.object),iA.isEmpty())return;const t=iA.min,i=iA.max,o=this.geometry.attributes.position,s=o.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=t.x,s[4]=i.y,s[5]=i.z,s[6]=t.x,s[7]=t.y,s[8]=i.z,s[9]=i.x,s[10]=t.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=t.z,s[15]=t.x,s[16]=i.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=i.x,s[22]=t.y,s[23]=t.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return yi.prototype.copy.call(this,e),this.object=e.object,this}}class Kz extends yi{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new at;s.setIndex(new vt(i,1)),s.setAttribute("position",new tt(o,3));super(s,new En({color:t,toneMapped:!1}));this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class Fz extends ss{constructor(e,t=1,i=16776960){const o=i,s=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],r=new at;r.setAttribute("position",new tt(s,3)),r.computeBoundingSphere();super(r,new En({color:o,toneMapped:!1}));this.type="PlaneHelper",this.plane=e,this.size=t;const g=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],a=new at;a.setAttribute("position",new tt(g,3)),a.computeBoundingSphere(),this.add(new Sn(a,new Ki({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?wn:Yr,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const D2=new K;let oA,eb;class Yz extends Gt{constructor(e=new K(0,0,1),t=new K(0,0,0),i=1,o=16776960,s=i*.2,r=s*.2){super();this.type="ArrowHelper",oA===void 0&&(oA=new at,oA.setAttribute("position",new tt([0,0,0,0,1,0],3)),eb=new Er(0,.5,1,5,1),eb.translate(0,-.5,0)),this.position.copy(t),this.line=new ss(oA,new En({color:o,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Sn(eb,new Ki({color:o,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{D2.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(D2,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class AH extends yi{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],o=new at;o.setAttribute("position",new tt(t,3)),o.setAttribute("color",new tt(i,3));const s=new En({vertexColors:!0,toneMapped:!1});super(o,s);this.type="AxesHelper"}setColors(e,t,i){const o=new ze,s=this.geometry.attributes.color.array;return o.set(e),o.toArray(s,0),o.toArray(s,3),o.set(t),o.toArray(s,6),o.toArray(s,9),o.set(i),o.toArray(s,12),o.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Nz{constructor(){this.type="ShapePath",this.color=new ze,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new BC,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,o){return this.currentPath.quadraticCurveTo(e,t,i,o),this}bezierCurveTo(e,t,i,o,s,r){return this.currentPath.bezierCurveTo(e,t,i,o,s,r),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function i(h){const B=[];for(let y=0,Z=h.length;y<Z;y++){const R=h[y],W=new ns;W.curves=R.curves,B.push(W)}return B}function o(h,B){const y=B.length;let Z=!1;for(let R=y-1,W=0;W<y;R=W++){let x=B[R],X=B[W],Y=X.x-x.x,S=X.y-x.y;if(Math.abs(S)>Number.EPSILON){if(S<0&&(x=B[W],Y=-Y,X=B[R],S=-S),h.y<x.y||h.y>X.y)continue;if(h.y===x.y){if(h.x===x.x)return!0}else{const H=S*(h.x-x.x)-Y*(h.y-x.y);if(H===0)return!0;if(H<0)continue;Z=!Z}}else{if(h.y!==x.y)continue;if(X.x<=h.x&&h.x<=x.x||x.x<=h.x&&h.x<=X.x)return!0}}return Z}const s=is.isClockWise,r=this.subPaths;if(r.length===0)return[];if(t===!0)return i(r);let g,a,l;const u=[];if(r.length===1)return a=r[0],l=new ns,l.curves=a.curves,u.push(l),u;let d=!s(r[0].getPoints());d=e?!d:d;const C=[],A=[];let f=[],b=0,G;A[b]=void 0,f[b]=[];for(let h=0,B=r.length;h<B;h++)a=r[h],G=a.getPoints(),g=s(G),g=e?!g:g,g?(!d&&A[b]&&b++,A[b]={s:new ns,p:G},A[b].s.curves=a.curves,d&&b++,f[b]=[]):f[b].push({h:a,p:G[0]});if(!A[0])return i(r);if(A.length>1){let h=!1,B=0;for(let y=0,Z=A.length;y<Z;y++)C[y]=[];for(let y=0,Z=A.length;y<Z;y++){const R=f[y];for(let W=0;W<R.length;W++){const x=R[W];let X=!0;for(let Y=0;Y<A.length;Y++)o(x.p,A[Y].p)&&(y!==Y&&B++,X?(X=!1,C[Y].push(x)):h=!0);X&&C[y].push(x)}}B>0&&h===!1&&(f=C)}let m;for(let h=0,B=A.length;h<B;h++){l=A[h].s,u.push(l),m=f[h];for(let y=0,Z=m.length;y<Z;y++)l.holes.push(m[y].h)}return u}}const hH=new Float32Array(1),Lz=new Int32Array(hH.buffer);class zz{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),hH[0]=e;const t=Lz[0];let i=t>>16&32768,o=t>>12&2047;const s=t>>23&255;return s<103?i:s>142?(i|=31744,i|=(s==255?0:1)&&t&8388607,i):s<113?(o|=2048,i|=(o>>114-s)+(o>>113-s&1),i):(i|=s-112<<10|o>>1,i+=o&1,i)}}const kz=0,Tz=1,Ez=0,_z=1,Jz=2;function Dz(n){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),n}function Uz(n=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),n.isMultiMaterial=!0,n.materials=n,n.clone=function(){return n.slice()},n}function Pz(n,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new hI(n,e)}function Qz(n){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Oh(n)}function Oz(n,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new hI(n,e)}function jz(n){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new $r(n)}function qz(n){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new $r(n)}function $z(n){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new $r(n)}function ek(n,e,t){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new K(n,e,t)}function tk(n,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new vt(n,e).setUsage(Qg)}function nk(n,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new dx(n,e)}function ik(n,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Ax(n,e)}function ok(n,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new hx(n,e)}function sk(n,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new px(n,e)}function rk(n,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Th(n,e)}function gk(n,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new mx(n,e)}function ak(n,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Eh(n,e)}function lk(n,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new tt(n,e)}function Ik(n,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new bx(n,e)}Oi.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create(Oi.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n};BC.prototype.fromPoints=function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)};function ck(n){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AH(n)}function Ck(n,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new dH(n,e)}function uk(n,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new yi(new GB(n.geometry),new En({color:e!==void 0?e:16777215}))}uH.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};cH.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function dk(n,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new yi(new RB(n.geometry),new En({color:e!==void 0?e:16777215}))}oi.prototype.extractUrlBase=function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ho.extractUrlBase(n)};oi.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};function Ak(n){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Li(n)}function hk(n){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Px(n)}pI.prototype.center=function(n){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(n)};pI.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};pI.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};pI.prototype.size=function(n){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(n)};ki.prototype.center=function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)};ki.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ki.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};ki.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};ki.prototype.size=function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)};Es.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")};Ts.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};JC.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)};IH.prototype.center=function(n){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(n)};kn.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};kn.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};kn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};kn.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};kn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};kn.prototype.getInverse=function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};et.prototype.extractPosition=function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)};et.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};et.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new K().setFromMatrixColumn(this,3)};et.prototype.setRotationFromQuaternion=function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)};et.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};et.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};et.prototype.multiplyVector4=function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};et.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};et.prototype.rotateAxis=function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)};et.prototype.crossVector=function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};et.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};et.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};et.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};et.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};et.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};et.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};et.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};et.prototype.makeFrustum=function(n,e,t,i,o,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,i,t,o,s)};et.prototype.getInverse=function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};Do.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)};xn.prototype.multiplyVector3=function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)};xn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};jr.prototype.isIntersectionBox=function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};jr.prototype.isIntersectionPlane=function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)};jr.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};Wn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Wn.prototype.barycoordFromPoint=function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)};Wn.prototype.midpoint=function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)};Wn.prototypenormal=function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)};Wn.prototype.plane=function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)};Wn.barycoordFromPoint=function(n,e,t,i,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Wn.getBarycoord(n,e,t,i,o)};Wn.normal=function(n,e,t,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Wn.getNormal(n,e,t,i)};ns.prototype.extractAllPoints=function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)};ns.prototype.extrude=function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new gs(this,n)};ns.prototype.makeGeometry=function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ea(this,n)};Se.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};Se.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};Se.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};K.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};K.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};K.prototype.getPositionFromMatrix=function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)};K.prototype.getScaleFromMatrix=function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)};K.prototype.getColumnFromMatrix=function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)};K.prototype.applyProjection=function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)};K.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};K.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};K.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};zt.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};zt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Gt.prototype.getChildByName=function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)};Gt.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Gt.prototype.translate=function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)};Gt.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Gt.prototype.applyMatrix=function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(Gt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Sn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Sn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),nx},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});QC.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Kn.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(n)};Object.defineProperties(Mo.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}});Object.defineProperties(vt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Qg},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Qg)}}});vt.prototype.setDynamic=function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?Qg:Ll),this};vt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},vt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};at.prototype.addIndex=function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)};at.prototype.addAttribute=function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new vt(arguments[1],arguments[2]))):n==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e)};at.prototype.addDrawCall=function(n,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)};at.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};at.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};at.prototype.removeAttribute=function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)};at.prototype.applyMatrix=function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(at.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});qr.prototype.setDynamic=function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?Qg:Ll),this};qr.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};gs.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};gs.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};gs.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};PC.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};rp.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(cn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ze}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===IB}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(uo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}});Tt.prototype.clearTarget=function(n,e,t,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,i)};Tt.prototype.animate=function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)};Tt.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Tt.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Tt.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Tt.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Tt.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Tt.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Tt.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Tt.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Tt.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Tt.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Tt.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Tt.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Tt.prototype.enableScissorTest=function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)};Tt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Tt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Tt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Tt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Tt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Tt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Tt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Tt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Tt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Tt.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Tt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=n===!0?Lt:Xo}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(Vx.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});function pk(n,e,t){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Jh(n,t)}Object.defineProperties(Gi.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}});QB.prototype.load=function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new eH().load(n,function(i){e.setBuffer(i)}),this};iH.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};_h.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)};_h.prototype.clear=function(n,e,t,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,i)};Or.crossOrigin=void 0;Or.loadTexture=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const o=new LB;o.setCrossOrigin(this.crossOrigin);const s=o.load(n,t,void 0,i);return e&&(s.mapping=e),s};Or.loadTextureCube=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const o=new Ux;o.setCrossOrigin(this.crossOrigin);const s=o.load(n,t,void 0,i);return e&&(s.mapping=e),s};Or.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Or.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function mk(){console.error("THREE.CanvasRenderer has been removed")}function fk(){console.error("THREE.JSONLoader has been removed.")}const bk={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Gk(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function Bk(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new at}function yk(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new at}function vk(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function Zk(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function wk(){console.error("THREE.ImmediateRenderObject has been removed.")}function Rk(n,e,t){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.');const i=new Gi(n,e,t);return i.samples=4,i}function Wk(n,e,t,i){return console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),new uI(n,e,t,i)}function Sk(n,e,t,i){return console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),new _C(n,e,t,i)}typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Nh}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Nh);var Vk=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:uB,AddEquation:Bg,AddOperation:XV,AdditiveAnimationBlendMode:dB,AdditiveBlending:l0,AlphaFormat:EV,AlwaysDepth:wV,AlwaysStencilFunc:gx,AmbientLight:TB,AmbientLightProbe:nH,AnimationClip:$l,AnimationLoader:gz,AnimationMixer:rH,AnimationObjectGroup:sH,AnimationUtils:rn,ArcCurve:BB,ArrayCamera:mB,ArrowHelper:Yz,Audio:QB,AudioAnalyser:iH,AudioContext:UB,AudioListener:uz,AudioLoader:eH,AxesHelper:AH,AxisHelper:ck,BackSide:wn,BasicDepthPacking:ox,BasicShadowMap:gY,BinaryTextureLoader:hk,Bone:OC,BooleanKeyframeTrack:ua,BoundingBoxHelper:Ck,Box2:pI,Box3:ki,Box3Helper:Kz,BoxBufferGeometry:Ys,BoxGeometry:Ys,BoxHelper:dH,BufferAttribute:vt,BufferGeometry:at,BufferGeometryLoader:$x,ByteType:NV,Cache:na,Camera:Og,CameraHelper:Mz,CanvasRenderer:mk,CanvasTexture:Yx,CatmullRomCurve3:vB,CineonToneMapping:FV,CircleBufferGeometry:kl,CircleGeometry:kl,ClampToEdgeWrapping:ui,Clock:PB,Color:ze,ColorKeyframeTrack:YB,CompressedTexture:bB,CompressedTextureLoader:az,ConeBufferGeometry:Tl,ConeGeometry:Tl,CubeCamera:_h,CubeReflectionMapping:Lr,CubeRefractionMapping:zr,CubeTexture:dI,CubeTextureLoader:Ux,CubeUVReflectionMapping:CI,CubeUVRefractionMapping:EC,CubicBezierCurve:qh,CubicBezierCurve3:ZB,CubicInterpolant:Ex,CullFaceBack:a0,CullFaceFront:CV,CullFaceFrontBack:rY,CullFaceNone:cV,Curve:Oi,CurvePath:Lx,CustomBlending:uV,CustomToneMapping:YV,CylinderBufferGeometry:Er,CylinderGeometry:Er,Cylindrical:Rz,Data3DTexture:_C,DataArrayTexture:uI,DataTexture:Tg,DataTexture2DArray:Wk,DataTexture3D:Sk,DataTextureLoader:Px,DataUtils:zz,DecrementStencilOp:hY,DecrementWrapStencilOp:mY,DefaultLoadingManager:Dx,DepthFormat:Vr,DepthStencilFormat:Ug,DepthTexture:fB,DirectionalLight:sp,DirectionalLightHelper:Xz,DiscreteInterpolant:_x,DodecahedronBufferGeometry:El,DodecahedronGeometry:El,DoubleSide:Nr,DstAlphaFactor:bV,DstColorFactor:BV,DynamicBufferAttribute:tk,DynamicCopyUsage:HY,DynamicDrawUsage:Qg,DynamicReadUsage:SY,EdgesGeometry:GB,EdgesHelper:uk,EllipseCurve:qC,EqualDepth:WV,EqualStencilFunc:BY,EquirectangularReflectionMapping:AC,EquirectangularRefractionMapping:hC,Euler:Es,EventDispatcher:Qr,ExtrudeBufferGeometry:gs,ExtrudeGeometry:gs,FaceColors:_z,FileLoader:Li,FlatShading:IB,Float16BufferAttribute:fx,Float32Attribute:lk,Float32BufferAttribute:tt,Float64Attribute:Ik,Float64BufferAttribute:bx,FloatType:Hs,Fog:UC,FogExp2:DC,Font:Zk,FontLoader:vk,FramebufferTexture:Fx,FrontSide:Yr,Frustum:JC,GLBufferAttribute:aH,GLSL1:MY,GLSL3:K0,GreaterDepth:VV,GreaterEqualDepth:SV,GreaterEqualStencilFunc:wY,GreaterStencilFunc:vY,GridHelper:uH,Group:qo,HalfFloatType:Ng,HemisphereLight:zB,HemisphereLightHelper:xz,HemisphereLightProbe:tH,IcosahedronBufferGeometry:_l,IcosahedronGeometry:_l,ImageBitmapLoader:DB,ImageLoader:wC,ImageUtils:Or,ImmediateRenderObject:wk,IncrementStencilOp:AY,IncrementWrapStencilOp:pY,InstancedBufferAttribute:qg,InstancedBufferGeometry:JB,InstancedInterleavedBuffer:gH,InstancedMesh:Eg,Int16Attribute:sk,Int16BufferAttribute:px,Int32Attribute:gk,Int32BufferAttribute:mx,Int8Attribute:nk,Int8BufferAttribute:dx,IntType:zV,InterleavedBuffer:qr,InterleavedBufferAttribute:Ns,Interpolant:as,InterpolateDiscrete:Nl,InterpolateLinear:Pg,InterpolateSmooth:KA,InvertStencilOp:fY,JSONLoader:fk,KeepStencilOp:FA,KeyframeTrack:Ko,LOD:Mx,LatheBufferGeometry:Jl,LatheGeometry:Jl,Layers:kg,LensFlare:Gk,LessDepth:RV,LessEqualDepth:uh,LessEqualStencilFunc:yY,LessStencilFunc:GY,Light:Mo,LightProbe:eu,Line:ss,Line3:IH,LineBasicMaterial:En,LineCurve:$C,LineCurve3:Nx,LineDashedMaterial:KB,LineLoop:jh,LinePieces:Tz,LineSegments:yi,LineStrip:kz,LinearEncoding:Xo,LinearFilter:gn,LinearInterpolant:FB,LinearMipMapLinearFilter:CY,LinearMipMapNearestFilter:cY,LinearMipmapLinearFilter:ks,LinearMipmapNearestFilter:zh,LinearToneMapping:MV,Loader:oi,LoaderUtils:Ho,LoadingManager:NB,LoopOnce:$V,LoopPingPong:tx,LoopRepeat:ex,LuminanceAlphaFormat:DV,LuminanceFormat:JV,MOUSE:oY,Material:cn,MaterialLoader:qx,Math:Y0,MathUtils:Y0,Matrix3:kn,Matrix4:et,MaxEquation:u0,Mesh:Sn,MeshBasicMaterial:Ki,MeshDepthMaterial:Uh,MeshDistanceMaterial:Ph,MeshFaceMaterial:Dz,MeshLambertMaterial:XB,MeshMatcapMaterial:MB,MeshNormalMaterial:HB,MeshPhongMaterial:VB,MeshPhysicalMaterial:_s,MeshStandardMaterial:Ca,MeshToonMaterial:xB,MinEquation:C0,MirroredRepeatWrapping:Fl,MixOperation:HV,MultiMaterial:Uz,MultiplyBlending:c0,MultiplyOperation:TC,NearestFilter:Rn,NearestMipMapLinearFilter:IY,NearestMipMapNearestFilter:lY,NearestMipmapLinearFilter:mC,NearestMipmapNearestFilter:pC,NeverDepth:ZV,NeverStencilFunc:bY,NoBlending:Ms,NoColors:Ez,NoToneMapping:ts,NormalAnimationBlendMode:kh,NormalBlending:Yg,NotEqualDepth:xV,NotEqualStencilFunc:ZY,NumberKeyframeTrack:jl,Object3D:Gt,ObjectLoader:lz,ObjectSpaceNormalMap:rx,OctahedronBufferGeometry:$g,OctahedronGeometry:$g,OneFactor:pV,OneMinusDstAlphaFactor:GV,OneMinusDstColorFactor:yV,OneMinusSrcAlphaFactor:CB,OneMinusSrcColorFactor:fV,OrthographicCamera:ca,PCFShadowMap:aB,PCFSoftShadowMap:lB,PMREMGenerator:N0,ParametricGeometry:Bk,Particle:Qz,ParticleBasicMaterial:qz,ParticleSystem:Oz,ParticleSystemMaterial:$z,Path:BC,PerspectiveCamera:Kn,Plane:Do,PlaneBufferGeometry:jg,PlaneGeometry:jg,PlaneHelper:Fz,PointCloud:Pz,PointCloudMaterial:jz,PointLight:op,PointLightHelper:Sz,Points:hI,PointsMaterial:$r,PolarGridHelper:Hz,PolyhedronBufferGeometry:rs,PolyhedronGeometry:rs,PositionalAudio:Az,PropertyBinding:Vt,PropertyMixer:oH,QuadraticBezierCurve:$h,QuadraticBezierCurve3:ep,Quaternion:xn,QuaternionKeyframeTrack:Jr,QuaternionLinearInterpolant:Jx,REVISION:Nh,RGBADepthPacking:sx,RGBAFormat:Ai,RGBAIntegerFormat:jV,RGBA_ASTC_10x10_Format:x0,RGBA_ASTC_10x5_Format:W0,RGBA_ASTC_10x6_Format:S0,RGBA_ASTC_10x8_Format:V0,RGBA_ASTC_12x10_Format:H0,RGBA_ASTC_12x12_Format:X0,RGBA_ASTC_4x4_Format:b0,RGBA_ASTC_5x4_Format:G0,RGBA_ASTC_5x5_Format:B0,RGBA_ASTC_6x5_Format:y0,RGBA_ASTC_6x6_Format:v0,RGBA_ASTC_8x5_Format:Z0,RGBA_ASTC_8x6_Format:w0,RGBA_ASTC_8x8_Format:R0,RGBA_BPTC_Format:M0,RGBA_ETC2_EAC_Format:f0,RGBA_PVRTC_2BPPV1_Format:p0,RGBA_PVRTC_4BPPV1_Format:h0,RGBA_S3TC_DXT1_Format:HA,RGBA_S3TC_DXT3_Format:XA,RGBA_S3TC_DXT5_Format:MA,RGBFormat:_V,RGB_ETC1_Format:qV,RGB_ETC2_Format:m0,RGB_PVRTC_2BPPV1_Format:A0,RGB_PVRTC_4BPPV1_Format:d0,RGB_S3TC_DXT1_Format:xA,RGFormat:QV,RGIntegerFormat:OV,RawShaderMaterial:SB,Ray:jr,Raycaster:lH,RectAreaLight:EB,RedFormat:UV,RedIntegerFormat:PV,ReinhardToneMapping:KV,RepeatWrapping:kr,ReplaceStencilOp:dY,ReverseSubtractEquation:AV,RingBufferGeometry:Dl,RingGeometry:Dl,Scene:PC,SceneUtils:bk,ShaderChunk:yt,ShaderLib:Vo,ShaderMaterial:uo,ShadowMaterial:WB,Shape:ns,ShapeBufferGeometry:ea,ShapeGeometry:ea,ShapePath:Nz,ShapeUtils:is,ShortType:LV,Skeleton:jC,SkeletonHelper:cH,SkinnedMesh:QC,SmoothShading:aY,Sphere:Ts,SphereBufferGeometry:ta,SphereGeometry:ta,Spherical:wz,SphericalHarmonics3:_B,SplineCurve:tp,SpotLight:ip,SpotLightHelper:Wz,Sprite:Oh,SpriteMaterial:Qh,SrcAlphaFactor:cB,SrcAlphaSaturateFactor:vV,SrcColorFactor:mV,StaticCopyUsage:xY,StaticDrawUsage:Ll,StaticReadUsage:WY,StereoCamera:cz,StreamCopyUsage:XY,StreamDrawUsage:RY,StreamReadUsage:VY,StringKeyframeTrack:da,SubtractEquation:dV,SubtractiveBlending:I0,TOUCH:sY,TangentSpaceNormalMap:Pr,TetrahedronBufferGeometry:Ul,TetrahedronGeometry:Ul,TextGeometry:yk,Texture:pn,TextureLoader:LB,TorusBufferGeometry:Pl,TorusGeometry:Pl,TorusKnotBufferGeometry:Ql,TorusKnotGeometry:Ql,Triangle:Wn,TriangleFanDrawMode:AB,TriangleStripDrawMode:ix,TrianglesDrawMode:nx,TubeBufferGeometry:Ol,TubeGeometry:Ol,UVMapping:Lh,Uint16Attribute:rk,Uint16BufferAttribute:Th,Uint32Attribute:ak,Uint32BufferAttribute:Eh,Uint8Attribute:ik,Uint8BufferAttribute:Ax,Uint8ClampedAttribute:ok,Uint8ClampedBufferAttribute:hx,Uniform:rp,UniformsLib:_e,UniformsUtils:Gx,UnsignedByteType:Tr,UnsignedInt248Type:Lg,UnsignedIntType:Jc,UnsignedShort4444Type:kV,UnsignedShort5551Type:TV,UnsignedShortType:Yl,VSMShadowMap:ll,Vector2:Se,Vector3:K,Vector4:zt,VectorKeyframeTrack:ql,Vertex:ek,VertexColors:Jz,VideoTexture:Kx,WebGL1Renderer:Hx,WebGL3DRenderTarget:Cx,WebGLArrayRenderTarget:cx,WebGLCubeRenderTarget:Jh,WebGLMultipleRenderTargets:ux,WebGLMultisampleRenderTarget:Rk,WebGLRenderTarget:Gi,WebGLRenderTargetCube:pk,WebGLRenderer:Tt,WebGLUtils:xx,WireframeGeometry:RB,WireframeHelper:dk,WrapAroundEnding:fC,XHRLoader:Ak,ZeroCurvatureEnding:Hg,ZeroFactor:hV,ZeroSlopeEnding:Xg,ZeroStencilOp:uY,_SRGBAFormat:dh,sRGBEncoding:Lt},Symbol.toStringTag,{value:"Module"}));function xk(n){let e;const t=new Set,i=(l,u)=>{const d=typeof l=="function"?l(e):l;if(d!==e){const C=e;e=u?d:Object.assign({},e,d),t.forEach(A=>A(e,C))}},o=()=>e,s=(l,u=o,d=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let C=u(e);function A(){const f=u(e);if(!d(C,f)){const b=C;l(C=f,b)}}return t.add(A),()=>t.delete(A)},a={setState:i,getState:o,subscribe:(l,u,d)=>u||d?s(l,u,d):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=n(i,o,a),a}const Hk=typeof window=="undefined"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),U2=Hk?ce.exports.useEffect:ce.exports.useLayoutEffect;function Xk(n){const e=typeof n=="function"?xk(n):n,t=(i=e.getState,o=Object.is)=>{const[,s]=ce.exports.useReducer(G=>G+1,0),r=e.getState(),g=ce.exports.useRef(r),a=ce.exports.useRef(i),l=ce.exports.useRef(o),u=ce.exports.useRef(!1),d=ce.exports.useRef();d.current===void 0&&(d.current=i(r));let C,A=!1;(g.current!==r||a.current!==i||l.current!==o||u.current)&&(C=i(r),A=!o(d.current,C)),U2(()=>{A&&(d.current=C),g.current=r,a.current=i,l.current=o,u.current=!1});const f=ce.exports.useRef(r);U2(()=>{const G=()=>{try{const h=e.getState(),B=a.current(h);l.current(d.current,B)||(g.current=h,d.current=B,s())}catch{u.current=!0,s()}},m=e.subscribe(G);return e.getState()!==f.current&&G(),m},[]);const b=A?C:d.current;return ce.exports.useDebugValue(b),b};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[t,e];return{next(){const o=i.length<=0;return{value:i.shift(),done:o}}}},t}var pH={exports:{}},mH={exports:{}};/** @license React v0.26.2
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){n.exports=function(t){var i={},o=cG,s=ce.exports,r=Al.exports;function g(I){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+I,p=1;p<arguments.length;p++)c+="&args[]="+encodeURIComponent(arguments[p]);return"Minified React error #"+I+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=60103,u=60106,d=60107,C=60108,A=60114,f=60109,b=60110,G=60112,m=60113,h=60120,B=60115,y=60116,Z=60121,R=60129,W=60130,x=60131;if(typeof Symbol=="function"&&Symbol.for){var X=Symbol.for;l=X("react.element"),u=X("react.portal"),d=X("react.fragment"),C=X("react.strict_mode"),A=X("react.profiler"),f=X("react.provider"),b=X("react.context"),G=X("react.forward_ref"),m=X("react.suspense"),h=X("react.suspense_list"),B=X("react.memo"),y=X("react.lazy"),Z=X("react.block"),X("react.scope"),R=X("react.debug_trace_mode"),W=X("react.offscreen"),x=X("react.legacy_hidden")}var Y=typeof Symbol=="function"&&Symbol.iterator;function S(I){return I===null||typeof I!="object"?null:(I=Y&&I[Y]||I["@@iterator"],typeof I=="function"?I:null)}function H(I){if(I==null)return null;if(typeof I=="function")return I.displayName||I.name||null;if(typeof I=="string")return I;switch(I){case d:return"Fragment";case u:return"Portal";case A:return"Profiler";case C:return"StrictMode";case m:return"Suspense";case h:return"SuspenseList"}if(typeof I=="object")switch(I.$$typeof){case b:return(I.displayName||"Context")+".Consumer";case f:return(I._context.displayName||"Context")+".Provider";case G:var c=I.render;return c=c.displayName||c.name||"",I.displayName||(c!==""?"ForwardRef("+c+")":"ForwardRef");case B:return H(I.type);case Z:return H(I._render);case y:c=I._payload,I=I._init;try{return H(I(c))}catch{}}return null}function k(I){var c=I,p=I;if(I.alternate)for(;c.return;)c=c.return;else{I=c;do c=I,(c.flags&1026)!==0&&(p=c.return),I=c.return;while(I)}return c.tag===3?p:null}function U(I){if(k(I)!==I)throw Error(g(188))}function D(I){var c=I.alternate;if(!c){if(c=k(I),c===null)throw Error(g(188));return c!==I?null:I}for(var p=I,v=c;;){var w=p.return;if(w===null)break;var V=w.alternate;if(V===null){if(v=w.return,v!==null){p=v;continue}break}if(w.child===V.child){for(V=w.child;V;){if(V===p)return U(w),I;if(V===v)return U(w),c;V=V.sibling}throw Error(g(188))}if(p.return!==v.return)p=w,v=V;else{for(var L=!1,q=w.child;q;){if(q===p){L=!0,p=w,v=V;break}if(q===v){L=!0,v=w,p=V;break}q=q.sibling}if(!L){for(q=V.child;q;){if(q===p){L=!0,p=V,v=w;break}if(q===v){L=!0,v=V,p=w;break}q=q.sibling}if(!L)throw Error(g(189))}}if(p.alternate!==v)throw Error(g(190))}if(p.tag!==3)throw Error(g(188));return p.stateNode.current===p?I:c}function Q(I){if(I=D(I),!I)return null;for(var c=I;;){if(c.tag===5||c.tag===6)return c;if(c.child)c.child.return=c,c=c.child;else{if(c===I)break;for(;!c.sibling;){if(!c.return||c.return===I)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}}return null}function $(I){if(I=D(I),!I)return null;for(var c=I;;){if(c.tag===5||c.tag===6)return c;if(c.child&&c.tag!==4)c.child.return=c,c=c.child;else{if(c===I)break;for(;!c.sibling;){if(!c.return||c.return===I)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}}return null}function j(I,c){for(var p=I.alternate;c!==null;){if(c===I||c===p)return!0;c=c.return}return!1}var oe=t.getPublicInstance,Ie=t.getRootHostContext,T=t.getChildHostContext,P=t.prepareForCommit,Ce=t.resetAfterCommit,Me=t.createInstance,ee=t.appendInitialChild,_=t.finalizeInitialChildren,Ae=t.prepareUpdate,ye=t.shouldSetTextContent,ge=t.createTextInstance,we=t.scheduleTimeout,Ke=t.cancelTimeout,ie=t.noTimeout,de=t.isPrimaryRenderer,Ge=t.supportsMutation,Ve=t.supportsPersistence,xe=t.supportsHydration,Pe=t.getInstanceFromNode,Ue=t.makeOpaqueHydratingObject,nt=t.makeClientId,ct=t.beforeActiveInstanceBlur,F=t.afterActiveInstanceBlur,M=t.preparePortalMount,me=t.supportsTestSelectors,te=t.findFiberRoot,he=t.getBoundingRect,Re=t.getTextContent,Fe=t.isHiddenSubtree,pe=t.matchAccessibilityRole,$e=t.setFocusIfFocusable,ve=t.setupIntersectionObserver,Le=t.appendChild,Ye=t.appendChildToContainer,O=t.commitTextUpdate,ke=t.commitMount,E=t.commitUpdate,J=t.insertBefore,se=t.insertInContainerBefore,re=t.removeChild,Ze=t.removeChildFromContainer,He=t.resetTextContent,Qe=t.hideInstance,Te=t.hideTextInstance,it=t.unhideInstance,lt=t.unhideTextInstance,Ft=t.clearContainer,Bn=t.cloneInstance,un=t.createContainerChildSet,Yn=t.appendChildToContainerChildSet,si=t.finalizeContainerChildren,po=t.replaceContainerChildren,Cs=t.cloneHiddenInstance,Yo=t.cloneHiddenTextInstance,N=t.canHydrateInstance,le=t.canHydrateTextInstance,fe=t.isSuspenseInstancePending,ue=t.isSuspenseInstanceFallback,We=t.getNextHydratableSibling,Ct=t.getFirstHydratableChild,ht=t.hydrateInstance,ft=t.hydrateTextInstance,mt=t.getNextHydratableInstanceAfterSuspenseInstance,Ht=t.commitHydratedContainer,Rt=t.commitHydratedSuspenseInstance,Zt;function Jt(I){if(Zt===void 0)try{throw Error()}catch(p){var c=p.stack.trim().match(/\n( *(at )?)/);Zt=c&&c[1]||""}return`
`+Zt+I}var mo=!1;function fo(I,c){if(!I||mo)return"";mo=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(be){var v=be}Reflect.construct(I,[],c)}else{try{c.call()}catch(be){v=be}I.call(c.prototype)}else{try{throw Error()}catch(be){v=be}I()}}catch(be){if(be&&v&&typeof be.stack=="string"){for(var w=be.stack.split(`
`),V=v.stack.split(`
`),L=w.length-1,q=V.length-1;1<=L&&0<=q&&w[L]!==V[q];)q--;for(;1<=L&&0<=q;L--,q--)if(w[L]!==V[q]){if(L!==1||q!==1)do if(L--,q--,0>q||w[L]!==V[q])return`
`+w[L].replace(" at new "," at ");while(1<=L&&0<=q);break}}}finally{mo=!1,Error.prepareStackTrace=p}return(I=I?I.displayName||I.name:"")?Jt(I):""}var No=[],Pn=-1;function Bt(I){return{current:I}}function Xt(I){0>Pn||(I.current=No[Pn],No[Pn]=null,Pn--)}function pt(I,c){Pn++,No[Pn]=I.current,I.current=c}var Nn={},on=Bt(Nn),Hn=Bt(!1),bo=Nn;function dn(I,c){var p=I.type.contextTypes;if(!p)return Nn;var v=I.stateNode;if(v&&v.__reactInternalMemoizedUnmaskedChildContext===c)return v.__reactInternalMemoizedMaskedChildContext;var w={},V;for(V in p)w[V]=c[V];return v&&(I=I.stateNode,I.__reactInternalMemoizedUnmaskedChildContext=c,I.__reactInternalMemoizedMaskedChildContext=w),w}function Xn(I){return I=I.childContextTypes,I!=null}function Ds(){Xt(Hn),Xt(on)}function Zi(I,c,p){if(on.current!==Nn)throw Error(g(168));pt(on,c),pt(Hn,p)}function Yy(I,c,p){var v=I.stateNode;if(I=c.childContextTypes,typeof v.getChildContext!="function")return p;v=v.getChildContext();for(var w in v)if(!(w in I))throw Error(g(108,H(c)||"Unknown",w));return o({},p,v)}function hu(I){return I=(I=I.stateNode)&&I.__reactInternalMemoizedMergedChildContext||Nn,bo=on.current,pt(on,I),pt(Hn,Hn.current),!0}function Ny(I,c,p){var v=I.stateNode;if(!v)throw Error(g(169));p?(I=Yy(I,c,bo),v.__reactInternalMemoizedMergedChildContext=I,Xt(Hn),Xt(on),pt(on,I)):Xt(Hn),pt(Hn,p)}var Qp=null,og=null,gM=r.unstable_now;gM();var pu=0,Ot=8;function sg(I){if((1&I)!==0)return Ot=15,1;if((2&I)!==0)return Ot=14,2;if((4&I)!==0)return Ot=13,4;var c=24&I;return c!==0?(Ot=12,c):(I&32)!==0?(Ot=11,32):(c=192&I,c!==0?(Ot=10,c):(I&256)!==0?(Ot=9,256):(c=3584&I,c!==0?(Ot=8,c):(I&4096)!==0?(Ot=7,4096):(c=4186112&I,c!==0?(Ot=6,c):(c=62914560&I,c!==0?(Ot=5,c):I&67108864?(Ot=4,67108864):(I&134217728)!==0?(Ot=3,134217728):(c=805306368&I,c!==0?(Ot=2,c):(1073741824&I)!==0?(Ot=1,1073741824):(Ot=8,I))))))}function aM(I){switch(I){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function lM(I){switch(I){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(g(358,I))}}function GI(I,c){var p=I.pendingLanes;if(p===0)return Ot=0;var v=0,w=0,V=I.expiredLanes,L=I.suspendedLanes,q=I.pingedLanes;if(V!==0)v=V,w=Ot=15;else if(V=p&134217727,V!==0){var be=V&~L;be!==0?(v=sg(be),w=Ot):(q&=V,q!==0&&(v=sg(q),w=Ot))}else V=p&~L,V!==0?(v=sg(V),w=Ot):q!==0&&(v=sg(q),w=Ot);if(v===0)return 0;if(v=31-Us(v),v=p&((0>v?0:1<<v)<<1)-1,c!==0&&c!==v&&(c&L)===0){if(sg(c),w<=Ot)return c;Ot=w}if(c=I.entangledLanes,c!==0)for(I=I.entanglements,c&=v;0<c;)p=31-Us(c),w=1<<p,v|=I[p],c&=~w;return v}function Ly(I){return I=I.pendingLanes&-1073741825,I!==0?I:I&1073741824?1073741824:0}function mu(I,c){switch(I){case 15:return 1;case 14:return 2;case 12:return I=pa(24&~c),I===0?mu(10,c):I;case 10:return I=pa(192&~c),I===0?mu(8,c):I;case 8:return I=pa(3584&~c),I===0&&(I=pa(4186112&~c),I===0&&(I=512)),I;case 2:return c=pa(805306368&~c),c===0&&(c=268435456),c}throw Error(g(358,I))}function pa(I){return I&-I}function Op(I){for(var c=[],p=0;31>p;p++)c.push(I);return c}function fu(I,c,p){I.pendingLanes|=c;var v=c-1;I.suspendedLanes&=v,I.pingedLanes&=v,I=I.eventTimes,c=31-Us(c),I[c]=p}var Us=Math.clz32?Math.clz32:CM,IM=Math.log,cM=Math.LN2;function CM(I){return I===0?32:31-(IM(I)/cM|0)|0}var uM=r.unstable_runWithPriority,jp=r.unstable_scheduleCallback,qp=r.unstable_cancelCallback,dM=r.unstable_shouldYield,zy=r.unstable_requestPaint,$p=r.unstable_now,AM=r.unstable_getCurrentPriorityLevel,bu=r.unstable_ImmediatePriority,ky=r.unstable_UserBlockingPriority,Ty=r.unstable_NormalPriority,Ey=r.unstable_LowPriority,_y=r.unstable_IdlePriority,em={},hM=zy!==void 0?zy:function(){},us=null,Gu=null,tm=!1,Jy=$p(),Qn=1e4>Jy?$p:function(){return $p()-Jy};function ma(){switch(AM()){case bu:return 99;case ky:return 98;case Ty:return 97;case Ey:return 96;case _y:return 95;default:throw Error(g(332))}}function Dy(I){switch(I){case 99:return bu;case 98:return ky;case 97:return Ty;case 96:return Ey;case 95:return _y;default:throw Error(g(332))}}function ds(I,c){return I=Dy(I),uM(I,c)}function BI(I,c,p){return I=Dy(I),jp(I,c,p)}function $i(){if(Gu!==null){var I=Gu;Gu=null,qp(I)}Uy()}function Uy(){if(!tm&&us!==null){tm=!0;var I=0;try{var c=us;ds(99,function(){for(;I<c.length;I++){var p=c[I];do p=p(!0);while(p!==null)}}),us=null}catch(p){throw us!==null&&(us=us.slice(I+1)),jp(bu,$i),p}finally{tm=!1}}}var pM=a.ReactCurrentBatchConfig;function mM(I,c){return I===c&&(I!==0||1/I===1/c)||I!==I&&c!==c}var eo=typeof Object.is=="function"?Object.is:mM,fM=Object.prototype.hasOwnProperty;function Bu(I,c){if(eo(I,c))return!0;if(typeof I!="object"||I===null||typeof c!="object"||c===null)return!1;var p=Object.keys(I),v=Object.keys(c);if(p.length!==v.length)return!1;for(v=0;v<p.length;v++)if(!fM.call(c,p[v])||!eo(I[p[v]],c[p[v]]))return!1;return!0}function bM(I){switch(I.tag){case 5:return Jt(I.type);case 16:return Jt("Lazy");case 13:return Jt("Suspense");case 19:return Jt("SuspenseList");case 0:case 2:case 15:return I=fo(I.type,!1),I;case 11:return I=fo(I.type.render,!1),I;case 22:return I=fo(I.type._render,!1),I;case 1:return I=fo(I.type,!0),I;default:return""}}function Go(I,c){if(I&&I.defaultProps){c=o({},c),I=I.defaultProps;for(var p in I)c[p]===void 0&&(c[p]=I[p]);return c}return c}var yu=Bt(null),vu=null,fa=null,Zu=null;function nm(){Zu=fa=vu=null}function Py(I,c){I=I.type._context,de?(pt(yu,I._currentValue),I._currentValue=c):(pt(yu,I._currentValue2),I._currentValue2=c)}function im(I){var c=yu.current;Xt(yu),I=I.type._context,de?I._currentValue=c:I._currentValue2=c}function Qy(I,c){for(;I!==null;){var p=I.alternate;if((I.childLanes&c)===c){if(p===null||(p.childLanes&c)===c)break;p.childLanes|=c}else I.childLanes|=c,p!==null&&(p.childLanes|=c);I=I.return}}function ba(I,c){vu=I,Zu=fa=null,I=I.dependencies,I!==null&&I.firstContext!==null&&((I.lanes&c)!==0&&(Bo=!0),I.firstContext=null)}function to(I,c){if(Zu!==I&&c!==!1&&c!==0)if((typeof c!="number"||c===1073741823)&&(Zu=I,c=1073741823),c={context:I,observedBits:c,next:null},fa===null){if(vu===null)throw Error(g(308));fa=c,vu.dependencies={lanes:0,firstContext:c,responders:null}}else fa=fa.next=c;return de?I._currentValue:I._currentValue2}var Ps=!1;function om(I){I.updateQueue={baseState:I.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Oy(I,c){I=I.updateQueue,c.updateQueue===I&&(c.updateQueue={baseState:I.baseState,firstBaseUpdate:I.firstBaseUpdate,lastBaseUpdate:I.lastBaseUpdate,shared:I.shared,effects:I.effects})}function Qs(I,c){return{eventTime:I,lane:c,tag:0,payload:null,callback:null,next:null}}function Os(I,c){if(I=I.updateQueue,I!==null){I=I.shared;var p=I.pending;p===null?c.next=c:(c.next=p.next,p.next=c),I.pending=c}}function jy(I,c){var p=I.updateQueue,v=I.alternate;if(v!==null&&(v=v.updateQueue,p===v)){var w=null,V=null;if(p=p.firstBaseUpdate,p!==null){do{var L={eventTime:p.eventTime,lane:p.lane,tag:p.tag,payload:p.payload,callback:p.callback,next:null};V===null?w=V=L:V=V.next=L,p=p.next}while(p!==null);V===null?w=V=c:V=V.next=c}else w=V=c;p={baseState:v.baseState,firstBaseUpdate:w,lastBaseUpdate:V,shared:v.shared,effects:v.effects},I.updateQueue=p;return}I=p.lastBaseUpdate,I===null?p.firstBaseUpdate=c:I.next=c,p.lastBaseUpdate=c}function yI(I,c,p,v){var w=I.updateQueue;Ps=!1;var V=w.firstBaseUpdate,L=w.lastBaseUpdate,q=w.shared.pending;if(q!==null){w.shared.pending=null;var be=q,Ee=be.next;be.next=null,L===null?V=Ee:L.next=Ee,L=be;var st=I.alternate;if(st!==null){st=st.updateQueue;var ut=st.lastBaseUpdate;ut!==L&&(ut===null?st.firstBaseUpdate=Ee:ut.next=Ee,st.lastBaseUpdate=be)}}if(V!==null){ut=w.baseState,L=0,st=Ee=be=null;do{q=V.lane;var De=V.eventTime;if((v&q)===q){st!==null&&(st=st.next={eventTime:De,lane:0,tag:V.tag,payload:V.payload,callback:V.callback,next:null});e:{var Ut=I,ln=V;switch(q=c,De=p,ln.tag){case 1:if(Ut=ln.payload,typeof Ut=="function"){ut=Ut.call(De,ut,q);break e}ut=Ut;break e;case 3:Ut.flags=Ut.flags&-4097|64;case 0:if(Ut=ln.payload,q=typeof Ut=="function"?Ut.call(De,ut,q):Ut,q==null)break e;ut=o({},ut,q);break e;case 2:Ps=!0}}V.callback!==null&&(I.flags|=32,q=w.effects,q===null?w.effects=[V]:q.push(V))}else De={eventTime:De,lane:q,tag:V.tag,payload:V.payload,callback:V.callback,next:null},st===null?(Ee=st=De,be=ut):st=st.next=De,L|=q;if(V=V.next,V===null){if(q=w.shared.pending,q===null)break;V=q.next,q.next=null,w.lastBaseUpdate=q,w.shared.pending=null}}while(1);st===null&&(be=ut),w.baseState=be,w.firstBaseUpdate=Ee,w.lastBaseUpdate=st,YI|=L,I.lanes=L,I.memoizedState=ut}}function qy(I,c,p){if(I=c.effects,c.effects=null,I!==null)for(c=0;c<I.length;c++){var v=I[c],w=v.callback;if(w!==null){if(v.callback=null,v=p,typeof w!="function")throw Error(g(191,w));w.call(v)}}}var $y=new s.Component().refs;function wu(I,c,p,v){c=I.memoizedState,p=p(v,c),p=p==null?c:o({},c,p),I.memoizedState=p,I.lanes===0&&(I.updateQueue.baseState=p)}var Ru={isMounted:function(I){return(I=I._reactInternals)?k(I)===I:!1},enqueueSetState:function(I,c,p){I=I._reactInternals;var v=Wi(),w=$s(I),V=Qs(v,w);V.payload=c,p!=null&&(V.callback=p),Os(I,V),fs(I,w,v)},enqueueReplaceState:function(I,c,p){I=I._reactInternals;var v=Wi(),w=$s(I),V=Qs(v,w);V.tag=1,V.payload=c,p!=null&&(V.callback=p),Os(I,V),fs(I,w,v)},enqueueForceUpdate:function(I,c){I=I._reactInternals;var p=Wi(),v=$s(I),w=Qs(p,v);w.tag=2,c!=null&&(w.callback=c),Os(I,w),fs(I,v,p)}};function ev(I,c,p,v,w,V,L){return I=I.stateNode,typeof I.shouldComponentUpdate=="function"?I.shouldComponentUpdate(v,V,L):c.prototype&&c.prototype.isPureReactComponent?!Bu(p,v)||!Bu(w,V):!0}function tv(I,c,p){var v=!1,w=Nn,V=c.contextType;return typeof V=="object"&&V!==null?V=to(V):(w=Xn(c)?bo:on.current,v=c.contextTypes,V=(v=v!=null)?dn(I,w):Nn),c=new c(p,V),I.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Ru,I.stateNode=c,c._reactInternals=I,v&&(I=I.stateNode,I.__reactInternalMemoizedUnmaskedChildContext=w,I.__reactInternalMemoizedMaskedChildContext=V),c}function nv(I,c,p,v){I=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(p,v),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(p,v),c.state!==I&&Ru.enqueueReplaceState(c,c.state,null)}function sm(I,c,p,v){var w=I.stateNode;w.props=p,w.state=I.memoizedState,w.refs=$y,om(I);var V=c.contextType;typeof V=="object"&&V!==null?w.context=to(V):(V=Xn(c)?bo:on.current,w.context=dn(I,V)),yI(I,p,w,v),w.state=I.memoizedState,V=c.getDerivedStateFromProps,typeof V=="function"&&(wu(I,c,V,p),w.state=I.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(c=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),c!==w.state&&Ru.enqueueReplaceState(w,w.state,null),yI(I,p,w,v),w.state=I.memoizedState),typeof w.componentDidMount=="function"&&(I.flags|=4)}var Wu=Array.isArray;function vI(I,c,p){if(I=p.ref,I!==null&&typeof I!="function"&&typeof I!="object"){if(p._owner){if(p=p._owner,p){if(p.tag!==1)throw Error(g(309));var v=p.stateNode}if(!v)throw Error(g(147,I));var w=""+I;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===w?c.ref:(c=function(V){var L=v.refs;L===$y&&(L=v.refs={}),V===null?delete L[w]:L[w]=V},c._stringRef=w,c)}if(typeof I!="string")throw Error(g(284));if(!p._owner)throw Error(g(290,I))}return I}function Su(I,c){if(I.type!=="textarea")throw Error(g(31,Object.prototype.toString.call(c)==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":c))}function iv(I){function c(ae,ne){if(I){var Be=ae.lastEffect;Be!==null?(Be.nextEffect=ne,ae.lastEffect=ne):ae.firstEffect=ae.lastEffect=ne,ne.nextEffect=null,ne.flags=8}}function p(ae,ne){if(!I)return null;for(;ne!==null;)c(ae,ne),ne=ne.sibling;return null}function v(ae,ne){for(ae=new Map;ne!==null;)ne.key!==null?ae.set(ne.key,ne):ae.set(ne.index,ne),ne=ne.sibling;return ae}function w(ae,ne){return ae=tr(ae,ne),ae.index=0,ae.sibling=null,ae}function V(ae,ne,Be){return ae.index=Be,I?(Be=ae.alternate,Be!==null?(Be=Be.index,Be<ne?(ae.flags=2,ne):Be):(ae.flags=2,ne)):ne}function L(ae){return I&&ae.alternate===null&&(ae.flags=2),ae}function q(ae,ne,Be,Je){return ne===null||ne.tag!==6?(ne=Um(Be,ae.mode,Je),ne.return=ae,ne):(ne=w(ne,Be),ne.return=ae,ne)}function be(ae,ne,Be,Je){return ne!==null&&ne.elementType===Be.type?(Je=w(ne,Be.props),Je.ref=vI(ae,ne,Be),Je.return=ae,Je):(Je=id(Be.type,Be.key,Be.props,null,ae.mode,Je),Je.ref=vI(ae,ne,Be),Je.return=ae,Je)}function Ee(ae,ne,Be,Je){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==Be.containerInfo||ne.stateNode.implementation!==Be.implementation?(ne=Pm(Be,ae.mode,Je),ne.return=ae,ne):(ne=w(ne,Be.children||[]),ne.return=ae,ne)}function st(ae,ne,Be,Je,rt){return ne===null||ne.tag!==7?(ne=Wa(Be,ae.mode,Je,rt),ne.return=ae,ne):(ne=w(ne,Be),ne.return=ae,ne)}function ut(ae,ne,Be){if(typeof ne=="string"||typeof ne=="number")return ne=Um(""+ne,ae.mode,Be),ne.return=ae,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case l:return Be=id(ne.type,ne.key,ne.props,null,ae.mode,Be),Be.ref=vI(ae,null,ne),Be.return=ae,Be;case u:return ne=Pm(ne,ae.mode,Be),ne.return=ae,ne}if(Wu(ne)||S(ne))return ne=Wa(ne,ae.mode,Be,null),ne.return=ae,ne;Su(ae,ne)}return null}function De(ae,ne,Be,Je){var rt=ne!==null?ne.key:null;if(typeof Be=="string"||typeof Be=="number")return rt!==null?null:q(ae,ne,""+Be,Je);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case l:return Be.key===rt?Be.type===d?st(ae,ne,Be.props.children,Je,rt):be(ae,ne,Be,Je):null;case u:return Be.key===rt?Ee(ae,ne,Be,Je):null}if(Wu(Be)||S(Be))return rt!==null?null:st(ae,ne,Be,Je,null);Su(ae,Be)}return null}function Ut(ae,ne,Be,Je,rt){if(typeof Je=="string"||typeof Je=="number")return ae=ae.get(Be)||null,q(ne,ae,""+Je,rt);if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case l:return ae=ae.get(Je.key===null?Be:Je.key)||null,Je.type===d?st(ne,ae,Je.props.children,rt,Je.key):be(ne,ae,Je,rt);case u:return ae=ae.get(Je.key===null?Be:Je.key)||null,Ee(ne,ae,Je,rt)}if(Wu(Je)||S(Je))return ae=ae.get(Be)||null,st(ne,ae,Je,rt,null);Su(ne,Je)}return null}function ln(ae,ne,Be,Je){for(var rt=null,jt=null,At=ne,Yt=ne=0,Mn=null;At!==null&&Yt<Be.length;Yt++){At.index>Yt?(Mn=At,At=null):Mn=At.sibling;var St=De(ae,At,Be[Yt],Je);if(St===null){At===null&&(At=Mn);break}I&&At&&St.alternate===null&&c(ae,At),ne=V(St,ne,Yt),jt===null?rt=St:jt.sibling=St,jt=St,At=Mn}if(Yt===Be.length)return p(ae,At),rt;if(At===null){for(;Yt<Be.length;Yt++)At=ut(ae,Be[Yt],Je),At!==null&&(ne=V(At,ne,Yt),jt===null?rt=At:jt.sibling=At,jt=At);return rt}for(At=v(ae,At);Yt<Be.length;Yt++)Mn=Ut(At,ae,Yt,Be[Yt],Je),Mn!==null&&(I&&Mn.alternate!==null&&At.delete(Mn.key===null?Yt:Mn.key),ne=V(Mn,ne,Yt),jt===null?rt=Mn:jt.sibling=Mn,jt=Mn);return I&&At.forEach(function(nr){return c(ae,nr)}),rt}function so(ae,ne,Be,Je){var rt=S(Be);if(typeof rt!="function")throw Error(g(150));if(Be=rt.call(Be),Be==null)throw Error(g(151));for(var jt=rt=null,At=ne,Yt=ne=0,Mn=null,St=Be.next();At!==null&&!St.done;Yt++,St=Be.next()){At.index>Yt?(Mn=At,At=null):Mn=At.sibling;var nr=De(ae,At,St.value,Je);if(nr===null){At===null&&(At=Mn);break}I&&At&&nr.alternate===null&&c(ae,At),ne=V(nr,ne,Yt),jt===null?rt=nr:jt.sibling=nr,jt=nr,At=Mn}if(St.done)return p(ae,At),rt;if(At===null){for(;!St.done;Yt++,St=Be.next())St=ut(ae,St.value,Je),St!==null&&(ne=V(St,ne,Yt),jt===null?rt=St:jt.sibling=St,jt=St);return rt}for(At=v(ae,At);!St.done;Yt++,St=Be.next())St=Ut(At,ae,Yt,St.value,Je),St!==null&&(I&&St.alternate!==null&&At.delete(St.key===null?Yt:St.key),ne=V(St,ne,Yt),jt===null?rt=St:jt.sibling=St,jt=St);return I&&At.forEach(function(QM){return c(ae,QM)}),rt}return function(ae,ne,Be,Je){var rt=typeof Be=="object"&&Be!==null&&Be.type===d&&Be.key===null;rt&&(Be=Be.props.children);var jt=typeof Be=="object"&&Be!==null;if(jt)switch(Be.$$typeof){case l:e:{for(jt=Be.key,rt=ne;rt!==null;){if(rt.key===jt){switch(rt.tag){case 7:if(Be.type===d){p(ae,rt.sibling),ne=w(rt,Be.props.children),ne.return=ae,ae=ne;break e}break;default:if(rt.elementType===Be.type){p(ae,rt.sibling),ne=w(rt,Be.props),ne.ref=vI(ae,rt,Be),ne.return=ae,ae=ne;break e}}p(ae,rt);break}else c(ae,rt);rt=rt.sibling}Be.type===d?(ne=Wa(Be.props.children,ae.mode,Je,Be.key),ne.return=ae,ae=ne):(Je=id(Be.type,Be.key,Be.props,null,ae.mode,Je),Je.ref=vI(ae,ne,Be),Je.return=ae,ae=Je)}return L(ae);case u:e:{for(rt=Be.key;ne!==null;){if(ne.key===rt)if(ne.tag===4&&ne.stateNode.containerInfo===Be.containerInfo&&ne.stateNode.implementation===Be.implementation){p(ae,ne.sibling),ne=w(ne,Be.children||[]),ne.return=ae,ae=ne;break e}else{p(ae,ne);break}else c(ae,ne);ne=ne.sibling}ne=Pm(Be,ae.mode,Je),ne.return=ae,ae=ne}return L(ae)}if(typeof Be=="string"||typeof Be=="number")return Be=""+Be,ne!==null&&ne.tag===6?(p(ae,ne.sibling),ne=w(ne,Be),ne.return=ae,ae=ne):(p(ae,ne),ne=Um(Be,ae.mode,Je),ne.return=ae,ae=ne),L(ae);if(Wu(Be))return ln(ae,ne,Be,Je);if(S(Be))return so(ae,ne,Be,Je);if(jt&&Su(ae,Be),typeof Be=="undefined"&&!rt)switch(ae.tag){case 1:case 22:case 0:case 11:case 15:throw Error(g(152,H(ae.type)||"Component"))}return p(ae,ne)}}var Vu=iv(!0),ov=iv(!1),ZI={},no=Bt(ZI),wI=Bt(ZI),Ga=Bt(ZI);function Lo(I){if(I===ZI)throw Error(g(174));return I}function rm(I,c){pt(Ga,c),pt(wI,I),pt(no,ZI),I=Ie(c),Xt(no),pt(no,I)}function Ba(){Xt(no),Xt(wI),Xt(Ga)}function sv(I){var c=Lo(Ga.current),p=Lo(no.current);c=T(p,I.type,c),p!==c&&(pt(wI,I),pt(no,c))}function gm(I){wI.current===I&&(Xt(no),Xt(wI))}var mn=Bt(0);function xu(I){for(var c=I;c!==null;){if(c.tag===13){var p=c.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||fe(p)||ue(p)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&64)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===I)break;for(;c.sibling===null;){if(c.return===null||c.return===I)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var As=null,rg=null,zo=!1;function rv(I,c){var p=oo(5,null,null,0);p.elementType="DELETED",p.type="DELETED",p.stateNode=c,p.return=I,p.flags=8,I.lastEffect!==null?(I.lastEffect.nextEffect=p,I.lastEffect=p):I.firstEffect=I.lastEffect=p}function gv(I,c){switch(I.tag){case 5:return c=N(c,I.type,I.pendingProps),c!==null?(I.stateNode=c,!0):!1;case 6:return c=le(c,I.pendingProps),c!==null?(I.stateNode=c,!0):!1;case 13:return!1;default:return!1}}function am(I){if(zo){var c=rg;if(c){var p=c;if(!gv(I,c)){if(c=We(p),!c||!gv(I,c)){I.flags=I.flags&-1025|2,zo=!1,As=I;return}rv(As,p)}As=I,rg=Ct(c)}else I.flags=I.flags&-1025|2,zo=!1,As=I}}function av(I){for(I=I.return;I!==null&&I.tag!==5&&I.tag!==3&&I.tag!==13;)I=I.return;As=I}function Hu(I){if(!xe||I!==As)return!1;if(!zo)return av(I),zo=!0,!1;var c=I.type;if(I.tag!==5||c!=="head"&&c!=="body"&&!ye(c,I.memoizedProps))for(c=rg;c;)rv(I,c),c=We(c);if(av(I),I.tag===13){if(!xe)throw Error(g(316));if(I=I.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(g(317));rg=mt(I)}else rg=As?We(I.stateNode):null;return!0}function lm(){xe&&(rg=As=null,zo=!1)}var ya=[];function Im(){for(var I=0;I<ya.length;I++){var c=ya[I];de?c._workInProgressVersionPrimary=null:c._workInProgressVersionSecondary=null}ya.length=0}var RI=a.ReactCurrentDispatcher,io=a.ReactCurrentBatchConfig,WI=0,yn=null,ri=null,On=null,Xu=!1,SI=!1;function wi(){throw Error(g(321))}function cm(I,c){if(c===null)return!1;for(var p=0;p<c.length&&p<I.length;p++)if(!eo(I[p],c[p]))return!1;return!0}function Cm(I,c,p,v,w,V){if(WI=V,yn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,RI.current=I===null||I.memoizedState===null?BM:yM,I=p(v,w),SI){V=0;do{if(SI=!1,!(25>V))throw Error(g(301));V+=1,On=ri=null,c.updateQueue=null,RI.current=vM,I=p(v,w)}while(SI)}if(RI.current=Yu,c=ri!==null&&ri.next!==null,WI=0,On=ri=yn=null,Xu=!1,c)throw Error(g(300));return I}function gg(){var I={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return On===null?yn.memoizedState=On=I:On=On.next=I,On}function ag(){if(ri===null){var I=yn.alternate;I=I!==null?I.memoizedState:null}else I=ri.next;var c=On===null?yn.memoizedState:On.next;if(c!==null)On=c,ri=I;else{if(I===null)throw Error(g(310));ri=I,I={memoizedState:ri.memoizedState,baseState:ri.baseState,baseQueue:ri.baseQueue,queue:ri.queue,next:null},On===null?yn.memoizedState=On=I:On=On.next=I}return On}function ko(I,c){return typeof c=="function"?c(I):c}function VI(I){var c=ag(),p=c.queue;if(p===null)throw Error(g(311));p.lastRenderedReducer=I;var v=ri,w=v.baseQueue,V=p.pending;if(V!==null){if(w!==null){var L=w.next;w.next=V.next,V.next=L}v.baseQueue=w=V,p.pending=null}if(w!==null){w=w.next,v=v.baseState;var q=L=V=null,be=w;do{var Ee=be.lane;if((WI&Ee)===Ee)q!==null&&(q=q.next={lane:0,action:be.action,eagerReducer:be.eagerReducer,eagerState:be.eagerState,next:null}),v=be.eagerReducer===I?be.eagerState:I(v,be.action);else{var st={lane:Ee,action:be.action,eagerReducer:be.eagerReducer,eagerState:be.eagerState,next:null};q===null?(L=q=st,V=v):q=q.next=st,yn.lanes|=Ee,YI|=Ee}be=be.next}while(be!==null&&be!==w);q===null?V=v:q.next=L,eo(v,c.memoizedState)||(Bo=!0),c.memoizedState=v,c.baseState=V,c.baseQueue=q,p.lastRenderedState=v}return[c.memoizedState,p.dispatch]}function xI(I){var c=ag(),p=c.queue;if(p===null)throw Error(g(311));p.lastRenderedReducer=I;var v=p.dispatch,w=p.pending,V=c.memoizedState;if(w!==null){p.pending=null;var L=w=w.next;do V=I(V,L.action),L=L.next;while(L!==w);eo(V,c.memoizedState)||(Bo=!0),c.memoizedState=V,c.baseQueue===null&&(c.baseState=V),p.lastRenderedState=V}return[V,v]}function lv(I,c,p){var v=c._getVersion;v=v(c._source);var w=de?c._workInProgressVersionPrimary:c._workInProgressVersionSecondary;if(w!==null?I=w===v:(I=I.mutableReadLanes,(I=(WI&I)===I)&&(de?c._workInProgressVersionPrimary=v:c._workInProgressVersionSecondary=v,ya.push(c))),I)return p(c._source);throw ya.push(c),Error(g(350))}function Iv(I,c,p,v){var w=fi;if(w===null)throw Error(g(349));var V=c._getVersion,L=V(c._source),q=RI.current,be=q.useState(function(){return lv(w,c,p)}),Ee=be[1],st=be[0];be=On;var ut=I.memoizedState,De=ut.refs,Ut=De.getSnapshot,ln=ut.source;ut=ut.subscribe;var so=yn;return I.memoizedState={refs:De,source:c,subscribe:v},q.useEffect(function(){De.getSnapshot=p,De.setSnapshot=Ee;var ae=V(c._source);if(!eo(L,ae)){ae=p(c._source),eo(st,ae)||(Ee(ae),ae=$s(so),w.mutableReadLanes|=ae&w.pendingLanes),ae=w.mutableReadLanes,w.entangledLanes|=ae;for(var ne=w.entanglements,Be=ae;0<Be;){var Je=31-Us(Be),rt=1<<Je;ne[Je]|=ae,Be&=~rt}}},[p,c,v]),q.useEffect(function(){return v(c._source,function(){var ae=De.getSnapshot,ne=De.setSnapshot;try{ne(ae(c._source));var Be=$s(so);w.mutableReadLanes|=Be&w.pendingLanes}catch(Je){ne(function(){throw Je})}})},[c,v]),eo(Ut,p)&&eo(ln,c)&&eo(ut,v)||(I={pending:null,dispatch:null,lastRenderedReducer:ko,lastRenderedState:st},I.dispatch=Ee=hm.bind(null,yn,I),be.queue=I,be.baseQueue=null,st=lv(w,c,p),be.memoizedState=be.baseState=st),st}function cv(I,c,p){var v=ag();return Iv(v,I,c,p)}function HI(I){var c=gg();return typeof I=="function"&&(I=I()),c.memoizedState=c.baseState=I,I=c.queue={pending:null,dispatch:null,lastRenderedReducer:ko,lastRenderedState:I},I=I.dispatch=hm.bind(null,yn,I),[c.memoizedState,I]}function Mu(I,c,p,v){return I={tag:I,create:c,destroy:p,deps:v,next:null},c=yn.updateQueue,c===null?(c={lastEffect:null},yn.updateQueue=c,c.lastEffect=I.next=I):(p=c.lastEffect,p===null?c.lastEffect=I.next=I:(v=p.next,p.next=I,I.next=v,c.lastEffect=I)),I}function Cv(I){var c=gg();return I={current:I},c.memoizedState=I}function Ku(){return ag().memoizedState}function um(I,c,p,v){var w=gg();yn.flags|=I,w.memoizedState=Mu(1|c,p,void 0,v===void 0?null:v)}function dm(I,c,p,v){var w=ag();v=v===void 0?null:v;var V=void 0;if(ri!==null){var L=ri.memoizedState;if(V=L.destroy,v!==null&&cm(v,L.deps)){Mu(c,p,V,v);return}}yn.flags|=I,w.memoizedState=Mu(1|c,p,V,v)}function uv(I,c){return um(516,4,I,c)}function Fu(I,c){return dm(516,4,I,c)}function dv(I,c){return dm(4,2,I,c)}function Av(I,c){if(typeof c=="function")return I=I(),c(I),function(){c(null)};if(c!=null)return I=I(),c.current=I,function(){c.current=null}}function hv(I,c,p){return p=p!=null?p.concat([I]):null,dm(4,2,Av.bind(null,c,I),p)}function Am(){}function pv(I,c){var p=ag();c=c===void 0?null:c;var v=p.memoizedState;return v!==null&&c!==null&&cm(c,v[1])?v[0]:(p.memoizedState=[I,c],I)}function mv(I,c){var p=ag();c=c===void 0?null:c;var v=p.memoizedState;return v!==null&&c!==null&&cm(c,v[1])?v[0]:(I=I(),p.memoizedState=[I,c],I)}function GM(I,c){var p=ma();ds(98>p?98:p,function(){I(!0)}),ds(97<p?97:p,function(){var v=io.transition;io.transition=1;try{I(!1),c()}finally{io.transition=v}})}function hm(I,c,p){var v=Wi(),w=$s(I),V={lane:w,action:p,eagerReducer:null,eagerState:null,next:null},L=c.pending;if(L===null?V.next=V:(V.next=L.next,L.next=V),c.pending=V,L=I.alternate,I===yn||L!==null&&L===yn)SI=Xu=!0;else{if(I.lanes===0&&(L===null||L.lanes===0)&&(L=c.lastRenderedReducer,L!==null))try{var q=c.lastRenderedState,be=L(q,p);if(V.eagerReducer=L,V.eagerState=be,eo(be,q))return}catch{}finally{}fs(I,w,v)}}var Yu={readContext:to,useCallback:wi,useContext:wi,useEffect:wi,useImperativeHandle:wi,useLayoutEffect:wi,useMemo:wi,useReducer:wi,useRef:wi,useState:wi,useDebugValue:wi,useDeferredValue:wi,useTransition:wi,useMutableSource:wi,useOpaqueIdentifier:wi,unstable_isNewReconciler:!1},BM={readContext:to,useCallback:function(I,c){return gg().memoizedState=[I,c===void 0?null:c],I},useContext:to,useEffect:uv,useImperativeHandle:function(I,c,p){return p=p!=null?p.concat([I]):null,um(4,2,Av.bind(null,c,I),p)},useLayoutEffect:function(I,c){return um(4,2,I,c)},useMemo:function(I,c){var p=gg();return c=c===void 0?null:c,I=I(),p.memoizedState=[I,c],I},useReducer:function(I,c,p){var v=gg();return c=p!==void 0?p(c):c,v.memoizedState=v.baseState=c,I=v.queue={pending:null,dispatch:null,lastRenderedReducer:I,lastRenderedState:c},I=I.dispatch=hm.bind(null,yn,I),[v.memoizedState,I]},useRef:Cv,useState:HI,useDebugValue:Am,useDeferredValue:function(I){var c=HI(I),p=c[0],v=c[1];return uv(function(){var w=io.transition;io.transition=1;try{v(I)}finally{io.transition=w}},[I]),p},useTransition:function(){var I=HI(!1),c=I[0];return I=GM.bind(null,I[1]),Cv(I),[I,c]},useMutableSource:function(I,c,p){var v=gg();return v.memoizedState={refs:{getSnapshot:c,setSnapshot:null},source:I,subscribe:p},Iv(v,I,c,p)},useOpaqueIdentifier:function(){if(zo){var I=!1,c=Ue(function(){throw I||(I=!0,p(nt())),Error(g(355))}),p=HI(c)[1];return(yn.mode&2)===0&&(yn.flags|=516,Mu(5,function(){p(nt())},void 0,null)),c}return c=nt(),HI(c),c},unstable_isNewReconciler:!1},yM={readContext:to,useCallback:pv,useContext:to,useEffect:Fu,useImperativeHandle:hv,useLayoutEffect:dv,useMemo:mv,useReducer:VI,useRef:Ku,useState:function(){return VI(ko)},useDebugValue:Am,useDeferredValue:function(I){var c=VI(ko),p=c[0],v=c[1];return Fu(function(){var w=io.transition;io.transition=1;try{v(I)}finally{io.transition=w}},[I]),p},useTransition:function(){var I=VI(ko)[0];return[Ku().current,I]},useMutableSource:cv,useOpaqueIdentifier:function(){return VI(ko)[0]},unstable_isNewReconciler:!1},vM={readContext:to,useCallback:pv,useContext:to,useEffect:Fu,useImperativeHandle:hv,useLayoutEffect:dv,useMemo:mv,useReducer:xI,useRef:Ku,useState:function(){return xI(ko)},useDebugValue:Am,useDeferredValue:function(I){var c=xI(ko),p=c[0],v=c[1];return Fu(function(){var w=io.transition;io.transition=1;try{v(I)}finally{io.transition=w}},[I]),p},useTransition:function(){var I=xI(ko)[0];return[Ku().current,I]},useMutableSource:cv,useOpaqueIdentifier:function(){return xI(ko)[0]},unstable_isNewReconciler:!1},ZM=a.ReactCurrentOwner,Bo=!1;function Ri(I,c,p,v){c.child=I===null?ov(c,null,p,v):Vu(c,I.child,p,v)}function fv(I,c,p,v,w){p=p.render;var V=c.ref;return ba(c,w),v=Cm(I,c,p,v,V,w),I!==null&&!Bo?(c.updateQueue=I.updateQueue,c.flags&=-517,I.lanes&=~w,hs(I,c,w)):(c.flags|=1,Ri(I,c,v,w),c.child)}function bv(I,c,p,v,w,V){if(I===null){var L=p.type;return typeof L=="function"&&!Jm(L)&&L.defaultProps===void 0&&p.compare===null&&p.defaultProps===void 0?(c.tag=15,c.type=L,Gv(I,c,L,v,w,V)):(I=id(p.type,null,v,c,c.mode,V),I.ref=c.ref,I.return=c,c.child=I)}return L=I.child,(w&V)===0&&(w=L.memoizedProps,p=p.compare,p=p!==null?p:Bu,p(w,v)&&I.ref===c.ref)?hs(I,c,V):(c.flags|=1,I=tr(L,v),I.ref=c.ref,I.return=c,c.child=I)}function Gv(I,c,p,v,w,V){if(I!==null&&Bu(I.memoizedProps,v)&&I.ref===c.ref)if(Bo=!1,(V&w)!==0)(I.flags&16384)!==0&&(Bo=!0);else return c.lanes=I.lanes,hs(I,c,V);return mm(I,c,p,v,V)}function pm(I,c,p){var v=c.pendingProps,w=v.children,V=I!==null?I.memoizedState:null;if(v.mode==="hidden"||v.mode==="unstable-defer-without-hiding")if((c.mode&4)===0)c.memoizedState={baseLanes:0},ed(c,p);else if((p&1073741824)!==0)c.memoizedState={baseLanes:0},ed(c,V!==null?V.baseLanes:p);else return I=V!==null?V.baseLanes|p:p,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:I},ed(c,I),null;else V!==null?(v=V.baseLanes|p,c.memoizedState=null):v=p,ed(c,v);return Ri(I,c,w,p),c.child}function Bv(I,c){var p=c.ref;(I===null&&p!==null||I!==null&&I.ref!==p)&&(c.flags|=128)}function mm(I,c,p,v,w){var V=Xn(p)?bo:on.current;return V=dn(c,V),ba(c,w),p=Cm(I,c,p,v,V,w),I!==null&&!Bo?(c.updateQueue=I.updateQueue,c.flags&=-517,I.lanes&=~w,hs(I,c,w)):(c.flags|=1,Ri(I,c,p,w),c.child)}function yv(I,c,p,v,w){if(Xn(p)){var V=!0;hu(c)}else V=!1;if(ba(c,w),c.stateNode===null)I!==null&&(I.alternate=null,c.alternate=null,c.flags|=2),tv(c,p,v),sm(c,p,v,w),v=!0;else if(I===null){var L=c.stateNode,q=c.memoizedProps;L.props=q;var be=L.context,Ee=p.contextType;typeof Ee=="object"&&Ee!==null?Ee=to(Ee):(Ee=Xn(p)?bo:on.current,Ee=dn(c,Ee));var st=p.getDerivedStateFromProps,ut=typeof st=="function"||typeof L.getSnapshotBeforeUpdate=="function";ut||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(q!==v||be!==Ee)&&nv(c,L,v,Ee),Ps=!1;var De=c.memoizedState;L.state=De,yI(c,v,L,w),be=c.memoizedState,q!==v||De!==be||Hn.current||Ps?(typeof st=="function"&&(wu(c,p,st,v),be=c.memoizedState),(q=Ps||ev(c,p,q,v,De,be,Ee))?(ut||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(c.flags|=4)):(typeof L.componentDidMount=="function"&&(c.flags|=4),c.memoizedProps=v,c.memoizedState=be),L.props=v,L.state=be,L.context=Ee,v=q):(typeof L.componentDidMount=="function"&&(c.flags|=4),v=!1)}else{L=c.stateNode,Oy(I,c),q=c.memoizedProps,Ee=c.type===c.elementType?q:Go(c.type,q),L.props=Ee,ut=c.pendingProps,De=L.context,be=p.contextType,typeof be=="object"&&be!==null?be=to(be):(be=Xn(p)?bo:on.current,be=dn(c,be));var Ut=p.getDerivedStateFromProps;(st=typeof Ut=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(q!==ut||De!==be)&&nv(c,L,v,be),Ps=!1,De=c.memoizedState,L.state=De,yI(c,v,L,w);var ln=c.memoizedState;q!==ut||De!==ln||Hn.current||Ps?(typeof Ut=="function"&&(wu(c,p,Ut,v),ln=c.memoizedState),(Ee=Ps||ev(c,p,Ee,v,De,ln,be))?(st||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(v,ln,be),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(v,ln,be)),typeof L.componentDidUpdate=="function"&&(c.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(c.flags|=256)):(typeof L.componentDidUpdate!="function"||q===I.memoizedProps&&De===I.memoizedState||(c.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||q===I.memoizedProps&&De===I.memoizedState||(c.flags|=256),c.memoizedProps=v,c.memoizedState=ln),L.props=v,L.state=ln,L.context=be,v=Ee):(typeof L.componentDidUpdate!="function"||q===I.memoizedProps&&De===I.memoizedState||(c.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||q===I.memoizedProps&&De===I.memoizedState||(c.flags|=256),v=!1)}return fm(I,c,p,v,V,w)}function fm(I,c,p,v,w,V){Bv(I,c);var L=(c.flags&64)!==0;if(!v&&!L)return w&&Ny(c,p,!1),hs(I,c,V);v=c.stateNode,ZM.current=c;var q=L&&typeof p.getDerivedStateFromError!="function"?null:v.render();return c.flags|=1,I!==null&&L?(c.child=Vu(c,I.child,null,V),c.child=Vu(c,null,q,V)):Ri(I,c,q,V),c.memoizedState=v.state,w&&Ny(c,p,!0),c.child}function vv(I){var c=I.stateNode;c.pendingContext?Zi(I,c.pendingContext,c.pendingContext!==c.context):c.context&&Zi(I,c.context,!1),rm(I,c.containerInfo)}var Nu={dehydrated:null,retryLane:0};function Zv(I,c,p){var v=c.pendingProps,w=mn.current,V=!1,L;return(L=(c.flags&64)!==0)||(L=I!==null&&I.memoizedState===null?!1:(w&2)!==0),L?(V=!0,c.flags&=-65):I!==null&&I.memoizedState===null||v.fallback===void 0||v.unstable_avoidThisFallback===!0||(w|=1),pt(mn,w&1),I===null?(v.fallback!==void 0&&am(c),I=v.children,w=v.fallback,V?(I=wv(c,I,w,p),c.child.memoizedState={baseLanes:p},c.memoizedState=Nu,I):typeof v.unstable_expectedLoadTime=="number"?(I=wv(c,I,w,p),c.child.memoizedState={baseLanes:p},c.memoizedState=Nu,c.lanes=33554432,I):(p=Dm({mode:"visible",children:I},c.mode,p,null),p.return=c,c.child=p)):I.memoizedState!==null?V?(v=Wv(I,c,v.children,v.fallback,p),V=c.child,w=I.child.memoizedState,V.memoizedState=w===null?{baseLanes:p}:{baseLanes:w.baseLanes|p},V.childLanes=I.childLanes&~p,c.memoizedState=Nu,v):(p=Rv(I,c,v.children,p),c.memoizedState=null,p):V?(v=Wv(I,c,v.children,v.fallback,p),V=c.child,w=I.child.memoizedState,V.memoizedState=w===null?{baseLanes:p}:{baseLanes:w.baseLanes|p},V.childLanes=I.childLanes&~p,c.memoizedState=Nu,v):(p=Rv(I,c,v.children,p),c.memoizedState=null,p)}function wv(I,c,p,v){var w=I.mode,V=I.child;return c={mode:"hidden",children:c},(w&2)===0&&V!==null?(V.childLanes=0,V.pendingProps=c):V=Dm(c,w,0,null),p=Wa(p,w,v,null),V.return=I,p.return=I,V.sibling=p,I.child=V,p}function Rv(I,c,p,v){var w=I.child;return I=w.sibling,p=tr(w,{mode:"visible",children:p}),(c.mode&2)===0&&(p.lanes=v),p.return=c,p.sibling=null,I!==null&&(I.nextEffect=null,I.flags=8,c.firstEffect=c.lastEffect=I),c.child=p}function Wv(I,c,p,v,w){var V=c.mode,L=I.child;I=L.sibling;var q={mode:"hidden",children:p};return(V&2)===0&&c.child!==L?(p=c.child,p.childLanes=0,p.pendingProps=q,L=p.lastEffect,L!==null?(c.firstEffect=p.firstEffect,c.lastEffect=L,L.nextEffect=null):c.firstEffect=c.lastEffect=null):p=tr(L,q),I!==null?v=tr(I,v):(v=Wa(v,V,w,null),v.flags|=2),v.return=c,p.return=c,p.sibling=v,c.child=p,v}function Sv(I,c){I.lanes|=c;var p=I.alternate;p!==null&&(p.lanes|=c),Qy(I.return,c)}function bm(I,c,p,v,w,V){var L=I.memoizedState;L===null?I.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:v,tail:p,tailMode:w,lastEffect:V}:(L.isBackwards=c,L.rendering=null,L.renderingStartTime=0,L.last=v,L.tail=p,L.tailMode=w,L.lastEffect=V)}function Vv(I,c,p){var v=c.pendingProps,w=v.revealOrder,V=v.tail;if(Ri(I,c,v.children,p),v=mn.current,(v&2)!==0)v=v&1|2,c.flags|=64;else{if(I!==null&&(I.flags&64)!==0)e:for(I=c.child;I!==null;){if(I.tag===13)I.memoizedState!==null&&Sv(I,p);else if(I.tag===19)Sv(I,p);else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===c)break e;for(;I.sibling===null;){if(I.return===null||I.return===c)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}v&=1}if(pt(mn,v),(c.mode&2)===0)c.memoizedState=null;else switch(w){case"forwards":for(p=c.child,w=null;p!==null;)I=p.alternate,I!==null&&xu(I)===null&&(w=p),p=p.sibling;p=w,p===null?(w=c.child,c.child=null):(w=p.sibling,p.sibling=null),bm(c,!1,w,p,V,c.lastEffect);break;case"backwards":for(p=null,w=c.child,c.child=null;w!==null;){if(I=w.alternate,I!==null&&xu(I)===null){c.child=w;break}I=w.sibling,w.sibling=p,p=w,w=I}bm(c,!0,p,null,V,c.lastEffect);break;case"together":bm(c,!1,null,null,void 0,c.lastEffect);break;default:c.memoizedState=null}return c.child}function hs(I,c,p){if(I!==null&&(c.dependencies=I.dependencies),YI|=c.lanes,(p&c.childLanes)!==0){if(I!==null&&c.child!==I.child)throw Error(g(153));if(c.child!==null){for(I=c.child,p=tr(I,I.pendingProps),c.child=p,p.return=c;I.sibling!==null;)I=I.sibling,p=p.sibling=tr(I,I.pendingProps),p.return=c;p.sibling=null}return c.child}return null}function To(I){I.flags|=4}var XI,MI,Lu,zu;if(Ge)XI=function(I,c){for(var p=c.child;p!==null;){if(p.tag===5||p.tag===6)ee(I,p.stateNode);else if(p.tag!==4&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return;p=p.return}p.sibling.return=p.return,p=p.sibling}},MI=function(){},Lu=function(I,c,p,v,w){if(I=I.memoizedProps,I!==v){var V=c.stateNode,L=Lo(no.current);p=Ae(V,p,I,v,w,L),(c.updateQueue=p)&&To(c)}},zu=function(I,c,p,v){p!==v&&To(c)};else if(Ve){XI=function(I,c,p,v){for(var w=c.child;w!==null;){if(w.tag===5){var V=w.stateNode;p&&v&&(V=Cs(V,w.type,w.memoizedProps,w)),ee(I,V)}else if(w.tag===6)V=w.stateNode,p&&v&&(V=Yo(V,w.memoizedProps,w)),ee(I,V);else if(w.tag!==4){if(w.tag===13&&(w.flags&4)!==0&&(V=w.memoizedState!==null)){var L=w.child;if(L!==null&&(L.child!==null&&(L.child.return=L,XI(I,L,!0,V)),V=L.sibling,V!==null)){V.return=w,w=V;continue}}if(w.child!==null){w.child.return=w,w=w.child;continue}}if(w===c)break;for(;w.sibling===null;){if(w.return===null||w.return===c)return;w=w.return}w.sibling.return=w.return,w=w.sibling}};var xv=function(I,c,p,v){for(var w=c.child;w!==null;){if(w.tag===5){var V=w.stateNode;p&&v&&(V=Cs(V,w.type,w.memoizedProps,w)),Yn(I,V)}else if(w.tag===6)V=w.stateNode,p&&v&&(V=Yo(V,w.memoizedProps,w)),Yn(I,V);else if(w.tag!==4){if(w.tag===13&&(w.flags&4)!==0&&(V=w.memoizedState!==null)){var L=w.child;if(L!==null&&(L.child!==null&&(L.child.return=L,xv(I,L,!0,V)),V=L.sibling,V!==null)){V.return=w,w=V;continue}}if(w.child!==null){w.child.return=w,w=w.child;continue}}if(w===c)break;for(;w.sibling===null;){if(w.return===null||w.return===c)return;w=w.return}w.sibling.return=w.return,w=w.sibling}};MI=function(I){var c=I.stateNode;if(I.firstEffect!==null){var p=c.containerInfo,v=un(p);xv(v,I,!1,!1),c.pendingChildren=v,To(I),si(p,v)}},Lu=function(I,c,p,v,w){var V=I.stateNode,L=I.memoizedProps;if((I=c.firstEffect===null)&&L===v)c.stateNode=V;else{var q=c.stateNode,be=Lo(no.current),Ee=null;L!==v&&(Ee=Ae(q,p,L,v,w,be)),I&&Ee===null?c.stateNode=V:(V=Bn(V,Ee,p,L,v,c,I,q),_(V,p,v,w,be)&&To(c),c.stateNode=V,I?To(c):XI(V,c,!1,!1))}},zu=function(I,c,p,v){p!==v?(I=Lo(Ga.current),p=Lo(no.current),c.stateNode=ge(v,I,p,c),To(c)):c.stateNode=I.stateNode}}else MI=function(){},Lu=function(){},zu=function(){};function KI(I,c){if(!zo)switch(I.tailMode){case"hidden":c=I.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?I.tail=null:p.sibling=null;break;case"collapsed":p=I.tail;for(var v=null;p!==null;)p.alternate!==null&&(v=p),p=p.sibling;v===null?c||I.tail===null?I.tail=null:I.tail.sibling=null:v.sibling=null}}function wM(I,c,p){var v=c.pendingProps;switch(c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Xn(c.type)&&Ds(),null;case 3:return Ba(),Xt(Hn),Xt(on),Im(),v=c.stateNode,v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(I===null||I.child===null)&&(Hu(c)?To(c):v.hydrate||(c.flags|=256)),MI(c),null;case 5:gm(c);var w=Lo(Ga.current);if(p=c.type,I!==null&&c.stateNode!=null)Lu(I,c,p,v,w),I.ref!==c.ref&&(c.flags|=128);else{if(!v){if(c.stateNode===null)throw Error(g(166));return null}if(I=Lo(no.current),Hu(c)){if(!xe)throw Error(g(175));I=ht(c.stateNode,c.type,c.memoizedProps,w,I,c),c.updateQueue=I,I!==null&&To(c)}else{var V=Me(p,v,w,I,c);XI(V,c,!1,!1),c.stateNode=V,_(V,p,v,w,I)&&To(c)}c.ref!==null&&(c.flags|=128)}return null;case 6:if(I&&c.stateNode!=null)zu(I,c,I.memoizedProps,v);else{if(typeof v!="string"&&c.stateNode===null)throw Error(g(166));if(I=Lo(Ga.current),w=Lo(no.current),Hu(c)){if(!xe)throw Error(g(176));ft(c.stateNode,c.memoizedProps,c)&&To(c)}else c.stateNode=ge(v,I,w,c)}return null;case 13:return Xt(mn),v=c.memoizedState,(c.flags&64)!==0?(c.lanes=p,c):(v=v!==null,w=!1,I===null?c.memoizedProps.fallback!==void 0&&Hu(c):w=I.memoizedState!==null,v&&!w&&(c.mode&2)!==0&&(I===null&&c.memoizedProps.unstable_avoidThisFallback!==!0||(mn.current&1)!==0?jn===0&&(jn=3):((jn===0||jn===3)&&(jn=4),fi===null||(YI&134217727)===0&&(Za&134217727)===0||wa(fi,gi))),Ve&&v&&(c.flags|=4),Ge&&(v||w)&&(c.flags|=4),null);case 4:return Ba(),MI(c),I===null&&M(c.stateNode.containerInfo),null;case 10:return im(c),null;case 17:return Xn(c.type)&&Ds(),null;case 19:if(Xt(mn),v=c.memoizedState,v===null)return null;if(w=(c.flags&64)!==0,V=v.rendering,V===null)if(w)KI(v,!1);else{if(jn!==0||I!==null&&(I.flags&64)!==0)for(I=c.child;I!==null;){if(V=xu(I),V!==null){for(c.flags|=64,KI(v,!1),I=V.updateQueue,I!==null&&(c.updateQueue=I,c.flags|=4),v.lastEffect===null&&(c.firstEffect=null),c.lastEffect=v.lastEffect,I=p,v=c.child;v!==null;)w=v,p=I,w.flags&=2,w.nextEffect=null,w.firstEffect=null,w.lastEffect=null,V=w.alternate,V===null?(w.childLanes=0,w.lanes=p,w.child=null,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=V.childLanes,w.lanes=V.lanes,w.child=V.child,w.memoizedProps=V.memoizedProps,w.memoizedState=V.memoizedState,w.updateQueue=V.updateQueue,w.type=V.type,p=V.dependencies,w.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),v=v.sibling;return pt(mn,mn.current&1|2),c.child}I=I.sibling}v.tail!==null&&Qn()>Fm&&(c.flags|=64,w=!0,KI(v,!1),c.lanes=33554432)}else{if(!w)if(I=xu(V),I!==null){if(c.flags|=64,w=!0,I=I.updateQueue,I!==null&&(c.updateQueue=I,c.flags|=4),KI(v,!0),v.tail===null&&v.tailMode==="hidden"&&!V.alternate&&!zo)return c=c.lastEffect=v.lastEffect,c!==null&&(c.nextEffect=null),null}else 2*Qn()-v.renderingStartTime>Fm&&p!==1073741824&&(c.flags|=64,w=!0,KI(v,!1),c.lanes=33554432);v.isBackwards?(V.sibling=c.child,c.child=V):(I=v.last,I!==null?I.sibling=V:c.child=V,v.last=V)}return v.tail!==null?(I=v.tail,v.rendering=I,v.tail=I.sibling,v.lastEffect=c.lastEffect,v.renderingStartTime=Qn(),I.sibling=null,c=mn.current,pt(mn,w?c&1|2:c&1),I):null;case 23:case 24:return Tm(),I!==null&&I.memoizedState!==null!=(c.memoizedState!==null)&&v.mode!=="unstable-defer-without-hiding"&&(c.flags|=4),null}throw Error(g(156,c.tag))}function RM(I){switch(I.tag){case 1:Xn(I.type)&&Ds();var c=I.flags;return c&4096?(I.flags=c&-4097|64,I):null;case 3:if(Ba(),Xt(Hn),Xt(on),Im(),c=I.flags,(c&64)!==0)throw Error(g(285));return I.flags=c&-4097|64,I;case 5:return gm(I),null;case 13:return Xt(mn),c=I.flags,c&4096?(I.flags=c&-4097|64,I):null;case 19:return Xt(mn),null;case 4:return Ba(),null;case 10:return im(I),null;case 23:case 24:return Tm(),null;default:return null}}function Gm(I,c){try{var p="",v=c;do p+=bM(v),v=v.return;while(v);var w=p}catch(V){w=`
Error generating stack: `+V.message+`
`+V.stack}return{value:I,source:c,stack:w}}function Bm(I,c){try{console.error(c.value)}catch(p){setTimeout(function(){throw p})}}var WM=typeof WeakMap=="function"?WeakMap:Map;function Hv(I,c,p){p=Qs(-1,p),p.tag=3,p.payload={element:null};var v=c.value;return p.callback=function(){Ou||(Ou=!0,Ym=v),Bm(I,c)},p}function Xv(I,c,p){p=Qs(-1,p),p.tag=3;var v=I.type.getDerivedStateFromError;if(typeof v=="function"){var w=c.value;p.payload=function(){return Bm(I,c),v(w)}}var V=I.stateNode;return V!==null&&typeof V.componentDidCatch=="function"&&(p.callback=function(){typeof v!="function"&&(Eo===null?Eo=new Set([this]):Eo.add(this),Bm(I,c));var L=c.stack;this.componentDidCatch(c.value,{componentStack:L!==null?L:""})}),p}var SM=typeof WeakSet=="function"?WeakSet:Set;function Mv(I){var c=I.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(p){er(I,p)}else c.current=null}function VM(I,c){switch(c.tag){case 0:case 11:case 15:case 22:return;case 1:if(c.flags&256&&I!==null){var p=I.memoizedProps,v=I.memoizedState;I=c.stateNode,c=I.getSnapshotBeforeUpdate(c.elementType===c.type?p:Go(c.type,p),v),I.__reactInternalSnapshotBeforeUpdate=c}return;case 3:Ge&&c.flags&256&&Ft(c.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(g(163))}function Kv(I,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var p=c=c.next;do{if((p.tag&I)===I){var v=p.destroy;p.destroy=void 0,v!==void 0&&v()}p=p.next}while(p!==c)}}function xM(I,c,p){switch(p.tag){case 0:case 11:case 15:case 22:if(c=p.updateQueue,c=c!==null?c.lastEffect:null,c!==null){I=c=c.next;do{if((I.tag&3)===3){var v=I.create;I.destroy=v()}I=I.next}while(I!==c)}if(c=p.updateQueue,c=c!==null?c.lastEffect:null,c!==null){I=c=c.next;do{var w=I;v=w.next,w=w.tag,(w&4)!==0&&(w&1)!==0&&(qv(p,I),zM(p,I)),I=v}while(I!==c)}return;case 1:I=p.stateNode,p.flags&4&&(c===null?I.componentDidMount():(v=p.elementType===p.type?c.memoizedProps:Go(p.type,c.memoizedProps),I.componentDidUpdate(v,c.memoizedState,I.__reactInternalSnapshotBeforeUpdate))),c=p.updateQueue,c!==null&&qy(p,c,I);return;case 3:if(c=p.updateQueue,c!==null){if(I=null,p.child!==null)switch(p.child.tag){case 5:I=oe(p.child.stateNode);break;case 1:I=p.child.stateNode}qy(p,c,I)}return;case 5:I=p.stateNode,c===null&&p.flags&4&&ke(I,p.type,p.memoizedProps,p);return;case 6:return;case 4:return;case 12:return;case 13:xe&&p.memoizedState===null&&(p=p.alternate,p!==null&&(p=p.memoizedState,p!==null&&(p=p.dehydrated,p!==null&&Rt(p))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(g(163))}function Fv(I,c){if(Ge)for(var p=I;;){if(p.tag===5){var v=p.stateNode;c?Qe(v):it(p.stateNode,p.memoizedProps)}else if(p.tag===6)v=p.stateNode,c?Te(v):lt(v,p.memoizedProps);else if((p.tag!==23&&p.tag!==24||p.memoizedState===null||p===I)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===I)break;for(;p.sibling===null;){if(p.return===null||p.return===I)return;p=p.return}p.sibling.return=p.return,p=p.sibling}}function Yv(I,c){if(og&&typeof og.onCommitFiberUnmount=="function")try{og.onCommitFiberUnmount(Qp,c)}catch{}switch(c.tag){case 0:case 11:case 14:case 15:case 22:if(I=c.updateQueue,I!==null&&(I=I.lastEffect,I!==null)){var p=I=I.next;do{var v=p,w=v.destroy;if(v=v.tag,w!==void 0)if((v&4)!==0)qv(c,p);else{v=c;try{w()}catch(V){er(v,V)}}p=p.next}while(p!==I)}break;case 1:if(Mv(c),I=c.stateNode,typeof I.componentWillUnmount=="function")try{I.props=c.memoizedProps,I.state=c.memoizedState,I.componentWillUnmount()}catch(V){er(c,V)}break;case 5:Mv(c);break;case 4:Ge?Tv(I,c):Ve&&Ve&&(c=c.stateNode.containerInfo,I=un(c),po(c,I))}}function Nv(I,c){for(var p=c;;)if(Yv(I,p),p.child===null||Ge&&p.tag===4){if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return;p=p.return}p.sibling.return=p.return,p=p.sibling}else p.child.return=p,p=p.child}function Lv(I){I.alternate=null,I.child=null,I.dependencies=null,I.firstEffect=null,I.lastEffect=null,I.memoizedProps=null,I.memoizedState=null,I.pendingProps=null,I.return=null,I.updateQueue=null}function zv(I){return I.tag===5||I.tag===3||I.tag===4}function kv(I){if(Ge){e:{for(var c=I.return;c!==null;){if(zv(c))break e;c=c.return}throw Error(g(160))}var p=c;switch(c=p.stateNode,p.tag){case 5:var v=!1;break;case 3:c=c.containerInfo,v=!0;break;case 4:c=c.containerInfo,v=!0;break;default:throw Error(g(161))}p.flags&16&&(He(c),p.flags&=-17);e:t:for(p=I;;){for(;p.sibling===null;){if(p.return===null||zv(p.return)){p=null;break e}p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue t;p.child.return=p,p=p.child}if(!(p.flags&2)){p=p.stateNode;break e}}v?ym(I,p,c):vm(I,p,c)}}function ym(I,c,p){var v=I.tag,w=v===5||v===6;if(w)I=w?I.stateNode:I.stateNode.instance,c?se(p,I,c):Ye(p,I);else if(v!==4&&(I=I.child,I!==null))for(ym(I,c,p),I=I.sibling;I!==null;)ym(I,c,p),I=I.sibling}function vm(I,c,p){var v=I.tag,w=v===5||v===6;if(w)I=w?I.stateNode:I.stateNode.instance,c?J(p,I,c):Le(p,I);else if(v!==4&&(I=I.child,I!==null))for(vm(I,c,p),I=I.sibling;I!==null;)vm(I,c,p),I=I.sibling}function Tv(I,c){for(var p=c,v=!1,w,V;;){if(!v){v=p.return;e:for(;;){if(v===null)throw Error(g(160));switch(w=v.stateNode,v.tag){case 5:V=!1;break e;case 3:w=w.containerInfo,V=!0;break e;case 4:w=w.containerInfo,V=!0;break e}v=v.return}v=!0}if(p.tag===5||p.tag===6)Nv(I,p),V?Ze(w,p.stateNode):re(w,p.stateNode);else if(p.tag===4){if(p.child!==null){w=p.stateNode.containerInfo,V=!0,p.child.return=p,p=p.child;continue}}else if(Yv(I,p),p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return;p=p.return,p.tag===4&&(v=!1)}p.sibling.return=p.return,p=p.sibling}}function Zm(I,c){if(Ge){switch(c.tag){case 0:case 11:case 14:case 15:case 22:Kv(3,c);return;case 1:return;case 5:var p=c.stateNode;if(p!=null){var v=c.memoizedProps;I=I!==null?I.memoizedProps:v;var w=c.type,V=c.updateQueue;c.updateQueue=null,V!==null&&E(p,V,w,I,v,c)}return;case 6:if(c.stateNode===null)throw Error(g(162));p=c.memoizedProps,O(c.stateNode,I!==null?I.memoizedProps:p,p);return;case 3:xe&&(c=c.stateNode,c.hydrate&&(c.hydrate=!1,Ht(c.containerInfo)));return;case 12:return;case 13:Ev(c),ku(c);return;case 19:ku(c);return;case 17:return;case 23:case 24:Fv(c,c.memoizedState!==null);return}throw Error(g(163))}switch(c.tag){case 0:case 11:case 14:case 15:case 22:Kv(3,c);return;case 12:return;case 13:Ev(c),ku(c);return;case 19:ku(c);return;case 3:xe&&(p=c.stateNode,p.hydrate&&(p.hydrate=!1,Ht(p.containerInfo)));break;case 23:case 24:return}e:if(Ve){switch(c.tag){case 1:case 5:case 6:case 20:break e;case 3:case 4:c=c.stateNode,po(c.containerInfo,c.pendingChildren);break e}throw Error(g(163))}}function Ev(I){I.memoizedState!==null&&(Km=Qn(),Ge&&Fv(I.child,!0))}function ku(I){var c=I.updateQueue;if(c!==null){I.updateQueue=null;var p=I.stateNode;p===null&&(p=I.stateNode=new SM),c.forEach(function(v){var w=EM.bind(null,I,v);p.has(v)||(p.add(v),v.then(w,w))})}}function HM(I,c){return I!==null&&(I=I.memoizedState,I===null||I.dehydrated!==null)?(c=c.memoizedState,c!==null&&c.dehydrated===null):!1}var Tu=0,Eu=1,_u=2,Ju=3,Du=4;if(typeof Symbol=="function"&&Symbol.for){var FI=Symbol.for;Tu=FI("selector.component"),Eu=FI("selector.has_pseudo_class"),_u=FI("selector.role"),Ju=FI("selector.test_id"),Du=FI("selector.text")}function wm(I){var c=Pe(I);if(c!=null){if(typeof c.memoizedProps["data-testname"]!="string")throw Error(g(364));return c}if(I=te(I),I===null)throw Error(g(362));return I.stateNode.current}function Rm(I,c){switch(c.$$typeof){case Tu:if(I.type===c.value)return!0;break;case Eu:e:{c=c.value,I=[I,0];for(var p=0;p<I.length;){var v=I[p++],w=I[p++],V=c[w];if(v.tag!==5||!Fe(v)){for(;V!=null&&Rm(v,V);)w++,V=c[w];if(w===c.length){c=!0;break e}else for(v=v.child;v!==null;)I.push(v,w),v=v.sibling}}c=!1}return c;case _u:if(I.tag===5&&pe(I.stateNode,c.value))return!0;break;case Du:if((I.tag===5||I.tag===6)&&(I=Re(I),I!==null&&0<=I.indexOf(c.value)))return!0;break;case Ju:if(I.tag===5&&(I=I.memoizedProps["data-testname"],typeof I=="string"&&I.toLowerCase()===c.value.toLowerCase()))return!0;break;default:throw Error(g(365,c))}return!1}function Wm(I){switch(I.$$typeof){case Tu:return"<"+(H(I.value)||"Unknown")+">";case Eu:return":has("+(Wm(I)||"")+")";case _u:return'[role="'+I.value+'"]';case Du:return'"'+I.value+'"';case Ju:return'[data-testname="'+I.value+'"]';default:throw Error(g(365,I))}}function _v(I,c){var p=[];I=[I,0];for(var v=0;v<I.length;){var w=I[v++],V=I[v++],L=c[V];if(w.tag!==5||!Fe(w)){for(;L!=null&&Rm(w,L);)V++,L=c[V];if(V===c.length)p.push(w);else for(w=w.child;w!==null;)I.push(w,V),w=w.sibling}}return p}function Sm(I,c){if(!me)throw Error(g(363));I=wm(I),I=_v(I,c),c=[],I=Array.from(I);for(var p=0;p<I.length;){var v=I[p++];if(v.tag===5)Fe(v)||c.push(v.stateNode);else for(v=v.child;v!==null;)I.push(v),v=v.sibling}return c}var Uu=null;function XM(I){if(Uu===null)try{var c=("require"+Math.random()).slice(0,7);Uu=(n&&n[c]).call(n,"timers").setImmediate}catch{Uu=function(v){var w=new MessageChannel;w.port1.onmessage=v,w.port2.postMessage(void 0)}}return Uu(I)}var MM=Math.ceil,Pu=a.ReactCurrentDispatcher,Vm=a.ReactCurrentOwner,xm=a.IsSomeRendererActing,It=0,fi=null,Ln=null,gi=0,lg=0,Hm=Bt(0),jn=0,Qu=null,va=0,YI=0,Za=0,Xm=0,Mm=null,Km=0,Fm=1/0;function js(){Fm=Qn()+500}var Oe=null,Ou=!1,Ym=null,Eo=null,qs=!1,NI=null,LI=90,Nm=[],Lm=[],ps=null,zI=0,zm=null,ju=-1,ms=0,qu=0,kI=null,TI=!1;function Wi(){return(It&48)!==0?Qn():ju!==-1?ju:ju=Qn()}function $s(I){if(I=I.mode,(I&2)===0)return 1;if((I&4)===0)return ma()===99?1:2;if(ms===0&&(ms=va),pM.transition!==0){qu!==0&&(qu=Mm!==null?Mm.pendingLanes:0),I=ms;var c=4186112&~qu;return c&=-c,c===0&&(I=4186112&~I,c=I&-I,c===0&&(c=8192)),c}return I=ma(),(It&4)!==0&&I===98?I=mu(12,ms):(I=aM(I),I=mu(I,ms)),I}function fs(I,c,p){if(50<zI)throw zI=0,zm=null,Error(g(185));if(I=$u(I,c),I===null)return null;fu(I,c,p),I===fi&&(Za|=c,jn===4&&wa(I,gi));var v=ma();c===1?(It&8)!==0&&(It&48)===0?km(I):(_i(I,p),It===0&&(js(),$i())):((It&4)===0||v!==98&&v!==99||(ps===null?ps=new Set([I]):ps.add(I)),_i(I,p)),Mm=I}function $u(I,c){I.lanes|=c;var p=I.alternate;for(p!==null&&(p.lanes|=c),p=I,I=I.return;I!==null;)I.childLanes|=c,p=I.alternate,p!==null&&(p.childLanes|=c),p=I,I=I.return;return p.tag===3?p.stateNode:null}function _i(I,c){for(var p=I.callbackNode,v=I.suspendedLanes,w=I.pingedLanes,V=I.expirationTimes,L=I.pendingLanes;0<L;){var q=31-Us(L),be=1<<q,Ee=V[q];if(Ee===-1){if((be&v)===0||(be&w)!==0){Ee=c,sg(be);var st=Ot;V[q]=10<=st?Ee+250:6<=st?Ee+5e3:-1}}else Ee<=c&&(I.expiredLanes|=be);L&=~be}if(v=GI(I,I===fi?gi:0),c=Ot,v===0)p!==null&&(p!==em&&qp(p),I.callbackNode=null,I.callbackPriority=0);else{if(p!==null){if(I.callbackPriority===c)return;p!==em&&qp(p)}c===15?(p=km.bind(null,I),us===null?(us=[p],Gu=jp(bu,Uy)):us.push(p),p=em):c===14?p=BI(99,km.bind(null,I)):(p=lM(c),p=BI(p,Jv.bind(null,I))),I.callbackPriority=c,I.callbackNode=p}}function Jv(I){if(ju=-1,qu=ms=0,(It&48)!==0)throw Error(g(327));var c=I.callbackNode;if(bs()&&I.callbackNode!==c)return null;var p=GI(I,I===fi?gi:0);if(p===0)return null;var v=p,w=It;It|=16;var V=Qv();(fi!==I||gi!==v)&&(js(),Ra(I,v));do try{YM();break}catch(q){Pv(I,q)}while(1);if(nm(),Pu.current=V,It=w,Ln!==null?v=0:(fi=null,gi=0,v=jn),(va&Za)!==0)Ra(I,0);else if(v!==0){if(v===2&&(It|=64,I.hydrate&&(I.hydrate=!1,Ft(I.containerInfo)),p=Ly(I),p!==0&&(v=EI(I,p))),v===1)throw c=Qu,Ra(I,0),wa(I,p),_i(I,Qn()),c;switch(I.finishedWork=I.current.alternate,I.finishedLanes=p,v){case 0:case 1:throw Error(g(345));case 2:Ig(I);break;case 3:if(wa(I,p),(p&62914560)===p&&(v=Km+500-Qn(),10<v)){if(GI(I,0)!==0)break;if(w=I.suspendedLanes,(w&p)!==p){Wi(),I.pingedLanes|=I.suspendedLanes&w;break}I.timeoutHandle=we(Ig.bind(null,I),v);break}Ig(I);break;case 4:if(wa(I,p),(p&4186112)===p)break;for(v=I.eventTimes,w=-1;0<p;){var L=31-Us(p);V=1<<L,L=v[L],L>w&&(w=L),p&=~V}if(p=w,p=Qn()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*MM(p/1960))-p,10<p){I.timeoutHandle=we(Ig.bind(null,I),p);break}Ig(I);break;case 5:Ig(I);break;default:throw Error(g(329))}}return _i(I,Qn()),I.callbackNode===c?Jv.bind(null,I):null}function wa(I,c){for(c&=~Xm,c&=~Za,I.suspendedLanes|=c,I.pingedLanes&=~c,I=I.expirationTimes;0<c;){var p=31-Us(c),v=1<<p;I[p]=-1,c&=~v}}function km(I){if((It&48)!==0)throw Error(g(327));if(bs(),I===fi&&(I.expiredLanes&gi)!==0){var c=gi,p=EI(I,c);(va&Za)!==0&&(c=GI(I,c),p=EI(I,c))}else c=GI(I,0),p=EI(I,c);if(I.tag!==0&&p===2&&(It|=64,I.hydrate&&(I.hydrate=!1,Ft(I.containerInfo)),c=Ly(I),c!==0&&(p=EI(I,c))),p===1)throw p=Qu,Ra(I,0),wa(I,c),_i(I,Qn()),p;return I.finishedWork=I.current.alternate,I.finishedLanes=c,Ig(I),_i(I,Qn()),null}function KM(){if(ps!==null){var I=ps;ps=null,I.forEach(function(c){c.expiredLanes|=24&c.pendingLanes,_i(c,Qn())})}$i()}function Dv(I,c){var p=It;It|=1;try{return I(c)}finally{It=p,It===0&&(js(),$i())}}function Uv(I,c){var p=It;if((p&48)!==0)return I(c);It|=1;try{if(I)return ds(99,I.bind(null,c))}finally{It=p,$i()}}function ed(I,c){pt(Hm,lg),lg|=c,va|=c}function Tm(){lg=Hm.current,Xt(Hm)}function Ra(I,c){I.finishedWork=null,I.finishedLanes=0;var p=I.timeoutHandle;if(p!==ie&&(I.timeoutHandle=ie,Ke(p)),Ln!==null)for(p=Ln.return;p!==null;){var v=p;switch(v.tag){case 1:v=v.type.childContextTypes,v!=null&&Ds();break;case 3:Ba(),Xt(Hn),Xt(on),Im();break;case 5:gm(v);break;case 4:Ba();break;case 13:Xt(mn);break;case 19:Xt(mn);break;case 10:im(v);break;case 23:case 24:Tm()}p=p.return}fi=I,Ln=tr(I.current,null),gi=lg=va=c,jn=0,Qu=null,Xm=Za=YI=0}function Pv(I,c){do{var p=Ln;try{if(nm(),RI.current=Yu,Xu){for(var v=yn.memoizedState;v!==null;){var w=v.queue;w!==null&&(w.pending=null),v=v.next}Xu=!1}if(WI=0,On=ri=yn=null,SI=!1,Vm.current=null,p===null||p.return===null){jn=1,Qu=c,Ln=null;break}e:{var V=I,L=p.return,q=p,be=c;if(c=gi,q.flags|=2048,q.firstEffect=q.lastEffect=null,be!==null&&typeof be=="object"&&typeof be.then=="function"){var Ee=be;if((q.mode&2)===0){var st=q.alternate;st?(q.updateQueue=st.updateQueue,q.memoizedState=st.memoizedState,q.lanes=st.lanes):(q.updateQueue=null,q.memoizedState=null)}var ut=(mn.current&1)!==0,De=L;do{var Ut;if(Ut=De.tag===13){var ln=De.memoizedState;if(ln!==null)Ut=ln.dehydrated!==null;else{var so=De.memoizedProps;Ut=so.fallback===void 0?!1:so.unstable_avoidThisFallback!==!0?!0:!ut}}if(Ut){var ae=De.updateQueue;if(ae===null){var ne=new Set;ne.add(Ee),De.updateQueue=ne}else ae.add(Ee);if((De.mode&2)===0){if(De.flags|=64,q.flags|=16384,q.flags&=-2981,q.tag===1)if(q.alternate===null)q.tag=17;else{var Be=Qs(-1,1);Be.tag=2,Os(q,Be)}q.lanes|=1;break e}be=void 0,q=c;var Je=V.pingCache;if(Je===null?(Je=V.pingCache=new WM,be=new Set,Je.set(Ee,be)):(be=Je.get(Ee),be===void 0&&(be=new Set,Je.set(Ee,be))),!be.has(q)){be.add(q);var rt=TM.bind(null,V,Ee,q);Ee.then(rt,rt)}De.flags|=4096,De.lanes=c;break e}De=De.return}while(De!==null);be=Error((H(q.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}jn!==5&&(jn=2),be=Gm(be,q),De=L;do{switch(De.tag){case 3:V=be,De.flags|=4096,c&=-c,De.lanes|=c;var jt=Hv(De,V,c);jy(De,jt);break e;case 1:V=be;var At=De.type,Yt=De.stateNode;if((De.flags&64)===0&&(typeof At.getDerivedStateFromError=="function"||Yt!==null&&typeof Yt.componentDidCatch=="function"&&(Eo===null||!Eo.has(Yt)))){De.flags|=4096,c&=-c,De.lanes|=c;var Mn=Xv(De,V,c);jy(De,Mn);break e}}De=De.return}while(De!==null)}jv(p)}catch(St){c=St,Ln===p&&p!==null&&(Ln=p=p.return);continue}break}while(1)}function Qv(){var I=Pu.current;return Pu.current=Yu,I===null?Yu:I}function EI(I,c){var p=It;It|=16;var v=Qv();fi===I&&gi===c||Ra(I,c);do try{FM();break}catch(w){Pv(I,w)}while(1);if(nm(),It=p,Pu.current=v,Ln!==null)throw Error(g(261));return fi=null,gi=0,jn}function FM(){for(;Ln!==null;)Ov(Ln)}function YM(){for(;Ln!==null&&!dM();)Ov(Ln)}function Ov(I){var c=eZ(I.alternate,I,lg);I.memoizedProps=I.pendingProps,c===null?jv(I):Ln=c,Vm.current=null}function jv(I){var c=I;do{var p=c.alternate;if(I=c.return,(c.flags&2048)===0){if(p=wM(p,c,lg),p!==null){Ln=p;return}if(p=c,p.tag!==24&&p.tag!==23||p.memoizedState===null||(lg&1073741824)!==0||(p.mode&4)===0){for(var v=0,w=p.child;w!==null;)v|=w.lanes|w.childLanes,w=w.sibling;p.childLanes=v}I!==null&&(I.flags&2048)===0&&(I.firstEffect===null&&(I.firstEffect=c.firstEffect),c.lastEffect!==null&&(I.lastEffect!==null&&(I.lastEffect.nextEffect=c.firstEffect),I.lastEffect=c.lastEffect),1<c.flags&&(I.lastEffect!==null?I.lastEffect.nextEffect=c:I.firstEffect=c,I.lastEffect=c))}else{if(p=RM(c),p!==null){p.flags&=2047,Ln=p;return}I!==null&&(I.firstEffect=I.lastEffect=null,I.flags|=2048)}if(c=c.sibling,c!==null){Ln=c;return}Ln=c=I}while(c!==null);jn===0&&(jn=5)}function Ig(I){var c=ma();return ds(99,NM.bind(null,I,c)),null}function NM(I,c){do bs();while(NI!==null);if((It&48)!==0)throw Error(g(327));var p=I.finishedWork;if(p===null)return null;if(I.finishedWork=null,I.finishedLanes=0,p===I.current)throw Error(g(177));I.callbackNode=null;var v=p.lanes|p.childLanes,w=v,V=I.pendingLanes&~w;I.pendingLanes=w,I.suspendedLanes=0,I.pingedLanes=0,I.expiredLanes&=w,I.mutableReadLanes&=w,I.entangledLanes&=w,w=I.entanglements;for(var L=I.eventTimes,q=I.expirationTimes;0<V;){var be=31-Us(V),Ee=1<<be;w[be]=0,L[be]=-1,q[be]=-1,V&=~Ee}if(ps!==null&&(v&24)===0&&ps.has(I)&&ps.delete(I),I===fi&&(Ln=fi=null,gi=0),1<p.flags?p.lastEffect!==null?(p.lastEffect.nextEffect=p,v=p.firstEffect):v=p:v=p.firstEffect,v!==null){w=It,It|=32,Vm.current=null,kI=P(I.containerInfo),TI=!1,Oe=v;do try{LM()}catch(ne){if(Oe===null)throw Error(g(330));er(Oe,ne),Oe=Oe.nextEffect}while(Oe!==null);kI=null,Oe=v;do try{for(L=I;Oe!==null;){var st=Oe.flags;if(st&16&&Ge&&He(Oe.stateNode),st&128){var ut=Oe.alternate;if(ut!==null){var De=ut.ref;De!==null&&(typeof De=="function"?De(null):De.current=null)}}switch(st&1038){case 2:kv(Oe),Oe.flags&=-3;break;case 6:kv(Oe),Oe.flags&=-3,Zm(Oe.alternate,Oe);break;case 1024:Oe.flags&=-1025;break;case 1028:Oe.flags&=-1025,Zm(Oe.alternate,Oe);break;case 4:Zm(Oe.alternate,Oe);break;case 8:q=L,V=Oe,Ge?Tv(q,V):Nv(q,V);var Ut=V.alternate;Lv(V),Ut!==null&&Lv(Ut)}Oe=Oe.nextEffect}}catch(ne){if(Oe===null)throw Error(g(330));er(Oe,ne),Oe=Oe.nextEffect}while(Oe!==null);TI&&F(),Ce(I.containerInfo),I.current=p,Oe=v;do try{for(st=I;Oe!==null;){var ln=Oe.flags;if(ln&36&&xM(st,Oe.alternate,Oe),ln&128){ut=void 0;var so=Oe.ref;if(so!==null){var ae=Oe.stateNode;switch(Oe.tag){case 5:ut=oe(ae);break;default:ut=ae}typeof so=="function"?so(ut):so.current=ut}}Oe=Oe.nextEffect}}catch(ne){if(Oe===null)throw Error(g(330));er(Oe,ne),Oe=Oe.nextEffect}while(Oe!==null);Oe=null,hM(),It=w}else I.current=p;if(qs)qs=!1,NI=I,LI=c;else for(Oe=v;Oe!==null;)c=Oe.nextEffect,Oe.nextEffect=null,Oe.flags&8&&(ln=Oe,ln.sibling=null,ln.stateNode=null),Oe=c;if(v=I.pendingLanes,v===0&&(Eo=null),v===1?I===zm?zI++:(zI=0,zm=I):zI=0,p=p.stateNode,og&&typeof og.onCommitFiberRoot=="function")try{og.onCommitFiberRoot(Qp,p,void 0,(p.current.flags&64)===64)}catch{}if(_i(I,Qn()),Ou)throw Ou=!1,I=Ym,Ym=null,I;return(It&8)!==0||$i(),null}function LM(){for(;Oe!==null;){var I=Oe.alternate;TI||kI===null||((Oe.flags&8)!==0?j(Oe,kI)&&(TI=!0,ct()):Oe.tag===13&&HM(I,Oe)&&j(Oe,kI)&&(TI=!0,ct()));var c=Oe.flags;(c&256)!==0&&VM(I,Oe),(c&512)===0||qs||(qs=!0,BI(97,function(){return bs(),null})),Oe=Oe.nextEffect}}function bs(){if(LI!==90){var I=97<LI?97:LI;return LI=90,ds(I,kM)}return!1}function zM(I,c){Nm.push(c,I),qs||(qs=!0,BI(97,function(){return bs(),null}))}function qv(I,c){Lm.push(c,I),qs||(qs=!0,BI(97,function(){return bs(),null}))}function kM(){if(NI===null)return!1;var I=NI;if(NI=null,(It&48)!==0)throw Error(g(331));var c=It;It|=32;var p=Lm;Lm=[];for(var v=0;v<p.length;v+=2){var w=p[v],V=p[v+1],L=w.destroy;if(w.destroy=void 0,typeof L=="function")try{L()}catch(be){if(V===null)throw Error(g(330));er(V,be)}}for(p=Nm,Nm=[],v=0;v<p.length;v+=2){w=p[v],V=p[v+1];try{var q=w.create;w.destroy=q()}catch(be){if(V===null)throw Error(g(330));er(V,be)}}for(q=I.current.firstEffect;q!==null;)I=q.nextEffect,q.nextEffect=null,q.flags&8&&(q.sibling=null,q.stateNode=null),q=I;return It=c,$i(),!0}function $v(I,c,p){c=Gm(p,c),c=Hv(I,c,1),Os(I,c),c=Wi(),I=$u(I,1),I!==null&&(fu(I,1,c),_i(I,c))}function er(I,c){if(I.tag===3)$v(I,I,c);else for(var p=I.return;p!==null;){if(p.tag===3){$v(p,I,c);break}else if(p.tag===1){var v=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(Eo===null||!Eo.has(v))){I=Gm(c,I);var w=Xv(p,I,1);if(Os(p,w),w=Wi(),p=$u(p,1),p!==null)fu(p,1,w),_i(p,w);else if(typeof v.componentDidCatch=="function"&&(Eo===null||!Eo.has(v)))try{v.componentDidCatch(c,I)}catch{}break}}p=p.return}}function TM(I,c,p){var v=I.pingCache;v!==null&&v.delete(c),c=Wi(),I.pingedLanes|=I.suspendedLanes&p,fi===I&&(gi&p)===p&&(jn===4||jn===3&&(gi&62914560)===gi&&500>Qn()-Km?Ra(I,0):Xm|=p),_i(I,c)}function EM(I,c){var p=I.stateNode;p!==null&&p.delete(c),c=0,c===0&&(c=I.mode,(c&2)===0?c=1:(c&4)===0?c=ma()===99?1:2:(ms===0&&(ms=va),c=pa(62914560&~ms),c===0&&(c=4194304))),p=Wi(),I=$u(I,c),I!==null&&(fu(I,c,p),_i(I,p))}var eZ;eZ=function(I,c,p){var v=c.lanes;if(I!==null)if(I.memoizedProps!==c.pendingProps||Hn.current)Bo=!0;else if((p&v)!==0)Bo=(I.flags&16384)!==0;else{switch(Bo=!1,c.tag){case 3:vv(c),lm();break;case 5:sv(c);break;case 1:Xn(c.type)&&hu(c);break;case 4:rm(c,c.stateNode.containerInfo);break;case 10:Py(c,c.memoizedProps.value);break;case 13:if(c.memoizedState!==null)return(p&c.child.childLanes)!==0?Zv(I,c,p):(pt(mn,mn.current&1),c=hs(I,c,p),c!==null?c.sibling:null);pt(mn,mn.current&1);break;case 19:if(v=(p&c.childLanes)!==0,(I.flags&64)!==0){if(v)return Vv(I,c,p);c.flags|=64}var w=c.memoizedState;if(w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),pt(mn,mn.current),v)break;return null;case 23:case 24:return c.lanes=0,pm(I,c,p)}return hs(I,c,p)}else Bo=!1;switch(c.lanes=0,c.tag){case 2:if(v=c.type,I!==null&&(I.alternate=null,c.alternate=null,c.flags|=2),I=c.pendingProps,w=dn(c,on.current),ba(c,p),w=Cm(null,c,v,I,w,p),c.flags|=1,typeof w=="object"&&w!==null&&typeof w.render=="function"&&w.$$typeof===void 0){if(c.tag=1,c.memoizedState=null,c.updateQueue=null,Xn(v)){var V=!0;hu(c)}else V=!1;c.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,om(c);var L=v.getDerivedStateFromProps;typeof L=="function"&&wu(c,v,L,I),w.updater=Ru,c.stateNode=w,w._reactInternals=c,sm(c,v,I,p),c=fm(null,c,v,!0,V,p)}else c.tag=0,Ri(null,c,w,p),c=c.child;return c;case 16:w=c.elementType;e:{switch(I!==null&&(I.alternate=null,c.alternate=null,c.flags|=2),I=c.pendingProps,V=w._init,w=V(w._payload),c.type=w,V=c.tag=JM(w),I=Go(w,I),V){case 0:c=mm(null,c,w,I,p);break e;case 1:c=yv(null,c,w,I,p);break e;case 11:c=fv(null,c,w,I,p);break e;case 14:c=bv(null,c,w,Go(w.type,I),v,p);break e}throw Error(g(306,w,""))}return c;case 0:return v=c.type,w=c.pendingProps,w=c.elementType===v?w:Go(v,w),mm(I,c,v,w,p);case 1:return v=c.type,w=c.pendingProps,w=c.elementType===v?w:Go(v,w),yv(I,c,v,w,p);case 3:if(vv(c),v=c.updateQueue,I===null||v===null)throw Error(g(282));if(v=c.pendingProps,w=c.memoizedState,w=w!==null?w.element:null,Oy(I,c),yI(c,v,null,p),v=c.memoizedState.element,v===w)lm(),c=hs(I,c,p);else{if(w=c.stateNode,(V=w.hydrate)&&(xe?(rg=Ct(c.stateNode.containerInfo),As=c,V=zo=!0):V=!1),V){if(xe&&(I=w.mutableSourceEagerHydrationData,I!=null))for(w=0;w<I.length;w+=2)V=I[w],L=I[w+1],de?V._workInProgressVersionPrimary=L:V._workInProgressVersionSecondary=L,ya.push(V);for(p=ov(c,null,v,p),c.child=p;p;)p.flags=p.flags&-3|1024,p=p.sibling}else Ri(I,c,v,p),lm();c=c.child}return c;case 5:return sv(c),I===null&&am(c),v=c.type,w=c.pendingProps,V=I!==null?I.memoizedProps:null,L=w.children,ye(v,w)?L=null:V!==null&&ye(v,V)&&(c.flags|=16),Bv(I,c),Ri(I,c,L,p),c.child;case 6:return I===null&&am(c),null;case 13:return Zv(I,c,p);case 4:return rm(c,c.stateNode.containerInfo),v=c.pendingProps,I===null?c.child=Vu(c,null,v,p):Ri(I,c,v,p),c.child;case 11:return v=c.type,w=c.pendingProps,w=c.elementType===v?w:Go(v,w),fv(I,c,v,w,p);case 7:return Ri(I,c,c.pendingProps,p),c.child;case 8:return Ri(I,c,c.pendingProps.children,p),c.child;case 12:return Ri(I,c,c.pendingProps.children,p),c.child;case 10:e:{if(v=c.type._context,w=c.pendingProps,L=c.memoizedProps,V=w.value,Py(c,V),L!==null){var q=L.value;if(V=eo(q,V)?0:(typeof v._calculateChangedBits=="function"?v._calculateChangedBits(q,V):1073741823)|0,V===0){if(L.children===w.children&&!Hn.current){c=hs(I,c,p);break e}}else for(q=c.child,q!==null&&(q.return=c);q!==null;){var be=q.dependencies;if(be!==null){L=q.child;for(var Ee=be.firstContext;Ee!==null;){if(Ee.context===v&&(Ee.observedBits&V)!==0){q.tag===1&&(Ee=Qs(-1,p&-p),Ee.tag=2,Os(q,Ee)),q.lanes|=p,Ee=q.alternate,Ee!==null&&(Ee.lanes|=p),Qy(q.return,p),be.lanes|=p;break}Ee=Ee.next}}else L=q.tag===10&&q.type===c.type?null:q.child;if(L!==null)L.return=q;else for(L=q;L!==null;){if(L===c){L=null;break}if(q=L.sibling,q!==null){q.return=L.return,L=q;break}L=L.return}q=L}}Ri(I,c,w.children,p),c=c.child}return c;case 9:return w=c.type,V=c.pendingProps,v=V.children,ba(c,p),w=to(w,V.unstable_observedBits),v=v(w),c.flags|=1,Ri(I,c,v,p),c.child;case 14:return w=c.type,V=Go(w,c.pendingProps),V=Go(w.type,V),bv(I,c,w,V,v,p);case 15:return Gv(I,c,c.type,c.pendingProps,v,p);case 17:return v=c.type,w=c.pendingProps,w=c.elementType===v?w:Go(v,w),I!==null&&(I.alternate=null,c.alternate=null,c.flags|=2),c.tag=1,Xn(v)?(I=!0,hu(c)):I=!1,ba(c,p),tv(c,v,w),sm(c,v,w,p),fm(null,c,v,!0,I,p);case 19:return Vv(I,c,p);case 23:return pm(I,c,p);case 24:return pm(I,c,p)}throw Error(g(156,c.tag))};var td={current:!1},Em=r.unstable_flushAllWithoutAsserting,tZ=typeof Em=="function";function _m(){if(Em!==void 0)return Em();for(var I=!1;bs();)I=!0;return I}function nZ(I){try{_m(),XM(function(){_m()?nZ(I):I()})}catch(c){I(c)}}var nd=0,iZ=!1;function _M(I,c,p,v){this.tag=I,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function oo(I,c,p,v){return new _M(I,c,p,v)}function Jm(I){return I=I.prototype,!(!I||!I.isReactComponent)}function JM(I){if(typeof I=="function")return Jm(I)?1:0;if(I!=null){if(I=I.$$typeof,I===G)return 11;if(I===B)return 14}return 2}function tr(I,c){var p=I.alternate;return p===null?(p=oo(I.tag,c,I.key,I.mode),p.elementType=I.elementType,p.type=I.type,p.stateNode=I.stateNode,p.alternate=I,I.alternate=p):(p.pendingProps=c,p.type=I.type,p.flags=0,p.nextEffect=null,p.firstEffect=null,p.lastEffect=null),p.childLanes=I.childLanes,p.lanes=I.lanes,p.child=I.child,p.memoizedProps=I.memoizedProps,p.memoizedState=I.memoizedState,p.updateQueue=I.updateQueue,c=I.dependencies,p.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},p.sibling=I.sibling,p.index=I.index,p.ref=I.ref,p}function id(I,c,p,v,w,V){var L=2;if(v=I,typeof I=="function")Jm(I)&&(L=1);else if(typeof I=="string")L=5;else e:switch(I){case d:return Wa(p.children,w,V,c);case R:L=8,w|=16;break;case C:L=8,w|=1;break;case A:return I=oo(12,p,c,w|8),I.elementType=A,I.type=A,I.lanes=V,I;case m:return I=oo(13,p,c,w),I.type=m,I.elementType=m,I.lanes=V,I;case h:return I=oo(19,p,c,w),I.elementType=h,I.lanes=V,I;case W:return Dm(p,w,V,c);case x:return I=oo(24,p,c,w),I.elementType=x,I.lanes=V,I;default:if(typeof I=="object"&&I!==null)switch(I.$$typeof){case f:L=10;break e;case b:L=9;break e;case G:L=11;break e;case B:L=14;break e;case y:L=16,v=null;break e;case Z:L=22;break e}throw Error(g(130,I==null?I:typeof I,""))}return c=oo(L,p,c,w),c.elementType=I,c.type=v,c.lanes=V,c}function Wa(I,c,p,v){return I=oo(7,I,v,c),I.lanes=p,I}function Dm(I,c,p,v){return I=oo(23,I,v,c),I.elementType=W,I.lanes=p,I}function Um(I,c,p){return I=oo(6,I,null,c),I.lanes=p,I}function Pm(I,c,p){return c=oo(4,I.children!==null?I.children:[],I.key,c),c.lanes=p,c.stateNode={containerInfo:I.containerInfo,pendingChildren:null,implementation:I.implementation},c}function DM(I,c,p){this.tag=c,this.containerInfo=I,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ie,this.pendingContext=this.context=null,this.hydrate=p,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Op(0),this.expirationTimes=Op(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Op(0),xe&&(this.mutableSourceEagerHydrationData=null)}function oZ(I){var c=I._reactInternals;if(c===void 0)throw typeof I.render=="function"?Error(g(188)):Error(g(268,Object.keys(I)));return I=Q(c),I===null?null:I.stateNode}function sZ(I,c){if(I=I.memoizedState,I!==null&&I.dehydrated!==null){var p=I.retryLane;I.retryLane=p!==0&&p<c?p:c}}function od(I,c){sZ(I,c),(I=I.alternate)&&sZ(I,c)}function UM(I){return I=Q(I),I===null?null:I.stateNode}function PM(){return null}return i.IsThisRendererActing=td,i.act=function(I){function c(){nd--,xm.current=p,td.current=v}iZ===!1&&(iZ=!0,console.error("act(...) is not supported in production builds of React, and might not behave as expected.")),nd++;var p=xm.current,v=td.current;xm.current=!0,td.current=!0;try{var w=Dv(I)}catch(V){throw c(),V}if(w!==null&&typeof w=="object"&&typeof w.then=="function")return{then:function(V,L){w.then(function(){1<nd||tZ===!0&&p===!0?(c(),V()):nZ(function(q){c(),q?L(q):V()})},function(q){c(),L(q)})}};try{nd!==1||tZ!==!1&&p!==!1||_m(),c()}catch(V){throw c(),V}return{then:function(V){V()}}},i.attemptContinuousHydration=function(I){if(I.tag===13){var c=Wi();fs(I,67108864,c),od(I,67108864)}},i.attemptHydrationAtCurrentPriority=function(I){if(I.tag===13){var c=Wi(),p=$s(I);fs(I,p,c),od(I,p)}},i.attemptSynchronousHydration=function(I){switch(I.tag){case 3:var c=I.stateNode;if(c.hydrate){var p=sg(c.pendingLanes);c.expiredLanes|=p&c.pendingLanes,_i(c,Qn()),(It&48)===0&&(js(),$i())}break;case 13:var v=Wi();Uv(function(){return fs(I,1,v)}),od(I,4)}},i.attemptUserBlockingHydration=function(I){if(I.tag===13){var c=Wi();fs(I,4,c),od(I,4)}},i.batchedEventUpdates=function(I,c){var p=It;It|=2;try{return I(c)}finally{It=p,It===0&&(js(),$i())}},i.batchedUpdates=Dv,i.createComponentSelector=function(I){return{$$typeof:Tu,value:I}},i.createContainer=function(I,c,p){return I=new DM(I,c,p),c=oo(3,null,null,c===2?7:c===1?3:0),I.current=c,c.stateNode=I,om(c),I},i.createHasPsuedoClassSelector=function(I){return{$$typeof:Eu,value:I}},i.createPortal=function(I,c,p){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:v==null?null:""+v,children:I,containerInfo:c,implementation:p}},i.createRoleSelector=function(I){return{$$typeof:_u,value:I}},i.createTestNameSelector=function(I){return{$$typeof:Ju,value:I}},i.createTextSelector=function(I){return{$$typeof:Du,value:I}},i.deferredUpdates=function(I){return ds(97,I)},i.discreteUpdates=function(I,c,p,v,w){var V=It;It|=4;try{return ds(98,I.bind(null,c,p,v,w))}finally{It=V,It===0&&(js(),$i())}},i.findAllNodes=Sm,i.findBoundingRects=function(I,c){if(!me)throw Error(g(363));c=Sm(I,c),I=[];for(var p=0;p<c.length;p++)I.push(he(c[p]));for(c=I.length-1;0<c;c--){p=I[c];for(var v=p.x,w=v+p.width,V=p.y,L=V+p.height,q=c-1;0<=q;q--)if(c!==q){var be=I[q],Ee=be.x,st=Ee+be.width,ut=be.y,De=ut+be.height;if(v>=Ee&&V>=ut&&w<=st&&L<=De){I.splice(c,1);break}else if(v!==Ee||p.width!==be.width||De<V||ut>L){if(!(V!==ut||p.height!==be.height||st<v||Ee>w)){Ee>v&&(be.width+=Ee-v,be.x=v),st<w&&(be.width=w-Ee),I.splice(c,1);break}}else{ut>V&&(be.height+=ut-V,be.y=V),De<L&&(be.height=L-ut),I.splice(c,1);break}}}return I},i.findHostInstance=oZ,i.findHostInstanceWithNoPortals=function(I){return I=$(I),I===null?null:I.tag===20?I.stateNode.instance:I.stateNode},i.findHostInstanceWithWarning=function(I){return oZ(I)},i.flushControlled=function(I){var c=It;It|=1;try{ds(99,I)}finally{It=c,It===0&&(js(),$i())}},i.flushDiscreteUpdates=function(){(It&49)===0&&(KM(),bs())},i.flushPassiveEffects=bs,i.flushSync=Uv,i.focusWithin=function(I,c){if(!me)throw Error(g(363));for(I=wm(I),c=_v(I,c),c=Array.from(c),I=0;I<c.length;){var p=c[I++];if(!Fe(p)){if(p.tag===5&&$e(p.stateNode))return!0;for(p=p.child;p!==null;)c.push(p),p=p.sibling}}return!1},i.getCurrentUpdateLanePriority=function(){return pu},i.getFindAllNodesFailureDescription=function(I,c){if(!me)throw Error(g(363));var p=0,v=[];I=[wm(I),0];for(var w=0;w<I.length;){var V=I[w++],L=I[w++],q=c[L];if((V.tag!==5||!Fe(V))&&(Rm(V,q)&&(v.push(Wm(q)),L++,L>p&&(p=L)),L<c.length))for(V=V.child;V!==null;)I.push(V,L),V=V.sibling}if(p<c.length){for(I=[];p<c.length;p++)I.push(Wm(c[p]));return`findAllNodes was able to match part of the selector:
  `+(v.join(" > ")+`

No matching component was found for:
  `)+I.join(" > ")}return null},i.getPublicRootInstance=function(I){if(I=I.current,!I.child)return null;switch(I.child.tag){case 5:return oe(I.child.stateNode);default:return I.child.stateNode}},i.injectIntoDevTools=function(I){if(I={bundleType:I.bundleType,version:I.version,rendererPackageName:I.rendererPackageName,rendererConfig:I.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:UM,findFiberByHostInstance:I.findFiberByHostInstance||PM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined")I=!1;else{var c=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!c.isDisabled&&c.supportsFiber)try{Qp=c.inject(I),og=c}catch{}I=!0}return I},i.observeVisibleRects=function(I,c,p,v){if(!me)throw Error(g(363));I=Sm(I,c);var w=ve(I,p,v).disconnect;return{disconnect:function(){w()}}},i.registerMutableSourceForHydration=function(I,c){var p=c._getVersion;p=p(c._source),I.mutableSourceEagerHydrationData==null?I.mutableSourceEagerHydrationData=[c,p]:I.mutableSourceEagerHydrationData.push(c,p)},i.runWithPriority=function(I,c){var p=pu;try{return pu=I,c()}finally{pu=p}},i.shouldSuspend=function(){return!1},i.unbatchedUpdates=function(I,c){var p=It;It&=-2,It|=8;try{return I(c)}finally{It=p,It===0&&(js(),$i())}},i.updateContainer=function(I,c,p,v){var w=c.current,V=Wi(),L=$s(w);e:if(p){p=p._reactInternals;t:{if(k(p)!==p||p.tag!==1)throw Error(g(170));var q=p;do{switch(q.tag){case 3:q=q.stateNode.context;break t;case 1:if(Xn(q.type)){q=q.stateNode.__reactInternalMemoizedMergedChildContext;break t}}q=q.return}while(q!==null);throw Error(g(171))}if(p.tag===1){var be=p.type;if(Xn(be)){p=Yy(p,be,q);break e}}p=q}else p=Nn;return c.context===null?c.context=p:c.pendingContext=p,c=Qs(V,L),c.payload={element:I},v=v===void 0?null:v,v!==null&&(c.callback=v),Os(w,c),fs(w,L,V),L},i}})(mH);pH.exports=mH.exports;var Mk=pH.exports,qB=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var i,o,s;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(o=i;o--!==0;)if(!n(e[o],t[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),i=s.length,i!==Object.keys(t).length)return!1;for(o=i;o--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[o]))return!1;for(o=i;o--!==0;){var r=s[o];if(!n(e[r],t[r]))return!1}return!0}return e!==e&&t!==t};const gp=[];function fH(n,e,t,i=0,o=!1){for(const r of e)if(qB(t,r.args)){if(o)return;if(r.error)throw r.error;if(r.response)return r.response;throw r.promise}const s={args:t,promise:n(...t).then(r=>s.response=r!=null?r:!0).catch(r=>s.error=r!=null?r:"unknown error").then(()=>{i>0&&setTimeout(()=>{const r=e.indexOf(s);r!==-1&&e.splice(r,1)},i)})};if(e.push(s),!o)throw s.promise}function Kk(n,...e){if(e===void 0||e.length===0)n.splice(0,n.length);else{const t=n.find(i=>qB(e,i.args));if(t){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}}function Ls(n,...e){return fH(n,gp,e,Ls.lifespan)}Ls.lifespan=0;Ls.clear=(...n)=>Kk(gp,...n);Ls.preload=(n,...e)=>void fH(n,gp,e,Ls.lifespan,!0);Ls.peek=(...n)=>{var e;return(e=gp.find(t=>qB(n,t.args)))==null?void 0:e.response};function Fk(n){return function(e){n.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}function _0(n,e,t){var i,o,s,r,g;e==null&&(e=100);function a(){var u=Date.now()-r;u<e&&u>=0?i=setTimeout(a,e-u):(i=null,t||(g=n.apply(s,o),s=o=null))}var l=function(){s=this,o=arguments,r=Date.now();var u=t&&!i;return i||(i=setTimeout(a,e)),u&&(g=n.apply(s,o),s=o=null),g};return l.clear=function(){i&&(clearTimeout(i),i=null)},l.flush=function(){i&&(g=n.apply(s,o),s=o=null,clearTimeout(i),i=null)},l}_0.debounce=_0;var P2=_0;function Yk(n){let{debounce:e,scroll:t,polyfill:i,offsetSize:o}=n===void 0?{debounce:0,scroll:!1,offsetSize:!1}:n;const s=i||(typeof window=="undefined"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[r,g]=ce.exports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=ce.exports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:r}),l=e?typeof e=="number"?e:e.scroll:null,u=e?typeof e=="number"?e:e.resize:null,d=ce.exports.useRef(!1);ce.exports.useEffect(()=>(d.current=!0,()=>void(d.current=!1)));const[C,A,f]=ce.exports.useMemo(()=>{const h=()=>{if(!a.current.element)return;const{left:B,top:y,width:Z,height:R,bottom:W,right:x,x:X,y:Y}=a.current.element.getBoundingClientRect(),S={left:B,top:y,width:Z,height:R,bottom:W,right:x,x:X,y:Y};a.current.element instanceof HTMLElement&&o&&(S.height=a.current.element.offsetHeight,S.width=a.current.element.offsetWidth),Object.freeze(S),d.current&&!kk(a.current.lastBounds,S)&&g(a.current.lastBounds=S)};return[h,u?P2(h,u):h,l?P2(h,l):h]},[g,o,l,u]);function b(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(h=>h.removeEventListener("scroll",f,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null)}function G(){!a.current.element||(a.current.resizeObserver=new s(f),a.current.resizeObserver.observe(a.current.element),t&&a.current.scrollContainers&&a.current.scrollContainers.forEach(h=>h.addEventListener("scroll",f,{capture:!0,passive:!0})))}const m=h=>{!h||h===a.current.element||(b(),a.current.element=h,a.current.scrollContainers=bH(h),G())};return Lk(f,Boolean(t)),Nk(A),ce.exports.useEffect(()=>{b(),G()},[t,f,A]),ce.exports.useEffect(()=>b,[]),[m,r,C]}function Nk(n){ce.exports.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function Lk(n,e){ce.exports.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function bH(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:i,overflowY:o}=window.getComputedStyle(n);return[t,i,o].some(s=>s==="auto"||s==="scroll")&&e.push(n),[...e,...bH(n.parentElement)]}const zk=["x","y","top","bottom","left","right","width","height"],kk=(n,e)=>zk.every(t=>n[t]===e[t]),Pt={obj:n=>n===Object(n)&&!Pt.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e){if(typeof n!=typeof e||!!n!=!!e)return!1;if(Pt.str(n)||Pt.num(n)||Pt.obj(n))return n===e;if(Pt.arr(n)&&n==e)return!0;let t;for(t in n)if(!(t in e))return!1;for(t in e)if(n[t]!==e[t])return!1;return Pt.und(t)?n===e:!0}};function tb(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function GH(n,e,t,i){const o=t.get(e);o&&(t.delete(e),t.size===0&&(n.delete(i),o.target.releasePointerCapture(i)))}function Tk(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(i=>i!==e),t.initialHits=t.initialHits.filter(i=>i!==e),t.hovered.forEach((i,o)=>{(i.eventObject===e||i.object===e)&&t.hovered.delete(o)}),t.capturedMap.forEach((i,o)=>{GH(t.capturedMap,e,i,o)})}function Ek(n){const e=new K;function t(d){var C,A,f,b;const G=n.getState(),{raycaster:m,mouse:h,camera:B,size:y}=G,Z=m.computeOffsets==null?void 0:m.computeOffsets(d,G),R=(C=Z==null?void 0:Z.offsetX)!=null?C:d.offsetX,W=(A=Z==null?void 0:Z.offsetY)!=null?A:d.offsetY,x=(f=Z==null?void 0:Z.width)!=null?f:y.width,X=(b=Z==null?void 0:Z.height)!=null?b:y.height;h.set(R/x*2-1,-(W/X)*2+1),m.setFromCamera(h,B)}function i(d){const{internal:C}=n.getState(),A=d.offsetX-C.initialClick[0],f=d.offsetY-C.initialClick[1];return Math.round(Math.sqrt(A*A+f*f))}function o(d){return d.filter(C=>["Move","Over","Enter","Out","Leave"].some(A=>{var f;return(f=C.__r3f)==null?void 0:f.handlers["onPointer"+A]}))}function s(d){const C=n.getState(),{raycaster:A,internal:f}=C;if(!A.enabled)return[];const b=new Set,G=[],m=d?d(f.interaction):f.interaction;let h=A.intersectObjects(m,!0).filter(y=>{const Z=tb(y);return b.has(Z)?!1:(b.add(Z),!0)});A.filter&&(h=A.filter(h,C));for(const y of h){let Z=y.object;for(;Z;){var B;(B=Z.__r3f)!=null&&B.eventCount&&G.push(Mt(gt({},y),{eventObject:Z})),Z=Z.parent}}return G}function r(d,C){const{internal:A}=n.getState();if("pointerId"in C&&A.capturedMap.has(C.pointerId))for(let f of A.capturedMap.get(C.pointerId).values())d.push(f.intersection);return d}function g(d,C,A,f){const{raycaster:b,mouse:G,camera:m,internal:h}=n.getState();if(d.length){const B=e.set(G.x,G.y,0).unproject(m),y={stopped:!1};for(const Z of d){const R=S=>{var H,k;return(H=(k=h.capturedMap.get(S))==null?void 0:k.has(Z.eventObject))!=null?H:!1},W=S=>{const H={intersection:Z,target:C.target};h.capturedMap.has(S)?h.capturedMap.get(S).set(Z.eventObject,H):h.capturedMap.set(S,new Map([[Z.eventObject,H]])),C.target.setPointerCapture(S)},x=S=>{const H=h.capturedMap.get(S);H&&GH(h.capturedMap,Z.eventObject,H,S)};let X={};for(let S in C){let H=C[S];typeof H!="function"&&(X[S]=H)}let Y=Mt(gt(gt({},Z),X),{spaceX:G.x,spaceY:G.y,intersections:d,stopped:y.stopped,delta:A,unprojectedPoint:B,ray:b.ray,camera:m,stopPropagation:()=>{const S="pointerId"in C&&h.capturedMap.get(C.pointerId);if((!S||S.has(Z.eventObject))&&(Y.stopped=y.stopped=!0,h.hovered.size&&Array.from(h.hovered.values()).find(H=>H.eventObject===Z.eventObject))){const H=d.slice(0,d.indexOf(Z));a([...H,Z])}},target:{hasPointerCapture:R,setPointerCapture:W,releasePointerCapture:x},currentTarget:{hasPointerCapture:R,setPointerCapture:W,releasePointerCapture:x},sourceEvent:C,nativeEvent:C});if(f(Y),y.stopped===!0)break}}return d}function a(d){const{internal:C}=n.getState();Array.from(C.hovered.values()).forEach(A=>{if(!d.length||!d.find(f=>f.object===A.object&&f.index===A.index&&f.instanceId===A.instanceId)){const b=A.eventObject.__r3f,G=b==null?void 0:b.handlers;if(C.hovered.delete(tb(A)),b!=null&&b.eventCount){const m=Mt(gt({},A),{intersections:d||[]});G.onPointerOut==null||G.onPointerOut(m),G.onPointerLeave==null||G.onPointerLeave(m)}}})}const l=d=>{switch(d){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return C=>{const{internal:A}=n.getState();"pointerId"in C&&!A.capturedMap.has(C.pointerId)&&(A.capturedMap.delete(C.pointerId),a([]))}}return C=>{const{onPointerMissed:A,internal:f}=n.getState();t(C),f.lastEvent.current=C;const b=d==="onPointerMove",G=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",h=r(s(b?o:void 0),C),B=G?i(C):0;d==="onPointerDown"&&(f.initialClick=[C.offsetX,C.offsetY],f.initialHits=h.map(y=>y.eventObject)),G&&!h.length&&B<=2&&(u(C,f.interaction),A&&A(C)),b&&a(h),g(h,C,B,y=>{const Z=y.eventObject,R=Z.__r3f,W=R==null?void 0:R.handlers;if(!!(R!=null&&R.eventCount))if(b){if(W.onPointerOver||W.onPointerEnter||W.onPointerOut||W.onPointerLeave){const x=tb(y),X=f.hovered.get(x);X?X.stopped&&y.stopPropagation():(f.hovered.set(x,y),W.onPointerOver==null||W.onPointerOver(y),W.onPointerEnter==null||W.onPointerEnter(y))}W.onPointerMove==null||W.onPointerMove(y)}else{const x=W[d];x?(!G||f.initialHits.includes(Z))&&(u(C,f.interaction.filter(X=>!f.initialHits.includes(X))),x(y)):G&&f.initialHits.includes(Z)&&u(C,f.interaction.filter(X=>!f.initialHits.includes(X)))}})}};function u(d,C){C.forEach(A=>{var f;return(f=A.__r3f)==null||f.handlers.onPointerMissed==null?void 0:f.handlers.onPointerMissed(d)})}return{handlePointer:l}}const _k=n=>n&&!!n.memoized&&!!n.changes,hh=n=>n&&!!n.getState,nb=(n,e)=>{var t,i;return{root:hh(n)?n:(t=(i=n.__r3f)==null?void 0:i.root)!=null?t:e.__r3f.root,container:hh(n)?n.getState().scene:n}},Q2="__default",Jk={};let Dk={};function Uk(n,e){return!!(Pt.arr(n)&&Pt.equ(n,e)||n===e)}function nl(n,e){const t=n;return(e!=null&&e.primitive||!t.__r3f)&&(t.__r3f=gt({root:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},e)),n}function Pk(n){function e(C,R,x={},Z=!1){var W=R,{children:A,key:f,ref:b}=W,G=qn(W,["children","key","ref"]);var X=x,{children:m,key:h,ref:B}=X,y=qn(X,["children","key","ref"]);var Y;const S=(Y=C==null?void 0:C.__r3f)!=null?Y:{},H=Object.entries(G),k=[];if(Z){const D=Object.keys(y);for(let Q=0;Q<D.length;Q++)G.hasOwnProperty(D[Q])||H.unshift([D[Q],Q2+"remove"])}H.forEach(([D,Q])=>{var $;if(($=C.__r3f)!=null&&$.primitive&&D==="object"||Uk(Q,y[D]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(D))return k.push([D,Q,!0,[]]);let j=[];D.includes("-")&&(j=D.split("-")),k.push([D,Q,!1,j])});const U=gt({},G);return S.memoizedProps&&S.memoizedProps.args&&(U.args=S.memoizedProps.args),S.memoizedProps&&S.memoizedProps.attach&&(U.attach=S.memoizedProps.attach),{accumulative:Z,memoized:U,changes:k}}function t(C,A){var f,b,G;const m=(f=C==null?void 0:C.__r3f)!=null?f:{},h=m.root,B=(b=h==null||h.getState==null?void 0:h.getState())!=null?b:{},{memoized:y,changes:Z}=_k(A)?A:e(C,A),R=m.eventCount;if(C.__r3f&&(C.__r3f.memoizedProps=y),Z.forEach(([W,x,X,Y])=>{var S;let H=C,k=H[W];if(Y.length&&(k=Y.reduce((D,Q)=>D[Q],C),!(k&&k.set))){const[D,...Q]=Y.reverse();H=Q.reverse().reduce(($,j)=>$[j],C),W=D}if(x===Q2+"remove")if(k&&k.constructor)x=new k.constructor(y.args);else if(H.constructor){const D=new H.constructor(H.__r3f.memoizedProps.args);x=D[k],D.dispose&&D.dispose()}else x=0;const U=(B==null||(S=B.gl)==null?void 0:S.outputEncoding)===Xo;if(X)x?m.handlers[W]=x:delete m.handlers[W],m.eventCount=Object.keys(m.handlers).length;else if(k&&k.set&&(k.copy||k instanceof kg)){if(Array.isArray(x))k.fromArray?k.fromArray(x):k.set(...x);else if(k.copy&&x&&x.constructor&&k.constructor.name===x.constructor.name)k.copy(x);else if(x!==void 0){const D=k instanceof ze;!D&&k.setScalar?k.setScalar(x):k instanceof kg&&x instanceof kg?k.mask=x.mask:k.set(x),!U&&D&&k.convertSRGBToLinear()}}else H[W]=x,!U&&H[W]instanceof pn&&(H[W].encoding=Lt);i(C)}),m.parent&&B.internal&&C.raycast&&R!==m.eventCount){const W=B.internal.interaction.indexOf(C);W>-1&&B.internal.interaction.splice(W,1),m.eventCount&&B.internal.interaction.push(C)}return Z.length&&(G=C.__r3f)!=null&&G.parent&&o(C),C}function i(C){var A,f;const b=(A=C.__r3f)==null||(f=A.root)==null||f.getState==null?void 0:f.getState();b&&b.internal.frames===0&&b.invalidate()}function o(C){C.onUpdate==null||C.onUpdate(C)}function s(C,h,b,G,m){var B=h,{args:A=[]}=B,f=qn(B,["args"]);let y=`${C[0].toUpperCase()}${C.slice(1)}`,Z;if(!hh(b)&&m){const R=W=>W.return?R(W.return):W.stateNode&&W.stateNode.containerInfo;b=R(m)}if(!b||!hh(b))throw`No valid root for ${y}!`;if(C==="primitive"){if(f.object===void 0)throw"Primitives without 'object' are invalid!";const R=f.object;Z=nl(R,{root:b,primitive:!0})}else{const R=Dk[y]||Vk[y];if(!R)throw`${y} is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`;if(!Array.isArray(A))throw"The args prop must be an array!";Z=nl(new R(...A),{root:b,memoizedProps:{args:A.length===0?null:A}})}return"attachFns"in f||(y.endsWith("Geometry")?f=gt({attach:"geometry"},f):y.endsWith("Material")&&(f=gt({attach:"material"},f))),t(Z,f),Z}function r(C,A){let f=!1;if(A){if(A.attachArray)Pt.arr(C[A.attachArray])||(C[A.attachArray]=[]),C[A.attachArray].push(A);else if(A.attachObject)Pt.obj(C[A.attachObject[0]])||(C[A.attachObject[0]]={}),C[A.attachObject[0]][A.attachObject[1]]=A;else if(A.attach&&!Pt.fun(A.attach))C[A.attach]=A;else if(Pt.arr(A.attachFns)){const[b]=A.attachFns;Pt.str(b)&&Pt.fun(C[b])?C[b](A):Pt.fun(b)&&b(A,C)}else A.isObject3D&&C.isObject3D&&(C.add(A),f=!0);f||C.__r3f.objects.push(A),A.__r3f||nl(A,{}),A.__r3f.parent=C,o(A),i(A)}}function g(C,A,f){let b=!1;if(A){if(A.attachArray){const G=C[A.attachArray];Pt.arr(G)||(C[A.attachArray]=[]),G.splice(G.indexOf(f),0,A)}else{if(A.attachObject||A.attach&&!Pt.fun(A.attach))return r(C,A);if(A.isObject3D&&C.isObject3D){A.parent=C,A.dispatchEvent({type:"added"});const G=C.children.filter(h=>h!==A),m=G.indexOf(f);C.children=[...G.slice(0,m),A,...G.slice(m)],b=!0}}b||C.__r3f.objects.push(A),A.__r3f||nl(A,{}),A.__r3f.parent=C,o(A),i(A)}}function a(C,A,f=!1){C&&[...C].forEach(b=>l(A,b,f))}function l(C,A,f){if(A){var b,G;if(A.__r3f&&(A.__r3f.parent=null),(b=C.__r3f)!=null&&b.objects&&(C.__r3f.objects=C.__r3f.objects.filter(Z=>Z!==A)),A.attachArray)C[A.attachArray]=C[A.attachArray].filter(Z=>Z!==A);else if(A.attachObject)delete C[A.attachObject[0]][A.attachObject[1]];else if(A.attach&&!Pt.fun(A.attach)&&C[A.attach]===A)C[A.attach]=null;else if(Pt.arr(A.attachFns)){const[,Z]=A.attachFns;Pt.str(Z)&&Pt.fun(C[Z])?C[Z](A):Pt.fun(Z)&&Z(A,C)}else if(A.isObject3D&&C.isObject3D){var m;C.remove(A),(m=A.__r3f)!=null&&m.root&&Tk(A.__r3f.root,A)}const B=(G=A.__r3f)==null?void 0:G.primitive,y=f===void 0?A.dispose!==null&&!B:f;if(!B){var h;a((h=A.__r3f)==null?void 0:h.objects,A,y),a(A.children,A,y)}A.__r3f&&(delete A.__r3f.root,delete A.__r3f.objects,delete A.__r3f.handlers,delete A.__r3f.memoizedProps,B||delete A.__r3f),y&&A.dispose&&A.type!=="Scene"&&Al.exports.unstable_runWithPriority(Al.exports.unstable_IdlePriority,()=>{try{A.dispose()}catch{}}),i(C)}}function u(C,A,f,b){var G;const m=(G=C.__r3f)==null?void 0:G.parent;if(!m)return;const h=s(A,f,C.__r3f.root);A!=="primitive"&&C.children&&(C.children.forEach(B=>r(h,B)),C.children=[]),C.__r3f.objects.forEach(B=>r(h,B)),C.__r3f.objects=[],l(m,C),r(m,h),h.raycast&&h.__r3f.eventCount&&h.__r3f.root.getState().internal.interaction.push(h),[b,b.alternate].forEach(B=>{B!==null&&(B.stateNode=h,B.ref&&(typeof B.ref=="function"?B.ref(h):B.ref.current=h))})}return{reconciler:Mk({now:Al.exports.unstable_now,createInstance:s,removeChild:l,appendChild:r,appendInitialChild:r,insertBefore:g,warnsIfNotActing:!0,supportsMutation:!0,isPrimaryRenderer:!1,scheduleTimeout:Pt.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Pt.fun(clearTimeout)?clearTimeout:void 0,setTimeout:Pt.fun(setTimeout)?setTimeout:void 0,clearTimeout:Pt.fun(clearTimeout)?clearTimeout:void 0,noTimeout:-1,appendChildToContainer:(C,A)=>{const{container:f,root:b}=nb(C,A);f.__r3f.root=b,r(f,A)},removeChildFromContainer:(C,A)=>l(nb(C,A).container,A),insertInContainerBefore:(C,A,f)=>g(nb(C,A).container,A,f),prepareUpdate(C,A,f,b){if(C.__r3f.primitive&&b.object&&b.object!==C)return[!0];{const G=b,{args:h=[],children:B}=G,y=qn(G,["args","children"]),m=f,{args:Z=[],children:R}=m,W=qn(m,["args","children"]);if(!Array.isArray(h))throw"The args prop must be an array!";if(h.some((X,Y)=>X!==Z[Y]))return[!0];const x=e(C,y,W,!0);if(x.changes.length)return[!1,x];if(C.attach&&typeof C.attach!="function"){const Y=C.__r3f.parent;Y&&Y[C.attach]!==C&&r(Y,C)}return null}},commitUpdate(C,[A,f],b,G,m,h){A?u(C,b,m,h):t(C,f)},hideInstance(C){C.isObject3D&&(C.visible=!1,i(C))},unhideInstance(C,A){(C.isObject3D&&A.visible==null||A.visible)&&(C.visible=!0,i(C))},hideTextInstance(){throw new Error("Text is not allowed in the R3F tree.")},getPublicInstance(C){return C},getRootHostContext(C){return Jk},getChildHostContext(C){return C},createTextInstance(){},finalizeInitialChildren(C){var A;return!!((A=C==null?void 0:C.__r3f)!=null?A:{}).handlers},commitMount(C){var A;const f=(A=C==null?void 0:C.__r3f)!=null?A:{};C.raycast&&f.handlers&&f.eventCount&&C.__r3f.root.getState().internal.interaction.push(C)},shouldDeprioritizeSubtree(){return!1},prepareForCommit(){return null},preparePortalMount(C){nl(C)},resetAfterCommit(){},shouldSetTextContent(){return!1},clearContainer(){return!1}}),applyProps:t}}const Qk=n=>!!(n!=null&&n.render),O2=n=>n&&n.isOrthographicCamera;function J0(n){return Array.isArray(n)?Math.min(Math.max(n[0],window.devicePixelRatio),n[1]):n}const BH=ce.exports.createContext(null),Ok=(n,e,t,i)=>{const{gl:o,size:s,shadows:r=!1,linear:g=!1,flat:a=!1,vr:l=!1,orthographic:u=!1,frameloop:d="always",dpr:C=1,performance:A,clock:f=new PB,raycaster:b,camera:G,onPointerMissed:m}=i;r&&(o.shadowMap.enabled=!0,typeof r=="object"?Object.assign(o.shadowMap,r):o.shadowMap.type=lB),g&&(o.outputEncoding=Xo),a&&(o.toneMapping=ts),d==="never"&&(f.stop(),f.elapsedTime=0);const h=Xk((R,W)=>{const x=new lH,Ie=b||{},{params:X}=Ie,Y=qn(Ie,["params"]);n(x,Mt(gt({enabled:!0},Y),{params:gt(gt({},x.params),X)}));const S=G instanceof Og,H=S?G:u?new ca(0,0,0,0,.1,1e3):new Kn(75,0,.1,1e3);S||(H.position.z=5,G&&n(H,G),G!=null&&G.rotation||H.lookAt(0,0,0));const k=J0(C),U=new K,D=new K,Q=new K;function $(T=W().camera,P=D,Ce=W().size){const{width:Me,height:ee}=Ce,_=Me/ee;P instanceof K?Q.copy(P):Q.set(...P);const Ae=T.getWorldPosition(U).distanceTo(Q);if(O2(T))return{width:Me/T.zoom,height:ee/T.zoom,factor:1,distance:Ae,aspect:_};{const ye=T.fov*Math.PI/180,ge=2*Math.tan(ye/2)*Ae,we=ge*(Me/ee);return{width:we,height:ge,factor:Me/we,distance:Ae,aspect:_}}}let j;const oe=T=>R(P=>({performance:Mt(gt({},P.performance),{current:T})}));return{gl:o,set:R,get:W,invalidate:()=>e(W()),advance:(T,P)=>t(T,P,W()),linear:g,flat:a,scene:nl(new PC),camera:H,controls:null,raycaster:x,clock:f,mouse:new Se,vr:l,frameloop:d,onPointerMissed:m,performance:Mt(gt({current:1,min:.5,max:1,debounce:200},A),{regress:()=>{const T=W();j&&clearTimeout(j),T.performance.current!==T.performance.min&&oe(T.performance.min),j=setTimeout(()=>oe(W().performance.max),T.performance.debounce)}}),size:{width:0,height:0},viewport:{initialDpr:k,dpr:k,width:0,height:0,aspect:0,distance:0,factor:0,getCurrentViewport:$},setSize:(T,P)=>{const Ce={width:T,height:P};R(Me=>({size:Ce,viewport:gt(gt({},Me.viewport),$(H,D,Ce))}))},setDpr:T=>R(P=>({viewport:Mt(gt({},P.viewport),{dpr:J0(T)})})),setFrameloop:(T="always")=>R(()=>({frameloop:T})),events:{connected:!1},internal:{active:!1,priority:0,frames:0,lastProps:i,lastEvent:ce.exports.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(T,P=0)=>(R(({internal:Ce})=>({internal:Mt(gt({},Ce),{priority:Ce.priority+(P>0?1:0),subscribers:[...Ce.subscribers,{ref:T,priority:P}].sort((Me,ee)=>Me.priority-ee.priority)})})),()=>{R(({internal:Ce})=>({internal:Mt(gt({},Ce),{priority:Ce.priority-(P>0?1:0),subscribers:Ce.subscribers.filter(Me=>Me.ref!==T)})}))})}}}),B=h.getState();let y=B.size,Z=B.viewport.dpr;return h.subscribe(()=>{const{camera:R,size:W,viewport:x,internal:X}=h.getState();(W!==y||x.dpr!==Z)&&(!R.manual&&!(X.lastProps.camera instanceof Og)&&(O2(R)?(R.left=W.width/-2,R.right=W.width/2,R.top=W.height/2,R.bottom=W.height/-2):R.aspect=W.width/W.height,R.updateProjectionMatrix(),R.updateMatrixWorld()),o.setPixelRatio(x.dpr),o.setSize(W.width,W.height),y=W,Z=x.dpr)}),s&&B.setSize(s.width,s.height),h.subscribe(R=>e(R)),h};let fr,j2=[],q2=[],jk=[];function Ic(n,e){for(fr=0;fr<n.length;fr++)n[fr](e)}function ib(n,e){let t=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(t=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),fr=0;fr<e.internal.subscribers.length;fr++)e.internal.subscribers[fr].ref.current(e,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function qk(n){let e=!1,t;function i(r){if(e=!0,t=0,Ic(j2,r),n.forEach(g=>{const a=g.store.getState();a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&(t+=ib(r,a))}),Ic(q2,r),t>0)return requestAnimationFrame(i);Ic(jk,r),e=!1}function o(r){if(!r)return n.forEach(g=>o(g.store.getState()));r.vr||!r.internal.active||r.frameloop==="never"||(r.internal.frames=Math.min(60,r.internal.frames+1),e||(e=!0,requestAnimationFrame(i)))}function s(r,g=!0,a){g&&Ic(j2,r),a?ib(r,a):n.forEach(l=>ib(r,l.store.getState())),g&&Ic(q2,r)}return{loop:i,invalidate:o,advance:s}}function $k(n){const{handlePointer:e}=Ek(n),t={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};return{connected:!1,handlers:Object.keys(t).reduce((i,o)=>Mt(gt({},i),{[o]:e(o)}),{}),connect:i=>{var o;const{set:s,events:r}=n.getState();r.disconnect==null||r.disconnect(),s(g=>({events:Mt(gt({},g.events),{connected:i})})),Object.entries((o=r==null?void 0:r.handlers)!=null?o:[]).forEach(([g,a])=>{const[l,u]=t[g];i.addEventListener(l,a,{passive:u})})},disconnect:()=>{const{set:i,events:o}=n.getState();if(o.connected){var s;Object.entries((s=o.handlers)!=null?s:[]).forEach(([r,g])=>{if(o&&o.connected instanceof HTMLElement){const[a]=t[r];o.connected.removeEventListener(a,g)}}),i(r=>({events:Mt(gt({},r.events),{connected:!1})}))}}}}const D0=typeof window!="undefined"?ce.exports.useLayoutEffect:ce.exports.useEffect;function eT({set:n}){return D0(()=>(n(new Promise(()=>null)),()=>n(!1)),[]),null}class yH extends ce.exports.Component{constructor(...e){super(...e);this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}yH.getDerivedStateFromError=()=>({error:!0});const qq=ce.exports.forwardRef(function(d,u){var C=d,{children:e,fallback:t,tabIndex:i,resize:o,id:s,style:r,className:g,events:a}=C,l=qn(C,["children","fallback","tabIndex","resize","id","style","className","events"]);const[A,{width:f,height:b}]=Yk(gt({scroll:!0,debounce:{scroll:50,resize:0}},o)),G=ce.exports.useRef(null),[m,h]=ce.exports.useState(!1),[B,y]=ce.exports.useState(!1);if(m)throw m;if(B)throw B;return D0(()=>{f>0&&b>0&&rT(ce.exports.createElement(yH,{set:y},ce.exports.createElement(ce.exports.Suspense,{fallback:ce.exports.createElement(eT,{set:h})},e)),G.current,Mt(gt({},l),{size:{width:f,height:b},events:a||$k}))},[f,b,e]),D0(()=>{const Z=G.current;return()=>RH(Z)},[]),ce.exports.createElement("div",{ref:A,id:s,className:g,tabIndex:i,style:gt({position:"relative",width:"100%",height:"100%",overflow:"hidden"},r)},ce.exports.createElement("canvas",{ref:Fk([G,u]),style:{display:"block"}},t))});function vH(){const n=ce.exports.useContext(BH);if(!n)throw"R3F hooks can only be used within the Canvas component!";return n}function tT(n=t=>t,e){return vH()(n,e)}function nT(n,e=0){const t=vH().getState().internal.subscribe,i=ce.exports.useRef(n);return ce.exports.useLayoutEffect(()=>void(i.current=n),[n]),ce.exports.useLayoutEffect(()=>t(i,e),[e,t]),null}function iT(n){const e={nodes:{},materials:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function ZH(n,e){return function(t,...i){const o=new t;return n&&n(o),Promise.all(i.map(s=>new Promise((r,g)=>o.load(s,a=>{a.scene&&Object.assign(a,iT(a.scene)),r(a)},e,a=>g(`Could not load ${s}: ${a.message}`)))))}}function tu(n,e,t,i){const o=Array.isArray(e)?e:[e],s=Ls(ZH(t,i),n,...o);return Array.isArray(e)?s:s[0]}tu.preload=function(n,e,t){const i=Array.isArray(e)?e:[e];return Ls.preload(ZH(t),n,...i)};tu.clear=function(n,e){const t=Array.isArray(e)?e:[e];return Ls.clear(n,...t)};const RC=new Map,$2=["legacy","blocking","concurrent"],{invalidate:oT,advance:eR}=qk(RC),{reconciler:WC,applyProps:wH}=Pk(),sT=(n,e)=>{const t=typeof n=="function"?n(e):n;if(Qk(t))return t;const i=new Tt(gt({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0},n));return i.outputEncoding=Lt,i.toneMapping=uB,n&&wH(i,n),i};function rT(n,e,a={}){var l=a,{gl:t,size:i,mode:o=$2[1],events:s,onCreated:r}=l,g=qn(l,["gl","size","mode","events","onCreated"]);var u;if(!i){var d,C,A,f;i={width:(d=(C=e.parentElement)==null?void 0:C.clientWidth)!=null?d:0,height:(A=(f=e.parentElement)==null?void 0:f.clientHeight)!=null?A:0}}let b=RC.get(e),G=b==null?void 0:b.fiber,m=b==null?void 0:b.store,h=(u=m)==null?void 0:u.getState();if(G&&h&&(g.dpr!==void 0&&!Pt.equ(h.viewport.dpr,J0(g.dpr))&&h.setDpr(g.dpr),(h.size.width!==i.width||h.size.height!==i.height)&&h.setSize(i.width,i.height),h.frameloop!==g.frameloop&&h.setFrameloop(g.frameloop),g.linear!==h.internal.lastProps.linear&&(RH(e),G=void 0)),!G){const B=sT(t,e);g.vr&&(B.xr.enabled=!0,B.setAnimationLoop(Z=>eR(Z,!0))),m=Ok(wH,oT,eR,gt({gl:B,size:i},g));const y=m.getState();G=WC.createContainer(m,$2.indexOf(o),!1,null),RC.set(e,{fiber:G,store:m}),s&&y.set({events:s(m)})}if(m&&G)return WC.updateContainer(ce.exports.createElement(gT,{store:m,element:n,onCreated:r,target:e}),G,null,()=>{}),m;throw"Error creating root!"}function gT({store:n,element:e,onCreated:t,target:i}){return ce.exports.useEffect(()=>{const o=n.getState();o.set(s=>({internal:Mt(gt({},s.internal),{active:!0})})),o.events.connect==null||o.events.connect(i),t&&t(o)},[]),ce.exports.createElement(BH.Provider,{value:n},e)}function RH(n,e){const t=RC.get(n),i=t==null?void 0:t.fiber;if(i){const o=t==null?void 0:t.store.getState();o&&(o.internal.active=!1),WC.updateContainer(null,i,null,()=>{o&&setTimeout(()=>{var s,r,g;o.events.disconnect==null||o.events.disconnect(),(s=o.gl)==null||(r=s.renderLists)==null||r.dispose==null||r.dispose(),(g=o.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),aT(o),RC.delete(n),e&&e(n)},500)})}}function aT(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const i in n){var e,t;(e=(t=i).dispose)==null||e.call(t),delete n[i]}}WC.act;WC.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:"17.0.2"});var $B={exports:{}},Rl=typeof Reflect=="object"?Reflect:null,tR=Rl&&typeof Rl.apply=="function"?Rl.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},YA;Rl&&typeof Rl.ownKeys=="function"?YA=Rl.ownKeys:Object.getOwnPropertySymbols?YA=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:YA=function(e){return Object.getOwnPropertyNames(e)};function lT(n){console&&console.warn&&console.warn(n)}var WH=Number.isNaN||function(e){return e!==e};function Dt(){Dt.init.call(this)}$B.exports=Dt;$B.exports.once=uT;Dt.EventEmitter=Dt;Dt.prototype._events=void 0;Dt.prototype._eventsCount=0;Dt.prototype._maxListeners=void 0;var nR=10;function ap(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(Dt,"defaultMaxListeners",{enumerable:!0,get:function(){return nR},set:function(n){if(typeof n!="number"||n<0||WH(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");nR=n}});Dt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Dt.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||WH(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function SH(n){return n._maxListeners===void 0?Dt.defaultMaxListeners:n._maxListeners}Dt.prototype.getMaxListeners=function(){return SH(this)};Dt.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var o=e==="error",s=this._events;if(s!==void 0)o=o&&s.error===void 0;else if(!o)return!1;if(o){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var g=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw g.context=r,g}var a=s[e];if(a===void 0)return!1;if(typeof a=="function")tR(a,this,t);else for(var l=a.length,u=MH(a,l),i=0;i<l;++i)tR(u[i],this,t);return!0};function VH(n,e,t,i){var o,s,r;if(ap(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),r=s[e]),r===void 0)r=s[e]=t,++n._eventsCount;else if(typeof r=="function"?r=s[e]=i?[t,r]:[r,t]:i?r.unshift(t):r.push(t),o=SH(n),o>0&&r.length>o&&!r.warned){r.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=n,g.type=e,g.count=r.length,lT(g)}return n}Dt.prototype.addListener=function(e,t){return VH(this,e,t,!1)};Dt.prototype.on=Dt.prototype.addListener;Dt.prototype.prependListener=function(e,t){return VH(this,e,t,!0)};function IT(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function xH(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},o=IT.bind(i);return o.listener=t,i.wrapFn=o,o}Dt.prototype.once=function(e,t){return ap(t),this.on(e,xH(this,e,t)),this};Dt.prototype.prependOnceListener=function(e,t){return ap(t),this.prependListener(e,xH(this,e,t)),this};Dt.prototype.removeListener=function(e,t){var i,o,s,r,g;if(ap(t),o=this._events,o===void 0)return this;if(i=o[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,r=i.length-1;r>=0;r--)if(i[r]===t||i[r].listener===t){g=i[r].listener,s=r;break}if(s<0)return this;s===0?i.shift():cT(i,s),i.length===1&&(o[e]=i[0]),o.removeListener!==void 0&&this.emit("removeListener",e,g||t)}return this};Dt.prototype.off=Dt.prototype.removeListener;Dt.prototype.removeAllListeners=function(e){var t,i,o;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),r;for(o=0;o<s.length;++o)r=s[o],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this};function HH(n,e,t){var i=n._events;if(i===void 0)return[];var o=i[e];return o===void 0?[]:typeof o=="function"?t?[o.listener||o]:[o]:t?CT(o):MH(o,o.length)}Dt.prototype.listeners=function(e){return HH(this,e,!0)};Dt.prototype.rawListeners=function(e){return HH(this,e,!1)};Dt.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):XH.call(n,e)};Dt.prototype.listenerCount=XH;function XH(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Dt.prototype.eventNames=function(){return this._eventsCount>0?YA(this._events):[]};function MH(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function cT(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function CT(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function uT(n,e){return new Promise(function(t,i){function o(r){n.removeListener(e,s),i(r)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",o),t([].slice.call(arguments))}KH(n,e,s,{once:!0}),e!=="error"&&dT(n,o,{once:!0})})}function dT(n,e,t){typeof n.on=="function"&&KH(n,"error",e,t)}function KH(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function o(s){i.once&&n.removeEventListener(e,o),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var AT=$B.exports,lp={exports:{}},nu={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hT=ce.exports,FH=60103;nu.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var iR=Symbol.for;FH=iR("react.element"),nu.Fragment=iR("react.fragment")}var pT=hT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,mT=Object.prototype.hasOwnProperty,fT={key:!0,ref:!0,__self:!0,__source:!0};function YH(n,e,t){var i,o={},s=null,r=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(r=e.ref);for(i in e)mT.call(e,i)&&!fT.hasOwnProperty(i)&&(o[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)o[i]===void 0&&(o[i]=e[i]);return{$$typeof:FH,type:n,key:s,ref:r,props:o,_owner:pT.current}}nu.jsx=YH;nu.jsxs=YH;lp.exports=nu;const en=lp.exports.jsx,SC=lp.exports.jsxs,$q=lp.exports.Fragment;var NH=null;try{var bT=typeof module!="undefined"&&typeof module.require=="function"&&module.require("worker_threads")||typeof __non_webpack_require__=="function"&&__non_webpack_require__("worker_threads")||typeof require=="function"&&require("worker_threads");NH=bT.Worker}catch{}function GT(n,e){return Buffer.from(n,"base64").toString(e?"utf16":"utf8")}function BT(n,e,t){var i=e===void 0?null:e,o=t===void 0?!1:t,s=GT(n,o),r=s.indexOf(`
`,10)+1,g=s.substring(r)+(i?"//# sourceMappingURL="+i:"");return function(l){return new NH(g,Object.assign({},l,{eval:!0}))}}function yT(n,e){var t=atob(n);if(e){for(var i=new Uint8Array(t.length),o=0,s=t.length;o<s;++o)i[o]=t.charCodeAt(o);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return t}function vT(n,e,t){var i=e===void 0?null:e,o=t===void 0?!1:t,s=yT(n,o),r=s.indexOf(`
`,10)+1,g=s.substring(r)+(i?"//# sourceMappingURL="+i:""),a=new Blob([g],{type:"application/javascript"});return URL.createObjectURL(a)}function ZT(n,e,t){var i;return function(s){return i=i||vT(n,e,t),new Worker(i,s)}}var wT=Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";function RT(){return wT}function WT(n,e,t){return RT()?BT(n,e,t):ZT(n,e,t)}var ST=WT("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KICAvKioKICAgKiBBIDN4MyBtYXRyaXguCiAgICogQXV0aG9yZWQgYnkge0BsaW5rIGh0dHA6Ly9naXRodWIuY29tL3NjaHRlcHBlLyBzY2h0ZXBwZX0KICAgKi8KCgogIGNsYXNzIE1hdDMgewogICAgLyoqCiAgICAgKiBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZWxlbWVudHMgQSB2ZWN0b3Igb2YgbGVuZ3RoIDksIGNvbnRhaW5pbmcgYWxsIG1hdHJpeCBlbGVtZW50cy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZWxlbWVudHMpIHsKICAgICAgaWYgKGVsZW1lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBlbGVtZW50cyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKICAgICAgfQoKICAgICAgdGhpcy5lbGVtZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy5lbGVtZW50cyA9IGVsZW1lbnRzOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggdG8gaWRlbnRpdHkKICAgICAqIEB0b2RvIFNob3VsZCBwZXJoYXBzIGJlIHJlbmFtZWQgdG8gYHNldElkZW50aXR5KClgIHRvIGJlIG1vcmUgY2xlYXIuCiAgICAgKiBAdG9kbyBDcmVhdGUgYW5vdGhlciBmdW5jdGlvbiB0aGF0IGltbWVkaWF0ZWx5IGNyZWF0ZXMgYW4gaWRlbnRpdHkgbWF0cml4IGVnLiBgZXllKClgCiAgICAgKi8KCgogICAgaWRlbnRpdHkoKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMTsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDE7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAxOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYWxsIGVsZW1lbnRzIHRvIHplcm8KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVswXSA9IDA7CiAgICAgIGVbMV0gPSAwOwogICAgICBlWzJdID0gMDsKICAgICAgZVszXSA9IDA7CiAgICAgIGVbNF0gPSAwOwogICAgICBlWzVdID0gMDsKICAgICAgZVs2XSA9IDA7CiAgICAgIGVbN10gPSAwOwogICAgICBlWzhdID0gMDsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF0cml4IGRpYWdvbmFsIGVsZW1lbnRzIGZyb20gYSBWZWMzCiAgICAgKi8KCgogICAgc2V0VHJhY2UodmVjdG9yKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gdmVjdG9yLng7CiAgICAgIGVbNF0gPSB2ZWN0b3IueTsKICAgICAgZVs4XSA9IHZlY3Rvci56OwogICAgfQogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMKICAgICAqLwoKCiAgICBnZXRUcmFjZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIHRhcmdldC54ID0gZVswXTsKICAgICAgdGFyZ2V0LnkgPSBlWzRdOwogICAgICB0YXJnZXQueiA9IGVbOF07CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeC1WZWN0b3IgbXVsdGlwbGljYXRpb24KICAgICAqIEBwYXJhbSB2IFRoZSB2ZWN0b3IgdG8gbXVsdGlwbHkgd2l0aAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCwgdGFyZ2V0IHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICB2bXVsdCh2LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IHggPSB2Lng7CiAgICAgIGNvbnN0IHkgPSB2Lnk7CiAgICAgIGNvbnN0IHogPSB2Lno7CiAgICAgIHRhcmdldC54ID0gZVswXSAqIHggKyBlWzFdICogeSArIGVbMl0gKiB6OwogICAgICB0YXJnZXQueSA9IGVbM10gKiB4ICsgZVs0XSAqIHkgKyBlWzVdICogejsKICAgICAgdGFyZ2V0LnogPSBlWzZdICogeCArIGVbN10gKiB5ICsgZVs4XSAqIHo7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeC1zY2FsYXIgbXVsdGlwbGljYXRpb24KICAgICAqLwoKCiAgICBzbXVsdChzKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuZWxlbWVudHNbaV0gKj0gczsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBNYXRyaXggbXVsdGlwbGljYXRpb24KICAgICAqIEBwYXJhbSBtYXRyaXggTWF0cml4IHRvIG11bHRpcGx5IHdpdGggZnJvbSBsZWZ0IHNpZGUuCiAgICAgKi8KCgogICAgbW11bHQobWF0cml4LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgQSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IEIgPSBtYXRyaXguZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGNvbnN0IGExMSA9IEFbMF0sCiAgICAgICAgICAgIGExMiA9IEFbMV0sCiAgICAgICAgICAgIGExMyA9IEFbMl0sCiAgICAgICAgICAgIGEyMSA9IEFbM10sCiAgICAgICAgICAgIGEyMiA9IEFbNF0sCiAgICAgICAgICAgIGEyMyA9IEFbNV0sCiAgICAgICAgICAgIGEzMSA9IEFbNl0sCiAgICAgICAgICAgIGEzMiA9IEFbN10sCiAgICAgICAgICAgIGEzMyA9IEFbOF07CiAgICAgIGNvbnN0IGIxMSA9IEJbMF0sCiAgICAgICAgICAgIGIxMiA9IEJbMV0sCiAgICAgICAgICAgIGIxMyA9IEJbMl0sCiAgICAgICAgICAgIGIyMSA9IEJbM10sCiAgICAgICAgICAgIGIyMiA9IEJbNF0sCiAgICAgICAgICAgIGIyMyA9IEJbNV0sCiAgICAgICAgICAgIGIzMSA9IEJbNl0sCiAgICAgICAgICAgIGIzMiA9IEJbN10sCiAgICAgICAgICAgIGIzMyA9IEJbOF07CiAgICAgIFRbMF0gPSBhMTEgKiBiMTEgKyBhMTIgKiBiMjEgKyBhMTMgKiBiMzE7CiAgICAgIFRbMV0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzI7CiAgICAgIFRbMl0gPSBhMTEgKiBiMTMgKyBhMTIgKiBiMjMgKyBhMTMgKiBiMzM7CiAgICAgIFRbM10gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzE7CiAgICAgIFRbNF0gPSBhMjEgKiBiMTIgKyBhMjIgKiBiMjIgKyBhMjMgKiBiMzI7CiAgICAgIFRbNV0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzM7CiAgICAgIFRbNl0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CiAgICAgIFRbN10gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CiAgICAgIFRbOF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzM7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNjYWxlIGVhY2ggY29sdW1uIG9mIHRoZSBtYXRyaXgKICAgICAqLwoKCiAgICBzY2FsZSh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgdCA9IHRhcmdldC5lbGVtZW50czsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSAzOyBpKyspIHsKICAgICAgICB0WzMgKiBpICsgMF0gPSB2ZWN0b3IueCAqIGVbMyAqIGkgKyAwXTsKICAgICAgICB0WzMgKiBpICsgMV0gPSB2ZWN0b3IueSAqIGVbMyAqIGkgKyAxXTsKICAgICAgICB0WzMgKiBpICsgMl0gPSB2ZWN0b3IueiAqIGVbMyAqIGkgKyAyXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUgQXg9YgogICAgICogQHBhcmFtIGIgVGhlIHJpZ2h0IGhhbmQgc2lkZQogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbC4gVGFyZ2V0IHZlY3RvciB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICogQHRvZG8gc2hvdWxkIHJldXNlIGFycmF5cwogICAgICovCgoKICAgIHNvbHZlKGIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICAvLyBDb25zdHJ1Y3QgZXF1YXRpb25zCiAgICAgIGNvbnN0IG5yID0gMzsgLy8gbnVtIHJvd3MKCiAgICAgIGNvbnN0IG5jID0gNDsgLy8gbnVtIGNvbHMKCiAgICAgIGNvbnN0IGVxbnMgPSBbXTsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IG5yICogbmM7IGkrKykgewogICAgICAgIGVxbnMucHVzaCgwKTsKICAgICAgfQoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA0ICogMF0gPSBiLng7CiAgICAgIGVxbnNbMyArIDQgKiAxXSA9IGIueTsKICAgICAgZXFuc1szICsgNCAqIDJdID0gYi56OyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSA0OyAvLyBudW0gcm93cwoKICAgICAgbGV0IHA7CgogICAgICBkbyB7CiAgICAgICAgaSA9IGsgLSBuOwoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSA9PT0gMCkgewogICAgICAgICAgLy8gdGhlIHBpdm90IGlzIG51bGwsIHN3YXAgbGluZXMKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGpdICE9PSAwKSB7CiAgICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgLy8gZG8gbGlnbmUoIGkgKSA9IGxpZ25lKCBpICkgKyBsaWduZSggayApCiAgICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICAgIGVxbnNbcCArIG5jICogaV0gKz0gZXFuc1twICsgbmMgKiBqXTsKICAgICAgICAgICAgICB9IHdoaWxlICgtLW5wKTsKCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldICE9PSAwKSB7CiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gZXFuc1tpICsgbmMgKiBqXSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgLy8gZG8gbGlnbmUoIGsgKSA9IGxpZ25lKCBrICkgLSBtdWx0aXBsaWVyICogbGlnbmUoIGkgKQogICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgIGVxbnNbcCArIG5jICogal0gPSBwIDw9IGkgPyAwIDogZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgICB9IHdoaWxlICgtLW5wKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gd2hpbGUgKC0tbik7IC8vIEdldCB0aGUgc29sdXRpb24KCgogICAgICB0YXJnZXQueiA9IGVxbnNbMiAqIG5jICsgM10gLyBlcW5zWzIgKiBuYyArIDJdOwogICAgICB0YXJnZXQueSA9IChlcW5zWzEgKiBuYyArIDNdIC0gZXFuc1sxICogbmMgKyAyXSAqIHRhcmdldC56KSAvIGVxbnNbMSAqIG5jICsgMV07CiAgICAgIHRhcmdldC54ID0gKGVxbnNbMCAqIG5jICsgM10gLSBlcW5zWzAgKiBuYyArIDJdICogdGFyZ2V0LnogLSBlcW5zWzAgKiBuYyArIDFdICogdGFyZ2V0LnkpIC8gZXFuc1swICogbmMgKyAwXTsKCiAgICAgIGlmIChpc05hTih0YXJnZXQueCkgfHwgaXNOYU4odGFyZ2V0LnkpIHx8IGlzTmFOKHRhcmdldC56KSB8fCB0YXJnZXQueCA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnkgPT09IEluZmluaXR5IHx8IHRhcmdldC56ID09PSBJbmZpbml0eSkgewogICAgICAgIHRocm93ICJDb3VsZCBub3Qgc29sdmUgZXF1YXRpb24hIEdvdCB4PVsiICsgdGFyZ2V0LnRvU3RyaW5nKCkgKyAiXSwgYj1bIiArIGIudG9TdHJpbmcoKSArICJdLCBBPVsiICsgdGhpcy50b1N0cmluZygpICsgIl0iOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWxlbWVudCBpbiB0aGUgbWF0cml4IGJ5IGluZGV4LiBJbmRleCBzdGFydHMgYXQgMCwgbm90IDEhISEKICAgICAqIEBwYXJhbSB2YWx1ZSBJZiBwcm92aWRlZCwgdGhlIG1hdHJpeCBlbGVtZW50IHdpbGwgYmUgc2V0IHRvIHRoaXMgdmFsdWUuCiAgICAgKi8KCgogICAgZShyb3csIGNvbHVtbiwgdmFsdWUpIHsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50c1tjb2x1bW4gKyAzICogcm93XTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBTZXQgdmFsdWUKICAgICAgICB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29weSBhbm90aGVyIG1hdHJpeCBpbnRvIHRoaXMgbWF0cml4IG9iamVjdC4KICAgICAqLwoKCiAgICBjb3B5KG1hdHJpeCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1hdHJpeC5lbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuZWxlbWVudHNbaV0gPSBtYXRyaXguZWxlbWVudHNbaV07CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBtYXRyaXguCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIGxldCByID0gJyc7CiAgICAgIGNvbnN0IHNlcCA9ICcsJzsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgOTsgaSsrKSB7CiAgICAgICAgciArPSB0aGlzLmVsZW1lbnRzW2ldICsgc2VwOwogICAgICB9CgogICAgICByZXR1cm4gcjsKICAgIH0KICAgIC8qKgogICAgICogcmV2ZXJzZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRhcmdldCBtYXRyaXggdG8gc2F2ZSBpbi4KICAgICAqIEByZXR1cm4gVGhlIHNvbHV0aW9uIHgKICAgICAqLwoKCiAgICByZXZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICAvLyBDb25zdHJ1Y3QgZXF1YXRpb25zCiAgICAgIGNvbnN0IG5yID0gMzsgLy8gbnVtIHJvd3MKCiAgICAgIGNvbnN0IG5jID0gNjsgLy8gbnVtIGNvbHMKCiAgICAgIGNvbnN0IGVxbnMgPSByZXZlcnNlX2VxbnM7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICBlcW5zW2kgKyBuYyAqIGpdID0gdGhpcy5lbGVtZW50c1tpICsgMyAqIGpdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZXFuc1szICsgNiAqIDBdID0gMTsKICAgICAgZXFuc1szICsgNiAqIDFdID0gMDsKICAgICAgZXFuc1szICsgNiAqIDJdID0gMDsKICAgICAgZXFuc1s0ICsgNiAqIDBdID0gMDsKICAgICAgZXFuc1s0ICsgNiAqIDFdID0gMTsKICAgICAgZXFuc1s0ICsgNiAqIDJdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDBdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDFdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDJdID0gMTsgLy8gQ29tcHV0ZSByaWdodCB1cHBlciB0cmlhbmd1bGFyIHZlcnNpb24gb2YgdGhlIG1hdHJpeCAtIEdhdXNzIGVsaW1pbmF0aW9uCgogICAgICBsZXQgbiA9IDM7CiAgICAgIGNvbnN0IGsgPSBuOwogICAgICBsZXQgbnA7CiAgICAgIGNvbnN0IGtwID0gbmM7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaW5lKCBpICkgPSBsaW5lKCBpICkgKyBsaW5lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaW5lKCBrICkgPSBsaW5lKCBrICkgLSBtdWx0aXBsaWVyICogbGluZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gZWxpbWluYXRlIHRoZSB1cHBlciBsZWZ0IHRyaWFuZ2xlIG9mIHRoZSBtYXRyaXgKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gaSAtIDE7CgogICAgICAgIGRvIHsKICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgIG5wID0gbmM7CgogICAgICAgICAgZG8gewogICAgICAgICAgICBwID0gbmMgLSBucDsKICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgIH0gd2hpbGUgKGotLSk7CiAgICAgIH0gd2hpbGUgKC0taSk7IC8vIG9wZXJhdGlvbnMgb24gdGhlIGRpYWdvbmFsCgoKICAgICAgaSA9IDI7CgogICAgICBkbyB7CiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IDEgLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgIG5wID0gbmM7CgogICAgICAgIGRvIHsKICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgZXFuc1twICsgbmMgKiBpXSA9IGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgaSA9IDI7CgogICAgICBkbyB7CiAgICAgICAgaiA9IDI7CgogICAgICAgIGRvIHsKICAgICAgICAgIHAgPSBlcW5zW25yICsgaiArIG5jICogaV07CgogICAgICAgICAgaWYgKGlzTmFOKHApIHx8IHAgPT09IEluZmluaXR5KSB7CiAgICAgICAgICAgIHRocm93ICJDb3VsZCBub3QgcmV2ZXJzZSEgQT1bIiArIHRoaXMudG9TdHJpbmcoKSArICJdIjsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQoKICBjb25zdCByZXZlcnNlX2VxbnMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07CiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB2b2lkIDA7CiAgICAgIHRoaXMueSA9IHZvaWQgMDsKICAgICAgdGhpcy56ID0gdm9pZCAwOwogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLnggKyAiLCIgKyB0aGlzLnkgKyAiLCIgKyB0aGlzLno7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRvIGFuIGFycmF5CiAgICAgKi8KCgogICAgdG9BcnJheSgpIHsKICAgICAgcmV0dXJuIFt0aGlzLngsIHRoaXMueSwgdGhpcy56XTsKICAgIH0KICAgIC8qKgogICAgICogQ29waWVzIHZhbHVlIG9mIHNvdXJjZSB0byB0aGlzIHZlY3Rvci4KICAgICAqLwoKCiAgICBjb3B5KHZlY3RvcikgewogICAgICB0aGlzLnggPSB2ZWN0b3IueDsKICAgICAgdGhpcy55ID0gdmVjdG9yLnk7CiAgICAgIHRoaXMueiA9IHZlY3Rvci56OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byB2ZWN0b3JzCiAgICAgKiBAcGFyYW0gdCBBIG51bWJlciBiZXR3ZWVuIDAgYW5kIDEuIDAgd2lsbCBtYWtlIHRoaXMgZnVuY3Rpb24gcmV0dXJuIHUsIGFuZCAxIHdpbGwgbWFrZSBpdCByZXR1cm4gdi4gTnVtYmVycyBpbiBiZXR3ZWVuIHdpbGwgZ2VuZXJhdGUgYSB2ZWN0b3IgaW4gYmV0d2VlbiB0aGVtLgogICAgICovCgoKICAgIGxlcnAodmVjdG9yLCB0LCB0YXJnZXQpIHsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgdGFyZ2V0LnggPSB4ICsgKHZlY3Rvci54IC0geCkgKiB0OwogICAgICB0YXJnZXQueSA9IHkgKyAodmVjdG9yLnkgLSB5KSAqIHQ7CiAgICAgIHRhcmdldC56ID0geiArICh2ZWN0b3IueiAtIHopICogdDsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2ZWN0b3IgZXF1YWxzIGlzIGFsbW9zdCBlcXVhbCB0byBhbm90aGVyIG9uZS4KICAgICAqLwoKCiAgICBhbG1vc3RFcXVhbHModmVjdG9yLCBwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCAtIHZlY3Rvci54KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnkgLSB2ZWN0b3IueSkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy56IC0gdmVjdG9yLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2ZWN0b3IgaXMgYWxtb3N0IHplcm8KICAgICAqLwoKCiAgICBhbG1vc3RaZXJvKHByZWNpc2lvbikgewogICAgICBpZiAocHJlY2lzaW9uID09PSB2b2lkIDApIHsKICAgICAgICBwcmVjaXNpb24gPSAxZS02OwogICAgICB9CgogICAgICBpZiAoTWF0aC5hYnModGhpcy54KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueikgPiBwcmVjaXNpb24pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgdmVjdG9yIGlzIGFudGktcGFyYWxsZWwgdG8gYW5vdGhlciB2ZWN0b3IuCiAgICAgKiBAcGFyYW0gcHJlY2lzaW9uIFNldCB0byB6ZXJvIGZvciBleGFjdCBjb21wYXJpc29ucwogICAgICovCgoKICAgIGlzQW50aXBhcmFsbGVsVG8odmVjdG9yLCBwcmVjaXNpb24pIHsKICAgICAgdGhpcy5uZWdhdGUoYW50aXBfbmVnKTsKICAgICAgcmV0dXJuIGFudGlwX25lZy5hbG1vc3RFcXVhbHModmVjdG9yLCBwcmVjaXNpb24pOwogICAgfQogICAgLyoqCiAgICAgKiBDbG9uZSB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLngsIHRoaXMueSwgdGhpcy56KTsKICAgIH0KCiAgfQoKICBWZWMzLlpFUk8gPSB2b2lkIDA7CiAgVmVjMy5VTklUX1ggPSB2b2lkIDA7CiAgVmVjMy5VTklUX1kgPSB2b2lkIDA7CiAgVmVjMy5VTklUX1ogPSB2b2lkIDA7CiAgVmVjMy5aRVJPID0gbmV3IFZlYzMoMCwgMCwgMCk7CiAgVmVjMy5VTklUX1ggPSBuZXcgVmVjMygxLCAwLCAwKTsKICBWZWMzLlVOSVRfWSA9IG5ldyBWZWMzKDAsIDEsIDApOwogIFZlYzMuVU5JVF9aID0gbmV3IFZlYzMoMCwgMCwgMSk7CiAgY29uc3QgVmVjM190YW5nZW50c19uID0gbmV3IFZlYzMoKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX3JhbmRWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFudGlwX25lZyA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KCiAgY2xhc3MgQUFCQiB7CiAgICAvKioKICAgICAqIFRoZSBsb3dlciBib3VuZCBvZiB0aGUgYm91bmRpbmcgYm94CiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB1cHBlciBib3VuZCBvZiB0aGUgYm91bmRpbmcgYm94CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5sb3dlckJvdW5kID0gdm9pZCAwOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSB2b2lkIDA7CiAgICAgIHRoaXMubG93ZXJCb3VuZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZCA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5sb3dlckJvdW5kKSB7CiAgICAgICAgdGhpcy5sb3dlckJvdW5kLmNvcHkob3B0aW9ucy5sb3dlckJvdW5kKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudXBwZXJCb3VuZCkgewogICAgICAgIHRoaXMudXBwZXJCb3VuZC5jb3B5KG9wdGlvbnMudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBBQUJCIGJvdW5kcyBmcm9tIGEgc2V0IG9mIHBvaW50cy4KICAgICAqIEBwYXJhbSBwb2ludHMgQW4gYXJyYXkgb2YgVmVjMydzLgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QKICAgICAqLwoKCiAgICBzZXRGcm9tUG9pbnRzKHBvaW50cywgcG9zaXRpb24sIHF1YXRlcm5pb24sIHNraW5TaXplKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IHEgPSBxdWF0ZXJuaW9uOyAvLyBTZXQgdG8gdGhlIGZpcnN0IHBvaW50CgogICAgICBsLmNvcHkocG9pbnRzWzBdKTsKCiAgICAgIGlmIChxKSB7CiAgICAgICAgcS52bXVsdChsLCBsKTsKICAgICAgfQoKICAgICAgdS5jb3B5KGwpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgcCA9IHBvaW50c1tpXTsKCiAgICAgICAgaWYgKHEpIHsKICAgICAgICAgIHEudm11bHQocCwgdG1wJDEpOwogICAgICAgICAgcCA9IHRtcCQxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueCA+IHUueCkgewogICAgICAgICAgdS54ID0gcC54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueCA8IGwueCkgewogICAgICAgICAgbC54ID0gcC54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueSA+IHUueSkgewogICAgICAgICAgdS55ID0gcC55OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueSA8IGwueSkgewogICAgICAgICAgbC55ID0gcC55OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueiA+IHUueikgewogICAgICAgICAgdS56ID0gcC56OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueiA8IGwueikgewogICAgICAgICAgbC56ID0gcC56OwogICAgICAgIH0KICAgICAgfSAvLyBBZGQgb2Zmc2V0CgoKICAgICAgaWYgKHBvc2l0aW9uKSB7CiAgICAgICAgcG9zaXRpb24udmFkZChsLCBsKTsKICAgICAgICBwb3NpdGlvbi52YWRkKHUsIHUpOwogICAgICB9CgogICAgICBpZiAoc2tpblNpemUpIHsKICAgICAgICBsLnggLT0gc2tpblNpemU7CiAgICAgICAgbC55IC09IHNraW5TaXplOwogICAgICAgIGwueiAtPSBza2luU2l6ZTsKICAgICAgICB1LnggKz0gc2tpblNpemU7CiAgICAgICAgdS55ICs9IHNraW5TaXplOwogICAgICAgIHUueiArPSBza2luU2l6ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvcHkgYm91bmRzIGZyb20gYW4gQUFCQiB0byB0aGlzIEFBQkIKICAgICAqIEBwYXJhbSBhYWJiIFNvdXJjZSB0byBjb3B5IGZyb20KICAgICAqIEByZXR1cm4gVGhlIHRoaXMgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5CiAgICAgKi8KCgogICAgY29weShhYWJiKSB7CiAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KGFhYmIubG93ZXJCb3VuZCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC5jb3B5KGFhYmIudXBwZXJCb3VuZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDbG9uZSBhbiBBQUJCCiAgICAgKi8KCgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgQUFCQigpLmNvcHkodGhpcyk7CiAgICB9CiAgICAvKioKICAgICAqIEV4dGVuZCB0aGlzIEFBQkIgc28gdGhhdCBpdCBjb3ZlcnMgdGhlIGdpdmVuIEFBQkIgdG9vLgogICAgICovCgoKICAgIGV4dGVuZChhYWJiKSB7CiAgICAgIHRoaXMubG93ZXJCb3VuZC54ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC54KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnggPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueCwgYWFiYi51cHBlckJvdW5kLngpOwogICAgICB0aGlzLmxvd2VyQm91bmQueSA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC55LCBhYWJiLmxvd2VyQm91bmQueSk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC55ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLnksIGFhYmIudXBwZXJCb3VuZC55KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnogPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueiwgYWFiYi5sb3dlckJvdW5kLnopOwogICAgICB0aGlzLnVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC56LCBhYWJiLnVwcGVyQm91bmQueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBvdmVybGFwcyB0aGlzIEFBQkIuCiAgICAgKi8KCgogICAgb3ZlcmxhcHMoYWFiYikgewogICAgICBjb25zdCBsMSA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTEgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGwyID0gYWFiYi5sb3dlckJvdW5kOwogICAgICBjb25zdCB1MiA9IGFhYmIudXBwZXJCb3VuZDsgLy8gICAgICBsMiAgICAgICAgdTIKICAgICAgLy8gICAgICB8LS0tLS0tLS0tfAogICAgICAvLyB8LS0tLS0tLS18CiAgICAgIC8vIGwxICAgICAgIHUxCgogICAgICBjb25zdCBvdmVybGFwc1ggPSBsMi54IDw9IHUxLnggJiYgdTEueCA8PSB1Mi54IHx8IGwxLnggPD0gdTIueCAmJiB1Mi54IDw9IHUxLng7CiAgICAgIGNvbnN0IG92ZXJsYXBzWSA9IGwyLnkgPD0gdTEueSAmJiB1MS55IDw9IHUyLnkgfHwgbDEueSA8PSB1Mi55ICYmIHUyLnkgPD0gdTEueTsKICAgICAgY29uc3Qgb3ZlcmxhcHNaID0gbDIueiA8PSB1MS56ICYmIHUxLnogPD0gdTIueiB8fCBsMS56IDw9IHUyLnogJiYgdTIueiA8PSB1MS56OwogICAgICByZXR1cm4gb3ZlcmxhcHNYICYmIG92ZXJsYXBzWSAmJiBvdmVybGFwc1o7CiAgICB9IC8vIE1vc3RseSBmb3IgZGVidWdnaW5nCgoKICAgIHZvbHVtZSgpIHsKICAgICAgY29uc3QgbCA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgcmV0dXJuICh1LnggLSBsLngpICogKHUueSAtIGwueSkgKiAodS56IC0gbC56KTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBBQUJCIGlzIGZ1bGx5IGNvbnRhaW5lZCBpbiB0aGlzIEFBQkIuCiAgICAgKi8KCgogICAgY29udGFpbnMoYWFiYikgewogICAgICBjb25zdCBsMSA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTEgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGwyID0gYWFiYi5sb3dlckJvdW5kOwogICAgICBjb25zdCB1MiA9IGFhYmIudXBwZXJCb3VuZDsgLy8gICAgICBsMiAgICAgICAgdTIKICAgICAgLy8gICAgICB8LS0tLS0tLS0tfAogICAgICAvLyB8LS0tLS0tLS0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICAgICAgICAgdTEKCiAgICAgIHJldHVybiBsMS54IDw9IGwyLnggJiYgdTEueCA+PSB1Mi54ICYmIGwxLnkgPD0gbDIueSAmJiB1MS55ID49IHUyLnkgJiYgbDEueiA8PSBsMi56ICYmIHUxLnogPj0gdTIuejsKICAgIH0KCiAgICBnZXRDb3JuZXJzKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpIHsKICAgICAgY29uc3QgbCA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgYS5jb3B5KGwpOwogICAgICBiLnNldCh1LngsIGwueSwgbC56KTsKICAgICAgYy5zZXQodS54LCB1LnksIGwueik7CiAgICAgIGQuc2V0KGwueCwgdS55LCB1LnopOwogICAgICBlLnNldCh1LngsIGwueSwgdS56KTsKICAgICAgZi5zZXQobC54LCB1LnksIGwueik7CiAgICAgIGcuc2V0KGwueCwgbC55LCB1LnopOwogICAgICBoLmNvcHkodSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgcmVwcmVzZW50YXRpb24gb2YgYW4gQUFCQiBpbiBhbm90aGVyIGZyYW1lLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgQUFCQiBvYmplY3QuCiAgICAgKi8KCgogICAgdG9Mb2NhbEZyYW1lKGZyYW1lLCB0YXJnZXQpIHsKICAgICAgY29uc3QgY29ybmVycyA9IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzOwogICAgICBjb25zdCBhID0gY29ybmVyc1swXTsKICAgICAgY29uc3QgYiA9IGNvcm5lcnNbMV07CiAgICAgIGNvbnN0IGMgPSBjb3JuZXJzWzJdOwogICAgICBjb25zdCBkID0gY29ybmVyc1szXTsKICAgICAgY29uc3QgZSA9IGNvcm5lcnNbNF07CiAgICAgIGNvbnN0IGYgPSBjb3JuZXJzWzVdOwogICAgICBjb25zdCBnID0gY29ybmVyc1s2XTsKICAgICAgY29uc3QgaCA9IGNvcm5lcnNbN107IC8vIEdldCBjb3JuZXJzIGluIGN1cnJlbnQgZnJhbWUKCiAgICAgIHRoaXMuZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKTsgLy8gVHJhbnNmb3JtIHRoZW0gdG8gbmV3IGxvY2FsIGZyYW1lCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY29ybmVyID0gY29ybmVyc1tpXTsKICAgICAgICBmcmFtZS5wb2ludFRvTG9jYWwoY29ybmVyLCBjb3JuZXIpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0LnNldEZyb21Qb2ludHMoY29ybmVycyk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgcmVwcmVzZW50YXRpb24gb2YgYW4gQUFCQiBpbiB0aGUgZ2xvYmFsIGZyYW1lLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgQUFCQiBvYmplY3QuCiAgICAgKi8KCgogICAgdG9Xb3JsZEZyYW1lKGZyYW1lLCB0YXJnZXQpIHsKICAgICAgY29uc3QgY29ybmVycyA9IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzOwogICAgICBjb25zdCBhID0gY29ybmVyc1swXTsKICAgICAgY29uc3QgYiA9IGNvcm5lcnNbMV07CiAgICAgIGNvbnN0IGMgPSBjb3JuZXJzWzJdOwogICAgICBjb25zdCBkID0gY29ybmVyc1szXTsKICAgICAgY29uc3QgZSA9IGNvcm5lcnNbNF07CiAgICAgIGNvbnN0IGYgPSBjb3JuZXJzWzVdOwogICAgICBjb25zdCBnID0gY29ybmVyc1s2XTsKICAgICAgY29uc3QgaCA9IGNvcm5lcnNbN107IC8vIEdldCBjb3JuZXJzIGluIGN1cnJlbnQgZnJhbWUKCiAgICAgIHRoaXMuZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKTsgLy8gVHJhbnNmb3JtIHRoZW0gdG8gbmV3IGxvY2FsIGZyYW1lCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY29ybmVyID0gY29ybmVyc1tpXTsKICAgICAgICBmcmFtZS5wb2ludFRvV29ybGQoY29ybmVyLCBjb3JuZXIpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0LnNldEZyb21Qb2ludHMoY29ybmVycyk7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBBQUJCIGlzIGhpdCBieSBhIHJheS4KICAgICAqLwoKCiAgICBvdmVybGFwc1JheShyYXkpIHsKICAgICAgY29uc3QgewogICAgICAgIGRpcmVjdGlvbiwKICAgICAgICBmcm9tCiAgICAgIH0gPSByYXk7IC8vIGNvbnN0IHQgPSAwCiAgICAgIC8vIHJheS5kaXJlY3Rpb24gaXMgdW5pdCBkaXJlY3Rpb24gdmVjdG9yIG9mIHJheQoKICAgICAgY29uc3QgZGlyRnJhY1ggPSAxIC8gZGlyZWN0aW9uLng7CiAgICAgIGNvbnN0IGRpckZyYWNZID0gMSAvIGRpcmVjdGlvbi55OwogICAgICBjb25zdCBkaXJGcmFjWiA9IDEgLyBkaXJlY3Rpb24uejsgLy8gdGhpcy5sb3dlckJvdW5kIGlzIHRoZSBjb3JuZXIgb2YgQUFCQiB3aXRoIG1pbmltYWwgY29vcmRpbmF0ZXMgLSBsZWZ0IGJvdHRvbSwgcnQgaXMgbWF4aW1hbCBjb3JuZXIKCiAgICAgIGNvbnN0IHQxID0gKHRoaXMubG93ZXJCb3VuZC54IC0gZnJvbS54KSAqIGRpckZyYWNYOwogICAgICBjb25zdCB0MiA9ICh0aGlzLnVwcGVyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDMgPSAodGhpcy5sb3dlckJvdW5kLnkgLSBmcm9tLnkpICogZGlyRnJhY1k7CiAgICAgIGNvbnN0IHQ0ID0gKHRoaXMudXBwZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NSA9ICh0aGlzLmxvd2VyQm91bmQueiAtIGZyb20ueikgKiBkaXJGcmFjWjsKICAgICAgY29uc3QgdDYgPSAodGhpcy51cHBlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7IC8vIGNvbnN0IHRtaW4gPSBNYXRoLm1heChNYXRoLm1heChNYXRoLm1pbih0MSwgdDIpLCBNYXRoLm1pbih0MywgdDQpKSk7CiAgICAgIC8vIGNvbnN0IHRtYXggPSBNYXRoLm1pbihNYXRoLm1pbihNYXRoLm1heCh0MSwgdDIpLCBNYXRoLm1heCh0MywgdDQpKSk7CgogICAgICBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSksIE1hdGgubWluKHQ1LCB0NikpOwogICAgICBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSksIE1hdGgubWF4KHQ1LCB0NikpOyAvLyBpZiB0bWF4IDwgMCwgcmF5IChsaW5lKSBpcyBpbnRlcnNlY3RpbmcgQUFCQiwgYnV0IHdob2xlIEFBQkIgaXMgYmVoaW5nIHVzCgogICAgICBpZiAodG1heCA8IDApIHsKICAgICAgICAvL3QgPSB0bWF4OwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAvLyBpZiB0bWluID4gdG1heCwgcmF5IGRvZXNuJ3QgaW50ZXJzZWN0IEFBQkIKCgogICAgICBpZiAodG1pbiA+IHRtYXgpIHsKICAgICAgICAvL3QgPSB0bWF4OwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogIH0KCiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwogIC8qKgogICAqIENvbGxpc2lvbiAibWF0cml4Ii4KICAgKiBJdCdzIGFjdHVhbGx5IGEgdHJpYW5ndWxhci1zaGFwZWQgYXJyYXkgb2Ygd2hldGhlciB0d28gYm9kaWVzIGFyZSB0b3VjaGluZyB0aGlzIHN0ZXAsIGZvciByZWZlcmVuY2UgbmV4dCBzdGVwCiAgICovCgogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0cml4ID0gW107CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50CiAgICAgKi8KCgogICAgZ2V0KGJpLCBiaikgewogICAgICBsZXQgewogICAgICAgIGluZGV4OiBpCiAgICAgIH0gPSBiaTsKICAgICAgbGV0IHsKICAgICAgICBpbmRleDogagogICAgICB9ID0gYmo7CgogICAgICBpZiAoaiA+IGkpIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMubWF0cml4WyhpICogKGkgKyAxKSA+PiAxKSArIGogLSAxXTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBzZXQoYmksIGJqLCB2YWx1ZSkgewogICAgICBsZXQgewogICAgICAgIGluZGV4OiBpCiAgICAgIH0gPSBiaTsKICAgICAgbGV0IHsKICAgICAgICBpbmRleDogagogICAgICB9ID0gYmo7CgogICAgICBpZiAoaiA+IGkpIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdID0gdmFsdWUgPyAxIDogMDsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHRoaXMubWF0cml4Lmxlbmd0aDsgaSAhPT0gbDsgaSsrKSB7CiAgICAgICAgdGhpcy5tYXRyaXhbaV0gPSAwOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1heCBudW1iZXIgb2Ygb2JqZWN0cwogICAgICovCgoKICAgIHNldE51bU9iamVjdHMobikgewogICAgICB0aGlzLm1hdHJpeC5sZW5ndGggPSBuICogKG4gLSAxKSA+PiAxOwogICAgfQoKICB9CiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwoKCiAgY2xhc3MgRXZlbnRUYXJnZXQgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuX2xpc3RlbmVycyA9IHZvaWQgMDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX2xpc3RlbmVycyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgICBpZiAobGlzdGVuZXJzW3R5cGVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICBsaXN0ZW5lcnNbdHlwZV0gPSBbXTsKICAgICAgfQoKICAgICAgaWYgKCFsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdLnB1c2gobGlzdGVuZXIpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gZXZlbnQgbGlzdGVuZXIgaXMgYWRkZWQKICAgICAqLwoKCiAgICBoYXNFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSAhPT0gdW5kZWZpbmVkICYmIGxpc3RlbmVyc1t0eXBlXS5pbmNsdWRlcyhsaXN0ZW5lcikpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbnkgZXZlbnQgbGlzdGVuZXIgb2YgdGhlIGdpdmVuIHR5cGUgaXMgYWRkZWQKICAgICAqLwoKCiAgICBoYXNBbnlFdmVudExpc3RlbmVyKHR5cGUpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CiAgICAgIHJldHVybiBsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZDsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgICBpZiAobGlzdGVuZXJzW3R5cGVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgaW5kZXggPSBsaXN0ZW5lcnNbdHlwZV0uaW5kZXhPZihsaXN0ZW5lcik7CgogICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBFbWl0IGFuIGV2ZW50LgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgZGlzcGF0Y2hFdmVudChldmVudCkgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICBjb25zdCBsaXN0ZW5lckFycmF5ID0gbGlzdGVuZXJzW2V2ZW50LnR5cGVdOwoKICAgICAgaWYgKGxpc3RlbmVyQXJyYXkgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGV2ZW50LnRhcmdldCA9IHRoaXM7CgogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gbGlzdGVuZXJBcnJheS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGxpc3RlbmVyQXJyYXlbaV0uY2FsbCh0aGlzLCBldmVudCk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfQogIC8qKgogICAqIEEgUXVhdGVybmlvbiBkZXNjcmliZXMgYSByb3RhdGlvbiBpbiAzRCBzcGFjZS4gVGhlIFF1YXRlcm5pb24gaXMgbWF0aGVtYXRpY2FsbHkgZGVmaW5lZCBhcyBRID0geCppICsgeSpqICsgeiprICsgdywgd2hlcmUgKGksaixrKSBhcmUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvcnMuICh4LHkseikgY2FuIGJlIHNlZW4gYXMgYSB2ZWN0b3IgcmVsYXRlZCB0byB0aGUgYXhpcyBvZiByb3RhdGlvbiwgd2hpbGUgdGhlIHJlYWwgbXVsdGlwbGllciwgdywgaXMgcmVsYXRlZCB0byB0aGUgYW1vdW50IG9mIHJvdGF0aW9uLgogICAqIEBwYXJhbSB4IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3IgaS4KICAgKiBAcGFyYW0geSBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGouCiAgICogQHBhcmFtIHogTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBrLgogICAqIEBwYXJhbSB3IE11bHRpcGxpZXIgb2YgdGhlIHJlYWwgcGFydC4KICAgKiBAc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUXVhdGVybmlvbgogICAqLwoKCiAgY2xhc3MgUXVhdGVybmlvbiB7CiAgICBjb25zdHJ1Y3Rvcih4LCB5LCB6LCB3KSB7CiAgICAgIGlmICh4ID09PSB2b2lkIDApIHsKICAgICAgICB4ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwOwogICAgICB9CgogICAgICBpZiAoeiA9PT0gdm9pZCAwKSB7CiAgICAgICAgeiA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh3ID09PSB2b2lkIDApIHsKICAgICAgICB3ID0gMTsKICAgICAgfQoKICAgICAgdGhpcy54ID0gdm9pZCAwOwogICAgICB0aGlzLnkgPSB2b2lkIDA7CiAgICAgIHRoaXMueiA9IHZvaWQgMDsKICAgICAgdGhpcy53ID0gdm9pZCAwOwogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICB0aGlzLncgPSB3OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIHNldCh4LCB5LCB6LCB3KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRvIGEgcmVhZGFibGUgZm9ybWF0CiAgICAgKiBAcmV0dXJuICJ4LHkseix3IgogICAgICovCgoKICAgIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gdGhpcy54ICsgIiwiICsgdGhpcy55ICsgIiwiICsgdGhpcy56ICsgIiwiICsgdGhpcy53OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRvIGFuIEFycmF5CiAgICAgKiBAcmV0dXJuIFt4LCB5LCB6LCB3XQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMueiwgdGhpcy53XTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBxdWF0ZXJuaW9uIGNvbXBvbmVudHMgZ2l2ZW4gYW4gYXhpcyBhbmQgYW4gYW5nbGUgaW4gcmFkaWFucy4KICAgICAqLwoKCiAgICBzZXRGcm9tQXhpc0FuZ2xlKHZlY3RvciwgYW5nbGUpIHsKICAgICAgY29uc3QgcyA9IE1hdGguc2luKGFuZ2xlICogMC41KTsKICAgICAgdGhpcy54ID0gdmVjdG9yLnggKiBzOwogICAgICB0aGlzLnkgPSB2ZWN0b3IueSAqIHM7CiAgICAgIHRoaXMueiA9IHZlY3Rvci56ICogczsKICAgICAgdGhpcy53ID0gTWF0aC5jb3MoYW5nbGUgKiAwLjUpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydHMgdGhlIHF1YXRlcm5pb24gdG8gWyBheGlzLCBhbmdsZSBdIHJlcHJlc2VudGF0aW9uLgogICAgICogQHBhcmFtIHRhcmdldEF4aXMgQSB2ZWN0b3Igb2JqZWN0IHRvIHJldXNlIGZvciBzdG9yaW5nIHRoZSBheGlzLgogICAgICogQHJldHVybiBBbiBhcnJheSwgZmlyc3QgZWxlbWVudCBpcyB0aGUgYXhpcyBhbmQgdGhlIHNlY29uZCBpcyB0aGUgYW5nbGUgaW4gcmFkaWFucy4KICAgICAqLwoKCiAgICB0b0F4aXNBbmdsZSh0YXJnZXRBeGlzKSB7CiAgICAgIGlmICh0YXJnZXRBeGlzID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXRBeGlzID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5ub3JtYWxpemUoKTsgLy8gaWYgdz4xIGFjb3MgYW5kIHNxcnQgd2lsbCBwcm9kdWNlIGVycm9ycywgdGhpcyBjYW50IGhhcHBlbiBpZiBxdWF0ZXJuaW9uIGlzIG5vcm1hbGlzZWQKCiAgICAgIGNvbnN0IGFuZ2xlID0gMiAqIE1hdGguYWNvcyh0aGlzLncpOwogICAgICBjb25zdCBzID0gTWF0aC5zcXJ0KDEgLSB0aGlzLncgKiB0aGlzLncpOyAvLyBhc3N1bWluZyBxdWF0ZXJuaW9uIG5vcm1hbGlzZWQgdGhlbiB3IGlzIGxlc3MgdGhhbiAxLCBzbyB0ZXJtIGFsd2F5cyBwb3NpdGl2ZS4KCiAgICAgIGlmIChzIDwgMC4wMDEpIHsKICAgICAgICAvLyB0ZXN0IHRvIGF2b2lkIGRpdmlkZSBieSB6ZXJvLCBzIGlzIGFsd2F5cyBwb3NpdGl2ZSBkdWUgdG8gc3FydAogICAgICAgIC8vIGlmIHMgY2xvc2UgdG8gemVybyB0aGVuIGRpcmVjdGlvbiBvZiBheGlzIG5vdCBpbXBvcnRhbnQKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLng7IC8vIGlmIGl0IGlzIGltcG9ydGFudCB0aGF0IGF4aXMgaXMgbm9ybWFsaXNlZCB0aGVuIHJlcGxhY2Ugd2l0aCB4PTE7IHk9ej0wOwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnk7CiAgICAgICAgdGFyZ2V0QXhpcy56ID0gdGhpcy56OwogICAgICB9IGVsc2UgewogICAgICAgIHRhcmdldEF4aXMueCA9IHRoaXMueCAvIHM7IC8vIG5vcm1hbGlzZSBheGlzCgogICAgICAgIHRhcmdldEF4aXMueSA9IHRoaXMueSAvIHM7CiAgICAgICAgdGFyZ2V0QXhpcy56ID0gdGhpcy56IC8gczsKICAgICAgfQoKICAgICAgcmV0dXJuIFt0YXJnZXRBeGlzLCBhbmdsZV07CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiB2YWx1ZSBnaXZlbiB0d28gdmVjdG9ycy4gVGhlIHJlc3VsdGluZyByb3RhdGlvbiB3aWxsIGJlIHRoZSBuZWVkZWQgcm90YXRpb24gdG8gcm90YXRlIHUgdG8gdi4KICAgICAqLwoKCiAgICBzZXRGcm9tVmVjdG9ycyh1LCB2KSB7CiAgICAgIGlmICh1LmlzQW50aXBhcmFsbGVsVG8odikpIHsKICAgICAgICBjb25zdCB0MSA9IHNmdl90MTsKICAgICAgICBjb25zdCB0MiA9IHNmdl90MjsKICAgICAgICB1LnRhbmdlbnRzKHQxLCB0Mik7CiAgICAgICAgdGhpcy5zZXRGcm9tQXhpc0FuZ2xlKHQxLCBNYXRoLlBJKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBhID0gdS5jcm9zcyh2KTsKICAgICAgICB0aGlzLnggPSBhLng7CiAgICAgICAgdGhpcy55ID0gYS55OwogICAgICAgIHRoaXMueiA9IGEuejsKICAgICAgICB0aGlzLncgPSBNYXRoLnNxcnQodS5sZW5ndGgoKSAqKiAyICogdi5sZW5ndGgoKSAqKiAyKSArIHUuZG90KHYpOwogICAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiB3aXRoIGFuIG90aGVyIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbXVsdChxdWF0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGNvbnN0IGJ4ID0gcXVhdC54OwogICAgICBjb25zdCBieSA9IHF1YXQueTsKICAgICAgY29uc3QgYnogPSBxdWF0Lno7CiAgICAgIGNvbnN0IGJ3ID0gcXVhdC53OwogICAgICB0YXJnZXQueCA9IGF4ICogYncgKyBhdyAqIGJ4ICsgYXkgKiBieiAtIGF6ICogYnk7CiAgICAgIHRhcmdldC55ID0gYXkgKiBidyArIGF3ICogYnkgKyBheiAqIGJ4IC0gYXggKiBiejsKICAgICAgdGFyZ2V0LnogPSBheiAqIGJ3ICsgYXcgKiBieiArIGF4ICogYnkgLSBheSAqIGJ4OwogICAgICB0YXJnZXQudyA9IGF3ICogYncgLSBheCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYno7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgaW52ZXJzZSBxdWF0ZXJuaW9uIHJvdGF0aW9uLgogICAgICovCgoKICAgIGludmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHcgPSB0aGlzLnc7CiAgICAgIHRoaXMuY29uanVnYXRlKHRhcmdldCk7CiAgICAgIGNvbnN0IGlub3JtMiA9IDEgLyAoeCAqIHggKyB5ICogeSArIHogKiB6ICsgdyAqIHcpOwogICAgICB0YXJnZXQueCAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC55ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LnogKj0gaW5vcm0yOwogICAgICB0YXJnZXQudyAqPSBpbm9ybTI7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgcXVhdGVybmlvbiBjb25qdWdhdGUKICAgICAqLwoKCiAgICBjb25qdWdhdGUodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIHRhcmdldC54ID0gLXRoaXMueDsKICAgICAgdGFyZ2V0LnkgPSAtdGhpcy55OwogICAgICB0YXJnZXQueiA9IC10aGlzLno7CiAgICAgIHRhcmdldC53ID0gdGhpcy53OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgdGhlIHF1YXRlcm5pb24uIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBvZiB0aGUgcXVhdGVybmlvbi4KICAgICAqLwoKCiAgICBub3JtYWxpemUoKSB7CiAgICAgIGxldCBsID0gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyk7CgogICAgICBpZiAobCA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbCA9IDEgLyBsOwogICAgICAgIHRoaXMueCAqPSBsOwogICAgICAgIHRoaXMueSAqPSBsOwogICAgICAgIHRoaXMueiAqPSBsOwogICAgICAgIHRoaXMudyAqPSBsOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQXBwcm94aW1hdGlvbiBvZiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24uIFdvcmtzIGJlc3Qgd2hlbiBxdWF0IGlzIGFscmVhZHkgYWxtb3N0LW5vcm1hbGl6ZWQuCiAgICAgKiBAYXV0aG9yIHVucGhhc2VkLCBodHRwczovL2dpdGh1Yi5jb20vdW5waGFzZWQKICAgICAqLwoKCiAgICBub3JtYWxpemVGYXN0KCkgewogICAgICBjb25zdCBmID0gKDMuMCAtICh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpKSAvIDIuMDsKCiAgICAgIGlmIChmID09PSAwKSB7CiAgICAgICAgdGhpcy54ID0gMDsKICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgIHRoaXMueiA9IDA7CiAgICAgICAgdGhpcy53ID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnggKj0gZjsKICAgICAgICB0aGlzLnkgKj0gZjsKICAgICAgICB0aGlzLnogKj0gZjsKICAgICAgICB0aGlzLncgKj0gZjsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHRoZSBxdWF0ZXJuaW9uIGJ5IGEgdmVjdG9yCiAgICAgKi8KCgogICAgdm11bHQodiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHggPSB2Lng7CiAgICAgIGNvbnN0IHkgPSB2Lnk7CiAgICAgIGNvbnN0IHogPSB2Lno7CiAgICAgIGNvbnN0IHF4ID0gdGhpcy54OwogICAgICBjb25zdCBxeSA9IHRoaXMueTsKICAgICAgY29uc3QgcXogPSB0aGlzLno7CiAgICAgIGNvbnN0IHF3ID0gdGhpcy53OyAvLyBxKnYKCiAgICAgIGNvbnN0IGl4ID0gcXcgKiB4ICsgcXkgKiB6IC0gcXogKiB5OwogICAgICBjb25zdCBpeSA9IHF3ICogeSArIHF6ICogeCAtIHF4ICogejsKICAgICAgY29uc3QgaXogPSBxdyAqIHogKyBxeCAqIHkgLSBxeSAqIHg7CiAgICAgIGNvbnN0IGl3ID0gLXF4ICogeCAtIHF5ICogeSAtIHF6ICogejsKICAgICAgdGFyZ2V0LnggPSBpeCAqIHF3ICsgaXcgKiAtcXggKyBpeSAqIC1xeiAtIGl6ICogLXF5OwogICAgICB0YXJnZXQueSA9IGl5ICogcXcgKyBpdyAqIC1xeSArIGl6ICogLXF4IC0gaXggKiAtcXo7CiAgICAgIHRhcmdldC56ID0gaXogKiBxdyArIGl3ICogLXF6ICsgaXggKiAtcXkgLSBpeSAqIC1xeDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29waWVzIHZhbHVlIG9mIHNvdXJjZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIHRoaXMKICAgICAqLwoKCiAgICBjb3B5KHF1YXQpIHsKICAgICAgdGhpcy54ID0gcXVhdC54OwogICAgICB0aGlzLnkgPSBxdWF0Lnk7CiAgICAgIHRoaXMueiA9IHF1YXQuejsKICAgICAgdGhpcy53ID0gcXVhdC53OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0aGUgcXVhdGVybmlvbiB0byBldWxlciBhbmdsZSByZXByZXNlbnRhdGlvbi4gT3JkZXI6IFlaWCwgYXMgdGhpcyBwYWdlIGRlc2NyaWJlczogaHR0cHM6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL3N0YW5kYXJkcy9pbmRleC5odG0KICAgICAqIEBwYXJhbSBvcmRlciBUaHJlZS1jaGFyYWN0ZXIgc3RyaW5nLCBkZWZhdWx0cyB0byAiWVpYIgogICAgICovCgoKICAgIHRvRXVsZXIodGFyZ2V0LCBvcmRlcikgewogICAgICBpZiAob3JkZXIgPT09IHZvaWQgMCkgewogICAgICAgIG9yZGVyID0gJ1laWCc7CiAgICAgIH0KCiAgICAgIGxldCBoZWFkaW5nOwogICAgICBsZXQgYXR0aXR1ZGU7CiAgICAgIGxldCBiYW5rOwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwoKICAgICAgc3dpdGNoIChvcmRlcikgewogICAgICAgIGNhc2UgJ1laWCc6CiAgICAgICAgICBjb25zdCB0ZXN0ID0geCAqIHkgKyB6ICogdzsKCiAgICAgICAgICBpZiAodGVzdCA+IDAuNDk5KSB7CiAgICAgICAgICAgIC8vIHNpbmd1bGFyaXR5IGF0IG5vcnRoIHBvbGUKICAgICAgICAgICAgaGVhZGluZyA9IDIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IE1hdGguUEkgLyAyOwogICAgICAgICAgICBiYW5rID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGVzdCA8IC0wLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBzb3V0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAtMiAqIE1hdGguYXRhbjIoeCwgdyk7CiAgICAgICAgICAgIGF0dGl0dWRlID0gLU1hdGguUEkgLyAyOwogICAgICAgICAgICBiYW5rID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaGVhZGluZyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnN0IHNxeCA9IHggKiB4OwogICAgICAgICAgICBjb25zdCBzcXkgPSB5ICogeTsKICAgICAgICAgICAgY29uc3Qgc3F6ID0geiAqIHo7CiAgICAgICAgICAgIGhlYWRpbmcgPSBNYXRoLmF0YW4yKDIgKiB5ICogdyAtIDIgKiB4ICogeiwgMSAtIDIgKiBzcXkgLSAyICogc3F6KTsgLy8gSGVhZGluZwoKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLmFzaW4oMiAqIHRlc3QpOyAvLyBhdHRpdHVkZQoKICAgICAgICAgICAgYmFuayA9IE1hdGguYXRhbjIoMiAqIHggKiB3IC0gMiAqIHkgKiB6LCAxIC0gMiAqIHNxeCAtIDIgKiBzcXopOyAvLyBiYW5rCiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkV1bGVyIG9yZGVyICIgKyBvcmRlciArICIgbm90IHN1cHBvcnRlZCB5ZXQuIik7CiAgICAgIH0KCiAgICAgIHRhcmdldC55ID0gaGVhZGluZzsKICAgICAgdGFyZ2V0LnogPSBhdHRpdHVkZTsKICAgICAgdGFyZ2V0LnggPSBiYW5rOwogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhlIG9yZGVyIHRvIGFwcGx5IGFuZ2xlczogJ1hZWicgb3IgJ1lYWicgb3IgYW55IG90aGVyIGNvbWJpbmF0aW9uLgogICAgICoKICAgICAqIFNlZSB7QGxpbmsgaHR0cHM6Ly93d3cubWF0aHdvcmtzLmNvbS9tYXRsYWJjZW50cmFsL2ZpbGVleGNoYW5nZS8yMDY5Ni1mdW5jdGlvbi10by1jb252ZXJ0LWJldHdlZW4tZGNtLWV1bGVyLWFuZ2xlcy1xdWF0ZXJuaW9ucy1hbmQtZXVsZXItdmVjdG9ycyBNYXRoV29ya3N9IHJlZmVyZW5jZQogICAgICovCgoKICAgIHNldEZyb21FdWxlcih4LCB5LCB6LCBvcmRlcikgewogICAgICBpZiAob3JkZXIgPT09IHZvaWQgMCkgewogICAgICAgIG9yZGVyID0gJ1hZWic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGMxID0gTWF0aC5jb3MoeCAvIDIpOwogICAgICBjb25zdCBjMiA9IE1hdGguY29zKHkgLyAyKTsKICAgICAgY29uc3QgYzMgPSBNYXRoLmNvcyh6IC8gMik7CiAgICAgIGNvbnN0IHMxID0gTWF0aC5zaW4oeCAvIDIpOwogICAgICBjb25zdCBzMiA9IE1hdGguc2luKHkgLyAyKTsKICAgICAgY29uc3QgczMgPSBNYXRoLnNpbih6IC8gMik7CgogICAgICBpZiAob3JkZXIgPT09ICdYWVonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWVhaJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pYWScpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdaWVgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWVpYJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1haWScpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFF1YXRlcm5pb24odGhpcy54LCB0aGlzLnksIHRoaXMueiwgdGhpcy53KTsKICAgIH0KICAgIC8qKgogICAgICogUGVyZm9ybXMgYSBzcGhlcmljYWwgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gcXVhdAogICAgICoKICAgICAqIEBwYXJhbSB0b1F1YXQgc2Vjb25kIG9wZXJhbmQKICAgICAqIEBwYXJhbSB0IGludGVycG9sYXRpb24gYW1vdW50IGJldHdlZW4gdGhlIHNlbGYgcXVhdGVybmlvbiBhbmQgdG9RdWF0CiAgICAgKiBAcGFyYW0gdGFyZ2V0IEEgcXVhdGVybmlvbiB0byBzdG9yZSB0aGUgcmVzdWx0IGluLiBJZiBub3QgcHJvdmlkZWQsIGEgbmV3IG9uZSB3aWxsIGJlIGNyZWF0ZWQuCiAgICAgKiBAcmV0dXJucyB7UXVhdGVybmlvbn0gVGhlICJ0YXJnZXQiIG9iamVjdAogICAgICovCgoKICAgIHNsZXJwKHRvUXVhdCwgdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBsZXQgYnggPSB0b1F1YXQueDsKICAgICAgbGV0IGJ5ID0gdG9RdWF0Lnk7CiAgICAgIGxldCBieiA9IHRvUXVhdC56OwogICAgICBsZXQgYncgPSB0b1F1YXQudzsKICAgICAgbGV0IG9tZWdhOwogICAgICBsZXQgY29zb207CiAgICAgIGxldCBzaW5vbTsKICAgICAgbGV0IHNjYWxlMDsKICAgICAgbGV0IHNjYWxlMTsgLy8gY2FsYyBjb3NpbmUKCiAgICAgIGNvc29tID0gYXggKiBieCArIGF5ICogYnkgKyBheiAqIGJ6ICsgYXcgKiBidzsgLy8gYWRqdXN0IHNpZ25zIChpZiBuZWNlc3NhcnkpCgogICAgICBpZiAoY29zb20gPCAwLjApIHsKICAgICAgICBjb3NvbSA9IC1jb3NvbTsKICAgICAgICBieCA9IC1ieDsKICAgICAgICBieSA9IC1ieTsKICAgICAgICBieiA9IC1iejsKICAgICAgICBidyA9IC1idzsKICAgICAgfSAvLyBjYWxjdWxhdGUgY29lZmZpY2llbnRzCgoKICAgICAgaWYgKDEuMCAtIGNvc29tID4gMC4wMDAwMDEpIHsKICAgICAgICAvLyBzdGFuZGFyZCBjYXNlIChzbGVycCkKICAgICAgICBvbWVnYSA9IE1hdGguYWNvcyhjb3NvbSk7CiAgICAgICAgc2lub20gPSBNYXRoLnNpbihvbWVnYSk7CiAgICAgICAgc2NhbGUwID0gTWF0aC5zaW4oKDEuMCAtIHQpICogb21lZ2EpIC8gc2lub207CiAgICAgICAgc2NhbGUxID0gTWF0aC5zaW4odCAqIG9tZWdhKSAvIHNpbm9tOwogICAgICB9IGVsc2UgewogICAgICAgIC8vICJmcm9tIiBhbmQgInRvIiBxdWF0ZXJuaW9ucyBhcmUgdmVyeSBjbG9zZQogICAgICAgIC8vICAuLi4gc28gd2UgY2FuIGRvIGEgbGluZWFyIGludGVycG9sYXRpb24KICAgICAgICBzY2FsZTAgPSAxLjAgLSB0OwogICAgICAgIHNjYWxlMSA9IHQ7CiAgICAgIH0gLy8gY2FsY3VsYXRlIGZpbmFsIHZhbHVlcwoKCiAgICAgIHRhcmdldC54ID0gc2NhbGUwICogYXggKyBzY2FsZTEgKiBieDsKICAgICAgdGFyZ2V0LnkgPSBzY2FsZTAgKiBheSArIHNjYWxlMSAqIGJ5OwogICAgICB0YXJnZXQueiA9IHNjYWxlMCAqIGF6ICsgc2NhbGUxICogYno7CiAgICAgIHRhcmdldC53ID0gc2NhbGUwICogYXcgKyBzY2FsZTEgKiBidzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogUm90YXRlIGFuIGFic29sdXRlIG9yaWVudGF0aW9uIHF1YXRlcm5pb24gZ2l2ZW4gYW4gYW5ndWxhciB2ZWxvY2l0eSBhbmQgYSB0aW1lIHN0ZXAuCiAgICAgKi8KCgogICAgaW50ZWdyYXRlKGFuZ3VsYXJWZWxvY2l0eSwgZHQsIGFuZ3VsYXJGYWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCBheCA9IGFuZ3VsYXJWZWxvY2l0eS54ICogYW5ndWxhckZhY3Rvci54LAogICAgICAgICAgICBheSA9IGFuZ3VsYXJWZWxvY2l0eS55ICogYW5ndWxhckZhY3Rvci55LAogICAgICAgICAgICBheiA9IGFuZ3VsYXJWZWxvY2l0eS56ICogYW5ndWxhckZhY3Rvci56LAogICAgICAgICAgICBieCA9IHRoaXMueCwKICAgICAgICAgICAgYnkgPSB0aGlzLnksCiAgICAgICAgICAgIGJ6ID0gdGhpcy56LAogICAgICAgICAgICBidyA9IHRoaXMudzsKICAgICAgY29uc3QgaGFsZl9kdCA9IGR0ICogMC41OwogICAgICB0YXJnZXQueCArPSBoYWxmX2R0ICogKGF4ICogYncgKyBheSAqIGJ6IC0gYXogKiBieSk7CiAgICAgIHRhcmdldC55ICs9IGhhbGZfZHQgKiAoYXkgKiBidyArIGF6ICogYnggLSBheCAqIGJ6KTsKICAgICAgdGFyZ2V0LnogKz0gaGFsZl9kdCAqIChheiAqIGJ3ICsgYXggKiBieSAtIGF5ICogYngpOwogICAgICB0YXJnZXQudyArPSBoYWxmX2R0ICogKC1heCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYnopOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICB9CgogIGNvbnN0IHNmdl90MSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc2Z2X3QyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBUaGUgYXZhaWxhYmxlIHNoYXBlIHR5cGVzLgogICAqLwoKICBjb25zdCBTSEFQRV9UWVBFUyA9IHsKICAgIC8qKiBTUEhFUkUgKi8KICAgIFNQSEVSRTogMSwKCiAgICAvKiogUExBTkUgKi8KICAgIFBMQU5FOiAyLAoKICAgIC8qKiBCT1ggKi8KICAgIEJPWDogNCwKCiAgICAvKiogQ09NUE9VTkQgKi8KICAgIENPTVBPVU5EOiA4LAoKICAgIC8qKiBDT05WRVhQT0xZSEVEUk9OICovCiAgICBDT05WRVhQT0xZSEVEUk9OOiAxNiwKCiAgICAvKiogSEVJR0hURklFTEQgKi8KICAgIEhFSUdIVEZJRUxEOiAzMiwKCiAgICAvKiogUEFSVElDTEUgKi8KICAgIFBBUlRJQ0xFOiA2NCwKCiAgICAvKiogQ1lMSU5ERVIgKi8KICAgIENZTElOREVSOiAxMjgsCgogICAgLyoqIFRSSU1FU0ggKi8KICAgIFRSSU1FU0g6IDI1NgogIH07CiAgLyoqCiAgICogU2hhcGVUeXBlCiAgICovCgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIHNoYXBlcwogICAqLwoKICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy50eXBlID0gdm9pZCAwOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvblJlc3BvbnNlID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9keSA9IHZvaWQgMDsKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgImNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAiICsgdGhpcy50eXBlOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyAidm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICIgKyB0aGlzLnR5cGU7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyAiY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICIgKyB0aGlzLnR5cGU7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgImNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAiICsgdGhpcy50eXBlOwogICAgfQoKICB9CgogIFNoYXBlLmlkQ291bnRlciA9IDA7CiAgU2hhcGUudHlwZXMgPSBTSEFQRV9UWVBFUzsKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCgogIGNsYXNzIFRyYW5zZm9ybSB7CiAgICAvKioKICAgICAqIHBvc2l0aW9uCiAgICAgKi8KCiAgICAvKioKICAgICAqIHF1YXRlcm5pb24KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnBvc2l0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNvbnN0IHRtcFF1YXQkMSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwoKICBjbGFzcyBDb252ZXhQb2x5aGVkcm9uIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHZlcnRpY2VzICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VyIGFycmF5cywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIGZhY2UgY29uc2lzdHMgb2YKICAgICAqLwoKICAgIC8qKiBmYWNlTm9ybWFscyAqLwoKICAgIC8qKiB3b3JsZFZlcnRpY2VzICovCgogICAgLyoqIHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSAqLwoKICAgIC8qKiB3b3JsZEZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHNOZWVkc1VwZGF0ZSAqLwoKICAgIC8qKgogICAgICogSWYgZ2l2ZW4sIHRoZXNlIGxvY2FsbHkgZGVmaW5lZCwgbm9ybWFsaXplZCBheGVzIGFyZSB0aGUgb25seSBvbmVzIGJlaW5nIGNoZWNrZWQgd2hlbiBkb2luZyBzZXBhcmF0aW5nIGF4aXMgY2hlY2suCiAgICAgKi8KCiAgICAvKiogdW5pcXVlRWRnZXMgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSB2ZXJ0aWNlcyBBbiBhcnJheSBvZiBWZWMzJ3MKICAgICAqIEBwYXJhbSBmYWNlcyBBcnJheSBvZiBpbnRlZ2VyIGFycmF5cywgZGVzY3JpYmluZyB3aGljaCB2ZXJ0aWNlcyB0aGF0IGlzIGluY2x1ZGVkIGluIGVhY2ggZmFjZS4KICAgICAqLwogICAgY29uc3RydWN0b3IocHJvcHMpIHsKICAgICAgaWYgKHByb3BzID09PSB2b2lkIDApIHsKICAgICAgICBwcm9wcyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCB7CiAgICAgICAgdmVydGljZXMgPSBbXSwKICAgICAgICBmYWNlcyA9IFtdLAogICAgICAgIG5vcm1hbHMgPSBbXSwKICAgICAgICBheGVzLAogICAgICAgIGJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgIH0gPSBwcm9wczsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04KICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZmFjZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGRWZXJ0aWNlcyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMudW5pcXVlQXhlcyA9IHZvaWQgMDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IHZvaWQgMDsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlZlcnRleCAiICsgdGhpcy5mYWNlc1tpXVtqXSArICIgbm90IGZvdW5kISIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY29uc3QgbiA9IHRoaXMuZmFjZU5vcm1hbHNbaV0gfHwgbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmdldEZhY2VOb3JtYWwoaSwgbik7CiAgICAgICAgbi5uZWdhdGUobik7CiAgICAgICAgdGhpcy5mYWNlTm9ybWFsc1tpXSA9IG47CiAgICAgICAgY29uc3QgdmVydGV4ID0gdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldWzBdXTsKCiAgICAgICAgaWYgKG4uZG90KHZlcnRleCkgPCAwKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCIuZmFjZU5vcm1hbHNbIiArIGkgKyAiXSA9IFZlYzMoIiArIG4udG9TdHJpbmcoKSArICIpIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuIik7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiLnZlcnRpY2VzWyIgKyB0aGlzLmZhY2VzW2ldW2pdICsgIl0gPSBWZWMzKCIgKyB0aGlzLnZlcnRpY2VzW3RoaXMuZmFjZXNbaV1bal1dLnRvU3RyaW5nKCkgKyAiKSIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWwgb2YgYSBmYWNlIGZyb20gaXRzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgZ2V0RmFjZU5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgZiA9IHRoaXMuZmFjZXNbaV07CiAgICAgIGNvbnN0IHZhID0gdGhpcy52ZXJ0aWNlc1tmWzBdXTsKICAgICAgY29uc3QgdmIgPSB0aGlzLnZlcnRpY2VzW2ZbMV1dOwogICAgICBjb25zdCB2YyA9IHRoaXMudmVydGljZXNbZlsyXV07CiAgICAgIENvbnZleFBvbHloZWRyb24uY29tcHV0ZU5vcm1hbCh2YSwgdmIsIHZjLCB0YXJnZXQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICBjb25zdCBjYiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICAgICAgdmIudnN1Yih2YSwgYWIpOwogICAgICB2Yy52c3ViKHZiLCBjYik7CiAgICAgIGNiLmNyb3NzKGFiLCB0YXJnZXQpOwoKICAgICAgaWYgKCF0YXJnZXQuaXNaZXJvKCkpIHsKICAgICAgICB0YXJnZXQubm9ybWFsaXplKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIG1pbkRpc3QgQ2xhbXAgZGlzdGFuY2UKICAgICAqIEBwYXJhbSByZXN1bHQgVGhlIGFuIGFycmF5IG9mIGNvbnRhY3QgcG9pbnQgb2JqZWN0cywgc2VlIGNsaXBGYWNlQWdhaW5zdEh1bGwKICAgICAqLwoKCiAgICBjbGlwQWdhaW5zdEh1bGwocG9zQSwgcXVhdEEsIGh1bGxCLCBwb3NCLCBxdWF0Qiwgc2VwYXJhdGluZ05vcm1hbCwgbWluRGlzdCwgbWF4RGlzdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IFdvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgbGV0IGNsb3Nlc3RGYWNlQiA9IC0xOwogICAgICBsZXQgZG1heCA9IC1OdW1iZXIuTUFYX1ZBTFVFOwoKICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCBodWxsQi5mYWNlcy5sZW5ndGg7IGZhY2UrKykgewogICAgICAgIFdvcmxkTm9ybWFsLmNvcHkoaHVsbEIuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRCLnZtdWx0KFdvcmxkTm9ybWFsLCBXb3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3QgZCA9IFdvcmxkTm9ybWFsLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPiBkbWF4KSB7CiAgICAgICAgICBkbWF4ID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQiA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCB3b3JsZFZlcnRzQjEgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaHVsbEIuZmFjZXNbY2xvc2VzdEZhY2VCXS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBodWxsQi52ZXJ0aWNlc1todWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdW2ldXTsKICAgICAgICBjb25zdCB3b3JsZGIgPSBuZXcgVmVjMygpOwogICAgICAgIHdvcmxkYi5jb3B5KGIpOwogICAgICAgIHF1YXRCLnZtdWx0KHdvcmxkYiwgd29ybGRiKTsKICAgICAgICBwb3NCLnZhZGQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHdvcmxkVmVydHNCMS5wdXNoKHdvcmxkYik7CiAgICAgIH0KCiAgICAgIGlmIChjbG9zZXN0RmFjZUIgPj0gMCkgewogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZpbmQgdGhlIHNlcGFyYXRpbmcgYXhpcyBiZXR3ZWVuIHRoaXMgaHVsbCBhbmQgYW5vdGhlcgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IHZlY3RvciB0byBzYXZlIHRoZSBheGlzIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgZmFsc2UgaWYgYSBzZXBhcmF0aW9uIGlzIGZvdW5kLCBlbHNlIHRydWUKICAgICAqLwoKCiAgICBmaW5kU2VwYXJhdGluZ0F4aXMoaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0QiwgdGFyZ2V0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBmYWNlQU5vcm1hbFdTMyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IFdvcmxkbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGRlbHRhQyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTAgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB3b3JsZEVkZ2UxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgQ3Jvc3MgPSBuZXcgVmVjMygpOwogICAgICBsZXQgZG1pbiA9IE51bWJlci5NQVhfVkFMVUU7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKCiAgICAgIGlmICghaHVsbEEudW5pcXVlQXhlcykgewogICAgICAgIGNvbnN0IG51bUZhY2VzQSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QS5sZW5ndGggOiBodWxsQS5mYWNlcy5sZW5ndGg7IC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEEKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1GYWNlc0E7IGkrKykgewogICAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdEEgPyBmYWNlTGlzdEFbaV0gOiBpOyAvLyBHZXQgd29ybGQgZmFjZSBub3JtYWwKCiAgICAgICAgICBmYWNlQU5vcm1hbFdTMy5jb3B5KGh1bGxBLmZhY2VOb3JtYWxzW2ZpXSk7CiAgICAgICAgICBxdWF0QS52bXVsdChmYWNlQU5vcm1hbFdTMywgZmFjZUFOb3JtYWxXUzMpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKGZhY2VBTm9ybWFsV1MzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKTsKCiAgICAgICAgICBpZiAoZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkIDwgZG1pbikgewogICAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgICAgdGFyZ2V0LmNvcHkoZmFjZUFOb3JtYWxXUzMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUZXN0IHVuaXF1ZSBheGVzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGh1bGxBLnVuaXF1ZUF4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIC8vIEdldCB3b3JsZCBheGlzCiAgICAgICAgICBxdWF0QS52bXVsdChodWxsQS51bmlxdWVBeGVzW2ldLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWh1bGxCLnVuaXF1ZUF4ZXMpIHsKICAgICAgICAvLyBUZXN0IGZhY2Ugbm9ybWFscyBmcm9tIGh1bGxCCiAgICAgICAgY29uc3QgbnVtRmFjZXNCID0gZmFjZUxpc3RCID8gZmFjZUxpc3RCLmxlbmd0aCA6IGh1bGxCLmZhY2VzLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1GYWNlc0I7IGkrKykgewogICAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEJbaV0gOiBpOwogICAgICAgICAgV29ybGRub3JtYWwxLmNvcHkoaHVsbEIuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRCLnZtdWx0KFdvcmxkbm9ybWFsMSwgV29ybGRub3JtYWwxKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhXb3JsZG5vcm1hbDEsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShXb3JsZG5vcm1hbDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUZXN0IHVuaXF1ZSBheGVzIGluIEIKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEIudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlQXhlc1tpXSwgV29ybGRub3JtYWwxKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhXb3JsZG5vcm1hbDEsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShXb3JsZG5vcm1hbDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBUZXN0IGVkZ2VzCgoKICAgICAgZm9yIChsZXQgZTAgPSAwOyBlMCAhPT0gaHVsbEEudW5pcXVlRWRnZXMubGVuZ3RoOyBlMCsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UKICAgICAgICBxdWF0QS52bXVsdChodWxsQS51bmlxdWVFZGdlc1tlMF0sIHdvcmxkRWRnZTApOwoKICAgICAgICBmb3IgKGxldCBlMSA9IDA7IGUxICE9PSBodWxsQi51bmlxdWVFZGdlcy5sZW5ndGg7IGUxKyspIHsKICAgICAgICAgIC8vIEdldCB3b3JsZCBlZGdlIDIKICAgICAgICAgIHF1YXRCLnZtdWx0KGh1bGxCLnVuaXF1ZUVkZ2VzW2UxXSwgd29ybGRFZGdlMSk7CiAgICAgICAgICB3b3JsZEVkZ2UwLmNyb3NzKHdvcmxkRWRnZTEsIENyb3NzKTsKCiAgICAgICAgICBpZiAoIUNyb3NzLmFsbW9zdFplcm8oKSkgewogICAgICAgICAgICBDcm9zcy5ub3JtYWxpemUoKTsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IGh1bGxBLnRlc3RTZXBBeGlzKENyb3NzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKTsKCiAgICAgICAgICAgIGlmIChkaXN0ID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRpc3QgPCBkbWluKSB7CiAgICAgICAgICAgICAgZG1pbiA9IGRpc3Q7CiAgICAgICAgICAgICAgdGFyZ2V0LmNvcHkoQ3Jvc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBwb3NCLnZzdWIocG9zQSwgZGVsdGFDKTsKCiAgICAgIGlmIChkZWx0YUMuZG90KHRhcmdldCkgPiAwLjApIHsKICAgICAgICB0YXJnZXQubmVnYXRlKHRhcmdldCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBUZXN0IHNlcGFyYXRpbmcgYXhpcyBhZ2FpbnN0IHR3byBodWxscy4gQm90aCBodWxscyBhcmUgcHJvamVjdGVkIG9udG8gdGhlIGF4aXMgYW5kIHRoZSBvdmVybGFwIHNpemUgaXMgcmV0dXJuZWQgaWYgdGhlcmUgaXMgb25lLgogICAgICogQHJldHVybiBUaGUgb3ZlcmxhcCBkZXB0aCwgb3IgRkFMU0UgaWYgbm8gcGVuZXRyYXRpb24uCiAgICAgKi8KCgogICAgdGVzdFNlcEF4aXMoYXhpcywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0QikgewogICAgICBjb25zdCBodWxsQSA9IHRoaXM7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQSwgYXhpcywgcG9zQSwgcXVhdEEsIG1heG1pbkEpOwogICAgICBDb252ZXhQb2x5aGVkcm9uLnByb2plY3QoaHVsbEIsIGF4aXMsIHBvc0IsIHF1YXRCLCBtYXhtaW5CKTsKICAgICAgY29uc3QgbWF4QSA9IG1heG1pbkFbMF07CiAgICAgIGNvbnN0IG1pbkEgPSBtYXhtaW5BWzFdOwogICAgICBjb25zdCBtYXhCID0gbWF4bWluQlswXTsKICAgICAgY29uc3QgbWluQiA9IG1heG1pbkJbMV07CgogICAgICBpZiAobWF4QSA8IG1pbkIgfHwgbWF4QiA8IG1pbkEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFNlcGFyYXRlZAogICAgICB9CgogICAgICBjb25zdCBkMCA9IG1heEEgLSBtaW5COwogICAgICBjb25zdCBkMSA9IG1heEIgLSBtaW5BOwogICAgICBjb25zdCBkZXB0aCA9IGQwIDwgZDEgPyBkMCA6IGQxOwogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgY29uc3QgYWFiYm1heCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGFhYmJtaW4gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoYWFiYm1pbiwgYWFiYm1heCk7CiAgICAgIGNvbnN0IHggPSBhYWJibWF4LnggLSBhYWJibWluLng7CiAgICAgIGNvbnN0IHkgPSBhYWJibWF4LnkgLSBhYWJibWluLnk7CiAgICAgIGNvbnN0IHogPSBhYWJibWF4LnogLSBhYWJibWluLno7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueSA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHggKiAyICogeCk7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSBmYWNlX2kgSW5kZXggb2YgdGhlIGZhY2UKICAgICAqLwoKCiAgICBnZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGZhY2VfaSkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tmYWNlX2ldOwogICAgICBjb25zdCBuID0gdGhpcy5mYWNlTm9ybWFsc1tmYWNlX2ldOwogICAgICBjb25zdCB2ID0gdGhpcy52ZXJ0aWNlc1tmWzBdXTsKICAgICAgY29uc3QgYyA9IC1uLmRvdCh2KTsKICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICAvKioKICAgICAqIENsaXAgYSBmYWNlIGFnYWluc3QgYSBodWxsLgogICAgICogQHBhcmFtIHdvcmxkVmVydHNCMSBBbiBhcnJheSBvZiBWZWMzIHdpdGggdmVydGljZXMgaW4gdGhlIHdvcmxkIGZyYW1lLgogICAgICogQHBhcmFtIG1pbkRpc3QgRGlzdGFuY2UgY2xhbXBpbmcKICAgICAqIEBwYXJhbSBBcnJheSByZXN1bHQgQXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGNvbnRhY3QgcG9pbnRzIGluLiBXaWxsIGJlIG9iamVjdHMgd2l0aCBwcm9wZXJ0aWVzOiBwb2ludCwgZGVwdGgsIG5vcm1hbC4gVGhlc2UgYXJlIHJlcHJlc2VudGVkIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIGNsaXBGYWNlQWdhaW5zdEh1bGwoc2VwYXJhdGluZ05vcm1hbCwgcG9zQSwgcXVhdEEsIHdvcmxkVmVydHNCMSwgbWluRGlzdCwgbWF4RGlzdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBlZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IFdvcmxkRWRnZTAgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB3b3JsZFBsYW5lQW5vcm1hbDEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkQTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBsb2NhbFBsYW5lTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGxhbmVOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgY29uc3Qgd29ybGRWZXJ0c0IyID0gW107CiAgICAgIGNvbnN0IHBWdHhJbiA9IHdvcmxkVmVydHNCMTsKICAgICAgY29uc3QgcFZ0eE91dCA9IHdvcmxkVmVydHNCMjsKICAgICAgbGV0IGNsb3Nlc3RGYWNlQSA9IC0xOwogICAgICBsZXQgZG1pbiA9IE51bWJlci5NQVhfVkFMVUU7IC8vIEZpbmQgdGhlIGZhY2Ugd2l0aCBub3JtYWwgY2xvc2VzdCB0byB0aGUgc2VwYXJhdGluZyBheGlzCgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgZmFjZUFOb3JtYWxXUy5jb3B5KGh1bGxBLmZhY2VOb3JtYWxzW2ZhY2VdKTsKICAgICAgICBxdWF0QS52bXVsdChmYWNlQU5vcm1hbFdTLCBmYWNlQU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBkID0gZmFjZUFOb3JtYWxXUy5kb3Qoc2VwYXJhdGluZ05vcm1hbCk7CgogICAgICAgIGlmIChkIDwgZG1pbikgewogICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICBjbG9zZXN0RmFjZUEgPSBmYWNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQSA8IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gR2V0IHRoZSBmYWNlIGFuZCBjb25zdHJ1Y3QgY29ubmVjdGVkIGZhY2VzCgoKICAgICAgY29uc3QgcG9seUEgPSBodWxsQS5mYWNlc1tjbG9zZXN0RmFjZUFdOwogICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcyA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQS5mYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaHVsbEEuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICgKICAgICAgICAgIC8qIFNoYXJpbmcgYSB2ZXJ0ZXgqLwogICAgICAgICAgcG9seUEuaW5kZXhPZihodWxsQS5mYWNlc1tpXVtqXSkgIT09IC0xICYmCiAgICAgICAgICAvKiBOb3QgdGhlIG9uZSB3ZSBhcmUgbG9va2luZyBmb3IgY29ubmVjdGlvbnMgZnJvbSAqLwogICAgICAgICAgaSAhPT0gY2xvc2VzdEZhY2VBICYmCiAgICAgICAgICAvKiBOb3QgYWxyZWFkeSBhZGRlZCAqLwogICAgICAgICAgcG9seUEuY29ubmVjdGVkRmFjZXMuaW5kZXhPZihpKSA9PT0gLTEpIHsKICAgICAgICAgICAgcG9seUEuY29ubmVjdGVkRmFjZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gQ2xpcCB0aGUgcG9seWdvbiB0byB0aGUgYmFjayBvZiB0aGUgcGxhbmVzIG9mIGFsbCBmYWNlcyBvZiBodWxsIEEsCiAgICAgIC8vIHRoYXQgYXJlIGFkamFjZW50IHRvIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBjb25zdCBudW1WZXJ0aWNlc0EgPSBwb2x5QS5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVZlcnRpY2VzQTsgaSsrKSB7CiAgICAgICAgY29uc3QgYSA9IGh1bGxBLnZlcnRpY2VzW3BvbHlBW2ldXTsKICAgICAgICBjb25zdCBiID0gaHVsbEEudmVydGljZXNbcG9seUFbKGkgKyAxKSAlIG51bVZlcnRpY2VzQV1dOwogICAgICAgIGEudnN1YihiLCBlZGdlMCk7CiAgICAgICAgV29ybGRFZGdlMC5jb3B5KGVkZ2UwKTsKICAgICAgICBxdWF0QS52bXVsdChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICBwb3NBLnZhZGQoV29ybGRFZGdlMCwgV29ybGRFZGdlMCk7CiAgICAgICAgd29ybGRQbGFuZUFub3JtYWwxLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgICBxdWF0QS52bXVsdCh3b3JsZFBsYW5lQW5vcm1hbDEsIHdvcmxkUGxhbmVBbm9ybWFsMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBXb3JsZEVkZ2UwLmNyb3NzKHdvcmxkUGxhbmVBbm9ybWFsMSwgcGxhbmVOb3JtYWxXUzEpOwogICAgICAgIHBsYW5lTm9ybWFsV1MxLm5lZ2F0ZShwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgd29ybGRBMS5jb3B5KGEpOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIHBvc0EudmFkZCh3b3JsZEExLCB3b3JsZEExKTsKICAgICAgICBjb25zdCBvdGhlckZhY2UgPSBwb2x5QS5jb25uZWN0ZWRGYWNlc1tpXTsKICAgICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tvdGhlckZhY2VdKTsKICAgICAgICBjb25zdCBsb2NhbFBsYW5lRXEgPSB0aGlzLmdldFBsYW5lQ29uc3RhbnRPZkZhY2Uob3RoZXJGYWNlKTsKICAgICAgICBwbGFuZU5vcm1hbFdTLmNvcHkobG9jYWxQbGFuZU5vcm1hbCk7CiAgICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgICAgY29uc3QgcGxhbmVFcVdTID0gbG9jYWxQbGFuZUVxIC0gcGxhbmVOb3JtYWxXUy5kb3QocG9zQSk7IC8vIENsaXAgZmFjZSBhZ2FpbnN0IG91ciBjb25zdHJ1Y3RlZCBwbGFuZQoKICAgICAgICB0aGlzLmNsaXBGYWNlQWdhaW5zdFBsYW5lKHBWdHhJbiwgcFZ0eE91dCwgcGxhbmVOb3JtYWxXUywgcGxhbmVFcVdTKTsgLy8gVGhyb3cgYXdheSBhbGwgY2xpcHBlZCBwb2ludHMsIGJ1dCBzYXZlIHRoZSByZW1haW5pbmcgdW50aWwgbmV4dCBjbGlwCgogICAgICAgIHdoaWxlIChwVnR4SW4ubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4uc2hpZnQoKTsKICAgICAgICB9CgogICAgICAgIHdoaWxlIChwVnR4T3V0Lmxlbmd0aCkgewogICAgICAgICAgcFZ0eEluLnB1c2gocFZ0eE91dC5zaGlmdCgpKTsKICAgICAgICB9CiAgICAgIH0gLy8gb25seSBrZWVwIGNvbnRhY3QgcG9pbnRzIHRoYXQgYXJlIGJlaGluZCB0aGUgd2l0bmVzcyBmYWNlCgoKICAgICAgbG9jYWxQbGFuZU5vcm1hbC5jb3B5KHRoaXMuZmFjZU5vcm1hbHNbY2xvc2VzdEZhY2VBXSk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShjbG9zZXN0RmFjZUEpOwogICAgICBwbGFuZU5vcm1hbFdTLmNvcHkobG9jYWxQbGFuZU5vcm1hbCk7CiAgICAgIHF1YXRBLnZtdWx0KHBsYW5lTm9ybWFsV1MsIHBsYW5lTm9ybWFsV1MpOwogICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcFZ0eEluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGRlcHRoID0gcGxhbmVOb3JtYWxXUy5kb3QocFZ0eEluW2ldKSArIHBsYW5lRXFXUzsgLy8gPz8/CgogICAgICAgIGlmIChkZXB0aCA8PSBtaW5EaXN0KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiY2xhbXBlZDogZGVwdGg9IiArIGRlcHRoICsgIiB0byBtaW5EaXN0PSIgKyBtaW5EaXN0KTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuZ2V0QXZlcmFnZVBvaW50TG9jYWwocG9pbnRJbnNpZGUpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IG4gPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tmYWNlc1tpXVswXV07IC8vIFdlIG9ubHkgbmVlZCBvbmUgcG9pbnQgaW4gdGhlIGZhY2UKICAgICAgICAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgICAgY29uc3QgdlRvUCA9IG5ldyBWZWMzKCk7CiAgICAgICAgcC52c3ViKHYsIHZUb1ApOwogICAgICAgIGNvbnN0IHIxID0gbi5kb3QodlRvUCk7CiAgICAgICAgY29uc3QgdlRvUG9pbnRJbnNpZGUgPSBuZXcgVmVjMygpOwogICAgICAgIHBvaW50SW5zaWRlLnZzdWIodiwgdlRvUG9pbnRJbnNpZGUpOwogICAgICAgIGNvbnN0IHIyID0gbi5kb3QodlRvUG9pbnRJbnNpZGUpOwoKICAgICAgICBpZiAocjEgPCAwICYmIHIyID4gMCB8fCByMSA+IDAgJiYgcjIgPCAwKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgICB9CiAgICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG1heCBhbmQgbWluIGRvdCBwcm9kdWN0IG9mIGEgY29udmV4IGh1bGwgYXQgcG9zaXRpb24gKHBvcyxxdWF0KSBwcm9qZWN0ZWQgb250byBhbiBheGlzLgogICAgICogUmVzdWx0cyBhcmUgc2F2ZWQgaW4gdGhlIGFycmF5IG1heG1pbi4KICAgICAqIEBwYXJhbSByZXN1bHQgcmVzdWx0WzBdIGFuZCByZXN1bHRbMV0gd2lsbCBiZSBzZXQgdG8gbWF4aW11bSBhbmQgbWluaW11bSwgcmVzcGVjdGl2ZWx5LgogICAgICovCgoKICAgIHN0YXRpYyBwcm9qZWN0KHNoYXBlLCBheGlzLCBwb3MsIHF1YXQsIHJlc3VsdCkgewogICAgICBjb25zdCBuID0gc2hhcGUudmVydGljZXMubGVuZ3RoOwogICAgICBjb25zdCBsb2NhbEF4aXMgPSBwcm9qZWN0X2xvY2FsQXhpczsKICAgICAgbGV0IG1heCA9IDA7CiAgICAgIGxldCBtaW4gPSAwOwogICAgICBjb25zdCBsb2NhbE9yaWdpbiA9IHByb2plY3RfbG9jYWxPcmlnaW47CiAgICAgIGNvbnN0IHZzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGxvY2FsT3JpZ2luLnNldFplcm8oKTsgLy8gVHJhbnNmb3JtIHRoZSBheGlzIHRvIGxvY2FsCgogICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgYXhpcywgbG9jYWxBeGlzKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgbG9jYWxPcmlnaW4sIGxvY2FsT3JpZ2luKTsKICAgICAgY29uc3QgYWRkID0gbG9jYWxPcmlnaW4uZG90KGxvY2FsQXhpcyk7CiAgICAgIG1pbiA9IG1heCA9IHZzWzBdLmRvdChsb2NhbEF4aXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBuOyBpKyspIHsKICAgICAgICBjb25zdCB2YWwgPSB2c1tpXS5kb3QobG9jYWxBeGlzKTsKCiAgICAgICAgaWYgKHZhbCA+IG1heCkgewogICAgICAgICAgbWF4ID0gdmFsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbCA8IG1pbikgewogICAgICAgICAgbWluID0gdmFsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgbWluIC09IGFkZDsKICAgICAgbWF4IC09IGFkZDsKCiAgICAgIGlmIChtaW4gPiBtYXgpIHsKICAgICAgICAvLyBJbmNvbnNpc3RlbnQgLSBzd2FwCiAgICAgICAgY29uc3QgdGVtcCA9IG1pbjsKICAgICAgICBtaW4gPSBtYXg7CiAgICAgICAgbWF4ID0gdGVtcDsKICAgICAgfSAvLyBPdXRwdXQKCgogICAgICByZXN1bHRbMF0gPSBtYXg7CiAgICAgIHJlc3VsdFsxXSA9IG1pbjsKICAgIH0KCiAgfQoKICBjb25zdCBtYXhtaW5BID0gW107CiAgY29uc3QgbWF4bWluQiA9IFtdOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBBIDNkIGJveCBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaXplID0gMQogICAqICAgICBjb25zdCBoYWxmRXh0ZW50cyA9IG5ldyBDQU5OT04uVmVjMyhzaXplLCBzaXplLCBzaXplKQogICAqICAgICBjb25zdCBib3hTaGFwZSA9IG5ldyBDQU5OT04uQm94KGhhbGZFeHRlbnRzKQogICAqICAgICBjb25zdCBib3hCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IGJveFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm94Qm9keSkKICAgKi8KCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5oYWxmRXh0ZW50cyA9IGhhbGZFeHRlbnRzOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IG51bGw7CiAgICAgIHRoaXMudXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgbG9jYWwgY29udmV4IHBvbHloZWRyb24gcmVwcmVzZW50YXRpb24gdXNlZCBmb3Igc29tZSBjb2xsaXNpb25zLgogICAgICovCgoKICAgIHVwZGF0ZUNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbigpIHsKICAgICAgY29uc3Qgc3ggPSB0aGlzLmhhbGZFeHRlbnRzLng7CiAgICAgIGNvbnN0IHN5ID0gdGhpcy5oYWxmRXh0ZW50cy55OwogICAgICBjb25zdCBzeiA9IHRoaXMuaGFsZkV4dGVudHMuejsKICAgICAgY29uc3QgViA9IFZlYzM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW25ldyBWKC1zeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgLXN5LCBzeiksIG5ldyBWKHN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIHN5LCBzeiksIG5ldyBWKC1zeCwgc3ksIHN6KV07CiAgICAgIGNvbnN0IGZhY2VzID0gW1szLCAyLCAxLCAwXSwgLy8gLXoKICAgICAgWzQsIDUsIDYsIDddLCAvLyAregogICAgICBbNSwgNCwgMCwgMV0sIC8vIC15CiAgICAgIFsyLCAzLCA3LCA2XSwgLy8gK3kKICAgICAgWzAsIDQsIDcsIDNdLCAvLyAteAogICAgICBbMSwgMiwgNiwgNV0gLy8gK3gKICAgICAgXTsKICAgICAgY29uc3QgYXhlcyA9IFtuZXcgVigwLCAwLCAxKSwgbmV3IFYoMCwgMSwgMCksIG5ldyBWKDEsIDAsIDApXTsKICAgICAgY29uc3QgaCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKHsKICAgICAgICB2ZXJ0aWNlcywKICAgICAgICBmYWNlcywKICAgICAgICBheGVzCiAgICAgIH0pOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IGg7CiAgICAgIGgubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdGhlIGluZXJ0aWEgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKHRoaXMuaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgc3RhdGljIGNhbGN1bGF0ZUluZXJ0aWEoaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCkgewogICAgICBjb25zdCBlID0gaGFsZkV4dGVudHM7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueCAqIDIgKiBlLnggKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC56ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS54ICogMiAqIGUueCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYm94IDYgc2lkZSBub3JtYWxzCiAgICAgKiBAcGFyYW0gc2l4VGFyZ2V0VmVjdG9ycyBBbiBhcnJheSBvZiA2IHZlY3RvcnMsIHRvIHN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBub3JtYWxzIGluLgogICAgICogQHBhcmFtIHF1YXQgT3JpZW50YXRpb24gdG8gYXBwbHkgdG8gdGhlIG5vcm1hbCB2ZWN0b3JzLiBJZiBub3QgcHJvdmlkZWQsIHRoZSB2ZWN0b3JzIHdpbGwgYmUgaW4gcmVzcGVjdCB0byB0aGUgbG9jYWwgZnJhbWUuCiAgICAgKi8KCgogICAgZ2V0U2lkZU5vcm1hbHMoc2l4VGFyZ2V0VmVjdG9ycywgcXVhdCkgewogICAgICBjb25zdCBzaWRlcyA9IHNpeFRhcmdldFZlY3RvcnM7CiAgICAgIGNvbnN0IGV4ID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgc2lkZXNbMF0uc2V0KGV4LngsIDAsIDApOwogICAgICBzaWRlc1sxXS5zZXQoMCwgZXgueSwgMCk7CiAgICAgIHNpZGVzWzJdLnNldCgwLCAwLCBleC56KTsKICAgICAgc2lkZXNbM10uc2V0KC1leC54LCAwLCAwKTsKICAgICAgc2lkZXNbNF0uc2V0KDAsIC1leC55LCAwKTsKICAgICAgc2lkZXNbNV0uc2V0KDAsIDAsIC1leC56KTsKCiAgICAgIGlmIChxdWF0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gc2lkZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHF1YXQudm11bHQoc2lkZXNbaV0sIHNpZGVzW2ldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaWRlczsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdm9sdW1lIG9mIHRoZSBib3guCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gOC4wICogdGhpcy5oYWxmRXh0ZW50cy54ICogdGhpcy5oYWxmRXh0ZW50cy55ICogdGhpcy5oYWxmRXh0ZW50cy56OwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cwogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5oYWxmRXh0ZW50cy5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogZm9yRWFjaFdvcmxkQ29ybmVyCiAgICAgKi8KCgogICAgZm9yRWFjaFdvcmxkQ29ybmVyKHBvcywgcXVhdCwgY2FsbGJhY2spIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSBbW2UueCwgZS55LCBlLnpdLCBbLWUueCwgZS55LCBlLnpdLCBbLWUueCwgLWUueSwgZS56XSwgWy1lLngsIC1lLnksIC1lLnpdLCBbZS54LCAtZS55LCAtZS56XSwgW2UueCwgZS55LCAtZS56XSwgWy1lLngsIGUueSwgLWUuel0sIFtlLngsIC1lLnksIGUuel1dOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3JuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgd29ybGRDb3JuZXJUZW1wUG9zLnNldChjb3JuZXJzW2ldWzBdLCBjb3JuZXJzW2ldWzFdLCBjb3JuZXJzW2ldWzJdKTsKICAgICAgICBxdWF0LnZtdWx0KHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBwb3MudmFkZCh3b3JsZENvcm5lclRlbXBQb3MsIHdvcmxkQ29ybmVyVGVtcFBvcyk7CiAgICAgICAgY2FsbGJhY2sod29ybGRDb3JuZXJUZW1wUG9zLngsIHdvcmxkQ29ybmVyVGVtcFBvcy55LCB3b3JsZENvcm5lclRlbXBQb3Mueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMF0uc2V0KGUueCwgZS55LCBlLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzFdLnNldCgtZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMl0uc2V0KC1lLngsIC1lLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbM10uc2V0KC1lLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzRdLnNldChlLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzVdLnNldChlLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNl0uc2V0KC1lLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbN10uc2V0KGUueCwgLWUueSwgZS56KTsKICAgICAgY29uc3Qgd2MgPSB3b3JsZENvcm5lcnNUZW1wWzBdOwogICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgIG1heC5jb3B5KHdjKTsKICAgICAgbWluLmNvcHkod2MpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCA4OyBpKyspIHsKICAgICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbaV07CiAgICAgICAgcXVhdC52bXVsdCh3Yywgd2MpOwogICAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgICAgY29uc3QgeCA9IHdjLng7CiAgICAgICAgY29uc3QgeSA9IHdjLnk7CiAgICAgICAgY29uc3QgeiA9IHdjLno7CgogICAgICAgIGlmICh4ID4gbWF4LngpIHsKICAgICAgICAgIG1heC54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5ID4gbWF4LnkpIHsKICAgICAgICAgIG1heC55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6ID4gbWF4LnopIHsKICAgICAgICAgIG1heC56ID0gejsKICAgICAgICB9CgogICAgICAgIGlmICh4IDwgbWluLngpIHsKICAgICAgICAgIG1pbi54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5IDwgbWluLnkpIHsKICAgICAgICAgIG1pbi55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6IDwgbWluLnopIHsKICAgICAgICAgIG1pbi56ID0gejsKICAgICAgICB9CiAgICAgIH0gLy8gR2V0IGVhY2ggYXhpcyBtYXgKICAgICAgLy8gbWluLnNldChJbmZpbml0eSxJbmZpbml0eSxJbmZpbml0eSk7CiAgICAgIC8vIG1heC5zZXQoLUluZmluaXR5LC1JbmZpbml0eSwtSW5maW5pdHkpOwogICAgICAvLyB0aGlzLmZvckVhY2hXb3JsZENvcm5lcihwb3MscXVhdCxmdW5jdGlvbih4LHkseil7CiAgICAgIC8vICAgICBpZih4ID4gbWF4LngpewogICAgICAvLyAgICAgICAgIG1heC54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPiBtYXgueSl7CiAgICAgIC8vICAgICAgICAgbWF4LnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA+IG1heC56KXsKICAgICAgLy8gICAgICAgICBtYXgueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih4IDwgbWluLngpewogICAgICAvLyAgICAgICAgIG1pbi54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPCBtaW4ueSl7CiAgICAgIC8vICAgICAgICAgbWluLnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA8IG1pbi56KXsKICAgICAgLy8gICAgICAgICBtaW4ueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vIH0pOwoKICAgIH0KCiAgfQoKICBjb25zdCB3b3JsZENvcm5lclRlbXBQb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHdvcmxkQ29ybmVyc1RlbXAgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgLyoqCiAgICogQk9EWV9UWVBFUwogICAqLwoKICBjb25zdCBCT0RZX1RZUEVTID0gewogICAgLyoqIERZTkFNSUMgKi8KICAgIERZTkFNSUM6IDEsCgogICAgLyoqIFNUQVRJQyAqLwogICAgU1RBVElDOiAyLAoKICAgIC8qKiBLSU5FTUFUSUMgKi8KICAgIEtJTkVNQVRJQzogNAogIH07CiAgLyoqCiAgICogQm9keVR5cGUKICAgKi8KCiAgLyoqCiAgICogQk9EWV9TTEVFUF9TVEFURVMKICAgKi8KCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KCiAgY2xhc3MgQm9keSBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciB0d28gYm9kaWVzIGNvbGxpZGUuIFRoaXMgZXZlbnQgaXMgZGlzcGF0Y2hlZCBvbiBlYWNoCiAgICAgKiBvZiB0aGUgdHdvIGJvZGllcyBpbnZvbHZlZCBpbiB0aGUgY29sbGlzaW9uLgogICAgICogQGV2ZW50IGNvbGxpZGUKICAgICAqIEBwYXJhbSBib2R5IFRoZSBib2R5IHRoYXQgd2FzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAcGFyYW0gY29udGFjdCBUaGUgZGV0YWlscyBvZiB0aGUgY29sbGlzaW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGR5bmFtaWMgYm9keSBpcyBmdWxseSBzaW11bGF0ZWQuIENhbiBiZSBtb3ZlZCBtYW51YWxseSBieSB0aGUgdXNlciwgYnV0IG5vcm1hbGx5IHRoZXkgbW92ZSBhY2NvcmRpbmcgdG8gZm9yY2VzLiBBIGR5bmFtaWMgYm9keSBjYW4gY29sbGlkZSB3aXRoIGFsbCBib2R5IHR5cGVzLiBBIGR5bmFtaWMgYm9keSBhbHdheXMgaGFzIGZpbml0ZSwgbm9uLXplcm8gbWFzcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBzdGF0aWMgYm9keSBkb2VzIG5vdCBtb3ZlIGR1cmluZyBzaW11bGF0aW9uIGFuZCBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBTdGF0aWMgYm9kaWVzIGNhbiBiZSBtb3ZlZCBtYW51YWxseSBieSBzZXR0aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgYm9keS4gVGhlIHZlbG9jaXR5IG9mIGEgc3RhdGljIGJvZHkgaXMgYWx3YXlzIHplcm8uIFN0YXRpYyBib2RpZXMgZG8gbm90IGNvbGxpZGUgd2l0aCBvdGhlciBzdGF0aWMgb3Iga2luZW1hdGljIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBraW5lbWF0aWMgYm9keSBtb3ZlcyB1bmRlciBzaW11bGF0aW9uIGFjY29yZGluZyB0byBpdHMgdmVsb2NpdHkuIFRoZXkgZG8gbm90IHJlc3BvbmQgdG8gZm9yY2VzLiBUaGV5IGNhbiBiZSBtb3ZlZCBtYW51YWxseSwgYnV0IG5vcm1hbGx5IGEga2luZW1hdGljIGJvZHkgaXMgbW92ZWQgYnkgc2V0dGluZyBpdHMgdmVsb2NpdHkuIEEga2luZW1hdGljIGJvZHkgYmVoYXZlcyBhcyBpZiBpdCBoYXMgaW5maW5pdGUgbWFzcy4gS2luZW1hdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBV0FLRQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUFkKICAgICAqLwoKICAgIC8qKgogICAgICogU0xFRVBJTkcKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIHNsZWVwaW5nIGJvZHkgaGFzIHdva2VuIHVwLgogICAgICogQGV2ZW50IHdha2V1cAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZ29uZSBpbiB0byB0aGUgc2xlZXB5IHN0YXRlLgogICAgICogQGV2ZW50IHNsZWVweQogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZmFsbGVuIGFzbGVlcC4KICAgICAqIEBldmVudCBzbGVlcAogICAgICovCgogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBQb3NpdGlvbiBvZiBib2R5IGluIFdvcmxkLmJvZGllcy4gVXBkYXRlZCBieSBXb3JsZCBhbmQgdXNlZCBpbiBBcnJheUNvbGxpc2lvbk1hdHJpeC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVmZXJlbmNlIHRvIHRoZSB3b3JsZCB0aGUgYm9keSBpcyBsaXZpbmcgaW4uCiAgICAgKi8KCiAgICAvKioKICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgdXNlZCBCRUZPUkUgc3RlcHBpbmcgdGhlIHN5c3RlbS4gVXNlIGl0IHRvIGFwcGx5IGZvcmNlcywgZm9yIGV4YW1wbGUuIEluc2lkZSB0aGUgZnVuY3Rpb24sICJ0aGlzIiB3aWxsIHJlZmVyIHRvIHRoaXMgQm9keSBvYmplY3QuIERlcHJlY2F0ZWQgLSB1c2UgV29ybGQgZXZlbnRzIGluc3RlYWQuCiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgV29ybGQgZXZlbnRzIGluc3RlYWQKICAgICAqLwoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIEFGVEVSIHN0ZXBwaW5nIHRoZSBzeXN0ZW0uIEluc2lkZSB0aGUgZnVuY3Rpb24sICJ0aGlzIiB3aWxsIHJlZmVyIHRvIHRoaXMgQm9keSBvYmplY3QuIERlcHJlY2F0ZWQgLSB1c2UgV29ybGQgZXZlbnRzIGluc3RlYWQuCiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgV29ybGQgZXZlbnRzIGluc3RlYWQKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGNvbGxpc2lvbiBncm91cCB0aGUgYm9keSBiZWxvbmdzIHRvLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgY29sbGlzaW9uIGdyb3VwIHRoZSBib2R5IGNhbiBjb2xsaWRlIHdpdGguCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHByb2R1Y2UgY29udGFjdCBmb3JjZXMgd2hlbiBpbiBjb250YWN0IHdpdGggb3RoZXIgYm9kaWVzLiBOb3RlIHRoYXQgY29udGFjdHMgd2lsbCBiZSBnZW5lcmF0ZWQsIGJ1dCB0aGV5IHdpbGwgYmUgZGlzYWJsZWQgLSBpLmUuICJjb2xsaWRlIiBldmVudHMgd2lsbCBiZSByYWlzZWQsIGJ1dCBmb3JjZXMgd2lsbCBub3QgYmUgYWx0ZXJlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2UgcG9zaXRpb24gb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEludGVycG9sYXRlZCBwb3NpdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogSW5pdGlhbCBwb3NpdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2UgdmVsb2NpdHkgb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEluaXRpYWwgdmVsb2NpdHkgb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIExpbmVhciBmb3JjZSBvbiB0aGUgYm9keSBpbiB3b3JsZCBzcGFjZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIG1hc3Mgb2YgdGhlIGJvZHkuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBwaHlzaWNzIG1hdGVyaWFsIG9mIHRoZSBib2R5LiBJdCBkZWZpbmVzIHRoZSBib2R5IGludGVyYWN0aW9uIHdpdGggb3RoZXIgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBIb3cgbXVjaCB0byBkYW1wIHRoZSBib2R5IHZlbG9jaXR5IGVhY2ggc3RlcC4gSXQgY2FuIGdvIGZyb20gMCB0byAxLgogICAgICogQGRlZmF1bHQgMC4wMQogICAgICovCgogICAgLyoqCiAgICAgKiBPbmUgb2Y6IGBCb2R5LkRZTkFNSUNgLCBgQm9keS5TVEFUSUNgIGFuZCBgQm9keS5LSU5FTUFUSUNgLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0cnVlLCB0aGUgYm9keSB3aWxsIGF1dG9tYXRpY2FsbHkgZmFsbCB0byBzbGVlcC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCBzbGVlcCBzdGF0ZS4KICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIHNwZWVkICh0aGUgbm9ybSBvZiB0aGUgdmVsb2NpdHkpIGlzIHNtYWxsZXIgdGhhbiB0aGlzIHZhbHVlLCB0aGUgYm9keSBpcyBjb25zaWRlcmVkIHNsZWVweS4KICAgICAqIEBkZWZhdWx0IDAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBoYXMgYmVlbiBzbGVlcHkgZm9yIHRoaXMgc2xlZXBUaW1lTGltaXQgc2Vjb25kcywgaXQgaXMgY29uc2lkZXJlZCBzbGVlcGluZy4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2Ugcm90YXRpb25hbCBmb3JjZSBvbiB0aGUgYm9keSwgYXJvdW5kIGNlbnRlciBvZiBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSBvcmllbnRhdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogSW5pdGlhbCBxdWF0ZXJuaW9uIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBJbnRlcnBvbGF0ZWQgb3JpZW50YXRpb24gb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZHksIGluIHdvcmxkIHNwYWNlLiBUaGluayBvZiB0aGUgYW5ndWxhciB2ZWxvY2l0eSBhcyBhIHZlY3Rvciwgd2hpY2ggdGhlIGJvZHkgcm90YXRlcyBhcm91bmQuIFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IgZGV0ZXJtaW5lcyBob3cgZmFzdCAoaW4gcmFkaWFucyBwZXIgc2Vjb25kKSB0aGUgYm9keSByb3RhdGVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBJbml0aWFsIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIExpc3Qgb2YgU2hhcGVzIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBQb3NpdGlvbiBvZiBlYWNoIFNoYXBlIGluIHRoZSBib2R5LCBnaXZlbiBpbiBsb2NhbCBCb2R5IHNwYWNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBPcmllbnRhdGlvbiBvZiBlYWNoIFNoYXBlLCBnaXZlbiBpbiBsb2NhbCBCb2R5IHNwYWNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5lcnRpYSBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgeW91IGRvbid0IHdhbnQgdGhlIGJvZHkgdG8gcm90YXRlLiBNYWtlIHN1cmUgdG8gcnVuIC51cGRhdGVNYXNzUHJvcGVydGllcygpIGlmIHlvdSBjaGFuZ2UgdGhpcyBhZnRlciB0aGUgYm9keSBjcmVhdGlvbi4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEhvdyBtdWNoIHRvIGRhbXAgdGhlIGJvZHkgYW5ndWxhciB2ZWxvY2l0eSBlYWNoIHN0ZXAuIEl0IGNhbiBnbyBmcm9tIDAgdG8gMS4KICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogVXNlIHRoaXMgcHJvcGVydHkgdG8gbGltaXQgdGhlIG1vdGlvbiBhbG9uZyBhbnkgd29ybGQgYXhpcy4gKDEsMSwxKSB3aWxsIGFsbG93IG1vdGlvbiBhbG9uZyBhbGwgYXhlcyB3aGlsZSAoMCwwLDApIGFsbG93cyBub25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2UgdGhpcyBwcm9wZXJ0eSB0byBsaW1pdCB0aGUgcm90YXRpb25hbCBtb3Rpb24gYWxvbmcgYW55IHdvcmxkIGF4aXMuICgxLDEsMSkgd2lsbCBhbGxvdyByb3RhdGlvbiBhbG9uZyBhbGwgYXhlcyB3aGlsZSAoMCwwLDApIGFsbG93cyBub25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSBib3VuZGluZyBib3ggb2YgdGhlIGJvZHkgYW5kIGl0cyBzaGFwZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEluZGljYXRlcyBpZiB0aGUgQUFCQiBuZWVkcyB0byBiZSB1cGRhdGVkIGJlZm9yZSB1c2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRvdGFsIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgQm9keSBpbmNsdWRpbmcgaXRzIHNoYXBlcywgcmVsYXRpdmUgdG8gYm9keS5wb3NpdGlvbi4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0cnVlIHRoZSBib2R5IGJlaGF2ZXMgbGlrZSBhIHRyaWdnZXIuIEl0IGRvZXMgbm90IGNvbGxpZGUKICAgICAqIHdpdGggb3RoZXIgYm9kaWVzIGJ1dCBjb2xsaXNpb24gZXZlbnRzIGFyZSBzdGlsbCB0cmlnZ2VyZWQuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaWQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5kZXggPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMucHJlU3RlcCA9IHZvaWQgMDsKICAgICAgdGhpcy5wb3N0U3RlcCA9IHZvaWQgMDsKICAgICAgdGhpcy52bGFtYmRhID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSB2b2lkIDA7CiAgICAgIHRoaXMucG9zaXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRQb3NpdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5pbml0UG9zaXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMudmVsb2NpdHkgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5pdFZlbG9jaXR5ID0gdm9pZCAwOwogICAgICB0aGlzLmZvcmNlID0gdm9pZCAwOwogICAgICB0aGlzLm1hc3MgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW52TWFzcyA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdm9pZCAwOwogICAgICB0aGlzLnR5cGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gdm9pZCAwOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHZvaWQgMDsKICAgICAgdGhpcy50aW1lTGFzdFNsZWVweSA9IHZvaWQgMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gdm9pZCAwOwogICAgICB0aGlzLnRvcnF1ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gdm9pZCAwOwogICAgICB0aGlzLmluaXRRdWF0ZXJuaW9uID0gdm9pZCAwOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gdm9pZCAwOwogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gdm9pZCAwOwogICAgICB0aGlzLnNoYXBlcyA9IHZvaWQgMDsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5lcnRpYSA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnZJbmVydGlhID0gdm9pZCAwOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlID0gdm9pZCAwOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gdm9pZCAwOwogICAgICB0aGlzLmZpeGVkUm90YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuYW5ndWxhckRhbXBpbmcgPSB2b2lkIDA7CiAgICAgIHRoaXMubGluZWFyRmFjdG9yID0gdm9pZCAwOwogICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWFiYiA9IHZvaWQgMDsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm91bmRpbmdSYWRpdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IHZvaWQgMDsKICAgICAgdGhpcy5pc1RyaWdnZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWQgPSBCb2R5LmlkQ291bnRlcisrOwogICAgICB0aGlzLmluZGV4ID0gLTE7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnByZVN0ZXAgPSBudWxsOwogICAgICB0aGlzLnBvc3RTdGVwID0gbnVsbDsKICAgICAgdGhpcy52bGFtYmRhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwID09PSAnbnVtYmVyJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgOiAxOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrID09PSAnbnVtYmVyJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA6IC0xOwogICAgICB0aGlzLmNvbGxpc2lvblJlc3BvbnNlID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uUmVzcG9uc2UgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuY29sbGlzaW9uUmVzcG9uc2UgOiB0cnVlOwogICAgICB0aGlzLnBvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW5pdFBvc2l0aW9uID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLnBvc2l0aW9uKSB7CiAgICAgICAgdGhpcy5wb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmluaXRQb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLnZlbG9jaXR5KSB7CiAgICAgICAgdGhpcy52ZWxvY2l0eS5jb3B5KG9wdGlvbnMudmVsb2NpdHkpOwogICAgICB9CgogICAgICB0aGlzLmluaXRWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuZm9yY2UgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBtYXNzID0gdHlwZW9mIG9wdGlvbnMubWFzcyA9PT0gJ251bWJlcicgPyBvcHRpb25zLm1hc3MgOiAwOwogICAgICB0aGlzLm1hc3MgPSBtYXNzOwogICAgICB0aGlzLmludk1hc3MgPSBtYXNzID4gMCA/IDEuMCAvIG1hc3MgOiAwOwogICAgICB0aGlzLm1hdGVyaWFsID0gb3B0aW9ucy5tYXRlcmlhbCB8fCBudWxsOwogICAgICB0aGlzLmxpbmVhckRhbXBpbmcgPSB0eXBlb2Ygb3B0aW9ucy5saW5lYXJEYW1waW5nID09PSAnbnVtYmVyJyA/IG9wdGlvbnMubGluZWFyRGFtcGluZyA6IDAuMDE7CiAgICAgIHRoaXMudHlwZSA9IG1hc3MgPD0gMC4wID8gQm9keS5TVEFUSUMgOiBCb2R5LkRZTkFNSUM7CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMudHlwZSA9PT0gdHlwZW9mIEJvZHkuU1RBVElDKSB7CiAgICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlOwogICAgICB9CgogICAgICB0aGlzLmFsbG93U2xlZXAgPSB0eXBlb2Ygb3B0aW9ucy5hbGxvd1NsZWVwICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYWxsb3dTbGVlcCA6IHRydWU7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuQVdBS0U7CiAgICAgIHRoaXMuc2xlZXBTcGVlZExpbWl0ID0gdHlwZW9mIG9wdGlvbnMuc2xlZXBTcGVlZExpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBTcGVlZExpbWl0IDogMC4xOwogICAgICB0aGlzLnNsZWVwVGltZUxpbWl0ID0gdHlwZW9mIG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5zbGVlcFRpbWVMaW1pdCA6IDE7CiAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSAwOwogICAgICB0aGlzLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgdGhpcy50b3JxdWUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLmluaXRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5wcmV2aW91c1F1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucXVhdGVybmlvbikgewogICAgICAgIHRoaXMucXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgICAgdGhpcy5pbml0UXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgICAgdGhpcy5wcmV2aW91c1F1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmFuZ3VsYXJWZWxvY2l0eSkgewogICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LmNvcHkob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpOwogICAgICB9CgogICAgICB0aGlzLmluaXRBbmd1bGFyVmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnNoYXBlcyA9IFtdOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cyA9IFtdOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zID0gW107CiAgICAgIHRoaXMuaW5lcnRpYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW52SW5lcnRpYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSAwOwogICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUgPSBuZXcgTWF0MygpOwogICAgICB0aGlzLmZpeGVkUm90YXRpb24gPSB0eXBlb2Ygb3B0aW9ucy5maXhlZFJvdGF0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZml4ZWRSb3RhdGlvbiA6IGZhbHNlOwogICAgICB0aGlzLmFuZ3VsYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmd1bGFyRGFtcGluZyA6IDAuMDE7CiAgICAgIHRoaXMubGluZWFyRmFjdG9yID0gbmV3IFZlYzMoMSwgMSwgMSk7CgogICAgICBpZiAob3B0aW9ucy5saW5lYXJGYWN0b3IpIHsKICAgICAgICB0aGlzLmxpbmVhckZhY3Rvci5jb3B5KG9wdGlvbnMubGluZWFyRmFjdG9yKTsKICAgICAgfQoKICAgICAgdGhpcy5hbmd1bGFyRmFjdG9yID0gbmV3IFZlYzMoMSwgMSwgMSk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5hbmd1bGFyRmFjdG9yLmNvcHkob3B0aW9ucy5hbmd1bGFyRmFjdG9yKTsKICAgICAgfQoKICAgICAgdGhpcy5hYWJiID0gbmV3IEFBQkIoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gMDsKICAgICAgdGhpcy53bGFtYmRhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pc1RyaWdnZXIgPSBCb29sZWFuKG9wdGlvbnMuaXNUcmlnZ2VyKTsKCiAgICAgIGlmIChvcHRpb25zLnNoYXBlKSB7CiAgICAgICAgdGhpcy5hZGRTaGFwZShvcHRpb25zLnNoYXBlKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgfQogICAgLyoqCiAgICAgKiBXYWtlIHRoZSBib2R5IHVwLgogICAgICovCgoKICAgIHdha2VVcCgpIHsKICAgICAgY29uc3QgcHJldlN0YXRlID0gdGhpcy5zbGVlcFN0YXRlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKCiAgICAgIGlmIChwcmV2U3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoQm9keS53YWtldXBFdmVudCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRm9yY2UgYm9keSBzbGVlcAogICAgICovCgoKICAgIHNsZWVwKCkgewogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LlNMRUVQSU5HOwogICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICB0aGlzLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2FsbGVkIGV2ZXJ5IHRpbWVzdGVwIHRvIHVwZGF0ZSBpbnRlcm5hbCBzbGVlcCB0aW1lciBhbmQgY2hhbmdlIHNsZWVwIHN0YXRlIGlmIG5lZWRlZC4KICAgICAqIEBwYXJhbSB0aW1lIFRoZSB3b3JsZCB0aW1lIGluIHNlY29uZHMKICAgICAqLwoKCiAgICBzbGVlcFRpY2sodGltZSkgewogICAgICBpZiAodGhpcy5hbGxvd1NsZWVwKSB7CiAgICAgICAgY29uc3Qgc2xlZXBTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWQgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKSArIHRoaXMuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICBjb25zdCBzcGVlZExpbWl0U3F1YXJlZCA9IHRoaXMuc2xlZXBTcGVlZExpbWl0ICoqIDI7CgogICAgICAgIGlmIChzbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIHNwZWVkU3F1YXJlZCA8IHNwZWVkTGltaXRTcXVhcmVkKSB7CiAgICAgICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LlNMRUVQWTsgLy8gU2xlZXB5CgogICAgICAgICAgdGhpcy50aW1lTGFzdFNsZWVweSA9IHRpbWU7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoQm9keS5zbGVlcHlFdmVudCk7CiAgICAgICAgfSBlbHNlIGlmIChzbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQWSAmJiBzcGVlZFNxdWFyZWQgPiBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy53YWtlVXAoKTsgLy8gV2FrZSB1cAogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgdGltZSAtIHRoaXMudGltZUxhc3RTbGVlcHkgPiB0aGlzLnNsZWVwVGltZUxpbWl0KSB7CiAgICAgICAgICB0aGlzLnNsZWVwKCk7IC8vIFNsZWVwaW5nCgogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXBFdmVudCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIElmIHRoZSBib2R5IGlzIHNsZWVwaW5nLCBpdCBzaG91bGQgYmUgaW1tb3ZhYmxlIC8gaGF2ZSBpbmZpbml0ZSBtYXNzIGR1cmluZyBzb2x2ZS4gV2Ugc29sdmUgaXQgYnkgaGF2aW5nIGEgc2VwYXJhdGUgInNvbHZlIG1hc3MiLgogICAgICovCgoKICAgIHVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKSB7CiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcgfHwgdGhpcy50eXBlID09PSBCb2R5LktJTkVNQVRJQykgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZS5zZXRaZXJvKCk7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZS5zZXRaZXJvKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSB0aGlzLmludk1hc3M7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuY29weSh0aGlzLmludkluZXJ0aWEpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuY29weSh0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHBvaW50IHRvIGxvY2FsIGJvZHkgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsRnJhbWUod29ybGRQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICB0aGlzLnF1YXRlcm5pb24uY29uanVnYXRlKCkudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgd29ybGQgdmVjdG9yIHRvIGxvY2FsIGJvZHkgZnJhbWUuCiAgICAgKi8KCgogICAgdmVjdG9yVG9Mb2NhbEZyYW1lKHdvcmxkVmVjdG9yLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHdvcmxkVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGRGcmFtZShsb2NhbFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnZtdWx0KGxvY2FsUG9pbnQsIHJlc3VsdCk7CiAgICAgIHJlc3VsdC52YWRkKHRoaXMucG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSBsb2NhbCBib2R5IHBvaW50IHRvIHdvcmxkIGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvV29ybGRGcmFtZShsb2NhbFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGEgc2hhcGUgdG8gdGhlIGJvZHkgd2l0aCBhIGxvY2FsIG9mZnNldCBhbmQgb3JpZW50YXRpb24uCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICBhZGRTaGFwZShzaGFwZSwgX29mZnNldCwgX29yaWVudGF0aW9uKSB7CiAgICAgIGNvbnN0IG9mZnNldCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG9yaWVudGF0aW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChfb2Zmc2V0KSB7CiAgICAgICAgb2Zmc2V0LmNvcHkoX29mZnNldCk7CiAgICAgIH0KCiAgICAgIGlmIChfb3JpZW50YXRpb24pIHsKICAgICAgICBvcmllbnRhdGlvbi5jb3B5KF9vcmllbnRhdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnB1c2goc2hhcGUpOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cy5wdXNoKG9mZnNldCk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMucHVzaChvcmllbnRhdGlvbik7CiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1JhZGl1cygpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHNoYXBlLmJvZHkgPSB0aGlzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgc2hhcGUgZnJvbSB0aGUgYm9keS4KICAgICAqIEByZXR1cm4gVGhlIGJvZHkgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIHJlbW92ZVNoYXBlKHNoYXBlKSB7CiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zaGFwZXMuaW5kZXhPZihzaGFwZSk7CgogICAgICBpZiAoaW5kZXggPT09IC0xKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdTaGFwZSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIGJvZHknKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgdGhpcy5zaGFwZXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gbnVsbDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYm91bmRpbmcgcmFkaXVzIG9mIHRoZSBib2R5LiBTaG91bGQgYmUgZG9uZSBpZiBhbnkgb2YgdGhlIHNoYXBlcyBhcmUgY2hhbmdlZC4KICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1JhZGl1cygpIHsKICAgICAgY29uc3Qgc2hhcGVzID0gdGhpcy5zaGFwZXM7CiAgICAgIGNvbnN0IHNoYXBlT2Zmc2V0cyA9IHRoaXMuc2hhcGVPZmZzZXRzOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgbGV0IHJhZGl1cyA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07CiAgICAgICAgc2hhcGUudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgICBjb25zdCBvZmZzZXQgPSBzaGFwZU9mZnNldHNbaV0ubGVuZ3RoKCk7CiAgICAgICAgY29uc3QgciA9IHNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzOwoKICAgICAgICBpZiAob2Zmc2V0ICsgciA+IHJhZGl1cykgewogICAgICAgICAgcmFkaXVzID0gb2Zmc2V0ICsgcjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYm91bmRpbmdSYWRpdXMgPSByYWRpdXM7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIC5hYWJiCiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgY29uc3Qgc2hhcGVzID0gdGhpcy5zaGFwZXM7CiAgICAgIGNvbnN0IHNoYXBlT2Zmc2V0cyA9IHRoaXMuc2hhcGVPZmZzZXRzOwogICAgICBjb25zdCBzaGFwZU9yaWVudGF0aW9ucyA9IHRoaXMuc2hhcGVPcmllbnRhdGlvbnM7CiAgICAgIGNvbnN0IE4gPSBzaGFwZXMubGVuZ3RoOwogICAgICBjb25zdCBvZmZzZXQgPSB0bXBWZWM7CiAgICAgIGNvbnN0IG9yaWVudGF0aW9uID0gdG1wUXVhdDsKICAgICAgY29uc3QgYm9keVF1YXQgPSB0aGlzLnF1YXRlcm5pb247CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IHNoYXBlQUFCQiA9IHVwZGF0ZUFBQkJfc2hhcGVBQUJCOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOyAvLyBHZXQgc2hhcGUgd29ybGQgcG9zaXRpb24KCiAgICAgICAgYm9keVF1YXQudm11bHQoc2hhcGVPZmZzZXRzW2ldLCBvZmZzZXQpOwogICAgICAgIG9mZnNldC52YWRkKHRoaXMucG9zaXRpb24sIG9mZnNldCk7IC8vIEdldCBzaGFwZSB3b3JsZCBxdWF0ZXJuaW9uCgogICAgICAgIGJvZHlRdWF0Lm11bHQoc2hhcGVPcmllbnRhdGlvbnNbaV0sIG9yaWVudGF0aW9uKTsgLy8gR2V0IHNoYXBlIEFBQkIKCiAgICAgICAgc2hhcGUuY2FsY3VsYXRlV29ybGRBQUJCKG9mZnNldCwgb3JpZW50YXRpb24sIHNoYXBlQUFCQi5sb3dlckJvdW5kLCBzaGFwZUFBQkIudXBwZXJCb3VuZCk7CgogICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICBhYWJiLmNvcHkoc2hhcGVBQUJCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWFiYi5leHRlbmQoc2hhcGVBQUJCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBgLmluZXJ0aWFXb3JsZGAgYW5kIGAuaW52SW5lcnRpYVdvcmxkYAogICAgICovCgoKICAgIHVwZGF0ZUluZXJ0aWFXb3JsZChmb3JjZSkgewogICAgICBjb25zdCBJID0gdGhpcy5pbnZJbmVydGlhOwogICAgICBpZiAoSS54ID09PSBJLnkgJiYgSS55ID09PSBJLnogJiYgIWZvcmNlKSA7ZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KCiAgQm9keS5pZENvdW50ZXIgPSAwOwogIEJvZHkuQ09MTElERV9FVkVOVF9OQU1FID0gJ2NvbGxpZGUnOwogIEJvZHkuRFlOQU1JQyA9IEJPRFlfVFlQRVMuRFlOQU1JQzsKICBCb2R5LlNUQVRJQyA9IEJPRFlfVFlQRVMuU1RBVElDOwogIEJvZHkuS0lORU1BVElDID0gQk9EWV9UWVBFUy5LSU5FTUFUSUM7CiAgQm9keS5BV0FLRSA9IEJPRFlfU0xFRVBfU1RBVEVTLkFXQUtFOwogIEJvZHkuU0xFRVBZID0gQk9EWV9TTEVFUF9TVEFURVMuU0xFRVBZOwogIEJvZHkuU0xFRVBJTkcgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUElORzsKICBCb2R5Lndha2V1cEV2ZW50ID0gewogICAgdHlwZTogJ3dha2V1cCcKICB9OwogIEJvZHkuc2xlZXB5RXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXB5JwogIH07CiAgQm9keS5zbGVlcEV2ZW50ID0gewogICAgdHlwZTogJ3NsZWVwJwogIH07CiAgY29uc3QgdG1wVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB1cGRhdGVBQUJCX3NoYXBlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgdWl3X20xID0gbmV3IE1hdDMoKTsKICBjb25zdCB1aXdfbTIgPSBuZXcgTWF0MygpOwogIGNvbnN0IEJvZHlfYXBwbHlGb3JjZV9yb3RGb3JjZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsRm9yY2Vfd29ybGRGb3JjZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsRm9yY2VfcmVsYXRpdmVQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5SW1wdWxzZV92ZWxvID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5SW1wdWxzZV9yb3RWZWxvID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3dvcmxkSW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV9yZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBicm9hZHBoYXNlIGltcGxlbWVudGF0aW9ucwogICAqIEBhdXRob3Igc2NodGVwcGUKICAgKi8KCiAgY2xhc3MgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIFRoZSB3b3JsZCB0byBzZWFyY2ggZm9yIGNvbGxpc2lvbnMgaW4uCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHNldCB0byB0cnVlLCB0aGUgYnJvYWRwaGFzZSB1c2VzIGJvdW5kaW5nIGJveGVzIGZvciBpbnRlcnNlY3Rpb24gdGVzdHMsIGVsc2UgaXQgdXNlcyBib3VuZGluZyBzcGhlcmVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gdHJ1ZSBpZiB0aGUgb2JqZWN0cyBpbiB0aGUgd29ybGQgbW92ZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLndvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLnVzZUJvdW5kaW5nQm94ZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlydHkgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnVzZUJvdW5kaW5nQm94ZXMgPSBmYWxzZTsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY29sbGlzaW9uIHBhaXJzIGZyb20gdGhlIHdvcmxkCiAgICAgKiBAcGFyYW0gd29ybGQgVGhlIHdvcmxkIHRvIHNlYXJjaCBpbgogICAgICogQHBhcmFtIHAxIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICogQHBhcmFtIHAyIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb2xsaXNpb25QYWlycyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgQnJvYWRQaGFzZSBjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBib2R5IHBhaXIgbmVlZHMgdG8gYmUgaW50ZXJzZWN0aW9uIHRlc3RlZCBhdCBhbGwuCiAgICAgKi8KCgogICAgbmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYm9keUEsIGJvZHlCKSB7CiAgICAgIC8vIENoZWNrIGNvbGxpc2lvbiBmaWx0ZXIgbWFza3MKICAgICAgaWYgKChib2R5QS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlCLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5Qi5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlBLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIENoZWNrIHR5cGVzCgoKICAgICAgaWYgKCgoYm9keUEudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5QS5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSAmJiAoKGJvZHlCLnR5cGUgJiBCb2R5LlNUQVRJQykgIT09IDAgfHwgYm9keUIuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykpIHsKICAgICAgICAvLyBCb3RoIGJvZGllcyBhcmUgc3RhdGljIG9yIHNsZWVwaW5nLiBTa2lwLgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyB2b2x1bWVzIG9mIHR3byBib2RpZXMgaW50ZXJzZWN0LgogICAgICovCgoKICAgIGludGVyc2VjdGlvblRlc3QoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBpZiAodGhpcy51c2VCb3VuZGluZ0JveGVzKSB7CiAgICAgICAgdGhpcy5kb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqIEBwYXJhbSBwYWlyczEgYm9keUEgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqIEBwYXJhbSBwYWlyczIgYm9keUIgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nU3BoZXJlQnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHIgPSBCcm9hZHBoYXNlX2NvbGxpc2lvblBhaXJzX3I7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIHIpOwogICAgICBjb25zdCBib3VuZGluZ1JhZGl1c1N1bTIgPSAoYm9keUEuYm91bmRpbmdSYWRpdXMgKyBib2R5Qi5ib3VuZGluZ1JhZGl1cykgKiogMjsKICAgICAgY29uc3Qgbm9ybTIgPSByLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChub3JtMiA8IGJvdW5kaW5nUmFkaXVzU3VtMikgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIGJveGVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmIChib2R5QS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5QS51cGRhdGVBQUJCKCk7CiAgICAgIH0KCiAgICAgIGlmIChib2R5Qi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5Qi51cGRhdGVBQUJCKCk7CiAgICAgIH0gLy8gQ2hlY2sgQUFCQiAvIEFBQkIKCgogICAgICBpZiAoYm9keUEuYWFiYi5vdmVybGFwcyhib2R5Qi5hYWJiKSkgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBkdXBsaWNhdGUgcGFpcnMgZnJvbSB0aGUgcGFpciBhcnJheXMuCiAgICAgKi8KCgogICAgbWFrZVBhaXJzVW5pcXVlKHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHQgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wOwogICAgICBjb25zdCBwMSA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxOwogICAgICBjb25zdCBwMiA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyOwogICAgICBjb25zdCBOID0gcGFpcnMxLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBwMVtpXSA9IHBhaXJzMVtpXTsKICAgICAgICBwMltpXSA9IHBhaXJzMltpXTsKICAgICAgfQoKICAgICAgcGFpcnMxLmxlbmd0aCA9IDA7CiAgICAgIHBhaXJzMi5sZW5ndGggPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGlkMSA9IHAxW2ldLmlkOwogICAgICAgIGNvbnN0IGlkMiA9IHAyW2ldLmlkOwogICAgICAgIGNvbnN0IGtleSA9IGlkMSA8IGlkMiA/IGlkMSArICIsIiArIGlkMiA6IGlkMiArICIsIiArIGlkMTsKICAgICAgICB0W2tleV0gPSBpOwogICAgICAgIHQua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0LmtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBrZXkgPSB0LmtleXMucG9wKCk7CiAgICAgICAgY29uc3QgcGFpckluZGV4ID0gdFtrZXldOwogICAgICAgIHBhaXJzMS5wdXNoKHAxW3BhaXJJbmRleF0pOwogICAgICAgIHBhaXJzMi5wdXNoKHAyW3BhaXJJbmRleF0pOwogICAgICAgIGRlbGV0ZSB0W2tleV07CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVG8gYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2Fzc2VzCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHt9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgb3ZlcmxhcC4KICAgICAqLwoKCiAgICBzdGF0aWMgYm91bmRpbmdTcGhlcmVDaGVjayhib2R5QSwgYm9keUIpIHsKICAgICAgY29uc3QgZGlzdCA9IG5ldyBWZWMzKCk7IC8vIGJzY19kaXN0OwoKICAgICAgYm9keUEucG9zaXRpb24udnN1Yihib2R5Qi5wb3NpdGlvbiwgZGlzdCk7CiAgICAgIGNvbnN0IHNhID0gYm9keUEuc2hhcGVzWzBdOwogICAgICBjb25zdCBzYiA9IGJvZHlCLnNoYXBlc1swXTsKICAgICAgcmV0dXJuIE1hdGgucG93KHNhLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2IuYm91bmRpbmdTcGhlcmVSYWRpdXMsIDIpID4gZGlzdC5sZW5ndGhTcXVhcmVkKCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIHRoZSBBQUJCLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGNvbnNvbGUud2FybignLmFhYmJRdWVyeSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBCcm9hZHBoYXNlIHN1YmNsYXNzLicpOwogICAgICByZXR1cm4gW107CiAgICB9CgogIH0gLy8gVGVtcCBvYmplY3RzCgoKICBjb25zdCBCcm9hZHBoYXNlX2NvbGxpc2lvblBhaXJzX3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXAgPSB7CiAgICBrZXlzOiBbXQogIH07CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDEgPSBbXTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMiA9IFtdOwoKICBuZXcgVmVjMygpOwogIC8qKgogICAqIE5haXZlIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb24sIHVzZWQgaW4gbGFjayBvZiBiZXR0ZXIgb25lcy4KICAgKgogICAqIFRoZSBuYWl2ZSBicm9hZHBoYXNlIGxvb2tzIGF0IGFsbCBwb3NzaWJsZSBwYWlycyB3aXRob3V0IHJlc3RyaWN0aW9uLCB0aGVyZWZvcmUgaXQgaGFzIGNvbXBsZXhpdHkgTl4yIF8od2hpY2ggaXMgYmFkKV8KICAgKi8KCiAgY2xhc3MgTmFpdmVCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIEB0b2RvIFJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcigpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYWxsIHRoZSBjb2xsaXNpb24gcGFpcnMgaW4gdGhlIHBoeXNpY3Mgd29ybGQKICAgICAqLwoKCiAgICBjb2xsaXNpb25QYWlycyh3b3JsZCwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgYm9kaWVzID0gd29ybGQuYm9kaWVzOwogICAgICBjb25zdCBuID0gYm9kaWVzLmxlbmd0aDsKICAgICAgbGV0IGJpOwogICAgICBsZXQgYmo7IC8vIE5haXZlIE5eMiBmdHchCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IGk7IGorKykgewogICAgICAgICAgYmkgPSBib2RpZXNbaV07CiAgICAgICAgICBiaiA9IGJvZGllc1tqXTsKCiAgICAgICAgICBpZiAoIXRoaXMubmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYmksIGJqKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmludGVyc2VjdGlvblRlc3QoYmksIGJqLCBwYWlyczEsIHBhaXJzMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIGFuIEFBQkIuCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFuIGFycmF5IHRvIHN0b3JlIHJlc3VsdGluZyBib2RpZXMgaW4uCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29ybGQuYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IHdvcmxkLmJvZGllc1tpXTsKCiAgICAgICAgaWYgKGIuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgICBiLnVwZGF0ZUFBQkIoKTsKICAgICAgICB9IC8vIFVnbHkgaGFjayB1bnRpbCBCb2R5IGdldHMgYWFiYgoKCiAgICAgICAgaWYgKGIuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goYik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgLyoqCiAgICogU3RvcmFnZSBmb3IgUmF5IGNhc3RpbmcgZGF0YQogICAqLwoKCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5yYXlUb1dvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaGFzSGl0ID0gdm9pZCAwOwogICAgICB0aGlzLnNoYXBlID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHkgPSB2b2lkIDA7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gdm9pZCAwOwogICAgICB0aGlzLmRpc3RhbmNlID0gdm9pZCAwOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSB2b2lkIDA7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMuc2hhcGUgPSBudWxsOwogICAgICB0aGlzLmJvZHkgPSBudWxsOwogICAgICB0aGlzLmhpdEZhY2VJbmRleCA9IC0xOwogICAgICB0aGlzLmRpc3RhbmNlID0gLTE7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBSZXNldCBhbGwgcmVzdWx0IGRhdGEuCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMuc2hhcGUgPSBudWxsOwogICAgICB0aGlzLmJvZHkgPSBudWxsOwogICAgICB0aGlzLmhpdEZhY2VJbmRleCA9IC0xOwogICAgICB0aGlzLmRpc3RhbmNlID0gLTE7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBhYm9ydAogICAgICovCgoKICAgIGFib3J0KCkgewogICAgICB0aGlzLnNob3VsZFN0b3AgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgcmVzdWx0IGRhdGEuCiAgICAgKi8KCgogICAgc2V0KHJheUZyb21Xb3JsZCwgcmF5VG9Xb3JsZCwgaGl0Tm9ybWFsV29ybGQsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5jb3B5KHJheUZyb21Xb3JsZCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5jb3B5KHJheVRvV29ybGQpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkLmNvcHkoaGl0Tm9ybWFsV29ybGQpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuY29weShoaXRQb2ludFdvcmxkKTsKICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlOwogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICB9CgogIH0KCiAgbGV0IF9TaGFwZSR0eXBlcyRTUEhFUkUsIF9TaGFwZSR0eXBlcyRQTEFORSwgX1NoYXBlJHR5cGVzJEJPWCwgX1NoYXBlJHR5cGVzJENZTElOREVSLCBfU2hhcGUkdHlwZXMkQ09OVkVYUE8sIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSwgX1NoYXBlJHR5cGVzJFRSSU1FU0g7CiAgLyoqCiAgICogUkFZX01PREVTCiAgICovCgoKICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKICAvKioKICAgKiBBIGxpbmUgaW4gM0Qgc3BhY2UgdGhhdCBpbnRlcnNlY3RzIGJvZGllcyBhbmQgcmV0dXJuIHBvaW50cy4KICAgKi8KCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IHZvaWQgMDsKICAgICAgdGhpcy50byA9IHZvaWQgMDsKICAgICAgdGhpcy5kaXJlY3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucHJlY2lzaW9uID0gdm9pZCAwOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdm9pZCAwOwogICAgICB0aGlzLm1vZGUgPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdWx0ID0gdm9pZCAwOwogICAgICB0aGlzLmhhc0hpdCA9IHZvaWQgMDsKICAgICAgdGhpcy5jYWxsYmFjayA9IHZvaWQgMDsKICAgICAgdGhpcy5mcm9tID0gZnJvbS5jbG9uZSgpOwogICAgICB0aGlzLnRvID0gdG8uY2xvbmUoKTsKICAgICAgdGhpcy5kaXJlY3Rpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnByZWNpc2lvbiA9IDAuMDAwMTsKICAgICAgdGhpcy5jaGVja0NvbGxpc2lvblJlc3BvbnNlID0gdHJ1ZTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gZmFsc2U7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IC0xOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gLTE7CiAgICAgIHRoaXMubW9kZSA9IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKCiAgICAgIHRoaXMuY2FsbGJhY2sgPSByZXN1bHQgPT4ge307CiAgICB9CiAgICAvKioKICAgICAqIERvIGl0ZXJzZWN0aW9uIGFnYWluc3QgYWxsIGJvZGllcyBpbiB0aGUgZ2l2ZW4gV29ybGQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcsIG90aGVyd2lzZSBmYWxzZS4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RXb3JsZCh3b3JsZCwgb3B0aW9ucykgewogICAgICB0aGlzLm1vZGUgPSBvcHRpb25zLm1vZGUgfHwgUmF5LkFOWTsKICAgICAgdGhpcy5yZXN1bHQgPSBvcHRpb25zLnJlc3VsdCB8fCBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogICAgICB0aGlzLnNraXBCYWNrZmFjZXMgPSAhIW9wdGlvbnMuc2tpcEJhY2tmYWNlczsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgOiAtMTsKICAgICAgdGhpcy5jaGVja0NvbGxpc2lvblJlc3BvbnNlID0gdHlwZW9mIG9wdGlvbnMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgOiB0cnVlOwoKICAgICAgaWYgKG9wdGlvbnMuZnJvbSkgewogICAgICAgIHRoaXMuZnJvbS5jb3B5KG9wdGlvbnMuZnJvbSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnRvKSB7CiAgICAgICAgdGhpcy50by5jb3B5KG9wdGlvbnMudG8pOwogICAgICB9CgogICAgICB0aGlzLmNhbGxiYWNrID0gb3B0aW9ucy5jYWxsYmFjayB8fCAoKCkgPT4ge30pOwoKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5yZXN1bHQucmVzZXQoKTsKICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgdGhpcy5nZXRBQUJCKHRtcEFBQkIkMSk7CiAgICAgIHRtcEFycmF5Lmxlbmd0aCA9IDA7CiAgICAgIHdvcmxkLmJyb2FkcGhhc2UuYWFiYlF1ZXJ5KHdvcmxkLCB0bXBBQUJCJDEsIHRtcEFycmF5KTsKICAgICAgdGhpcy5pbnRlcnNlY3RCb2RpZXModG1wQXJyYXkpOwogICAgICByZXR1cm4gdGhpcy5oYXNIaXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGEgYm9keSwgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBkZXByZWNhdGVkIEBwYXJhbSByZXN1bHQgc2V0IHRoZSByZXN1bHQgcHJvcGVydHkgb2YgdGhlIFJheSBpbnN0ZWFkLgogICAgICovCgoKICAgIGludGVyc2VjdEJvZHkoYm9keSwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnVwZGF0ZURpcmVjdGlvbigpOwogICAgICB9CgogICAgICBjb25zdCBjaGVja0NvbGxpc2lvblJlc3BvbnNlID0gdGhpcy5jaGVja0NvbGxpc2lvblJlc3BvbnNlOwoKICAgICAgaWYgKGNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgJiYgIWJvZHkuY29sbGlzaW9uUmVzcG9uc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICgodGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHkuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHkuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB4aSA9IGludGVyc2VjdEJvZHlfeGk7CiAgICAgIGNvbnN0IHFpID0gaW50ZXJzZWN0Qm9keV9xaTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gYm9keS5zaGFwZXMubGVuZ3RoOyBpIDwgTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBib2R5LnNoYXBlc1tpXTsKCiAgICAgICAgaWYgKGNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgJiYgIXNoYXBlLmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgICBjb250aW51ZTsgLy8gU2tpcAogICAgICAgIH0KCiAgICAgICAgYm9keS5xdWF0ZXJuaW9uLm11bHQoYm9keS5zaGFwZU9yaWVudGF0aW9uc1tpXSwgcWkpOwogICAgICAgIGJvZHkucXVhdGVybmlvbi52bXVsdChib2R5LnNoYXBlT2Zmc2V0c1tpXSwgeGkpOwogICAgICAgIHhpLnZhZGQoYm9keS5wb3NpdGlvbiwgeGkpOwogICAgICAgIHRoaXMuaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHFpLCB4aSwgYm9keSk7CgogICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2hvb3QgYSByYXkgYXQgYW4gYXJyYXkgYm9kaWVzLCBnZXQgYmFjayBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGl0LgogICAgICogQHBhcmFtIGJvZGllcyBBbiBhcnJheSBvZiBCb2R5IG9iamVjdHMuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqCiAgICAgKi8KCgogICAgaW50ZXJzZWN0Qm9kaWVzKGJvZGllcywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnVwZGF0ZURpcmVjdGlvbigpOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGJvZGllcy5sZW5ndGg7ICF0aGlzLnJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLmludGVyc2VjdEJvZHkoYm9kaWVzW2ldKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBkaXJlY3Rpb24gdmVjdG9yLgogICAgICovCgoKICAgIHVwZGF0ZURpcmVjdGlvbigpIHsKICAgICAgdGhpcy50by52c3ViKHRoaXMuZnJvbSwgdGhpcy5kaXJlY3Rpb24pOwogICAgICB0aGlzLmRpcmVjdGlvbi5ub3JtYWxpemUoKTsKICAgIH0KCiAgICBpbnRlcnNlY3RTaGFwZShzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHkpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsgLy8gQ2hlY2tpbmcgYm91bmRpbmdTcGhlcmUKCiAgICAgIGNvbnN0IGRpc3RhbmNlID0gZGlzdGFuY2VGcm9tSW50ZXJzZWN0aW9uKGZyb20sIHRoaXMuZGlyZWN0aW9uLCBwb3NpdGlvbik7CgogICAgICBpZiAoZGlzdGFuY2UgPiBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgaW50ZXJzZWN0TWV0aG9kID0gdGhpc1tzaGFwZS50eXBlXTsKCiAgICAgIGlmIChpbnRlcnNlY3RNZXRob2QpIHsKICAgICAgICBpbnRlcnNlY3RNZXRob2QuY2FsbCh0aGlzLCBzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHNoYXBlKTsKICAgICAgfQogICAgfQoKICAgIF9pbnRlcnNlY3RCb3goYm94LCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Q29udmV4KGJveC5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKTsKICAgIH0KCiAgICBfaW50ZXJzZWN0UGxhbmUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gbmV3IFZlYzMoMCwgMCwgMSk7CiAgICAgIHF1YXQudm11bHQod29ybGROb3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgY29uc3QgbGVuID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBsZW4pOwogICAgICBjb25zdCBwbGFuZVRvRnJvbSA9IGxlbi5kb3Qod29ybGROb3JtYWwpOwogICAgICB0by52c3ViKHBvc2l0aW9uLCBsZW4pOwogICAgICBjb25zdCBwbGFuZVRvVG8gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKCiAgICAgIGlmIChwbGFuZVRvRnJvbSAqIHBsYW5lVG9UbyA+IDApIHsKICAgICAgICAvLyAiZnJvbSIgYW5kICJ0byIgYXJlIG9uIHRoZSBzYW1lIHNpZGUgb2YgdGhlIHBsYW5lLi4uIGJhaWwgb3V0CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoZnJvbS5kaXN0YW5jZVRvKHRvKSA8IHBsYW5lVG9Gcm9tKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBuX2RvdF9kaXIgPSB3b3JsZE5vcm1hbC5kb3QoZGlyZWN0aW9uKTsKCiAgICAgIGlmIChNYXRoLmFicyhuX2RvdF9kaXIpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAvLyBObyBpbnRlcnNlY3Rpb24KICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHBsYW5lUG9pbnRUb0Zyb20gPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBkaXJfc2NhbGVkX3dpdGhfdCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICBmcm9tLnZzdWIocG9zaXRpb24sIHBsYW5lUG9pbnRUb0Zyb20pOwogICAgICBjb25zdCB0ID0gLXdvcmxkTm9ybWFsLmRvdChwbGFuZVBvaW50VG9Gcm9tKSAvIG5fZG90X2RpcjsKICAgICAgZGlyZWN0aW9uLnNjYWxlKHQsIGRpcl9zY2FsZWRfd2l0aF90KTsKICAgICAgZnJvbS52YWRkKGRpcl9zY2FsZWRfd2l0aF90LCBoaXRQb2ludFdvcmxkKTsKICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24od29ybGROb3JtYWwsIGhpdFBvaW50V29ybGQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCBBQUJCIG9mIHRoZSByYXkuCiAgICAgKi8KCgogICAgZ2V0QUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IGFhYmI7CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgbG93ZXJCb3VuZC54ID0gTWF0aC5taW4odG8ueCwgZnJvbS54KTsKICAgICAgbG93ZXJCb3VuZC55ID0gTWF0aC5taW4odG8ueSwgZnJvbS55KTsKICAgICAgbG93ZXJCb3VuZC56ID0gTWF0aC5taW4odG8ueiwgZnJvbS56KTsKICAgICAgdXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodG8ueCwgZnJvbS54KTsKICAgICAgdXBwZXJCb3VuZC55ID0gTWF0aC5tYXgodG8ueSwgZnJvbS55KTsKICAgICAgdXBwZXJCb3VuZC56ID0gTWF0aC5tYXgodG8ueiwgZnJvbS56KTsKICAgIH0KCiAgICBfaW50ZXJzZWN0SGVpZ2h0ZmllbGQoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIHNoYXBlLmRhdGE7CiAgICAgIHNoYXBlLmVsZW1lbnRTaXplOyAvLyBDb252ZXJ0IHRoZSByYXkgdG8gbG9jYWwgaGVpZ2h0ZmllbGQgY29vcmRpbmF0ZXMKCiAgICAgIGNvbnN0IGxvY2FsUmF5ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXk7IC8vbmV3IFJheSh0aGlzLmZyb20sIHRoaXMudG8pOwoKICAgICAgbG9jYWxSYXkuZnJvbS5jb3B5KHRoaXMuZnJvbSk7CiAgICAgIGxvY2FsUmF5LnRvLmNvcHkodGhpcy50byk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgbG9jYWxSYXkuZnJvbSwgbG9jYWxSYXkuZnJvbSk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgbG9jYWxSYXkudG8sIGxvY2FsUmF5LnRvKTsKICAgICAgbG9jYWxSYXkudXBkYXRlRGlyZWN0aW9uKCk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgY29uc3QgaW5kZXggPSBpbnRlcnNlY3RIZWlnaHRmaWVsZF9pbmRleDsKICAgICAgbGV0IGlNaW5YOwogICAgICBsZXQgaU1pblk7CiAgICAgIGxldCBpTWF4WDsKICAgICAgbGV0IGlNYXhZOyAvLyBTZXQgdG8gbWF4CgogICAgICBpTWluWCA9IGlNaW5ZID0gMDsKICAgICAgaU1heFggPSBpTWF4WSA9IHNoYXBlLmRhdGEubGVuZ3RoIC0gMTsKICAgICAgY29uc3QgYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIGxvY2FsUmF5LmdldEFBQkIoYWFiYik7CiAgICAgIHNoYXBlLmdldEluZGV4T2ZQb3NpdGlvbihhYWJiLmxvd2VyQm91bmQueCwgYWFiYi5sb3dlckJvdW5kLnksIGluZGV4LCB0cnVlKTsKICAgICAgaU1pblggPSBNYXRoLm1heChpTWluWCwgaW5kZXhbMF0pOwogICAgICBpTWluWSA9IE1hdGgubWF4KGlNaW5ZLCBpbmRleFsxXSk7CiAgICAgIHNoYXBlLmdldEluZGV4T2ZQb3NpdGlvbihhYWJiLnVwcGVyQm91bmQueCwgYWFiYi51cHBlckJvdW5kLnksIGluZGV4LCB0cnVlKTsKICAgICAgaU1heFggPSBNYXRoLm1pbihpTWF4WCwgaW5kZXhbMF0gKyAxKTsKICAgICAgaU1heFkgPSBNYXRoLm1pbihpTWF4WSwgaW5kZXhbMV0gKyAxKTsKCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgc2hhcGUuZ2V0QWFiYkF0SW5kZXgoaSwgaiwgYWFiYik7CgogICAgICAgICAgaWYgKCFhYWJiLm92ZXJsYXBzUmF5KGxvY2FsUmF5KSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0gLy8gTG93ZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBzaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICB0aGlzLl9pbnRlcnNlY3RDb252ZXgoc2hhcGUucGlsbGFyQ29udmV4LCBxdWF0LCB3b3JsZFBpbGxhck9mZnNldCwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgaW50ZXJzZWN0Q29udmV4T3B0aW9ucyk7CgogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBzaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIF9pbnRlcnNlY3RTcGhlcmUoc3BoZXJlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IHIgPSBzcGhlcmUucmFkaXVzOwogICAgICBjb25zdCBhID0gKHRvLnggLSBmcm9tLngpICoqIDIgKyAodG8ueSAtIGZyb20ueSkgKiogMiArICh0by56IC0gZnJvbS56KSAqKiAyOwogICAgICBjb25zdCBiID0gMiAqICgodG8ueCAtIGZyb20ueCkgKiAoZnJvbS54IC0gcG9zaXRpb24ueCkgKyAodG8ueSAtIGZyb20ueSkgKiAoZnJvbS55IC0gcG9zaXRpb24ueSkgKyAodG8ueiAtIGZyb20ueikgKiAoZnJvbS56IC0gcG9zaXRpb24ueikpOwogICAgICBjb25zdCBjID0gKGZyb20ueCAtIHBvc2l0aW9uLngpICoqIDIgKyAoZnJvbS55IC0gcG9zaXRpb24ueSkgKiogMiArIChmcm9tLnogLSBwb3NpdGlvbi56KSAqKiAyIC0gciAqKiAyOwogICAgICBjb25zdCBkZWx0YSA9IGIgKiogMiAtIDQgKiBhICogYzsKICAgICAgY29uc3QgaW50ZXJzZWN0aW9uUG9pbnQgPSBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50OwogICAgICBjb25zdCBub3JtYWwgPSBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbDsKCiAgICAgIGlmIChkZWx0YSA8IDApIHsKICAgICAgICAvLyBObyBpbnRlcnNlY3Rpb24KICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAoZGVsdGEgPT09IDApIHsKICAgICAgICAvLyBzaW5nbGUgaW50ZXJzZWN0aW9uIHBvaW50CiAgICAgICAgZnJvbS5sZXJwKHRvLCBkZWx0YSwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBkMSA9ICgtYiAtIE1hdGguc3FydChkZWx0YSkpIC8gKDIgKiBhKTsKICAgICAgICBjb25zdCBkMiA9ICgtYiArIE1hdGguc3FydChkZWx0YSkpIC8gKDIgKiBhKTsKCiAgICAgICAgaWYgKGQxID49IDAgJiYgZDEgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMSwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoZDIgPj0gMCAmJiBkMiA8PSAxKSB7CiAgICAgICAgICBmcm9tLmxlcnAodG8sIGQyLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIF9pbnRlcnNlY3RDb252ZXgoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdENvbnZleF9ub3JtYWw7CiAgICAgIGNvbnN0IHZlY3RvciA9IGludGVyc2VjdENvbnZleF92ZWN0b3I7CiAgICAgIGNvbnN0IGZhY2VMaXN0ID0gb3B0aW9ucyAmJiBvcHRpb25zLmZhY2VMaXN0IHx8IG51bGw7IC8vIENoZWNraW5nIGZhY2VzCgogICAgICBjb25zdCBmYWNlcyA9IHNoYXBlLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHNoYXBlLnZlcnRpY2VzOwogICAgICBjb25zdCBub3JtYWxzID0gc2hhcGUuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOwogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlID0gZnJvbS5kaXN0YW5jZVRvKHRvKTsKICAgICAgY29uc3QgTmZhY2VzID0gZmFjZUxpc3QgPyBmYWNlTGlzdC5sZW5ndGggOiBmYWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaiA9IDA7ICFyZXN1bHQuc2hvdWxkU3RvcCAmJiBqIDwgTmZhY2VzOyBqKyspIHsKICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0ID8gZmFjZUxpc3Rbal0gOiBqOwogICAgICAgIGNvbnN0IGZhY2UgPSBmYWNlc1tmaV07CiAgICAgICAgY29uc3QgZmFjZU5vcm1hbCA9IG5vcm1hbHNbZmldOwogICAgICAgIGNvbnN0IHEgPSBxdWF0OwogICAgICAgIGNvbnN0IHggPSBwb3NpdGlvbjsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICB2ZWN0b3IuY29weSh2ZXJ0aWNlc1tmYWNlWzBdXSk7CiAgICAgICAgcS52bXVsdCh2ZWN0b3IsIHZlY3Rvcik7CiAgICAgICAgdmVjdG9yLnZhZGQoeCwgdmVjdG9yKTsgLy8gLi4uYnV0IG1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIHJheSBmcm9tLiBXZSdsbCBmaXggdGhpcyBsYXRlci4KCiAgICAgICAgdmVjdG9yLnZzdWIoZnJvbSwgdmVjdG9yKTsgLy8gR2V0IHBsYW5lIG5vcm1hbAoKICAgICAgICBxLnZtdWx0KGZhY2VOb3JtYWwsIG5vcm1hbCk7IC8vIElmIHRoaXMgZG90IHByb2R1Y3QgaXMgbmVnYXRpdmUsIHdlIGhhdmUgc29tZXRoaW5nIGludGVyZXN0aW5nCgogICAgICAgIGNvbnN0IGRvdCA9IGRpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKCiAgICAgICAgaWYgKE1hdGguYWJzKGRvdCkgPCB0aGlzLnByZWNpc2lvbikgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyBjYWxjIGRpc3RhbmNlIHRvIHBsYW5lCgoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gaWYgKGRvdCA8IDApIHsKICAgICAgICAvLyBJbnRlcnNlY3Rpb24gcG9pbnQgaXMgZnJvbSArIGRpcmVjdGlvbiAqIHNjYWxhcgoKCiAgICAgICAgZGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQoZnJvbSwgaW50ZXJzZWN0UG9pbnQpOyAvLyBhIGlzIHRoZSBwb2ludCB3ZSBjb21wYXJlIHBvaW50cyBiIGFuZCBjIHdpdGguCgogICAgICAgIGEuY29weSh2ZXJ0aWNlc1tmYWNlWzBdXSk7CiAgICAgICAgcS52bXVsdChhLCBhKTsKICAgICAgICB4LnZhZGQoYSwgYSk7CgogICAgICAgIGZvciAobGV0IGkgPSAxOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaSA8IGZhY2UubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICAvLyBUcmFuc2Zvcm0gMyB2ZXJ0aWNlcyB0byB3b3JsZCBjb29yZHMKICAgICAgICAgIGIuY29weSh2ZXJ0aWNlc1tmYWNlW2ldXSk7CiAgICAgICAgICBjLmNvcHkodmVydGljZXNbZmFjZVtpICsgMV1dKTsKICAgICAgICAgIHEudm11bHQoYiwgYik7CiAgICAgICAgICBxLnZtdWx0KGMsIGMpOwogICAgICAgICAgeC52YWRkKGIsIGIpOwogICAgICAgICAgeC52YWRkKGMsIGMpOwogICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVRvKGZyb20pOwoKICAgICAgICAgIGlmICghKFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGEsIGIsIGMpIHx8IFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGIsIGEsIGMpKSB8fCBkaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0UG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIGZpKTsKICAgICAgICB9IC8vIH0KCiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQHRvZG8gT3B0aW1pemUgYnkgdHJhbnNmb3JtaW5nIHRoZSB3b3JsZCB0byBsb2NhbCBzcGFjZSBmaXJzdC4KICAgICAqIEB0b2RvIFVzZSBPY3RyZWUgbG9va3VwCiAgICAgKi8KCgogICAgX2ludGVyc2VjdFRyaW1lc2gobWVzaCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUsIG9wdGlvbnMpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gaW50ZXJzZWN0VHJpbWVzaF9ub3JtYWw7CiAgICAgIGNvbnN0IHRyaWFuZ2xlcyA9IGludGVyc2VjdFRyaW1lc2hfdHJpYW5nbGVzOwogICAgICBjb25zdCB0cmVlVHJhbnNmb3JtID0gaW50ZXJzZWN0VHJpbWVzaF90cmVlVHJhbnNmb3JtOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBsb2NhbERpcmVjdGlvbiA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxEaXJlY3Rpb247CiAgICAgIGNvbnN0IGxvY2FsRnJvbSA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxGcm9tOwogICAgICBjb25zdCBsb2NhbFRvID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvOwogICAgICBjb25zdCB3b3JsZEludGVyc2VjdFBvaW50ID0gaW50ZXJzZWN0VHJpbWVzaF93b3JsZEludGVyc2VjdFBvaW50OwogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGROb3JtYWw7IC8vIENoZWNraW5nIGZhY2VzCgogICAgICBjb25zdCBpbmRpY2VzID0gbWVzaC5pbmRpY2VzOwogICAgICBtZXNoLnZlcnRpY2VzOyAvLyBjb25zdCBub3JtYWxzID0gbWVzaC5mYWNlTm9ybWFscwoKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgdHJlZVRyYW5zZm9ybS5wb3NpdGlvbi5jb3B5KHBvc2l0aW9uKTsKICAgICAgdHJlZVRyYW5zZm9ybS5xdWF0ZXJuaW9uLmNvcHkocXVhdCk7IC8vIFRyYW5zZm9ybSByYXkgdG8gbG9jYWwgc3BhY2UhCgogICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBkaXJlY3Rpb24sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBmcm9tLCBsb2NhbEZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIHRvLCBsb2NhbFRvKTsKICAgICAgbG9jYWxUby54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxUby55ICo9IG1lc2guc2NhbGUueTsKICAgICAgbG9jYWxUby56ICo9IG1lc2guc2NhbGUuejsKICAgICAgbG9jYWxGcm9tLnggKj0gbWVzaC5zY2FsZS54OwogICAgICBsb2NhbEZyb20ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsRnJvbS56ICo9IG1lc2guc2NhbGUuejsKICAgICAgbG9jYWxUby52c3ViKGxvY2FsRnJvbSwgbG9jYWxEaXJlY3Rpb24pOwogICAgICBsb2NhbERpcmVjdGlvbi5ub3JtYWxpemUoKTsKICAgICAgY29uc3QgZnJvbVRvRGlzdGFuY2VTcXVhcmVkID0gbG9jYWxGcm9tLmRpc3RhbmNlU3F1YXJlZChsb2NhbFRvKTsKICAgICAgbWVzaC50cmVlLnJheVF1ZXJ5KHRoaXMsIHRyZWVUcmFuc2Zvcm0sIHRyaWFuZ2xlcyk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7ICF0aGlzLnJlc3VsdC5zaG91bGRTdG9wICYmIGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHRyaWFuZ2xlc0luZGV4ID0gdHJpYW5nbGVzW2ldOwogICAgICAgIG1lc2guZ2V0Tm9ybWFsKHRyaWFuZ2xlc0luZGV4LCBub3JtYWwpOyAvLyBkZXRlcm1pbmUgaWYgcmF5IGludGVyc2VjdHMgdGhlIHBsYW5lIG9mIHRoZSBmYWNlCiAgICAgICAgLy8gbm90ZTogdGhpcyB3b3JrcyByZWdhcmRsZXNzIG9mIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGZhY2Ugbm9ybWFsCiAgICAgICAgLy8gR2V0IHBsYW5lIHBvaW50IGluIHdvcmxkIGNvb3JkaW5hdGVzLi4uCgogICAgICAgIG1lc2guZ2V0VmVydGV4KGluZGljZXNbdHJpYW5nbGVzSW5kZXggKiAzXSwgYSk7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIGEudnN1Yihsb2NhbEZyb20sIHZlY3Rvcik7IC8vIElmIHRoaXMgZG90IHByb2R1Y3QgaXMgbmVnYXRpdmUsIHdlIGhhdmUgc29tZXRoaW5nIGludGVyZXN0aW5nCgogICAgICAgIGNvbnN0IGRvdCA9IGxvY2FsRGlyZWN0aW9uLmRvdChub3JtYWwpOyAvLyBCYWlsIG91dCBpZiByYXkgYW5kIHBsYW5lIGFyZSBwYXJhbGxlbAogICAgICAgIC8vIGlmIChNYXRoLmFicyggZG90ICkgPCB0aGlzLnByZWNpc2lvbil7CiAgICAgICAgLy8gICAgIGNvbnRpbnVlOwogICAgICAgIC8vIH0KICAgICAgICAvLyBjYWxjIGRpc3RhbmNlIHRvIHBsYW5lCgogICAgICAgIGNvbnN0IHNjYWxhciA9IG5vcm1hbC5kb3QodmVjdG9yKSAvIGRvdDsgLy8gaWYgbmVnYXRpdmUgZGlzdGFuY2UsIHRoZW4gcGxhbmUgaXMgYmVoaW5kIHJheQoKICAgICAgICBpZiAoc2NhbGFyIDwgMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyBJbnRlcnNlY3Rpb24gcG9pbnQgaXMgZnJvbSArIGRpcmVjdGlvbiAqIHNjYWxhcgoKCiAgICAgICAgbG9jYWxEaXJlY3Rpb24uc2NhbGUoc2NhbGFyLCBpbnRlcnNlY3RQb2ludCk7CiAgICAgICAgaW50ZXJzZWN0UG9pbnQudmFkZChsb2NhbEZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gR2V0IHRyaWFuZ2xlIHZlcnRpY2VzCgogICAgICAgIG1lc2guZ2V0VmVydGV4KGluZGljZXNbdHJpYW5nbGVzSW5kZXggKiAzICsgMV0sIGIpOwogICAgICAgIG1lc2guZ2V0VmVydGV4KGluZGljZXNbdHJpYW5nbGVzSW5kZXggKiAzICsgMl0sIGMpOwogICAgICAgIGNvbnN0IHNxdWFyZWREaXN0YW5jZSA9IGludGVyc2VjdFBvaW50LmRpc3RhbmNlU3F1YXJlZChsb2NhbEZyb20pOwoKICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSkgfHwgc3F1YXJlZERpc3RhbmNlID4gZnJvbVRvRGlzdGFuY2VTcXVhcmVkKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIHRyYW5zZm9ybSBpbnRlcnNlY3Rwb2ludCBhbmQgbm9ybWFsIHRvIHdvcmxkCgoKICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHF1YXQsIG5vcm1hbCwgd29ybGROb3JtYWwpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgaW50ZXJzZWN0UG9pbnQsIHdvcmxkSW50ZXJzZWN0UG9pbnQpOwogICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCB3b3JsZEludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCB0cmlhbmdsZXNJbmRleCk7CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIGludGVyc2VjdGlvbnMgc2hvdWxkIGNvbnRpbnVlCiAgICAgKi8KCgogICAgcmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGhpdEZhY2VJbmRleCkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpc3RhbmNlID0gZnJvbS5kaXN0YW5jZVRvKGhpdFBvaW50V29ybGQpOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsgLy8gU2tpcCBiYWNrIGZhY2VzPwoKICAgICAgaWYgKHRoaXMuc2tpcEJhY2tmYWNlcyAmJiBub3JtYWwuZG90KHRoaXMuZGlyZWN0aW9uKSA+IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJlc3VsdC5oaXRGYWNlSW5kZXggPSB0eXBlb2YgaGl0RmFjZUluZGV4ICE9PSAndW5kZWZpbmVkJyA/IGhpdEZhY2VJbmRleCA6IC0xOwoKICAgICAgc3dpdGNoICh0aGlzLm1vZGUpIHsKICAgICAgICBjYXNlIFJheS5BTEw6CiAgICAgICAgICB0aGlzLmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuY2FsbGJhY2socmVzdWx0KTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIFJheS5DTE9TRVNUOgogICAgICAgICAgLy8gU3RvcmUgaWYgY2xvc2VyIHRoYW4gY3VycmVudCBjbG9zZXN0CiAgICAgICAgICBpZiAoZGlzdGFuY2UgPCByZXN1bHQuZGlzdGFuY2UgfHwgIXJlc3VsdC5oYXNIaXQpIHsKICAgICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgICByZXN1bHQuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIFJheS5BTlk6CiAgICAgICAgICAvLyBSZXBvcnQgYW5kIHN0b3AuCiAgICAgICAgICB0aGlzLmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIHJlc3VsdC5zaG91bGRTdG9wID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFzIHBlciAiQmFyeWNlbnRyaWMgVGVjaG5pcXVlIiBhcyBuYW1lZAogICAgICoge0BsaW5rIGh0dHBzOi8vd3d3LmJsYWNrcGF3bi5jb20vdGV4dHMvcG9pbnRpbnBvbHkvZGVmYXVsdC5odG1sIGhlcmV9IGJ1dCB3aXRob3V0IHRoZSBkaXZpc2lvbgogICAgICovCgoKICAgIHN0YXRpYyBwb2ludEluVHJpYW5nbGUocCwgYSwgYiwgYykgewogICAgICBjLnZzdWIoYSwgdjApOwogICAgICBiLnZzdWIoYSwgdjEpOwogICAgICBwLnZzdWIoYSwgdjIpOwogICAgICBjb25zdCBkb3QwMCA9IHYwLmRvdCh2MCk7CiAgICAgIGNvbnN0IGRvdDAxID0gdjAuZG90KHYxKTsKICAgICAgY29uc3QgZG90MDIgPSB2MC5kb3QodjIpOwogICAgICBjb25zdCBkb3QxMSA9IHYxLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDEyID0gdjEuZG90KHYyKTsKICAgICAgbGV0IHU7CiAgICAgIGxldCB2OwogICAgICByZXR1cm4gKHUgPSBkb3QxMSAqIGRvdDAyIC0gZG90MDEgKiBkb3QxMikgPj0gMCAmJiAodiA9IGRvdDAwICogZG90MTIgLSBkb3QwMSAqIGRvdDAyKSA+PSAwICYmIHUgKyB2IDwgZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDE7CiAgICB9CgogIH0KCiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4T3B0aW9ucyA9IHsKICAgIGZhY2VMaXN0OiBbMF0KICB9OwogIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RIZWlnaHRmaWVsZF9sb2NhbFJheSA9IG5ldyBSYXkoKTsKICBjb25zdCBpbnRlcnNlY3RIZWlnaHRmaWVsZF9pbmRleCA9IFtdOwogIGNvbnN0IFJheV9pbnRlcnNlY3RTcGhlcmVfaW50ZXJzZWN0aW9uUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IFJheV9pbnRlcnNlY3RTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhfdmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb20gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZEludGVyc2VjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBuZXcgQUFCQigpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmVlVHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpOwogIGNvbnN0IHYwID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3QgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgZGlyZWN0aW9uLCBwb3NpdGlvbikgewogICAgLy8gdjAgaXMgdmVjdG9yIGZyb20gZnJvbSB0byBwb3NpdGlvbgogICAgcG9zaXRpb24udnN1Yihmcm9tLCB2MCk7CiAgICBjb25zdCBkb3QgPSB2MC5kb3QoZGlyZWN0aW9uKTsgLy8gaW50ZXJzZWN0ID0gZGlyZWN0aW9uKmRvdCArIGZyb20KCiAgICBkaXJlY3Rpb24uc2NhbGUoZG90LCBpbnRlcnNlY3QpOwogICAgaW50ZXJzZWN0LnZhZGQoZnJvbSwgaW50ZXJzZWN0KTsKICAgIGNvbnN0IGRpc3RhbmNlID0gcG9zaXRpb24uZGlzdGFuY2VUbyhpbnRlcnNlY3QpOwogICAgcmV0dXJuIGRpc3RhbmNlOwogIH0KICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KCgogIGNsYXNzIFNBUEJyb2FkcGhhc2UgZXh0ZW5kcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogTGlzdCBvZiBib2RpZXMgY3VycmVudGx5IGluIHRoZSBicm9hZHBoYXNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBBeGlzIHRvIHNvcnQgdGhlIGJvZGllcyBhbG9uZy4KICAgICAqIFNldCB0byAwIGZvciB4IGF4aXMsIGFuZCAxIGZvciB5IGF4aXMuCiAgICAgKiBGb3IgYmVzdCBwZXJmb3JtYW5jZSwgcGljayB0aGUgYXhpcyB3aGVyZSBib2RpZXMgYXJlIG1vc3QgZGlzdHJpYnV0ZWQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZHMgb2YgdHdvIGJvZGllcyBvdmVybGFwLCBhbG9uZyB0aGUgZ2l2ZW4gU0FQIGF4aXMuCiAgICAgKi8KICAgIHN0YXRpYyBjaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkgewogICAgICBsZXQgYmlQb3M7CiAgICAgIGxldCBialBvczsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDApIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLng7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi54OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24ueTsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLnk7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi56OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24uejsKICAgICAgfQoKICAgICAgY29uc3QgcmkgPSBiaS5ib3VuZGluZ1JhZGl1cywKICAgICAgICAgICAgcmogPSBiai5ib3VuZGluZ1JhZGl1cywKICAgICAgICAgICAgYm91bmRBMiA9IGJpUG9zICsgcmksCiAgICAgICAgICAgIGJvdW5kQjEgPSBialBvcyAtIHJqOwogICAgICByZXR1cm4gYm91bmRCMSA8IGJvdW5kQTI7CiAgICB9IC8vIE5vdGU6IHRoZXNlIGFyZSBpZGVudGljYWwsIHNhdmUgZm9yIHgveS96IGxvd2VyYm91bmQKCiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRYCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRYKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC54IDw9IHYuYWFiYi5sb3dlckJvdW5kLngpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFkKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFkoYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnkgPD0gdi5hYWJiLmxvd2VyQm91bmQueSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WgogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WihhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueiA8PSB2LmFhYmIubG93ZXJCb3VuZC56KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5heGlzTGlzdCA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzSW5kZXggPSB2b2lkIDA7CiAgICAgIHRoaXMuX2FkZEJvZHlIYW5kbGVyID0gdm9pZCAwOwogICAgICB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlciA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzTGlzdCA9IFtdOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5heGlzSW5kZXggPSAwOwogICAgICBjb25zdCBheGlzTGlzdCA9IHRoaXMuYXhpc0xpc3Q7CgogICAgICB0aGlzLl9hZGRCb2R5SGFuZGxlciA9IGV2ZW50ID0+IHsKICAgICAgICBheGlzTGlzdC5wdXNoKGV2ZW50LmJvZHkpOwogICAgICB9OwoKICAgICAgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgY29uc3QgaWR4ID0gYXhpc0xpc3QuaW5kZXhPZihldmVudC5ib2R5KTsKCiAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICAgIGF4aXNMaXN0LnNwbGljZShpZHgsIDEpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmICh3b3JsZCkgewogICAgICAgIHRoaXMuc2V0V29ybGQod29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoYW5nZSB0aGUgd29ybGQKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkgewogICAgICAvLyBDbGVhciB0aGUgb2xkIGF4aXMgYXJyYXkKICAgICAgdGhpcy5heGlzTGlzdC5sZW5ndGggPSAwOyAvLyBBZGQgYWxsIGJvZGllcyBmcm9tIHRoZSBuZXcgd29ybGQKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29ybGQuYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5heGlzTGlzdC5wdXNoKHdvcmxkLmJvZGllc1tpXSk7CiAgICAgIH0gLy8gUmVtb3ZlIG9sZCBoYW5kbGVycywgaWYgYW55CgoKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsgLy8gQWRkIGhhbmRsZXJzIHRvIHVwZGF0ZSB0aGUgbGlzdCBvZiBib2RpZXMuCgogICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdhZGRCb2R5JywgdGhpcy5fYWRkQm9keUhhbmRsZXIpOwogICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdyZW1vdmVCb2R5JywgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuZGlydHkgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDb2xsZWN0IGFsbCBjb2xsaXNpb24gcGFpcnMKICAgICAqLwoKCiAgICBjb2xsaXNpb25QYWlycyh3b3JsZCwgcDEsIHAyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLnNvcnRMaXN0KCk7CiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICB9IC8vIExvb2sgdGhyb3VnaCB0aGUgbGlzdAoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IE47IGorKykgewogICAgICAgICAgY29uc3QgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFTQVBCcm9hZHBoYXNlLmNoZWNrQm91bmRzKGJpLCBiaiwgYXhpc0luZGV4KSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmludGVyc2VjdGlvblRlc3QoYmksIGJqLCBwMSwgcDIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNvcnRMaXN0KCkgewogICAgICBjb25zdCBheGlzTGlzdCA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBjb25zdCBOID0gYXhpc0xpc3QubGVuZ3RoOyAvLyBVcGRhdGUgQUFCQnMKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGF4aXNMaXN0W2ldOwoKICAgICAgICBpZiAoYmkuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgICBiaS51cGRhdGVBQUJCKCk7CiAgICAgICAgfQogICAgICB9IC8vIFNvcnQgdGhlIGxpc3QKCgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgU0FQQnJvYWRwaGFzZS5pbnNlcnRpb25Tb3J0WChheGlzTGlzdCk7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgU0FQQnJvYWRwaGFzZS5pbnNlcnRpb25Tb3J0WShheGlzTGlzdCk7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgU0FQQnJvYWRwaGFzZS5pbnNlcnRpb25Tb3J0WihheGlzTGlzdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIHZhcmlhbmNlIG9mIHRoZSBib2R5IHBvc2l0aW9ucyBhbmQgZXN0aW1hdGVzIHRoZSBiZXN0IGF4aXMgdG8gdXNlLgogICAgICogV2lsbCBhdXRvbWF0aWNhbGx5IHNldCBwcm9wZXJ0eSBgYXhpc0luZGV4YC4KICAgICAqLwoKCiAgICBhdXRvRGV0ZWN0QXhpcygpIHsKICAgICAgbGV0IHN1bVggPSAwOwogICAgICBsZXQgc3VtWDIgPSAwOwogICAgICBsZXQgc3VtWSA9IDA7CiAgICAgIGxldCBzdW1ZMiA9IDA7CiAgICAgIGxldCBzdW1aID0gMDsKICAgICAgbGV0IHN1bVoyID0gMDsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGludk4gPSAxIC8gTjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgIGNvbnN0IGNlbnRlclggPSBiLnBvc2l0aW9uLng7CiAgICAgICAgc3VtWCArPSBjZW50ZXJYOwogICAgICAgIHN1bVgyICs9IGNlbnRlclggKiBjZW50ZXJYOwogICAgICAgIGNvbnN0IGNlbnRlclkgPSBiLnBvc2l0aW9uLnk7CiAgICAgICAgc3VtWSArPSBjZW50ZXJZOwogICAgICAgIHN1bVkyICs9IGNlbnRlclkgKiBjZW50ZXJZOwogICAgICAgIGNvbnN0IGNlbnRlclogPSBiLnBvc2l0aW9uLno7CiAgICAgICAgc3VtWiArPSBjZW50ZXJaOwogICAgICAgIHN1bVoyICs9IGNlbnRlclogKiBjZW50ZXJaOwogICAgICB9CgogICAgICBjb25zdCB2YXJpYW5jZVggPSBzdW1YMiAtIHN1bVggKiBzdW1YICogaW52TjsKICAgICAgY29uc3QgdmFyaWFuY2VZID0gc3VtWTIgLSBzdW1ZICogc3VtWSAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWiA9IHN1bVoyIC0gc3VtWiAqIHN1bVogKiBpbnZOOwoKICAgICAgaWYgKHZhcmlhbmNlWCA+IHZhcmlhbmNlWSkgewogICAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVopIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5heGlzSW5kZXggPSAyOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh2YXJpYW5jZVkgPiB2YXJpYW5jZVopIHsKICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAyOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIGFuIEFBQkIuCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFuIGFycmF5IHRvIHN0b3JlIHJlc3VsdGluZyBib2RpZXMgaW4uCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBheGlzID0gJ3gnOwoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIGF4aXMgPSAneSc7CiAgICAgIH0KCiAgICAgIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBheGlzID0gJ3onOwogICAgICB9CgogICAgICBjb25zdCBheGlzTGlzdCA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGFhYmIubG93ZXJCb3VuZFtheGlzXTsKICAgICAgYWFiYi51cHBlckJvdW5kW2F4aXNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGlzTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGIuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgICBiLnVwZGF0ZUFBQkIoKTsKICAgICAgICB9CgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICBjbGFzcyBVdGlscyB7CiAgICAvKioKICAgICAqIEV4dGVuZCBhbiBvcHRpb25zIG9iamVjdCB3aXRoIGRlZmF1bHQgdmFsdWVzLgogICAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG9wdGlvbnMgb2JqZWN0LiBNYXkgYmUgZmFsc3k6IGluIHRoaXMgY2FzZSwgYSBuZXcgb2JqZWN0IGlzIGNyZWF0ZWQgYW5kIHJldHVybmVkLgogICAgICogQHBhcmFtIGRlZmF1bHRzIEFuIG9iamVjdCBjb250YWluaW5nIGRlZmF1bHQgdmFsdWVzLgogICAgICogQHJldHVybiBUaGUgbW9kaWZpZWQgb3B0aW9ucyBvYmplY3QuCiAgICAgKi8KICAgIHN0YXRpYyBkZWZhdWx0cyhvcHRpb25zLCBkZWZhdWx0cykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBmb3IgKGxldCBrZXkgaW4gZGVmYXVsdHMpIHsKICAgICAgICBpZiAoIShrZXkgaW4gb3B0aW9ucykpIHsKICAgICAgICAgIG9wdGlvbnNba2V5XSA9IGRlZmF1bHRzW2tleV07CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0KCiAgfQogIC8qKgogICAqIENvbnN0cmFpbnQgYmFzZSBjbGFzcwogICAqLwoKCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMuZXF1YXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlBID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlCID0gdm9pZCAwOwogICAgICB0aGlzLmlkID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSB2b2lkIDA7CiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KCiAgQ29uc3RyYWludC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbCA9IHZvaWQgMDsKICAgICAgdGhpcy5zcGF0aWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yb3RhdGlvbmFsID0gbmV3IFZlYzMoKTsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgd2l0aCBvdGhlciBKYWNvYmlhbkVsZW1lbnQKICAgICAqLwoKCiAgICBtdWx0aXBseUVsZW1lbnQoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5zcGF0aWFsLmRvdCh0aGlzLnNwYXRpYWwpICsgZWxlbWVudC5yb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIHR3byB2ZWN0b3JzCiAgICAgKi8KCgogICAgbXVsdGlwbHlWZWN0b3JzKHNwYXRpYWwsIHJvdGF0aW9uYWwpIHsKICAgICAgcmV0dXJuIHNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyByb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQoKICB9CiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCgoKICBjbGFzcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIE1pbmltdW0gKHJlYWQ6IG5lZ2F0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogTWF4aW11bSAocmVhZDogcG9zaXRpdmUgbWF4KSBmb3JjZSB0byBiZSBhcHBsaWVkIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBBIG51bWJlciwgcHJvcG9ydGlvbmFsIHRvIHRoZSBmb3JjZSBhZGRlZCB0byB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihiaSwgYmosIG1pbkZvcmNlLCBtYXhGb3JjZSkgewogICAgICBpZiAobWluRm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1pbkZvcmNlID0gLTFlNjsKICAgICAgfQoKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5taW5Gb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhGb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5iaSA9IHZvaWQgMDsKICAgICAgdGhpcy5iaiA9IHZvaWQgMDsKICAgICAgdGhpcy5zaSA9IHZvaWQgMDsKICAgICAgdGhpcy5zaiA9IHZvaWQgMDsKICAgICAgdGhpcy5hID0gdm9pZCAwOwogICAgICB0aGlzLmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZXBzID0gdm9pZCAwOwogICAgICB0aGlzLmphY29iaWFuRWxlbWVudEEgPSB2b2lkIDA7CiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QiA9IHZvaWQgMDsKICAgICAgdGhpcy5lbmFibGVkID0gdm9pZCAwOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQoKICBFcXVhdGlvbi5pZENvdW50ZXIgPSAwOwogIGNvbnN0IGlNZmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGlNZmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklpX3ZtdWx0X3RhdWkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklqX3ZtdWx0X3RhdWogPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWRkVG9XbGFtYmRhX3RlbXAgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KCiAgY2xhc3MgQ29udGFjdEVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiAiYm91bmNpbmVzcyI6IHUxID0gLWUqdTAKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgZ29lcyBmcm9tIHRoZSBjZW50ZXIgb2YgYmkgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkLW9yaWVudGVkIHZlY3RvciB0aGF0IHN0YXJ0cyBpbiBib2R5IGogcG9zaXRpb24gYW5kIGdvZXMgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbnRhY3Qgbm9ybWFsLCBwb2ludGluZyBvdXQgb2YgYm9keSBpLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgMCwgbWF4Rm9yY2UpOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnJpID0gdm9pZCAwOwogICAgICB0aGlzLnJqID0gdm9pZCAwOwogICAgICB0aGlzLm5pID0gdm9pZCAwOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gMC4wOwogICAgICB0aGlzLnJpID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yaiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubmkgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHJpID0gdGhpcy5yaTsKICAgICAgY29uc3QgcmogPSB0aGlzLnJqOwogICAgICBjb25zdCByaXhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB2aSA9IGJpLnZlbG9jaXR5OwogICAgICBjb25zdCB3aSA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmkuZm9yY2U7CiAgICAgIGJpLnRvcnF1ZTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2ogPSBiai5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGJqLmZvcmNlOwogICAgICBiai50b3JxdWU7CiAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IG4gPSB0aGlzLm5pOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKG4sIHJpeG4pOwogICAgICByai5jcm9zcyhuLCByanhuKTsgLy8gZyA9IHhqK3JqIC0oeGkrcmkpCiAgICAgIC8vIEcgPSBbIC1uaSAgLXJpeG4gIG5pICByanhuIF0KCiAgICAgIG4ubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXhuLm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KG4pOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4bik7IC8vIENhbGN1bGF0ZSB0aGUgcGVuZXRyYXRpb24gdmVjdG9yCgogICAgICBwZW5ldHJhdGlvblZlYy5jb3B5KGJqLnBvc2l0aW9uKTsKICAgICAgcGVuZXRyYXRpb25WZWMudmFkZChyaiwgcGVuZXRyYXRpb25WZWMpOwogICAgICBwZW5ldHJhdGlvblZlYy52c3ViKGJpLnBvc2l0aW9uLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIocmksIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgY29uc3QgZyA9IG4uZG90KHBlbmV0cmF0aW9uVmVjKTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgIGNvbnN0IGVQbHVzT25lID0gdGhpcy5yZXN0aXR1dGlvbiArIDE7CiAgICAgIGNvbnN0IEdXID0gZVBsdXNPbmUgKiB2ai5kb3QobikgLSBlUGx1c09uZSAqIHZpLmRvdChuKSArIHdqLmRvdChyanhuKSAtIHdpLmRvdChyaXhuKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHJlbGF0aXZlIHZlbG9jaXR5IGluIHRoZSBjb250YWN0IHBvaW50LgogICAgICovCgoKICAgIGdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSB7CiAgICAgIGNvbnN0IHZpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmk7CiAgICAgIGNvbnN0IHZqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmo7CiAgICAgIGNvbnN0IHhpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGk7CiAgICAgIGNvbnN0IHhqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGo7CiAgICAgIGNvbnN0IHJlbFZlbCA9IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbDsKICAgICAgdGhpcy5iaS5wb3NpdGlvbi52YWRkKHRoaXMucmksIHhpKTsKICAgICAgdGhpcy5iai5wb3NpdGlvbi52YWRkKHRoaXMucmosIHhqKTsKICAgICAgdGhpcy5iaS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludCh4aSwgdmkpOwogICAgICB0aGlzLmJqLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhqLCB2aik7CiAgICAgIHZpLnZzdWIodmosIHJlbFZlbCk7CiAgICAgIHJldHVybiB0aGlzLm5pLmRvdChyZWxWZWwpOwogICAgfQoKICB9CgogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMSA9IG5ldyBWZWMzKCk7IC8vIFRlbXAgdmVjdG9ycwoKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGogPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQ29ubmVjdHMgdHdvIGJvZGllcyBhdCBnaXZlbiBvZmZzZXQgcG9pbnRzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGJvZHlBID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGNvbnN0IGJvZHlCID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGJvZHlBLnBvc2l0aW9uLnNldCgtMSwgMCwgMCkKICAgKiAgICAgYm9keUIucG9zaXRpb24uc2V0KDEsIDAsIDApCiAgICogICAgIGJvZHlBLmFkZFNoYXBlKHNoYXBlQSkKICAgKiAgICAgYm9keUIuYWRkU2hhcGUoc2hhcGVCKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlBKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlCKQogICAqICAgICBjb25zdCBsb2NhbFBpdm90QSA9IG5ldyBWZWMzKDEsIDAsIDApCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RCID0gbmV3IFZlYzMoLTEsIDAsIDApCiAgICogICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChib2R5QSwgbG9jYWxQaXZvdEEsIGJvZHlCLCBsb2NhbFBpdm90QikKICAgKiAgICAgd29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KQogICAqLwoKICBjbGFzcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IGV4dGVuZHMgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIFBpdm90LCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBpdm90LCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBwaXZvdEEgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QSB3aGljaCBib2R5QSBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBib2R5QiBCb2R5IHRoYXQgd2lsbCBiZSBjb25zdHJhaW5lZCBpbiBhIHNpbWlsYXIgd2F5IHRvIHRoZSBzYW1lIHBvaW50IGFzIGJvZHlBLiBXZSB3aWxsIHRoZXJlZm9yZSBnZXQgYSBsaW5rIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLiBJZiBub3Qgc3BlY2lmaWVkLCBib2R5QSB3aWxsIGJlIGNvbnN0cmFpbmVkIHRvIGEgc3RhdGljIHBvaW50LgogICAgICogQHBhcmFtIHBpdm90QiBUaGUgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIG9mIGJvZHlCIHdoaWNoIGJvZHlCIGlzIGNvbnN0cmFpbmVkIHRvLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChwaXZvdEEgPT09IHZvaWQgMCkgewogICAgICAgIHBpdm90QSA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmIChwaXZvdEIgPT09IHZvaWQgMCkgewogICAgICAgIHBpdm90QiA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMucGl2b3RBID0gdm9pZCAwOwogICAgICB0aGlzLnBpdm90QiA9IHZvaWQgMDsKICAgICAgdGhpcy5lcXVhdGlvblggPSB2b2lkIDA7CiAgICAgIHRoaXMuZXF1YXRpb25ZID0gdm9pZCAwOwogICAgICB0aGlzLmVxdWF0aW9uWiA9IHZvaWQgMDsKICAgICAgdGhpcy5waXZvdEEgPSBwaXZvdEEuY2xvbmUoKTsKICAgICAgdGhpcy5waXZvdEIgPSBwaXZvdEIuY2xvbmUoKTsKICAgICAgY29uc3QgeCA9IHRoaXMuZXF1YXRpb25YID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICBjb25zdCB5ID0gdGhpcy5lcXVhdGlvblkgPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHogPSB0aGlzLmVxdWF0aW9uWiA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsgLy8gRXF1YXRpb25zIHRvIGJlIGZlZCB0byB0aGUgc29sdmVyCgogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHgsIHksIHopOyAvLyBNYWtlIHRoZSBlcXVhdGlvbnMgYmlkaXJlY3Rpb25hbAoKICAgICAgeC5taW5Gb3JjZSA9IHkubWluRm9yY2UgPSB6Lm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICB4Lm1heEZvcmNlID0geS5tYXhGb3JjZSA9IHoubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgeC5uaS5zZXQoMSwgMCwgMCk7CiAgICAgIHkubmkuc2V0KDAsIDEsIDApOwogICAgICB6Lm5pLnNldCgwLCAwLCAxKTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblg7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aOyAvLyBSb3RhdGUgdGhlIHBpdm90cyB0byB3b3JsZCBzcGFjZQoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QSwgeC5yaSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5waXZvdEIsIHgucmopOwogICAgICB5LnJpLmNvcHkoeC5yaSk7CiAgICAgIHkucmouY29weSh4LnJqKTsKICAgICAgei5yaS5jb3B5KHgucmkpOwogICAgICB6LnJqLmNvcHkoeC5yaik7CiAgICB9CgogIH0KICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KCgogIGNsYXNzIENvbmVFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogTG9jYWwgYXhpcyBpbiBBCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgImNvbmUgYW5nbGUiIHRvIGtlZXAKICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQiA9IHZvaWQgMDsKICAgICAgdGhpcy5hbmdsZSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQSA9IG9wdGlvbnMuYXhpc0EgPyBvcHRpb25zLmF4aXNBLmNsb25lKCkgOiBuZXcgVmVjMygxLCAwLCAwKTsKICAgICAgdGhpcy5heGlzQiA9IG9wdGlvbnMuYXhpc0IgPyBvcHRpb25zLmF4aXNCLmNsb25lKCkgOiBuZXcgVmVjMygwLCAxLCAwKTsKICAgICAgdGhpcy5hbmdsZSA9IHR5cGVvZiBvcHRpb25zLmFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5nbGUgOiAwOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgbmkgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBuaiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IG5peG5qID0gdG1wVmVjMSQyOwogICAgICBjb25zdCBuanhuaSA9IHRtcFZlYzIkMjsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIG5pLmNyb3NzKG5qLCBuaXhuaik7CiAgICAgIG5qLmNyb3NzKG5pLCBuanhuaSk7IC8vIFRoZSBhbmdsZSBiZXR3ZWVuIHR3byB2ZWN0b3IgaXM6CiAgICAgIC8vIGNvcyh0aGV0YSkgPSBhICogYiAvIChsZW5ndGgoYSkgKiBsZW5ndGgoYikgPSB7IGxlbihhKSA9IGxlbihiKSA9IDEgfSA9IGEgKiBiCiAgICAgIC8vIGcgPSBhICogYgogICAgICAvLyBnZG90ID0gKGIgeCBhKSAqIHdpICsgKGEgeCBiKSAqIHdqCiAgICAgIC8vIEcgPSBbMCBieGEgMCBheGJdCiAgICAgIC8vIFcgPSBbdmkgd2kgdmogd2pdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkobmp4bmkpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkobml4bmopOwogICAgICBjb25zdCBnID0gTWF0aC5jb3ModGhpcy5hbmdsZSkgLSBuaS5kb3QobmopOwogICAgICBjb25zdCBHVyA9IHRoaXMuY29tcHV0ZUdXKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtZyAqIGEgLSBHVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIFJvdGF0aW9uYWwgY29uc3RyYWludC4gV29ya3MgdG8ga2VlcCB0aGUgbG9jYWwgdmVjdG9ycyBvcnRob2dvbmFsIHRvIGVhY2ggb3RoZXIgaW4gd29ybGQgc3BhY2UuCiAgICovCgogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0IgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF4QW5nbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQoKICBjb25zdCB0bXBWZWMxJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIkMSA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCgogIGNsYXNzIENvbmVUd2lzdENvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGF4aXMgZGlyZWN0aW9uIGZvciB0aGUgY29uc3RyYWludCBvZiB0aGUgYm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBhcGVydHVyZSBhbmdsZSBvZiB0aGUgY29uZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHR3aXN0IGFuZ2xlIG9mIHRoZSBqb2ludC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsgLy8gU2V0IHBpdm90IHBvaW50IGluIGJldHdlZW4KCiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQiA9IHZvaWQgMDsKICAgICAgdGhpcy5hbmdsZSA9IHZvaWQgMDsKICAgICAgdGhpcy50d2lzdEFuZ2xlID0gdm9pZCAwOwogICAgICB0aGlzLmNvbmVFcXVhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy50d2lzdEVxdWF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIC8qKgogICAqIENvbnN0cmFpbnMgdHdvIGJvZGllcyB0byBiZSBhdCBhIGNvbnN0YW50IGRpc3RhbmNlIGZyb20gZWFjaCBvdGhlcnMgY2VudGVyIG9mIG1hc3MuCiAgICovCgoKICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlzdGFuY2VFcXVhdGlvbiA9IHZvaWQgMDsKCiAgICAgIGlmICh0eXBlb2YgZGlzdGFuY2UgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgZGlzdGFuY2UgPSBib2R5QS5wb3NpdGlvbi5kaXN0YW5jZVRvKGJvZHlCLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbiA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChlcSk7IC8vIE1ha2UgaXQgYmlkaXJlY3Rpb25hbAoKICAgICAgZXEubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIGVxLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZQogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IGVxID0gdGhpcy5kaXN0YW5jZUVxdWF0aW9uOwogICAgICBjb25zdCBoYWxmRGlzdCA9IHRoaXMuZGlzdGFuY2UgKiAwLjU7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGVxLm5pOwogICAgICBib2R5Qi5wb3NpdGlvbi52c3ViKGJvZHlBLnBvc2l0aW9uLCBub3JtYWwpOwogICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgIG5vcm1hbC5zY2FsZShoYWxmRGlzdCwgZXEucmkpOwogICAgICBub3JtYWwuc2NhbGUoLWhhbGZEaXN0LCBlcS5yaik7CiAgICB9CgogIH0KICAvKioKICAgKiBMb2NrIGNvbnN0cmFpbnQuIFdpbGwgcmVtb3ZlIGFsbCBkZWdyZWVzIG9mIGZyZWVkb20gYmV0d2VlbiB0aGUgYm9kaWVzLgogICAqLwoKCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IHZvaWQgMDsKICAgICAgdGhpcy54QiA9IHZvaWQgMDsKICAgICAgdGhpcy55QSA9IHZvaWQgMDsKICAgICAgdGhpcy55QiA9IHZvaWQgMDsKICAgICAgdGhpcy56QSA9IHZvaWQgMDsKICAgICAgdGhpcy56QiA9IHZvaWQgMDsKICAgICAgdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbEVxdWF0aW9uMyA9IHZvaWQgMDsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnhBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9YKTsKICAgICAgdGhpcy54QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueUEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1kpOwogICAgICB0aGlzLnlCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy56QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWik7CiAgICAgIHRoaXMuekIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOyAvLyAuLi5hbmQgdGhlIGZvbGxvd2luZyByb3RhdGlvbmFsIGVxdWF0aW9ucyB3aWxsIGtlZXAgYWxsIHJvdGF0aW9uYWwgRE9GJ3MgaW4gcGxhY2UKCiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjMgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2gocjEsIHIyLCByMyk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZQogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCByMyA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMzsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIFRoZXNlIHZlY3RvciBwYWlycyBtdXN0IGJlIG9ydGhvZ29uYWwKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnhBLCByMS5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnlCLCByMS5heGlzQik7CiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnlBLCByMi5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnpCLCByMi5heGlzQik7CiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnpBLCByMy5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnhCLCByMy5heGlzQik7CiAgICB9CgogIH0KICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwoKCiAgY2xhc3MgUm90YXRpb25hbE1vdG9yRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNb3RvciB2ZWxvY2l0eS4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBtYXhGb3JjZSkgewogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNCID0gdm9pZCAwOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5heGlzQiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudGFyZ2V0VmVsb2NpdHkgPSAwOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOyAvLyBnID0gMAogICAgICAvLyBnZG90ID0gYXhpc0EgKiB3aSAtIGF4aXNCICogd2oKICAgICAgLy8gZ2RvdCA9IEcgKiBXID0gRyAqIFt2aSB3aSB2aiB3al0KICAgICAgLy8gPT4KICAgICAgLy8gRyA9IFswIGF4aXNBIDAgLWF4aXNCXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KGF4aXNBKTsKICAgICAgYXhpc0IubmVnYXRlKEdCLnJvdGF0aW9uYWwpOwogICAgICBjb25zdCBHVyA9IHRoaXMuY29tcHV0ZUdXKCkgLSB0aGlzLnRhcmdldFZlbG9jaXR5OwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIC8qKgogICAqIEhpbmdlIGNvbnN0cmFpbnQuIFRoaW5rIG9mIGl0IGFzIGEgZG9vciBoaW5nZS4gSXQgdHJpZXMgdG8ga2VlcCB0aGUgZG9vciBpbiB0aGUgY29ycmVjdCBwbGFjZSBhbmQgd2l0aCB0aGUgY29ycmVjdCBvcmllbnRhdGlvbi4KICAgKi8KCgogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNCID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IHZvaWQgMDsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uID0gdm9pZCAwOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KCiAgY29uc3QgSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzIgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KCiAgY2xhc3MgRnJpY3Rpb25FcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8vIFRhbmdlbnQKCiAgICAvKioKICAgICAqIEBwYXJhbSBzbGlwRm9yY2Ugc2hvdWxkIGJlICstRl9mcmljdGlvbiA9ICstbXUgKiBGX25vcm1hbCA9ICstbXUgKiBtICogZwogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIHNsaXBGb3JjZSkgewogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1zbGlwRm9yY2UsIHNsaXBGb3JjZSk7CiAgICAgIHRoaXMucmkgPSB2b2lkIDA7CiAgICAgIHRoaXMucmogPSB2b2lkIDA7CiAgICAgIHRoaXMudCA9IHZvaWQgMDsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQoKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KCiAgY2xhc3MgQ29udGFjdE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogSWRlbnRpZmllciBvZiB0aGlzIG1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBQYXJ0aWNpcGF0aW5nIG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBwcm9kdWNlZCBjb250YWN0IGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucwogICAgICogQGRlZmF1bHQgMwogICAgICovCiAgICBjb25zdHJ1Y3RvcihtMSwgbTIsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IHZvaWQgMDsKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjMsCiAgICAgICAgY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbjogMywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb246IDMKICAgICAgfSk7CiAgICAgIHRoaXMuaWQgPSBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW20xLCBtMl07CiAgICAgIHRoaXMuZnJpY3Rpb24gPSBvcHRpb25zLmZyaWN0aW9uOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gb3B0aW9ucy5yZXN0aXR1dGlvbjsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uID0gb3B0aW9ucy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uOwogICAgfQoKICB9CgogIENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIERlZmluZXMgYSBwaHlzaWNzIG1hdGVyaWFsLgogICAqLwoKICBjbGFzcyBNYXRlcmlhbCB7CiAgICAvKioKICAgICAqIE1hdGVyaWFsIG5hbWUuCiAgICAgKiBJZiBvcHRpb25zIGlzIGEgc3RyaW5nLCBuYW1lIHdpbGwgYmUgc2V0IHRvIHRoYXQgc3RyaW5nLgogICAgICogQHRvZG8gRGVwcmVjYXRlIHRoaXMKICAgICAqLwoKICAgIC8qKiBNYXRlcmlhbCBpZC4gKi8KCiAgICAvKioKICAgICAqIEZyaWN0aW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgICogSWYgbm9uLW5lZ2F0aXZlLCBpdCB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiB0aGUgZnJpY3Rpb24gZ2l2ZW4gYnkgQ29udGFjdE1hdGVyaWFscy4gSWYgdGhlcmUncyBubyBtYXRjaGluZyBDb250YWN0TWF0ZXJpYWwsIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0Q29udGFjdE1hdGVyaWFsYCBpbiB0aGUgV29ybGQgd2lsbCBiZSB1c2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIHJlc3RpdHV0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLm5hbWUgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB2b2lkIDA7CiAgICAgIGxldCBuYW1lID0gJyc7IC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZpeAoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykgewogICAgICAgIC8vY29uc29sZS53YXJuKGBQYXNzaW5nIGEgc3RyaW5nIHRvIE1hdGVyaWFsT3B0aW9ucyBpcyBkZXByZWNhdGVkLCBhbmQgaGFzIG5vIGVmZmVjdGApCiAgICAgICAgbmFtZSA9IG9wdGlvbnM7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmlkID0gTWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB0eXBlb2Ygb3B0aW9ucy5mcmljdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZyaWN0aW9uIDogLTE7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB0eXBlb2Ygb3B0aW9ucy5yZXN0aXR1dGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnJlc3RpdHV0aW9uIDogLTE7CiAgICB9CgogIH0KCiAgTWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKICAvKioKICAgKiBBIHNwcmluZywgY29ubmVjdGluZyB0d28gYm9kaWVzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoYm94Qm9keSwgc3BoZXJlQm9keSwgewogICAqICAgICAgIHJlc3RMZW5ndGg6IDAsCiAgICogICAgICAgc3RpZmZuZXNzOiA1MCwKICAgKiAgICAgICBkYW1waW5nOiAxLAogICAqICAgICB9KQogICAqCiAgICogICAgIC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAogICAqICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIChldmVudCkgPT4gewogICAqICAgICAgIHNwcmluZy5hcHBseUZvcmNlKCkKICAgKiAgICAgfSkKICAgKi8KCiAgY2xhc3MgU3ByaW5nIHsKICAgIC8qKgogICAgICogUmVzdCBsZW5ndGggb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPiAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPj0gMC4KICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBEYW1waW5nIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEZpcnN0IGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBTZWNvbmQgY29ubmVjdGVkIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuY2hvciBmb3IgYm9keUEgaW4gbG9jYWwgYm9keUEgY29vcmRpbmF0ZXMuCiAgICAgKiBXaGVyZSB0byBob29rIHRoZSBzcHJpbmcgdG8gYm9keSBBLCBpbiBsb2NhbCBib2R5IGNvb3JkaW5hdGVzLgogICAgICogQGRlZmF1bHQgbmV3IFZlYzMoKQogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlCIGluIGxvY2FsIGJvZHlCIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQiwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucmVzdExlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdGlmZm5lc3MgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGFtcGluZyA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5QSA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5QiA9IHZvaWQgMDsKICAgICAgdGhpcy5sb2NhbEFuY2hvckEgPSB2b2lkIDA7CiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gdm9pZCAwOwogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQoKICBjb25zdCBhcHBseUZvcmNlX3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfcl91bml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3UgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yal94X2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdG1wID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KCiAgY2xhc3MgV2hlZWxJbmZvIHsKICAgIC8qKgogICAgICogTWF4IHRyYXZlbCBkaXN0YW5jZSBvZiB0aGUgc3VzcGVuc2lvbiwgaW4gbWV0ZXJzLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBTcGVlZCB0byBhcHBseSB0byB0aGUgd2hlZWwgcm90YXRpb24gd2hlbiB0aGUgd2hlZWwgaXMgc2xpZGluZy4KICAgICAqIEBkZWZhdWx0IC0wLjEKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIGN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlkaW5nCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gcG9pbnQsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgY2hhc3NpcyBib2R5IGZyYW1lLgogICAgICovCgogICAgLyoqCiAgICAgKiBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZUxvY2FsCiAgICAgKi8KCiAgICAvKioKICAgICAqIGF4bGVXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uUmVzdExlbmd0aAogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTWF4TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAyCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJhZGl1cwogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uU3RpZmZuZXNzCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGFtcGluZ0NvbXByZXNzaW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nUmVsYXhhdGlvbgogICAgICogQGRlZmF1bHQgMTAKICAgICAqLwoKICAgIC8qKgogICAgICogZnJpY3Rpb25TbGlwCiAgICAgKiBAZGVmYXVsdCAxMC41CiAgICAgKi8KCiAgICAvKiogZm9yd2FyZEFjY2VsZXJhdGlvbiAqLwoKICAgIC8qKiBzaWRlQWNjZWxlcmF0aW9uICovCgogICAgLyoqCiAgICAgKiBzdGVlcmluZwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiB2YWx1ZSwgaW4gcmFkaWFucy4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGVsdGFSb3RhdGlvbgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiByb2xsSW5mbHVlbmNlCiAgICAgKiBAZGVmYXVsdCAwLjAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heFN1c3BlbnNpb25Gb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBlbmdpbmVGb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBicmFrZQogICAgICovCgogICAgLyoqCiAgICAgKiBpc0Zyb250V2hlZWwKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5CiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25Gb3JjZQogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlwSW5mbwogICAgICovCgogICAgLyoqCiAgICAgKiBza2lkSW5mbwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNpZGVJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGZvcndhcmRJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSByZXN1bHQgZnJvbSByYXljYXN0aW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVlbCB3b3JsZCB0cmFuc2Zvcm0uCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzSW5Db250YWN0CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uVHJhdmVsID0gdm9pZCAwOwogICAgICB0aGlzLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgPSB2b2lkIDA7CiAgICAgIHRoaXMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGlkaW5nID0gdm9pZCAwOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gdm9pZCAwOwogICAgICB0aGlzLmF4bGVXb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gdm9pZCAwOwogICAgICB0aGlzLnJhZGl1cyA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uU3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmRhbXBpbmdDb21wcmVzc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5kYW1waW5nUmVsYXhhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvblNsaXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuZm9yd2FyZEFjY2VsZXJhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5zaWRlQWNjZWxlcmF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnN0ZWVyaW5nID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucm9sbEluZmx1ZW5jZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuYnJha2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXNGcm9udFdoZWVsID0gdm9pZCAwOwogICAgICB0aGlzLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xpcEluZm8gPSB2b2lkIDA7CiAgICAgIHRoaXMuc2tpZEluZm8gPSB2b2lkIDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zaWRlSW1wdWxzZSA9IHZvaWQgMDsKICAgICAgdGhpcy5mb3J3YXJkSW1wdWxzZSA9IHZvaWQgMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkVHJhbnNmb3JtID0gdm9pZCAwOwogICAgICB0aGlzLmlzSW5Db250YWN0ID0gdm9pZCAwOwogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQoKICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVscG9zID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCgogIGNsYXNzIFJheWNhc3RWZWhpY2xlIHsKICAgIC8qKiBUaGUgY2FyIGNoYXNzaXMgYm9keS4gKi8KCiAgICAvKiogVGhlIHdoZWVscy4gKi8KCiAgICAvKiogV2lsbCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGUgY2FyIGlzIHNsaWRpbmcuICovCgogICAgLyoqIEluZGV4IG9mIHRoZSByaWdodCBheGlzLiB4PTAsIHk9MSwgej0yICovCgogICAgLyoqIEluZGV4IG9mIHRoZSBmb3J3YXJkIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHVwIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogVGhlIGNvbnN0cmFpbnRzLiAqLwoKICAgIC8qKiBPcHRpb25hbCBwcmUtc3RlcCBjYWxsYmFjay4gKi8KCiAgICAvKiogTnVtYmVyIG9mIHdoZWVscyBvbiB0aGUgZ3JvdW5kLiAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gdm9pZCAwOwogICAgICB0aGlzLndoZWVsSW5mb3MgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xpZGluZyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHZvaWQgMDsKICAgICAgdGhpcy5pbmRleEZvcndhcmRBeGlzID0gdm9pZCAwOwogICAgICB0aGlzLmluZGV4VXBBeGlzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gdm9pZCAwOwogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9IHZvaWQgMDsKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gdm9pZCAwOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gdm9pZCAwOwogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gb3B0aW9ucy5jaGFzc2lzQm9keTsKICAgICAgdGhpcy53aGVlbEluZm9zID0gW107CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4UmlnaHRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgOiAyOwogICAgICB0aGlzLmluZGV4Rm9yd2FyZEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhGb3J3YXJkQXhpcyA6IDA7CiAgICAgIHRoaXMuaW5kZXhVcEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleFVwQXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4VXBBeGlzIDogMTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7fTsKCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDA7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3aGVlbC4gRm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcHRpb25zLCBzZWUgYFdoZWVsSW5mb2AuCiAgICAgKi8KCgogICAgYWRkV2hlZWwob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBpbmZvID0gbmV3IFdoZWVsSW5mbyhvcHRpb25zKTsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLndoZWVsSW5mb3MubGVuZ3RoOwogICAgICB0aGlzLndoZWVsSW5mb3MucHVzaChpbmZvKTsKICAgICAgcmV0dXJuIGluZGV4OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHN0ZWVyaW5nIHZhbHVlIG9mIGEgd2hlZWwuCiAgICAgKi8KCgogICAgc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgd2hlZWwuc3RlZXJpbmcgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSB3aGVlbCBmb3JjZSB0byBhcHBseSBvbiBvbmUgb2YgdGhlIHdoZWVscyBlYWNoIHRpbWUgc3RlcAogICAgICovCgoKICAgIGFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmVuZ2luZUZvcmNlID0gdmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYnJha2luZyBmb3JjZSBvZiBhIHdoZWVsCiAgICAgKi8KCgogICAgc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmJyYWtlID0gYnJha2U7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCB0aGUgdmVoaWNsZSBpbmNsdWRpbmcgaXRzIGNvbnN0cmFpbnRzIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICBhZGRUb1dvcmxkKHdvcmxkKSB7CiAgICAgIHdvcmxkLmFkZEJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7CiAgICAgICAgdGhhdC51cGRhdGVWZWhpY2xlKHdvcmxkLmR0KTsKICAgICAgfTsKCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG9uZSBvZiB0aGUgd2hlZWwgYXhsZXMsIHdvcmxkLW9yaWVudGVkLgogICAgICovCgoKICAgIGdldFZlaGljbGVBeGlzV29ybGQoYXhpc0luZGV4LCByZXN1bHQpIHsKICAgICAgcmVzdWx0LnNldChheGlzSW5kZXggPT09IDAgPyAxIDogMCwgYXhpc0luZGV4ID09PSAxID8gMSA6IDAsIGF4aXNJbmRleCA9PT0gMiA/IDEgOiAwKTsKICAgICAgdGhpcy5jaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVzdWx0LCByZXN1bHQpOwogICAgfQoKICAgIHVwZGF0ZVZlaGljbGUodGltZVN0ZXApIHsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtKGkpOwogICAgICB9CgogICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgPSAzLjYgKiBjaGFzc2lzQm9keS52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZm9yd2FyZFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRWZWhpY2xlQXhpc1dvcmxkKHRoaXMuaW5kZXhGb3J3YXJkQXhpcywgZm9yd2FyZFdvcmxkKTsKCiAgICAgIGlmIChmb3J3YXJkV29ybGQuZG90KGNoYXNzaXNCb2R5LnZlbG9jaXR5KSA8IDApIHsKICAgICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgKj0gLTE7CiAgICAgIH0gLy8gc2ltdWxhdGUgc3VzcGVuc2lvbgoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLmNhc3RSYXkod2hlZWxJbmZvc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlU3VzcGVuc2lvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGltcHVsc2UgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIC8vYXBwbHkgc3VzcGVuc2lvbiBmb3JjZQogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBsZXQgc3VzcGVuc2lvbkZvcmNlID0gd2hlZWwuc3VzcGVuc2lvbkZvcmNlOwoKICAgICAgICBpZiAoc3VzcGVuc2lvbkZvcmNlID4gd2hlZWwubWF4U3VzcGVuc2lvbkZvcmNlKSB7CiAgICAgICAgICBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwLCBpbXB1bHNlKTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVscG9zKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVGcmljdGlvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2ogPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBmd2QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB2ZWwgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsgLy9jb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwogICAgICAgIC8vd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbHBvcyk7CgogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgdmVsKTsgLy8gSGFjayB0byBnZXQgdGhlIHJvdGF0aW9uIGluIHRoZSBjb3JyZWN0IGRpcmVjdGlvbgoKICAgICAgICBsZXQgbSA9IDE7CgogICAgICAgIHN3aXRjaCAodGhpcy5pbmRleFVwQXhpcykgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBtID0gLTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvaiA9IGZ3ZC5kb3Qod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHByb2osIGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2opOwogICAgICAgICAgZndkLnZzdWIoaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiwgZndkKTsKICAgICAgICAgIGNvbnN0IHByb2oyID0gZndkLmRvdCh2ZWwpOwogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IG0gKiBwcm9qMiAqIHRpbWVTdGVwIC8gd2hlZWwucmFkaXVzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCh3aGVlbC5zbGlkaW5nIHx8ICF3aGVlbC5pc0luQ29udGFjdCkgJiYgd2hlZWwuZW5naW5lRm9yY2UgIT09IDAgJiYgd2hlZWwudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCkgewogICAgICAgICAgLy8gQXBwbHkgY3VzdG9tIHJvdGF0aW9uIHdoZW4gYWNjZWxlcmF0aW5nIGFuZCBzbGlkaW5nCiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gKHdoZWVsLmVuZ2luZUZvcmNlID4gMCA/IDEgOiAtMSkgKiB3aGVlbC5jdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkICogdGltZVN0ZXA7CiAgICAgICAgfSAvLyBMb2NrIHdoZWVscwoKCiAgICAgICAgaWYgKE1hdGguYWJzKHdoZWVsLmJyYWtlKSA+IE1hdGguYWJzKHdoZWVsLmVuZ2luZUZvcmNlKSkgewogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IDA7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yb3RhdGlvbiArPSB3aGVlbC5kZWx0YVJvdGF0aW9uOyAvLyBVc2UgdGhlIG9sZCB2YWx1ZQoKICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uICo9IDAuOTk7IC8vIGRhbXBpbmcgb2Ygcm90YXRpb24gd2hlbiBub3QgaW4gY29udGFjdAogICAgICB9CiAgICB9CgogICAgdXBkYXRlU3VzcGVuc2lvbihkZWx0YVRpbWUpIHsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBjaGFzc2lzTWFzcyA9IGNoYXNzaXNCb2R5Lm1hc3M7CiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgd19pdCA9IDA7IHdfaXQgPCBudW1XaGVlbHM7IHdfaXQrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1t3X2l0XTsKCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICBsZXQgZm9yY2U7IC8vIFNwcmluZwoKICAgICAgICAgIGNvbnN0IHN1c3BfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgICAgICBjb25zdCBjdXJyZW50X2xlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICBjb25zdCBsZW5ndGhfZGlmZiA9IHN1c3BfbGVuZ3RoIC0gY3VycmVudF9sZW5ndGg7CiAgICAgICAgICBmb3JjZSA9IHdoZWVsLnN1c3BlbnNpb25TdGlmZm5lc3MgKiBsZW5ndGhfZGlmZiAqIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbjsgLy8gRGFtcGVyCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkX3JlbF92ZWwgPSB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eTsKICAgICAgICAgIGxldCBzdXNwX2RhbXBpbmc7CgogICAgICAgICAgaWYgKHByb2plY3RlZF9yZWxfdmVsIDwgMCkgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3JjZSAtPSBzdXNwX2RhbXBpbmcgKiBwcm9qZWN0ZWRfcmVsX3ZlbDsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA9IGZvcmNlICogY2hhc3Npc01hc3M7CgogICAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA8IDApIHsKICAgICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlRnJvbVdvcmxkKHdvcmxkKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHM7CiAgICAgIHdvcmxkLnJlbW92ZUJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgfQoKICAgIGNhc3RSYXkod2hlZWwpIHsKICAgICAgY29uc3QgcmF5dmVjdG9yID0gY2FzdFJheV9yYXl2ZWN0b3I7CiAgICAgIGNvbnN0IHRhcmdldCA9IGNhc3RSYXlfdGFyZ2V0OwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGxldCBkZXB0aCA9IC0xOwogICAgICBjb25zdCByYXlsZW4gPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLnJhZGl1czsKICAgICAgd2hlZWwuZGlyZWN0aW9uV29ybGQuc2NhbGUocmF5bGVuLCByYXl2ZWN0b3IpOwogICAgICBjb25zdCBzb3VyY2UgPSB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ7CiAgICAgIHNvdXJjZS52YWRkKHJheXZlY3RvciwgdGFyZ2V0KTsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQ7CiAgICAgIHJheWNhc3RSZXN1bHQucmVzZXQoKTsgLy8gVHVybiBvZmYgcmF5IGNvbGxpc2lvbiB3aXRoIHRoZSBjaGFzc2lzIHRlbXBvcmFyaWx5CgogICAgICBjb25zdCBvbGRTdGF0ZSA9IGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGZhbHNlOyAvLyBDYXN0IHJheSBhZ2FpbnN0IHdvcmxkCgogICAgICB0aGlzLndvcmxkLnJheVRlc3Qoc291cmNlLCB0YXJnZXQsIHJheWNhc3RSZXN1bHQpOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IG9sZFN0YXRlOwogICAgICBjb25zdCBvYmplY3QgPSByYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuZ3JvdW5kT2JqZWN0ID0gMDsKCiAgICAgIGlmIChvYmplY3QpIHsKICAgICAgICBkZXB0aCA9IHJheWNhc3RSZXN1bHQuZGlzdGFuY2U7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgd2hlZWwuaXNJbkNvbnRhY3QgPSB0cnVlOwogICAgICAgIGNvbnN0IGhpdERpc3RhbmNlID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gaGl0RGlzdGFuY2UgLSB3aGVlbC5yYWRpdXM7IC8vIGNsYW1wIG9uIG1heCBzdXNwZW5zaW9uIHRyYXZlbAoKICAgICAgICBjb25zdCBtaW5TdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggLSB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIGNvbnN0IG1heFN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoIDwgbWluU3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1pblN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA+IG1heFN1c3BlbnNpb25MZW5ndGgpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBtYXhTdXNwZW5zaW9uTGVuZ3RoOwogICAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5yZXNldCgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVub21pbmF0b3IgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdCh3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgICAgY29uc3QgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQgPSBuZXcgVmVjMygpOwogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwogICAgICAgIGNvbnN0IHByb2pWZWwgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CgogICAgICAgIGlmIChkZW5vbWluYXRvciA+PSAtMC4xKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIGRlbm9taW5hdG9yOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL3B1dCB3aGVlbCBpbmZvIGFzIGluIHJlc3QgcG9zaXRpb24KICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggKyAwICogd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CgogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CgogICAgdXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCkgewogICAgICB3aGVlbC5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNoYXNzaXNCb2R5LnBvaW50VG9Xb3JsZEZyYW1lKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwgd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmRpcmVjdGlvbkxvY2FsLCB3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZSh3aGVlbC5heGxlTG9jYWwsIHdoZWVsLmF4bGVXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBvbmUgb2YgdGhlIHdoZWVsIHRyYW5zZm9ybS4KICAgICAqIE5vdGUgd2hlbiByZW5kZXJpbmcgd2hlZWxzOiBkdXJpbmcgZWFjaCBzdGVwLCB3aGVlbCB0cmFuc2Zvcm1zIGFyZSB1cGRhdGVkIEJFRk9SRSB0aGUgY2hhc3NpczsgaWUuIHRoZWlyIHBvc2l0aW9uIGJlY29tZXMgaW52YWxpZCBhZnRlciB0aGUgc3RlcC4gVGh1cyB3aGVuIHlvdSByZW5kZXIgd2hlZWxzLCB5b3UgbXVzdCB1cGRhdGUgd2hlZWwgdHJhbnNmb3JtcyBiZWZvcmUgcmVuZGVyaW5nIHRoZW0uIFNlZSByYXljYXN0VmVoaWNsZSBkZW1vIGZvciBhbiBleGFtcGxlLgogICAgICogQHBhcmFtIHdoZWVsSW5kZXggVGhlIHdoZWVsIGluZGV4IHRvIHVwZGF0ZS4KICAgICAqLwoKCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybSh3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHVwID0gdG1wVmVjNDsKICAgICAgY29uc3QgcmlnaHQgPSB0bXBWZWM1OwogICAgICBjb25zdCBmd2QgPSB0bXBWZWM2OwogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgdGhpcy51cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKTsKICAgICAgd2hlZWwuZGlyZWN0aW9uTG9jYWwuc2NhbGUoLTEsIHVwKTsKICAgICAgcmlnaHQuY29weSh3aGVlbC5heGxlTG9jYWwpOwogICAgICB1cC5jcm9zcyhyaWdodCwgZndkKTsKICAgICAgZndkLm5vcm1hbGl6ZSgpOwogICAgICByaWdodC5ub3JtYWxpemUoKTsgLy8gUm90YXRlIGFyb3VuZCBzdGVlcmluZyBvdmVyIHRoZSB3aGVlbEF4bGUKCiAgICAgIGNvbnN0IHN0ZWVyaW5nID0gd2hlZWwuc3RlZXJpbmc7CiAgICAgIGNvbnN0IHN0ZWVyaW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgc3RlZXJpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZSh1cCwgc3RlZXJpbmcpOwogICAgICBjb25zdCByb3RhdGluZ09ybiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHJvdGF0aW5nT3JuLnNldEZyb21BeGlzQW5nbGUocmlnaHQsIHdoZWVsLnJvdGF0aW9uKTsgLy8gV29ybGQgcm90YXRpb24gb2YgdGhlIHdoZWVsCgogICAgICBjb25zdCBxID0gd2hlZWwud29ybGRUcmFuc2Zvcm0ucXVhdGVybmlvbjsKICAgICAgdGhpcy5jaGFzc2lzQm9keS5xdWF0ZXJuaW9uLm11bHQoc3RlZXJpbmdPcm4sIHEpOwogICAgICBxLm11bHQocm90YXRpbmdPcm4sIHEpOwogICAgICBxLm5vcm1hbGl6ZSgpOyAvLyB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHAgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5wb3NpdGlvbjsKICAgICAgcC5jb3B5KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgcC5zY2FsZSh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoLCBwKTsKICAgICAgcC52YWRkKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgcCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgdHJhbnNmb3JtIG9mIG9uZSBvZiB0aGUgd2hlZWxzCiAgICAgKi8KCgogICAgZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbEluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0ud29ybGRUcmFuc2Zvcm07CiAgICB9CgogICAgdXBkYXRlRnJpY3Rpb24odGltZVN0ZXApIHsKICAgICAgY29uc3Qgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qOyAvL2NhbGN1bGF0ZSB0aGUgaW1wdWxzZSwgc28gdGhhdCB0aGUgd2hlZWxzIGRvbid0IG1vdmUgc2lkZXdhcmRzCgogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBmb3J3YXJkV1MgPSB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1M7CiAgICAgIGNvbnN0IGF4bGUgPSB1cGRhdGVGcmljdGlvbl9heGxlOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kKys7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSAwOwoKICAgICAgICBpZiAoIWZvcndhcmRXU1tpXSkgewogICAgICAgICAgZm9yd2FyZFdTW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CgogICAgICAgIGlmICghYXhsZVtpXSkgewogICAgICAgICAgYXhsZVtpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgYXhsZWkgPSBheGxlW2ldOwogICAgICAgICAgY29uc3Qgd2hlZWxUcmFucyA9IHRoaXMuZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZChpKTsgLy8gR2V0IHdvcmxkIGF4bGUKCiAgICAgICAgICB3aGVlbFRyYW5zLnZlY3RvclRvV29ybGRGcmFtZShkaXJlY3Rpb25zW3RoaXMuaW5kZXhSaWdodEF4aXNdLCBheGxlaSk7CiAgICAgICAgICBjb25zdCBzdXJmTm9ybWFsV1MgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkOwogICAgICAgICAgY29uc3QgcHJvaiA9IGF4bGVpLmRvdChzdXJmTm9ybWFsV1MpOwogICAgICAgICAgc3VyZk5vcm1hbFdTLnNjYWxlKHByb2osIHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaik7CiAgICAgICAgICBheGxlaS52c3ViKHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaiwgYXhsZWkpOwogICAgICAgICAgYXhsZWkubm9ybWFsaXplKCk7CiAgICAgICAgICBzdXJmTm9ybWFsV1MuY3Jvc3MoYXhsZWksIGZvcndhcmRXU1tpXSk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0ubm9ybWFsaXplKCk7CiAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWwoY2hhc3Npc0JvZHksIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGF4bGVpKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHNpZGVGcmljdGlvblN0aWZmbmVzczI7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBzaWRlRmFjdG9yID0gMTsKICAgICAgY29uc3QgZndkRmFjdG9yID0gMC41OwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwogICAgICAgIGxldCByb2xsaW5nRnJpY3Rpb24gPSAwOwogICAgICAgIHdoZWVsLnNsaXBJbmZvID0gMTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgZGVmYXVsdFJvbGxpbmdGcmljdGlvbkltcHVsc2UgPSAwOwogICAgICAgICAgY29uc3QgbWF4SW1wdWxzZSA9IHdoZWVsLmJyYWtlID8gd2hlZWwuYnJha2UgOiBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZTsgLy8gYnRXaGVlbENvbnRhY3RQb2ludCBjb250YWN0UHQoY2hhc3Npc0JvZHksZ3JvdW5kT2JqZWN0LHdoZWVsSW5mcmF5Y2FzdEluZm8uaGl0UG9pbnRXb3JsZCxmb3J3YXJkV1Nbd2hlZWxdLG1heEltcHVsc2UpOwogICAgICAgICAgLy8gcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjb250YWN0UHQpOwoKICAgICAgICAgIHJvbGxpbmdGcmljdGlvbiA9IGNhbGNSb2xsaW5nRnJpY3Rpb24oY2hhc3Npc0JvZHksIGdyb3VuZE9iamVjdCwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBmb3J3YXJkV1NbaV0sIG1heEltcHVsc2UpOwogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uICs9IHdoZWVsLmVuZ2luZUZvcmNlICogdGltZVN0ZXA7IC8vIHJvbGxpbmdGcmljdGlvbiA9IDA7CgogICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4SW1wdWxzZSAvIHJvbGxpbmdGcmljdGlvbjsKICAgICAgICAgIHdoZWVsLnNsaXBJbmZvICo9IGZhY3RvcjsKICAgICAgICB9IC8vc3dpdGNoIGJldHdlZW4gYWN0aXZlIHJvbGxpbmcgKHRocm90dGxlKSwgYnJha2luZyBhbmQgbm9uLWFjdGl2ZSByb2xsaW5nIGZyaWN0aW9uIChudGhyb3R0bGUvYnJlYWspCgoKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuc2tpZEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CiAgICAgICAgICBjb25zdCBtYXhpbXAgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgKiB0aW1lU3RlcCAqIHdoZWVsLmZyaWN0aW9uU2xpcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNpZGUgPSBtYXhpbXA7CiAgICAgICAgICBjb25zdCBtYXhpbXBTcXVhcmVkID0gbWF4aW1wICogbWF4aW1wU2lkZTsKICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gcm9sbGluZ0ZyaWN0aW9uOyAvL3doZWVsSW5mby5lbmdpbmVGb3JjZSogdGltZVN0ZXA7CgogICAgICAgICAgY29uc3QgeCA9IHdoZWVsLmZvcndhcmRJbXB1bHNlICogZndkRmFjdG9yIC8gd2hlZWwuZm9yd2FyZEFjY2VsZXJhdGlvbjsKICAgICAgICAgIGNvbnN0IHkgPSB3aGVlbC5zaWRlSW1wdWxzZSAqIHNpZGVGYWN0b3IgLyB3aGVlbC5zaWRlQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgaW1wdWxzZVNxdWFyZWQgPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgd2hlZWwuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChpbXB1bHNlU3F1YXJlZCA+IG1heGltcFNxdWFyZWQpIHsKICAgICAgICAgICAgdGhpcy5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgd2hlZWwuc2xpZGluZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG1heGltcCAvIE1hdGguc3FydChpbXB1bHNlU3F1YXJlZCk7CiAgICAgICAgICAgIHdoZWVsLnNraWRJbmZvICo9IGZhY3RvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsaWRpbmcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CgogICAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICAgIGlmICh3aGVlbC5za2lkSW5mbyA8IDEpIHsKICAgICAgICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBhcHBseSB0aGUgaW1wdWxzZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IHJlbF9wb3MgPSBuZXcgVmVjMygpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxfcG9zKTsgLy8gY2Fubm9ucyBhcHBseWltcHVsc2UgaXMgdXNpbmcgd29ybGQgY29vcmQgZm9yIHRoZSBwb3NpdGlvbgogICAgICAgIC8vcmVsX3Bvcy5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgIGlmICh3aGVlbC5mb3J3YXJkSW1wdWxzZSAhPT0gMCkgewogICAgICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0uc2NhbGUod2hlZWwuZm9yd2FyZEltcHVsc2UsIGltcHVsc2UpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbF9wb3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgICBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1Yihncm91bmRPYmplY3QucG9zaXRpb24sIHJlbF9wb3MyKTsgLy9yZWxfcG9zMi5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgICAgY29uc3Qgc2lkZUltcCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBheGxlW2ldLnNjYWxlKHdoZWVsLnNpZGVJbXB1bHNlLCBzaWRlSW1wKTsgLy8gU2NhbGUgdGhlIHJlbGF0aXZlIHBvc2l0aW9uIGluIHRoZSB1cCBkaXJlY3Rpb24gd2l0aCByb2xsSW5mbHVlbmNlLgogICAgICAgICAgLy8gSWYgcm9sbEluZmx1ZW5jZSBpcyAxLCB0aGUgaW1wdWxzZSB3aWxsIGJlIGFwcGxpZWQgb24gdGhlIGhpdFBvaW50IChlYXN5IHRvIHJvbGwgb3ZlciksIGlmIGl0IGlzIHplcm8gaXQgd2lsbCBiZSBhcHBsaWVkIGluIHRoZSBzYW1lIHBsYW5lIGFzIHRoZSBjZW50ZXIgb2YgbWFzcyAobm90IGVhc3kgdG8gcm9sbCBvdmVyKS4KCiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb0xvY2FsRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICByZWxfcG9zWyd4eXonW3RoaXMuaW5kZXhVcEF4aXNdXSAqPSB3aGVlbC5yb2xsSW5mbHVlbmNlOwogICAgICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHJlbF9wb3MsIHJlbF9wb3MpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MpOyAvL2FwcGx5IGZyaWN0aW9uIGltcHVsc2Ugb24gdGhlIGdyb3VuZAoKICAgICAgICAgIHNpZGVJbXAuc2NhbGUoLTEsIHNpZGVJbXApOwogICAgICAgICAgZ3JvdW5kT2JqZWN0LmFwcGx5SW1wdWxzZShzaWRlSW1wLCByZWxfcG9zMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KCiAgY29uc3QgdG1wVmVjNCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjNSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjNiA9IG5ldyBWZWMzKCk7CiAgbmV3IFJheSgpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQogIC8qKgogICAqIFNwaGVyaWNhbCBzaGFwZQogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHJhZGl1cyA9IDEKICAgKiAgICAgY29uc3Qgc3BoZXJlU2hhcGUgPSBuZXcgQ0FOTk9OLlNwaGVyZShyYWRpdXMpCiAgICogICAgIGNvbnN0IHNwaGVyZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogc3BoZXJlU2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShzcGhlcmVCb2R5KQogICAqLwoKCiAgY2xhc3MgU3BoZXJlIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqCiAgICAgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZSwgYSBub24tbmVnYXRpdmUgbnVtYmVyLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihyYWRpdXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlNQSEVSRQogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMucmFkaXVzID0gcmFkaXVzICE9PSB1bmRlZmluZWQgPyByYWRpdXMgOiAxLjA7CgogICAgICBpZiAodGhpcy5yYWRpdXMgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgc3BoZXJlIHJhZGl1cyBjYW5ub3QgYmUgbmVnYXRpdmUuJyk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKiBjYWxjdWxhdGVMb2NhbEluZXJ0aWEgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBJID0gMi4wICogbWFzcyAqIHRoaXMucmFkaXVzICogdGhpcy5yYWRpdXMgLyA1LjA7CiAgICAgIHRhcmdldC54ID0gSTsKICAgICAgdGFyZ2V0LnkgPSBJOwogICAgICB0YXJnZXQueiA9IEk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKiogdm9sdW1lICovCgoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDQuMCAqIE1hdGguUEkgKiBNYXRoLnBvdyh0aGlzLnJhZGl1cywgMykgLyAzLjA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLnJhZGl1czsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCByID0gdGhpcy5yYWRpdXM7CiAgICAgIGNvbnN0IGF4ZXMgPSBbJ3gnLCAneScsICd6J107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBheCA9IGF4ZXNbaV07CiAgICAgICAgbWluW2F4XSA9IHBvc1theF0gLSByOwogICAgICAgIG1heFtheF0gPSBwb3NbYXhdICsgcjsKICAgICAgfQogICAgfQoKICB9CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzIGZvciBjYWxjdWxhdGlvbgoKICBuZXcgVmVjMygpOyAvLyBSZWxhdGl2ZSB2ZWxvY2l0eQoKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXNUb3AgPSB2b2lkIDA7CiAgICAgIHRoaXMucmFkaXVzQm90dG9tID0gdm9pZCAwOwogICAgICB0aGlzLmhlaWdodCA9IHZvaWQgMDsKICAgICAgdGhpcy5udW1TZWdtZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQogIC8qKgogICAqIFBhcnRpY2xlIHNoYXBlLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHBhcnRpY2xlU2hhcGUgPSBuZXcgQ0FOTk9OLlBhcnRpY2xlKCkKICAgKiAgICAgY29uc3QgcGFydGljbGVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHBhcnRpY2xlU2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShwYXJ0aWNsZUJvZHkpCiAgICovCgoKICBjbGFzcyBQYXJ0aWNsZSBleHRlbmRzIFNoYXBlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUEFSVElDTEUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gMDsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICBtaW4uY29weShwb3MpOwogICAgICBtYXguY29weShwb3MpOwogICAgfQoKICB9CiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCgoKICBjbGFzcyBQbGFuZSBleHRlbmRzIFNoYXBlIHsKICAgIC8qKiB3b3JsZE5vcm1hbCAqLwoKICAgIC8qKiB3b3JsZE5vcm1hbE5lZWRzVXBkYXRlICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlBMQU5FCiAgICAgIH0pOyAvLyBXb3JsZCBvcmllbnRlZCBub3JtYWwKCiAgICAgIHRoaXMud29ybGROb3JtYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgfQogICAgLyoqIGNvbXB1dGVXb3JsZE5vcm1hbCAqLwoKCiAgICBjb21wdXRlV29ybGROb3JtYWwocXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy53b3JsZE5vcm1hbDsKICAgICAgbi5zZXQoMCwgMCwgMSk7CiAgICAgIHF1YXQudm11bHQobiwgbik7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHBsYW5lIGlzIGluZmluaXRlLi4uCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIFRoZSBwbGFuZSBBQUJCIGlzIGluZmluaXRlLCBleGNlcHQgaWYgdGhlIG5vcm1hbCBpcyBwb2ludGluZyBhbG9uZyBhbnkgYXhpcwogICAgICB0ZW1wTm9ybWFsLnNldCgwLCAwLCAxKTsgLy8gRGVmYXVsdCBwbGFuZSBub3JtYWwgaXMgegoKICAgICAgcXVhdC52bXVsdCh0ZW1wTm9ybWFsLCB0ZW1wTm9ybWFsKTsKICAgICAgY29uc3QgbWF4VmFsID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgbWluLnNldCgtbWF4VmFsLCAtbWF4VmFsLCAtbWF4VmFsKTsKICAgICAgbWF4LnNldChtYXhWYWwsIG1heFZhbCwgbWF4VmFsKTsKCiAgICAgIGlmICh0ZW1wTm9ybWFsLnggPT09IDEpIHsKICAgICAgICBtYXgueCA9IHBvcy54OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueCA9PT0gLTEpIHsKICAgICAgICBtaW4ueCA9IHBvcy54OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC55ID09PSAxKSB7CiAgICAgICAgbWF4LnkgPSBwb3MueTsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnkgPT09IC0xKSB7CiAgICAgICAgbWluLnkgPSBwb3MueTsKICAgICAgfQoKICAgICAgaWYgKHRlbXBOb3JtYWwueiA9PT0gMSkgewogICAgICAgIG1heC56ID0gcG9zLno7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC56ID09PSAtMSkgewogICAgICAgIG1pbi56ID0gcG9zLno7CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CgogIH0KCiAgY29uc3QgdGVtcE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogSGVpZ2h0ZmllbGQgc2hhcGUgY2xhc3MuIEhlaWdodCBkYXRhIGlzIGdpdmVuIGFzIGFuIGFycmF5LiBUaGVzZSBkYXRhIHBvaW50cyBhcmUgc3ByZWFkIG91dCBldmVubHkgd2l0aCBhIGdpdmVuIGRpc3RhbmNlLgogICAqIEB0b2RvIFNob3VsZCBiZSBwb3NzaWJsZSB0byB1c2UgYWxvbmcgYWxsIGF4ZXMsIG5vdCBqdXN0IHkKICAgKiBAdG9kbyBzaG91bGQgYmUgcG9zc2libGUgdG8gc2NhbGUgYWxvbmcgYWxsIGF4ZXMKICAgKiBAdG9kbyBSZWZhY3RvciBlbGVtZW50U2l6ZSB0byBlbGVtZW50U2l6ZVggYW5kIGVsZW1lbnRTaXplWQogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgLy8gR2VuZXJhdGUgc29tZSBoZWlnaHQgZGF0YSAoeS12YWx1ZXMpLgogICAqICAgICBjb25zdCBkYXRhID0gW10KICAgKiAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgKiAgICAgICAgIGNvbnN0IHkgPSAwLjUgKiBNYXRoLmNvcygwLjIgKiBpKQogICAqICAgICAgICAgZGF0YS5wdXNoKHkpCiAgICogICAgIH0KICAgKgogICAqICAgICAvLyBDcmVhdGUgdGhlIGhlaWdodGZpZWxkIHNoYXBlCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkU2hhcGUgPSBuZXcgQ0FOTk9OLkhlaWdodGZpZWxkKGRhdGEsIHsKICAgKiAgICAgICAgIGVsZW1lbnRTaXplOiAxIC8vIERpc3RhbmNlIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9ucwogICAqICAgICB9KQogICAqICAgICBjb25zdCBoZWlnaHRmaWVsZEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBzaGFwZTogaGVpZ2h0ZmllbGRTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGhlaWdodGZpZWxkQm9keSkKICAgKi8KCiAgY2xhc3MgSGVpZ2h0ZmllbGQgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIG51bWJlcnMsIG9yIGhlaWdodCB2YWx1ZXMsIHRoYXQgYXJlIHNwcmVhZCBvdXQgYWxvbmcgdGhlIHggYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTWF4IHZhbHVlIG9mIHRoZSBkYXRhIHBvaW50cyBpbiB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKICAgIC8qKgogICAgICogTWluaW11bSB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIHNwYWNpbmcgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb24uCiAgICAgKiBAdG9kbyBlbGVtZW50U2l6ZVggYW5kIFkKICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZGF0YSBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGRhdGEsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBtYXhWYWx1ZTogbnVsbCwKICAgICAgICBtaW5WYWx1ZTogbnVsbCwKICAgICAgICBlbGVtZW50U2l6ZTogMQogICAgICB9KTsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxECiAgICAgIH0pOwogICAgICB0aGlzLmRhdGEgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF4VmFsdWUgPSB2b2lkIDA7CiAgICAgIHRoaXMubWluVmFsdWUgPSB2b2lkIDA7CiAgICAgIHRoaXMuZWxlbWVudFNpemUgPSB2b2lkIDA7CiAgICAgIHRoaXMuY2FjaGVFbmFibGVkID0gdm9pZCAwOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHZvaWQgMDsKICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSB2b2lkIDA7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgIHRoaXMubWF4VmFsdWUgPSBvcHRpb25zLm1heFZhbHVlOwogICAgICB0aGlzLm1pblZhbHVlID0gb3B0aW9ucy5taW5WYWx1ZTsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IG9wdGlvbnMuZWxlbWVudFNpemU7CgogICAgICBpZiAob3B0aW9ucy5taW5WYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWluVmFsdWUoKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMubWF4VmFsdWUgPT09IG51bGwpIHsKICAgICAgICB0aGlzLnVwZGF0ZU1heFZhbHVlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FjaGVFbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsgLy8gImlfal9pc1VwcGVyIiA9PiB7IGNvbnZleDogLi4uLCBvZmZzZXQ6IC4uLiB9CiAgICAgIC8vIGZvciBleGFtcGxlOgogICAgICAvLyBfY2FjaGVkUGlsbGFyc1siMF8yXzEiXQoKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFycyA9IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1pblZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1pblZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWluVmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPCBtaW5WYWx1ZSkgewogICAgICAgICAgICBtaW5WYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1pblZhbHVlID0gbWluVmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1heFZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1heFZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWF4VmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPiBtYXhWYWx1ZSkgewogICAgICAgICAgICBtYXhWYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1heFZhbHVlID0gbWF4VmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgaGVpZ2h0IHZhbHVlIGF0IGFuIGluZGV4LiBEb24ndCBmb3JnZXQgdG8gdXBkYXRlIG1heFZhbHVlIGFuZCBtaW5WYWx1ZSBhZnRlciB5b3UncmUgZG9uZS4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRWYWx1ZUF0SW5kZXgoeGksIHlpLCB2YWx1ZSkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBkYXRhW3hpXVt5aV0gPSB2YWx1ZTsgLy8gSW52YWxpZGF0ZSBjYWNoZQoKICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZmFsc2UpOwoKICAgICAgaWYgKHhpID4gMCkgewogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCB0cnVlKTsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSwgZmFsc2UpOwogICAgICB9CgogICAgICBpZiAoeWkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWkgLSAxLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDAgJiYgeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWkgLSAxLCB0cnVlKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4L21pbiBpbiBhIHJlY3RhbmdsZSBpbiB0aGUgbWF0cml4IGRhdGEKICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgdGhlIHJlc3VsdHMgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgYXJyYXksIGlmIGl0IHdhcyBwYXNzZWQgaW4uIE1pbmltdW0gd2lsbCBiZSBhdCBwb3NpdGlvbiAwIGFuZCBtYXggYXQgMS4KICAgICAqLwoKCiAgICBnZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIC8vIEdldCBtYXggYW5kIG1pbiBvZiB0aGUgZGF0YQogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOyAvLyBTZXQgZmlyc3QgdmFsdWUKCiAgICAgIGxldCBtYXggPSB0aGlzLm1pblZhbHVlOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDw9IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPD0gaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IGhlaWdodDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlc3VsdFswXSA9IHRoaXMubWluVmFsdWU7CiAgICAgIHJlc3VsdFsxXSA9IG1heDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBpbmRleCBvZiBhIGxvY2FsIHBvc2l0aW9uIG9uIHRoZSBoZWlnaHRmaWVsZC4gVGhlIGluZGV4ZXMgaW5kaWNhdGUgdGhlIHJlY3RhbmdsZXMsIHNvIGlmIHlvdXIgdGVycmFpbiBpcyBtYWRlIG9mIE4geCBOIGhlaWdodCBkYXRhIHBvaW50cywgeW91IHdpbGwgaGF2ZSByZWN0YW5nbGUgaW5kZXhlcyByYW5naW5nIGZyb20gMCB0byBOLTEuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFR3by1lbGVtZW50IGFycmF5CiAgICAgKiBAcGFyYW0gY2xhbXAgSWYgdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBjbGFtcGVkIHRvIHRoZSBoZWlnaHRmaWVsZCBlZGdlLgogICAgICovCgoKICAgIGdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCByZXN1bHQsIGNsYW1wKSB7CiAgICAgIC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAogICAgICBjb25zdCB3ID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IHhpID0gTWF0aC5mbG9vcih4IC8gdyk7CiAgICAgIGxldCB5aSA9IE1hdGguZmxvb3IoeSAvIHcpOwogICAgICByZXN1bHRbMF0gPSB4aTsKICAgICAgcmVzdWx0WzFdID0geWk7CgogICAgICBpZiAoY2xhbXApIHsKICAgICAgICAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwogICAgICAgIGlmICh4aSA8IDApIHsKICAgICAgICAgIHhpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh5aSA8IDApIHsKICAgICAgICAgIHlpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh4aSA+PSBkYXRhLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHhpID0gZGF0YS5sZW5ndGggLSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpID49IGRhdGFbMF0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgeWkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICB9IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCgogICAgICBpZiAoeGkgPCAwIHx8IHlpIDwgMCB8fCB4aSA+PSBkYXRhLmxlbmd0aCAtIDEgfHwgeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBnZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYykgewogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgbG93ZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSB4aSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSB5aSkgKiogMjsKICAgICAgY29uc3QgdXBwZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSAoeGkgKyAxKSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSAoeWkgKyAxKSkgKiogMjsKICAgICAgY29uc3QgdXBwZXIgPSBsb3dlckRpc3QyID4gdXBwZXJEaXN0MjsKICAgICAgdGhpcy5nZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKTsKICAgICAgcmV0dXJuIHVwcGVyOwogICAgfQoKICAgIGdldE5vcm1hbEF0KHgsIHksIGVkZ2VDbGFtcCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGEgPSBnZXROb3JtYWxBdF9hOwogICAgICBjb25zdCBiID0gZ2V0Tm9ybWFsQXRfYjsKICAgICAgY29uc3QgYyA9IGdldE5vcm1hbEF0X2M7CiAgICAgIGNvbnN0IGUwID0gZ2V0Tm9ybWFsQXRfZTA7CiAgICAgIGNvbnN0IGUxID0gZ2V0Tm9ybWFsQXRfZTE7CiAgICAgIHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiLnZzdWIoYSwgZTApOwogICAgICBjLnZzdWIoYSwgZTEpOwogICAgICBlMC5jcm9zcyhlMSwgcmVzdWx0KTsKICAgICAgcmVzdWx0Lm5vcm1hbGl6ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gQUFCQiBvZiBhIHNxdWFyZSBpbiB0aGUgaGVpZ2h0ZmllbGQKICAgICAqIEBwYXJhbSB4aQogICAgICogQHBhcmFtIHlpCiAgICAgKiBAcGFyYW0gcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0QWFiYkF0SW5kZXgoeGksIHlpLCBfcmVmKSB7CiAgICAgIGxldCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBfcmVmOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGxvd2VyQm91bmQuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgIHVwcGVyQm91bmQuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBoZWlnaHQgaW4gdGhlIGhlaWdodGZpZWxkIGF0IGEgZ2l2ZW4gcG9zaXRpb24KICAgICAqLwoKCiAgICBnZXRIZWlnaHRBdCh4LCB5LCBlZGdlQ2xhbXApIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgYSA9IGdldEhlaWdodEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXRIZWlnaHRBdF9iOwogICAgICBjb25zdCBjID0gZ2V0SGVpZ2h0QXRfYzsKICAgICAgY29uc3QgaWR4ID0gZ2V0SGVpZ2h0QXRfaWR4OwogICAgICB0aGlzLmdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCBpZHgsIGVkZ2VDbGFtcCk7CiAgICAgIGxldCB4aSA9IGlkeFswXTsKICAgICAgbGV0IHlpID0gaWR4WzFdOwoKICAgICAgaWYgKGVkZ2VDbGFtcCkgewogICAgICAgIHhpID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB4aSkpOwogICAgICAgIHlpID0gTWF0aC5taW4oZGF0YVswXS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB5aSkpOwogICAgICB9CgogICAgICBjb25zdCB1cHBlciA9IHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyk7CiAgICAgIGNvbnN0IHcgPSBnZXRIZWlnaHRBdF93ZWlnaHRzOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGkgKyAxXVt5aSArIDFdICogdy54ICsgZGF0YVt4aV1beWkgKyAxXSAqIHcueSArIGRhdGFbeGkgKyAxXVt5aV0gKiB3Lno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGldW3lpXSAqIHcueCArIGRhdGFbeGkgKyAxXVt5aV0gKiB3LnkgKyBkYXRhW3hpXVt5aSArIDFdICogdy56OwogICAgICB9CiAgICB9CgogICAgZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIHhpICsgIl8iICsgeWkgKyAiXyIgKyAoZ2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwKTsKICAgIH0KCiAgICBnZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldOwogICAgfQoKICAgIHNldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSwgY29udmV4LCBvZmZzZXQpIHsKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV0gPSB7CiAgICAgICAgY29udmV4LAogICAgICAgIG9mZnNldAogICAgICB9OwogICAgfQoKICAgIGNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIGRlbGV0ZSB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdHJpYW5nbGUgZnJvbSB0aGUgaGVpZ2h0ZmllbGQKICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmICh1cHBlcikgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGEuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgICAgICBiLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgICBjLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCh4aSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aV0pOwogICAgICAgIGIuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0pOwogICAgICAgIGMuc2V0KHhpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGluIHRoZSB0ZXJyYWluIGluIHRoZSBmb3JtIG9mIGEgdHJpYW5ndWxhciBjb252ZXggc2hhcGUuCiAgICAgKi8KCgogICAgZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIGxldCByZXN1bHQgPSB0aGlzLnBpbGxhckNvbnZleDsKICAgICAgbGV0IG9mZnNldFJlc3VsdCA9IHRoaXMucGlsbGFyT2Zmc2V0OwoKICAgICAgaWYgKHRoaXMuY2FjaGVFbmFibGVkKSB7CiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKTsKCiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgIHRoaXMucGlsbGFyQ29udmV4ID0gZGF0YS5jb252ZXg7CiAgICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IGRhdGEub2Zmc2V0OwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0ID0gbmV3IENvbnZleFBvbHloZWRyb24oKTsKICAgICAgICBvZmZzZXRSZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICAgIHRoaXMucGlsbGFyQ29udmV4ID0gcmVzdWx0OwogICAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gb2Zmc2V0UmVzdWx0OwogICAgICB9CgogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IGZhY2VzID0gcmVzdWx0LmZhY2VzOyAvLyBSZXVzZSB2ZXJ0cyBpZiBwb3NzaWJsZQoKICAgICAgcmVzdWx0LnZlcnRpY2VzLmxlbmd0aCA9IDY7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGlmICghcmVzdWx0LnZlcnRpY2VzW2ldKSB7CiAgICAgICAgICByZXN1bHQudmVydGljZXNbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KICAgICAgfSAvLyBSZXVzZSBmYWNlcyBpZiBwb3NzaWJsZQoKCiAgICAgIGZhY2VzLmxlbmd0aCA9IDU7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgIGlmICghZmFjZXNbaV0pIHsKICAgICAgICAgIGZhY2VzW2ldID0gW107CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCB2ZXJ0cyA9IHJlc3VsdC52ZXJ0aWNlczsKICAgICAgY29uc3QgaCA9IChNYXRoLm1pbihkYXRhW3hpXVt5aV0sIGRhdGFbeGkgKyAxXVt5aV0sIGRhdGFbeGldW3lpICsgMV0sIGRhdGFbeGkgKyAxXVt5aSArIDFdKSAtIHRoaXMubWluVmFsdWUpIC8gMiArIHRoaXMubWluVmFsdWU7CgogICAgICBpZiAoIWdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuMjUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAwLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s0XS5zZXQoMC43NSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s1XS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsgLy8gdG9wIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzBdWzBdID0gMDsKICAgICAgICBmYWNlc1swXVsxXSA9IDE7CiAgICAgICAgZmFjZXNbMF1bMl0gPSAyOyAvLyBib3R0b20gdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMV1bMF0gPSA1OwogICAgICAgIGZhY2VzWzFdWzFdID0gNDsKICAgICAgICBmYWNlc1sxXVsyXSA9IDM7IC8vIC14IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzJdWzBdID0gMDsKICAgICAgICBmYWNlc1syXVsxXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMl0gPSA1OwogICAgICAgIGZhY2VzWzJdWzNdID0gMzsgLy8gLXkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbM11bMF0gPSAxOwogICAgICAgIGZhY2VzWzNdWzFdID0gMDsKICAgICAgICBmYWNlc1szXVsyXSA9IDM7CiAgICAgICAgZmFjZXNbM11bM10gPSA0OyAvLyAreHkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbNF1bMF0gPSA0OwogICAgICAgIGZhY2VzWzRdWzFdID0gNTsKICAgICAgICBmYWNlc1s0XVsyXSA9IDI7CiAgICAgICAgZmFjZXNbNF1bM10gPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIENlbnRlciBvZiB0aGUgdHJpYW5nbGUgcGlsbGFyIC0gYWxsIHBvbHlnb25zIGFyZSBnaXZlbiByZWxhdGl2ZSB0byB0aGlzIG9uZQogICAgICAgIG9mZnNldFJlc3VsdC5zZXQoKHhpICsgMC43NSkgKiBlbGVtZW50U2l6ZSwgLy8gc29ydCBvZiBjZW50ZXIgb2YgYSB0cmlhbmdsZQogICAgICAgICh5aSArIDAuNzUpICogZWxlbWVudFNpemUsIGggLy8gdmVydGljYWwgY2VudGVyCiAgICAgICAgKTsgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzBdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0gLSBoKTsKICAgICAgICB2ZXJ0c1sxXS5zZXQoLTAuNzUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMl0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSAtIGgpOyAvLyBib3R0b20gdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbM10uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s0XS5zZXQoLTAuNzUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s1XS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAtMC43NSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsgLy8gVG9wIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzBdWzBdID0gMDsKICAgICAgICBmYWNlc1swXVsxXSA9IDE7CiAgICAgICAgZmFjZXNbMF1bMl0gPSAyOyAvLyBib3R0b20gdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMV1bMF0gPSA1OwogICAgICAgIGZhY2VzWzFdWzFdID0gNDsKICAgICAgICBmYWNlc1sxXVsyXSA9IDM7IC8vICt4IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzJdWzBdID0gMjsKICAgICAgICBmYWNlc1syXVsxXSA9IDU7CiAgICAgICAgZmFjZXNbMl1bMl0gPSAzOwogICAgICAgIGZhY2VzWzJdWzNdID0gMDsgLy8gK3kgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbM11bMF0gPSAzOwogICAgICAgIGZhY2VzWzNdWzFdID0gNDsKICAgICAgICBmYWNlc1szXVsyXSA9IDE7CiAgICAgICAgZmFjZXNbM11bM10gPSAwOyAvLyAteHkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbNF1bMF0gPSAxOwogICAgICAgIGZhY2VzWzRdWzFdID0gNDsKICAgICAgICBmYWNlc1s0XVsyXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bM10gPSAyOwogICAgICB9CgogICAgICByZXN1bHQuY29tcHV0ZU5vcm1hbHMoKTsKICAgICAgcmVzdWx0LmNvbXB1dGVFZGdlcygpOwogICAgICByZXN1bHQudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy5zZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIHJlc3VsdCwgb2Zmc2V0UmVzdWx0KTsKICAgIH0KCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRhcmdldC5zZXQoMCwgMCwgMCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gKC8vIFRoZSB0ZXJyYWluIGlzIGluZmluaXRlCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8qKiBAVE9ETyBkbyBpdCBwcm9wZXJseSAqLwogICAgICBtaW4uc2V0KC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUpOwogICAgICBtYXguc2V0KE51bWJlci5NQVhfVkFMVUUsIE51bWJlci5NQVhfVkFMVUUsIE51bWJlci5NQVhfVkFMVUUpOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBVc2UgdGhlIGJvdW5kaW5nIGJveCBvZiB0aGUgbWluL21heCB2YWx1ZXMKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgcyA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBuZXcgVmVjMyhkYXRhLmxlbmd0aCAqIHMsIGRhdGFbMF0ubGVuZ3RoICogcywgTWF0aC5tYXgoTWF0aC5hYnModGhpcy5tYXhWYWx1ZSksIE1hdGguYWJzKHRoaXMubWluVmFsdWUpKSkubGVuZ3RoKCk7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIGhlaWdodCB2YWx1ZXMgZnJvbSBhbiBpbWFnZS4gQ3VycmVudGx5IG9ubHkgc3VwcG9ydGVkIGluIGJyb3dzZXIuCiAgICAgKi8KCgogICAgc2V0SGVpZ2h0c0Zyb21JbWFnZShpbWFnZSwgc2NhbGUpIHsKICAgICAgY29uc3QgewogICAgICAgIHgsCiAgICAgICAgeiwKICAgICAgICB5CiAgICAgIH0gPSBzY2FsZTsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgIGNhbnZhcy53aWR0aCA9IGltYWdlLndpZHRoOwogICAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwogICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwKTsKICAgICAgY29uc3QgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7CiAgICAgIGNvbnN0IG1hdHJpeCA9IHRoaXMuZGF0YTsKICAgICAgbWF0cml4Lmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuZWxlbWVudFNpemUgPSBNYXRoLmFicyh4KSAvIGltYWdlRGF0YS53aWR0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VEYXRhLmhlaWdodDsgaSsrKSB7CiAgICAgICAgY29uc3Qgcm93ID0gW107CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaW1hZ2VEYXRhLndpZHRoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDRdOwogICAgICAgICAgY29uc3QgYiA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNCArIDFdOwogICAgICAgICAgY29uc3QgYyA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNCArIDJdOwogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gKGEgKyBiICsgYykgLyA0IC8gMjU1ICogejsKCiAgICAgICAgICBpZiAoeCA8IDApIHsKICAgICAgICAgICAgcm93LnB1c2goaGVpZ2h0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJvdy51bnNoaWZ0KGhlaWdodCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoeSA8IDApIHsKICAgICAgICAgIG1hdHJpeC51bnNoaWZ0KHJvdyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hdHJpeC5wdXNoKHJvdyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZU1heFZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlTWluVmFsdWUoKTsKICAgICAgdGhpcy51cGRhdGUoKTsKICAgIH0KCiAgfQoKICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CiAgLyoqCiAgICogT2N0cmVlTm9kZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlTm9kZSB7CiAgICAvKiogVGhlIHJvb3Qgbm9kZSAqLwoKICAgIC8qKiBCb3VuZGFyeSBvZiB0aGlzIG5vZGUgKi8KCiAgICAvKiogQ29udGFpbmVkIGRhdGEgYXQgdGhlIGN1cnJlbnQgbm9kZSBsZXZlbCAqLwoKICAgIC8qKiBDaGlsZHJlbiB0byB0aGlzIG5vZGUgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yb290ID0gdm9pZCAwOwogICAgICB0aGlzLmFhYmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGF0YSA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGlsZHJlbiA9IHZvaWQgMDsKICAgICAgdGhpcy5yb290ID0gb3B0aW9ucy5yb290IHx8IG51bGw7CiAgICAgIHRoaXMuYWFiYiA9IG9wdGlvbnMuYWFiYiA/IG9wdGlvbnMuYWFiYi5jbG9uZSgpIDogbmV3IEFBQkIoKTsKICAgICAgdGhpcy5kYXRhID0gW107CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogcmVzZXQKICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogSW5zZXJ0IGRhdGEgaW50byB0aGlzIG5vZGUKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBzdWNjZXNzZnVsLCBvdGhlcndpc2UgZmFsc2UKICAgICAqLwoKCiAgICBpbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsKSB7CiAgICAgIGlmIChsZXZlbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbGV2ZWwgPSAwOwogICAgICB9CgogICAgICBjb25zdCBub2RlRGF0YSA9IHRoaXMuZGF0YTsgLy8gSWdub3JlIG9iamVjdHMgdGhhdCBkbyBub3QgYmVsb25nIGluIHRoaXMgbm9kZQoKICAgICAgaWYgKCF0aGlzLmFhYmIuY29udGFpbnMoYWFiYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG9iamVjdCBjYW5ub3QgYmUgYWRkZWQKICAgICAgfQoKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjb25zdCBtYXhEZXB0aCA9IHRoaXMubWF4RGVwdGggfHwgdGhpcy5yb290Lm1heERlcHRoOwoKICAgICAgaWYgKGxldmVsIDwgbWF4RGVwdGgpIHsKICAgICAgICAvLyBTdWJkaXZpZGUgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuIHlldAogICAgICAgIGxldCBzdWJkaXZpZGVkID0gZmFsc2U7CgogICAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLnN1YmRpdmlkZSgpOwogICAgICAgICAgc3ViZGl2aWRlZCA9IHRydWU7CiAgICAgICAgfSAvLyBhZGQgdG8gd2hpY2hldmVyIG5vZGUgd2lsbCBhY2NlcHQgaXQKCgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsICsgMSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZGl2aWRlZCkgewogICAgICAgICAgLy8gTm8gY2hpbGRyZW4gYWNjZXB0ZWQhIE1pZ2h0IGFzIHdlbGwganVzdCByZW1vdmUgZW0gc2luY2UgdGhleSBjb250YWluIG5vbmUKICAgICAgICAgIGNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICB9IC8vIFRvbyBkZWVwLCBvciBjaGlsZHJlbiBkaWRudCB3YW50IGl0LiBhZGQgaXQgaW4gY3VycmVudCBub2RlCgoKICAgICAgbm9kZURhdGEucHVzaChlbGVtZW50RGF0YSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgOCBlcXVhbGx5IHNpemVkIGNoaWxkcmVuIG5vZGVzIGFuZCBwdXQgdGhlbSBpbiB0aGUgYGNoaWxkcmVuYCBhcnJheS4KICAgICAqLwoKCiAgICBzdWJkaXZpZGUoKSB7CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgY2hpbGRyZW4ucHVzaChuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDAsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSkpOwogICAgICB1LnZzdWIobCwgaGFsZkRpYWdvbmFsKTsKICAgICAgaGFsZkRpYWdvbmFsLnNjYWxlKDAuNSwgaGFsZkRpYWdvbmFsKTsKICAgICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdCB8fCB0aGlzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07IC8vIFNldCBjdXJyZW50IG5vZGUgYXMgcm9vdAoKICAgICAgICBjaGlsZC5yb290ID0gcm9vdDsgLy8gQ29tcHV0ZSBib3VuZHMKCiAgICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IGNoaWxkLmFhYmIubG93ZXJCb3VuZDsKICAgICAgICBsb3dlckJvdW5kLnggKj0gaGFsZkRpYWdvbmFsLng7CiAgICAgICAgbG93ZXJCb3VuZC55ICo9IGhhbGZEaWFnb25hbC55OwogICAgICAgIGxvd2VyQm91bmQueiAqPSBoYWxmRGlhZ29uYWwuejsKICAgICAgICBsb3dlckJvdW5kLnZhZGQobCwgbG93ZXJCb3VuZCk7IC8vIFVwcGVyIGJvdW5kIGlzIGFsd2F5cyBsb3dlciBib3VuZCArIGhhbGZEaWFnb25hbAoKICAgICAgICBsb3dlckJvdW5kLnZhZGQoaGFsZkRpYWdvbmFsLCBjaGlsZC5hYWJiLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgd2l0aGluIGFuIEFBQkIKICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIGFhYmJRdWVyeShhYWJiLCByZXN1bHQpIHsKICAgICAgdGhpcy5kYXRhOyAvLyBhYm9ydCBpZiB0aGUgcmFuZ2UgZG9lcyBub3QgaW50ZXJzZWN0IHRoaXMgbm9kZQogICAgICAvLyBpZiAoIXRoaXMuYWFiYi5vdmVybGFwcyhhYWJiKSl7CiAgICAgIC8vICAgICByZXR1cm4gcmVzdWx0OwogICAgICAvLyB9CiAgICAgIC8vIEFkZCBvYmplY3RzIGF0IHRoaXMgbGV2ZWwKICAgICAgLy8gQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocmVzdWx0LCBub2RlRGF0YSk7CiAgICAgIC8vIEFkZCBjaGlsZCBkYXRhCiAgICAgIC8vIEB0b2RvIHVud3JhcCByZWN1cnNpb24gaW50byBhIHF1ZXVlIC8gbG9vcCwgdGhhdCdzIGZhc3RlciBpbiBKUwoKICAgICAgdGhpcy5jaGlsZHJlbjsgLy8gZm9yIChsZXQgaSA9IDAsIE4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIC8vICAgICBjaGlsZHJlbltpXS5hYWJiUXVlcnkoYWFiYiwgcmVzdWx0KTsKICAgICAgLy8gfQoKICAgICAgY29uc3QgcXVldWUgPSBbdGhpc107CgogICAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOwoKICAgICAgICBpZiAobm9kZS5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGUuZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShxdWV1ZSwgbm9kZS5jaGlsZHJlbik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgaW50ZXJzZWN0ZWQgYnkgYSByYXkuCiAgICAgKiBAcmV0dXJuIFRoZSAicmVzdWx0IiBvYmplY3QKICAgICAqLwoKCiAgICByYXlRdWVyeShyYXksIHRyZWVUcmFuc2Zvcm0sIHJlc3VsdCkgewogICAgICAvLyBVc2UgYWFiYiBxdWVyeSBmb3Igbm93LgoKICAgICAgLyoqIEB0b2RvIGltcGxlbWVudCByZWFsIHJheSBxdWVyeSB3aGljaCBuZWVkcyBsZXNzIGxvb2t1cHMgKi8KICAgICAgcmF5LmdldEFBQkIodG1wQUFCQik7CiAgICAgIHRtcEFBQkIudG9Mb2NhbEZyYW1lKHRyZWVUcmFuc2Zvcm0sIHRtcEFBQkIpOwogICAgICB0aGlzLmFhYmJRdWVyeSh0bXBBQUJCLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiByZW1vdmVFbXB0eU5vZGVzCiAgICAgKi8KCgogICAgcmVtb3ZlRW1wdHlOb2RlcygpIHsKICAgICAgZm9yIChsZXQgaSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLnJlbW92ZUVtcHR5Tm9kZXMoKTsKCiAgICAgICAgaWYgKCF0aGlzLmNoaWxkcmVuW2ldLmNoaWxkcmVuLmxlbmd0aCAmJiAhdGhpcy5jaGlsZHJlbltpXS5kYXRhLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICAvKioKICAgKiBPY3RyZWUKICAgKi8KCgogIGNsYXNzIE9jdHJlZSBleHRlbmRzIE9jdHJlZU5vZGUgewogICAgLyoqCiAgICAgKiBNYXhpbXVtIHN1YmRpdmlzaW9uIGRlcHRoCiAgICAgKiBAZGVmYXVsdCA4CiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBhYWJiIFRoZSB0b3RhbCBBQUJCIG9mIHRoZSB0cmVlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGFhYmIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoewogICAgICAgIHJvb3Q6IG51bGwsCiAgICAgICAgYWFiYgogICAgICB9KTsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHR5cGVvZiBvcHRpb25zLm1heERlcHRoICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4RGVwdGggOiA4OwogICAgfQoKICB9CgogIGNvbnN0IGhhbGZEaWFnb25hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wQUFCQiA9IG5ldyBBQUJCKCk7CiAgLyoqCiAgICogVHJpbWVzaC4KICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBIb3cgdG8gbWFrZSBhIG1lc2ggd2l0aCBhIHNpbmdsZSB0cmlhbmdsZQogICAqICAgICBjb25zdCB2ZXJ0aWNlcyA9IFsKICAgKiAgICAgICAgIDAsIDAsIDAsIC8vIHZlcnRleCAwCiAgICogICAgICAgICAxLCAwLCAwLCAvLyB2ZXJ0ZXggMQogICAqICAgICAgICAgMCwgMSwgMCAgLy8gdmVydGV4IDIKICAgKiAgICAgXQogICAqICAgICBjb25zdCBpbmRpY2VzID0gWwogICAqICAgICAgICAgMCwgMSwgMiAgLy8gdHJpYW5nbGUgMAogICAqICAgICBdCiAgICogICAgIGNvbnN0IHRyaW1lc2hTaGFwZSA9IG5ldyBDQU5OT04uVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcykKICAgKi8KCiAgY2xhc3MgVHJpbWVzaCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogdmVydGljZXMKICAgICAqLwoKICAgIC8qKgogICAgICogQXJyYXkgb2YgaW50ZWdlcnMsIGluZGljYXRpbmcgd2hpY2ggdmVydGljZXMgZWFjaCB0cmlhbmdsZSBjb25zaXN0cyBvZi4gVGhlIGxlbmd0aCBvZiB0aGlzIGFycmF5IGlzIHRodXMgMyB0aW1lcyB0aGUgbnVtYmVyIG9mIHRyaWFuZ2xlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIG5vcm1hbHMgZGF0YS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGxvY2FsIEFBQkIgb2YgdGhlIG1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlZmVyZW5jZXMgdG8gdmVydGV4IHBhaXJzLCBtYWtpbmcgdXAgYWxsIHVuaXF1ZSBlZGdlcyBpbiB0aGUgdHJpbWVzaC4KICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgc2NhbGluZyBvZiB0aGUgbWVzaC4gVXNlIC5zZXRTY2FsZSgpIHRvIHNldCBpdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4ZWQgdHJpYW5nbGVzLiBVc2UgLnVwZGF0ZVRyZWUoKSB0byB1cGRhdGUgaXQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHZlcnRpY2VzLCBpbmRpY2VzKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5UUklNRVNICiAgICAgIH0pOwogICAgICB0aGlzLnZlcnRpY2VzID0gdm9pZCAwOwogICAgICB0aGlzLmluZGljZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMubm9ybWFscyA9IHZvaWQgMDsKICAgICAgdGhpcy5hYWJiID0gdm9pZCAwOwogICAgICB0aGlzLmVkZ2VzID0gdm9pZCAwOwogICAgICB0aGlzLnNjYWxlID0gdm9pZCAwOwogICAgICB0aGlzLnRyZWUgPSB2b2lkIDA7CiAgICAgIHRoaXMudmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKTsKICAgICAgdGhpcy5pbmRpY2VzID0gbmV3IEludDE2QXJyYXkoaW5kaWNlcyk7CiAgICAgIHRoaXMubm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoaW5kaWNlcy5sZW5ndGgpOwogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmVkZ2VzID0gbnVsbDsKICAgICAgdGhpcy5zY2FsZSA9IG5ldyBWZWMzKDEsIDEsIDEpOwogICAgICB0aGlzLnRyZWUgPSBuZXcgT2N0cmVlKCk7CiAgICAgIHRoaXMudXBkYXRlRWRnZXMoKTsKICAgICAgdGhpcy51cGRhdGVOb3JtYWxzKCk7CiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMudXBkYXRlVHJlZSgpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVUcmVlCiAgICAgKi8KCgogICAgdXBkYXRlVHJlZSgpIHsKICAgICAgY29uc3QgdHJlZSA9IHRoaXMudHJlZTsKICAgICAgdHJlZS5yZXNldCgpOwogICAgICB0cmVlLmFhYmIuY29weSh0aGlzLmFhYmIpOwogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7IC8vIFRoZSBsb2NhbCBtZXNoIEFBQkIgaXMgc2NhbGVkLCBidXQgdGhlIG9jdHJlZSBBQUJCIHNob3VsZCBiZSB1bnNjYWxlZAoKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueiAqPSAxIC8gc2NhbGUuejsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueiAqPSAxIC8gc2NhbGUuejsgLy8gSW5zZXJ0IGFsbCB0cmlhbmdsZXMKCiAgICAgIGNvbnN0IHRyaWFuZ2xlQUFCQiA9IG5ldyBBQUJCKCk7CiAgICAgIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBvaW50cyA9IFthLCBiLCBjXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vdGhpcy5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIGEsIGIsIGMpOwogICAgICAgIC8vIEdldCB1bnNjYWxlZCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwoKICAgICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKCiAgICAgICAgdHJpYW5nbGVBQUJCLnNldEZyb21Qb2ludHMocG9pbnRzKTsKICAgICAgICB0cmVlLmluc2VydCh0cmlhbmdsZUFBQkIsIGkpOwogICAgICB9CgogICAgICB0cmVlLnJlbW92ZUVtcHR5Tm9kZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRyaWFuZ2xlcyBpbiBhIGxvY2FsIEFBQkIgZnJvbSB0aGUgdHJpbWVzaC4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlZmVyZW5jaW5nIHRoZSBxdWVyaWVkIHRyaWFuZ2xlcy4KICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZXNJbkFBQkIoYWFiYiwgcmVzdWx0KSB7CiAgICAgIHVuc2NhbGVkQUFCQi5jb3B5KGFhYmIpOyAvLyBTY2FsZSBpdCB0byBsb2NhbAoKICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgICBjb25zdCBpc3ggPSBzY2FsZS54OwogICAgICBjb25zdCBpc3kgPSBzY2FsZS55OwogICAgICBjb25zdCBpc3ogPSBzY2FsZS56OwogICAgICBjb25zdCBsID0gdW5zY2FsZWRBQUJCLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB1bnNjYWxlZEFBQkIudXBwZXJCb3VuZDsKICAgICAgbC54IC89IGlzeDsKICAgICAgbC55IC89IGlzeTsKICAgICAgbC56IC89IGlzejsKICAgICAgdS54IC89IGlzeDsKICAgICAgdS55IC89IGlzeTsKICAgICAgdS56IC89IGlzejsKICAgICAgcmV0dXJuIHRoaXMudHJlZS5hYWJiUXVlcnkodW5zY2FsZWRBQUJCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRTY2FsZQogICAgICovCgoKICAgIHNldFNjYWxlKHNjYWxlKSB7CiAgICAgIGNvbnN0IHdhc1VuaWZvcm0gPSB0aGlzLnNjYWxlLnggPT09IHRoaXMuc2NhbGUueSAmJiB0aGlzLnNjYWxlLnkgPT09IHRoaXMuc2NhbGUuejsKICAgICAgY29uc3QgaXNVbmlmb3JtID0gc2NhbGUueCA9PT0gc2NhbGUueSAmJiBzY2FsZS55ID09PSBzY2FsZS56OwoKICAgICAgaWYgKCEod2FzVW5pZm9ybSAmJiBpc1VuaWZvcm0pKSB7CiAgICAgICAgLy8gTm9uLXVuaWZvcm0gc2NhbGluZy4gTmVlZCB0byB1cGRhdGUgbm9ybWFscy4KICAgICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgfQoKICAgICAgdGhpcy5zY2FsZS5jb3B5KHNjYWxlKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuIFdpbGwgc2F2ZSBpbiB0aGUgYC5ub3JtYWxzYCBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGVOb3JtYWxzKCkgewogICAgICBjb25zdCBuID0gY29tcHV0ZU5vcm1hbHNfbjsgLy8gR2VuZXJhdGUgbm9ybWFscwoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMubm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICB0aGlzLmdldFZlcnRleChhLCB2YSk7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYiwgdmIpOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGMsIHZjKTsKICAgICAgICBUcmltZXNoLmNvbXB1dGVOb3JtYWwodmIsIHZhLCB2Yywgbik7CiAgICAgICAgbm9ybWFsc1tpM10gPSBuLng7CiAgICAgICAgbm9ybWFsc1tpMyArIDFdID0gbi55OwogICAgICAgIG5vcm1hbHNbaTMgKyAyXSA9IG4uejsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuZWRnZXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlRWRnZXMoKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0ge307CgogICAgICBjb25zdCBhZGQgPSAoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGtleSA9IGEgPCBiID8gYSArICJfIiArIGIgOiBiICsgIl8iICsgYTsKICAgICAgICBlZGdlc1trZXldID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICBhZGQoYSwgYik7CiAgICAgICAgYWRkKGIsIGMpOwogICAgICAgIGFkZChjLCBhKTsKICAgICAgfQoKICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGVkZ2VzKTsKICAgICAgdGhpcy5lZGdlcyA9IG5ldyBJbnQxNkFycmF5KGtleXMubGVuZ3RoICogMik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBpbmRpY2VzID0ga2V5c1tpXS5zcGxpdCgnXycpOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGldID0gcGFyc2VJbnQoaW5kaWNlc1swXSwgMTApOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGkgKyAxXSA9IHBhcnNlSW50KGluZGljZXNbMV0sIDEwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWRnZSB2ZXJ0ZXgKICAgICAqIEBwYXJhbSBmaXJzdE9yU2Vjb25kIDAgb3IgMSwgZGVwZW5kaW5nIG9uIHdoaWNoIG9uZSBvZiB0aGUgdmVydGljZXMgeW91IG5lZWQuCiAgICAgKiBAcGFyYW0gdmVydGV4U3RvcmUgV2hlcmUgdG8gc3RvcmUgdGhlIHJlc3VsdAogICAgICovCgoKICAgIGdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCBmaXJzdE9yU2Vjb25kLCB2ZXJ0ZXhTdG9yZSkgewogICAgICBjb25zdCB2ZXJ0ZXhJbmRleCA9IHRoaXMuZWRnZXNbZWRnZUluZGV4ICogMiArIChmaXJzdE9yU2Vjb25kID8gMSA6IDApXTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodmVydGV4SW5kZXgsIHZlcnRleFN0b3JlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdmVjdG9yIGFsb25nIGFuIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0RWRnZVZlY3RvcihlZGdlSW5kZXgsIHZlY3RvclN0b3JlKSB7CiAgICAgIGNvbnN0IHZhID0gZ2V0RWRnZVZlY3Rvcl92YTsKICAgICAgY29uc3QgdmIgPSBnZXRFZGdlVmVjdG9yX3ZiOwogICAgICB0aGlzLmdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCAwLCB2YSk7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDEsIHZiKTsKICAgICAgdmIudnN1Yih2YSwgdmVjdG9yU3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdmVydGV4IGkuCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0VmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CgogICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpOwoKICAgICAgb3V0LnggKj0gc2NhbGUueDsKICAgICAgb3V0LnkgKj0gc2NhbGUueTsKICAgICAgb3V0LnogKj0gc2NhbGUuejsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHJhdyB2ZXJ0ZXggaQogICAgICogQHJldHVybiBUaGUgIm91dCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIF9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICByZXR1cm4gb3V0LnNldCh2ZXJ0aWNlc1tpM10sIHZlcnRpY2VzW2kzICsgMV0sIHZlcnRpY2VzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZXJ0ZXggZnJvbSB0aGUgdHJpbWVzaCx0cmFuc2Zvcm1lZCBieSB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0V29ybGRWZXJ0ZXgoaSwgcG9zLCBxdWF0LCBvdXQpIHsKICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgb3V0KTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvcywgcXVhdCwgb3V0LCBvdXQpOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRocmVlIHZlcnRpY2VzIGZvciB0cmlhbmdsZSBpLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYykgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTNdLCBhKTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMV0sIGIpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAyXSwgYyk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiB0cmlhbmdsZSBpLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGdldE5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQodGhpcy5ub3JtYWxzW2kzXSwgdGhpcy5ub3JtYWxzW2kzICsgMV0sIHRoaXMubm9ybWFsc1tpMyArIDJdKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKGNsaV9hYWJiKTsKICAgICAgY29uc3QgeCA9IGNsaV9hYWJiLnVwcGVyQm91bmQueCAtIGNsaV9hYWJiLmxvd2VyQm91bmQueDsKICAgICAgY29uc3QgeSA9IGNsaV9hYWJiLnVwcGVyQm91bmQueSAtIGNsaV9hYWJiLmxvd2VyQm91bmQueTsKICAgICAgY29uc3QgeiA9IGNsaV9hYWJiLnVwcGVyQm91bmQueiAtIGNsaV9hYWJiLmxvd2VyQm91bmQuejsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQoMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopLCAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeCAqIDIgKiB4ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGxvY2FsIEFBQkIgZm9yIHRoZSB0cmltZXNoCiAgICAgKi8KCgogICAgY29tcHV0ZUxvY2FsQUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgdiA9IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0OwogICAgICB0aGlzLmdldFZlcnRleCgwLCB2KTsKICAgICAgbC5jb3B5KHYpOwogICAgICB1LmNvcHkodik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CgogICAgICAgIGlmICh2LnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IHUueCkgewogICAgICAgICAgdS54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGwueSkgewogICAgICAgICAgbC55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgLmFhYmJgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKHRoaXMuYWFiYik7CiAgICB9CiAgICAvKioKICAgICAqIFdpbGwgdXBkYXRlIHRoZSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBBc3N1bWUgcG9pbnRzIGFyZSBkaXN0cmlidXRlZCB3aXRoIGxvY2FsICgwLDAsMCkgYXMgY2VudGVyCiAgICAgIGxldCBtYXgyID0gMDsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdmVydGljZXMubGVuZ3RoIC8gMzsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgY29uc3Qgbm9ybTIgPSB2Lmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoKICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAvIDMsCiAgICAgICAgICAgICAgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICAgICAgY29uc3QgbWlueCxtaW55LG1pbnosbWF4eCxtYXh5LG1heHo7CiAgICAgICAgICAgY29uc3QgdiA9IHRlbXBXb3JsZFZlcnRleDsKICAgICAgICAgIGZvcihsZXQgaT0wOyBpPG47IGkrKyl7CiAgICAgICAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICAgICAgICBwb3MudmFkZCh2LCB2KTsKICAgICAgICAgICAgICBpZiAodi54IDwgbWlueCB8fCBtaW54PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi54ID4gbWF4eCB8fCBtYXh4PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGlmICh2LnkgPCBtaW55IHx8IG1pbnk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW55ID0gdi55OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnkgPiBtYXh5IHx8IG1heHk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh5ID0gdi55OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueiA8IG1pbnogfHwgbWluej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnogPSB2Lno7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueiA+IG1heHogfHwgbWF4ej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHogPSB2Lno7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbWluLnNldChtaW54LG1pbnksbWlueik7CiAgICAgICAgICBtYXguc2V0KG1heHgsbWF4eSxtYXh6KTsKICAgICAgICAgICovCiAgICAgIC8vIEZhc3RlciBhcHByb3hpbWF0aW9uIHVzaW5nIGxvY2FsIEFBQkIKICAgICAgY29uc3QgZnJhbWUgPSBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWU7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiOwogICAgICBmcmFtZS5wb3NpdGlvbiA9IHBvczsKICAgICAgZnJhbWUucXVhdGVybmlvbiA9IHF1YXQ7CiAgICAgIHRoaXMuYWFiYi50b1dvcmxkRnJhbWUoZnJhbWUsIHJlc3VsdCk7CiAgICAgIG1pbi5jb3B5KHJlc3VsdC5sb3dlckJvdW5kKTsKICAgICAgbWF4LmNvcHkocmVzdWx0LnVwcGVyQm91bmQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYXBwcm94aW1hdGUgdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSBhIFRyaW1lc2ggaW5zdGFuY2UsIHNoYXBlZCBhcyBhIHRvcnVzLgogICAgICovCgoKICAgIHN0YXRpYyBjcmVhdGVUb3J1cyhyYWRpdXMsIHR1YmUsIHJhZGlhbFNlZ21lbnRzLCB0dWJ1bGFyU2VnbWVudHMsIGFyYykgewogICAgICBpZiAocmFkaXVzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpdXMgPSAxOwogICAgICB9CgogICAgICBpZiAodHViZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHViZSA9IDAuNTsKICAgICAgfQoKICAgICAgaWYgKHJhZGlhbFNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpYWxTZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmICh0dWJ1bGFyU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHR1YnVsYXJTZWdtZW50cyA9IDY7CiAgICAgIH0KCiAgICAgIGlmIChhcmMgPT09IHZvaWQgMCkgewogICAgICAgIGFyYyA9IE1hdGguUEkgKiAyOwogICAgICB9CgogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBpbmRpY2VzID0gW107CgogICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHUgPSBpIC8gdHVidWxhclNlZ21lbnRzICogYXJjOwogICAgICAgICAgY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwogICAgICAgICAgY29uc3QgeCA9IChyYWRpdXMgKyB0dWJlICogTWF0aC5jb3ModikpICogTWF0aC5jb3ModSk7CiAgICAgICAgICBjb25zdCB5ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLnNpbih1KTsKICAgICAgICAgIGNvbnN0IHogPSB0dWJlICogTWF0aC5zaW4odik7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKHgsIHksIHopOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gcmFkaWFsU2VnbWVudHM7IGorKykgewogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHR1YnVsYXJTZWdtZW50czsgaSsrKSB7CiAgICAgICAgICBjb25zdCBhID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogaiArIGkgLSAxOwogICAgICAgICAgY29uc3QgYiA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpIC0gMTsKICAgICAgICAgIGNvbnN0IGMgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiAoaiAtIDEpICsgaTsKICAgICAgICAgIGNvbnN0IGQgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaTsKICAgICAgICAgIGluZGljZXMucHVzaChhLCBiLCBkKTsKICAgICAgICAgIGluZGljZXMucHVzaChiLCBjLCBkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcyk7CiAgICB9CgogIH0KCiAgY29uc3QgY29tcHV0ZU5vcm1hbHNfbiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdW5zY2FsZWRBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCBnZXRFZGdlVmVjdG9yX3ZhID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRFZGdlVmVjdG9yX3ZiID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZhID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNsaV9hYWJiID0gbmV3IEFBQkIoKTsKICBjb25zdCBjb21wdXRlTG9jYWxBQUJCX3dvcmxkVmVydCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY3VsYXRlV29ybGRBQUJCX2ZyYW1lID0gbmV3IFRyYW5zZm9ybSgpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiID0gbmV3IEFBQkIoKTsKICAvKioKICAgKiBDb25zdHJhaW50IGVxdWF0aW9uIHNvbHZlciBiYXNlIGNsYXNzLgogICAqLwoKICBjbGFzcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBBbGwgZXF1YXRpb25zIHRvIGJlIHNvbHZlZAogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5lcXVhdGlvbnMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KICAvKioKICAgKiBDb25zdHJhaW50IGVxdWF0aW9uIEdhdXNzLVNlaWRlbCBzb2x2ZXIuCiAgICogQHRvZG8gVGhlIHNwb29rIHBhcmFtZXRlcnMgc2hvdWxkIGJlIHNwZWNpZmllZCBmb3IgZWFjaCBjb25zdHJhaW50LCBub3QgZ2xvYmFsbHkuCiAgICogQHNlZSBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci81RFYwNTgvVlQwOS9sZWN0dXJlcy9zcG9va25vdGVzLnBkZgogICAqLwoKCiAgY2xhc3MgR1NTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLgogICAgICogVGhlIG1vcmUgaXRlcmF0aW9ucywgdGhlIG1vcmUgY29ycmVjdCBzaW11bGF0aW9uLiBNb3JlIGl0ZXJhdGlvbnMgbmVlZCBtb3JlIGNvbXB1dGF0aW9ucyB0aG91Z2guIElmIHlvdSBoYXZlIGEgbGFyZ2UgZ3Jhdml0eSBmb3JjZSBpbiB5b3VyIHdvcmxkLCB5b3Ugd2lsbCBuZWVkIG1vcmUgaXRlcmF0aW9ucy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0b2xlcmFuY2UgaXMgcmVhY2hlZCwgdGhlIHN5c3RlbSBpcyBhc3N1bWVkIHRvIGJlIGNvbnZlcmdlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IHZvaWQgMDsKICAgICAgdGhpcy50b2xlcmFuY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBsZXQgaXRlciA9IDA7CiAgICAgIGNvbnN0IG1heEl0ZXIgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IHRvbFNxdWFyZWQgPSB0aGlzLnRvbGVyYW5jZSAqIHRoaXMudG9sZXJhbmNlOwogICAgICBjb25zdCBlcXVhdGlvbnMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgTmVxID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgY29uc3QgYm9kaWVzID0gd29ybGQuYm9kaWVzOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaCA9IGR0OwogICAgICBsZXQgQjsKICAgICAgbGV0IGludkM7CiAgICAgIGxldCBkZWx0YWxhbWJkYTsKICAgICAgbGV0IGRlbHRhbGFtYmRhVG90OwogICAgICBsZXQgR1dsYW1iZGE7CiAgICAgIGxldCBsYW1iZGFqOyAvLyBVcGRhdGUgc29sdmUgbWFzcwoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYm9kaWVzOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS51cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFRoaW5ncyB0aGF0IGRvIG5vdCBjaGFuZ2UgZHVyaW5nIGl0ZXJhdGlvbiBjYW4gYmUgY29tcHV0ZWQgb25jZQoKCiAgICAgIGNvbnN0IGludkNzID0gR1NTb2x2ZXJfc29sdmVfaW52Q3M7CiAgICAgIGNvbnN0IEJzID0gR1NTb2x2ZXJfc29sdmVfQnM7CiAgICAgIGNvbnN0IGxhbWJkYSA9IEdTU29sdmVyX3NvbHZlX2xhbWJkYTsKICAgICAgaW52Q3MubGVuZ3RoID0gTmVxOwogICAgICBCcy5sZW5ndGggPSBOZXE7CiAgICAgIGxhbWJkYS5sZW5ndGggPSBOZXE7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gZXF1YXRpb25zW2ldOwogICAgICAgIGxhbWJkYVtpXSA9IDAuMDsKICAgICAgICBCc1tpXSA9IGMuY29tcHV0ZUIoaCk7CiAgICAgICAgaW52Q3NbaV0gPSAxLjAgLyBjLmNvbXB1dGVDKCk7CiAgICAgIH0KCiAgICAgIGlmIChOZXEgIT09IDApIHsKICAgICAgICAvLyBSZXNldCB2bGFtYmRhCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHZsYW1iZGEgPSBiLnZsYW1iZGE7CiAgICAgICAgICBjb25zdCB3bGFtYmRhID0gYi53bGFtYmRhOwogICAgICAgICAgdmxhbWJkYS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICB3bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICB9IC8vIEl0ZXJhdGUgb3ZlciBlcXVhdGlvbnMKCgogICAgICAgIGZvciAoaXRlciA9IDA7IGl0ZXIgIT09IG1heEl0ZXI7IGl0ZXIrKykgewogICAgICAgICAgLy8gQWNjdW11bGF0ZSB0aGUgdG90YWwgZXJyb3IgZm9yIGVhY2ggaXRlcmF0aW9uLgogICAgICAgICAgZGVsdGFsYW1iZGFUb3QgPSAwLjA7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbal07IC8vIENvbXB1dGUgaXRlcmF0aW9uCgogICAgICAgICAgICBCID0gQnNbal07CiAgICAgICAgICAgIGludkMgPSBpbnZDc1tqXTsKICAgICAgICAgICAgbGFtYmRhaiA9IGxhbWJkYVtqXTsKICAgICAgICAgICAgR1dsYW1iZGEgPSBjLmNvbXB1dGVHV2xhbWJkYSgpOwogICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGludkMgKiAoQiAtIEdXbGFtYmRhIC0gYy5lcHMgKiBsYW1iZGFqKTsgLy8gQ2xhbXAgaWYgd2UgYXJlIG5vdCB3aXRoaW4gdGhlIG1pbi9tYXggaW50ZXJ2YWwKCiAgICAgICAgICAgIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPCBjLm1pbkZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1pbkZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfSBlbHNlIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPiBjLm1heEZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1heEZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFtYmRhW2pdICs9IGRlbHRhbGFtYmRhOwogICAgICAgICAgICBkZWx0YWxhbWJkYVRvdCArPSBkZWx0YWxhbWJkYSA+IDAuMCA/IGRlbHRhbGFtYmRhIDogLWRlbHRhbGFtYmRhOyAvLyBhYnMoZGVsdGFsYW1iZGEpCgogICAgICAgICAgICBjLmFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSk7CiAgICAgICAgICB9IC8vIElmIHRoZSB0b3RhbCBlcnJvciBpcyBzbWFsbCBlbm91Z2ggLSBzdG9wIGl0ZXJhdGUKCgogICAgICAgICAgaWYgKGRlbHRhbGFtYmRhVG90ICogZGVsdGFsYW1iZGFUb3QgPCB0b2xTcXVhcmVkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gQWRkIHJlc3VsdCB0byB2ZWxvY2l0eQoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHYgPSBiLnZlbG9jaXR5OwogICAgICAgICAgY29uc3QgdyA9IGIuYW5ndWxhclZlbG9jaXR5OwogICAgICAgICAgYi52bGFtYmRhLnZtdWwoYi5saW5lYXJGYWN0b3IsIGIudmxhbWJkYSk7CiAgICAgICAgICB2LnZhZGQoYi52bGFtYmRhLCB2KTsKICAgICAgICAgIGIud2xhbWJkYS52bXVsKGIuYW5ndWxhckZhY3RvciwgYi53bGFtYmRhKTsKICAgICAgICAgIHcudmFkZChiLndsYW1iZGEsIHcpOwogICAgICAgIH0gLy8gU2V0IHRoZSBgLm11bHRpcGxpZXJgIHByb3BlcnR5IG9mIGVhY2ggZXF1YXRpb24KCgogICAgICAgIGxldCBsID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgICBjb25zdCBpbnZEdCA9IDEgLyBoOwoKICAgICAgICB3aGlsZSAobC0tKSB7CiAgICAgICAgICBlcXVhdGlvbnNbbF0ubXVsdGlwbGllciA9IGxhbWJkYVtsXSAqIGludkR0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGl0ZXI7CiAgICB9CgogIH0gLy8gSnVzdCB0ZW1wb3JhcnkgbnVtYmVyIGhvbGRlcnMgdGhhdCB3ZSB3YW50IHRvIHJldXNlIGVhY2ggaXRlcmF0aW9uLgoKCiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfbGFtYmRhID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfaW52Q3MgPSBbXTsKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9CcyA9IFtdOwogIC8qKgogICAqIFNwbGl0cyB0aGUgZXF1YXRpb25zIGludG8gaXNsYW5kcyBhbmQgc29sdmVzIHRoZW0gaW5kZXBlbmRlbnRseS4gQ2FuIGltcHJvdmUgcGVyZm9ybWFuY2UuCiAgICovCgogIGNsYXNzIFNwbGl0U29sdmVyIGV4dGVuZHMgU29sdmVyIHsKICAgIC8qKgogICAgICogVGhlIG51bWJlciBvZiBzb2x2ZXIgaXRlcmF0aW9ucyBkZXRlcm1pbmVzIHF1YWxpdHkgb2YgdGhlIGNvbnN0cmFpbnRzIGluIHRoZSB3b3JsZC4gVGhlIG1vcmUgaXRlcmF0aW9ucywgdGhlIG1vcmUgY29ycmVjdCBzaW11bGF0aW9uLiBNb3JlIGl0ZXJhdGlvbnMgbmVlZCBtb3JlIGNvbXB1dGF0aW9ucyB0aG91Z2guIElmIHlvdSBoYXZlIGEgbGFyZ2UgZ3Jhdml0eSBmb3JjZSBpbiB5b3VyIHdvcmxkLCB5b3Ugd2lsbCBuZWVkIG1vcmUgaXRlcmF0aW9ucy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0b2xlcmFuY2UgaXMgcmVhY2hlZCwgdGhlIHN5c3RlbSBpcyBhc3N1bWVkIHRvIGJlIGNvbnZlcmdlZC4KICAgICAqLwoKICAgIC8qKiBzdWJzb2x2ZXIgKi8KICAgIGNvbnN0cnVjdG9yKHN1YnNvbHZlcikgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLml0ZXJhdGlvbnMgPSB2b2lkIDA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gdm9pZCAwOwogICAgICB0aGlzLnN1YnNvbHZlciA9IHZvaWQgMDsKICAgICAgdGhpcy5ub2RlcyA9IHZvaWQgMDsKICAgICAgdGhpcy5ub2RlUG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlcyA9IFtdOyAvLyBBbGwgYWxsb2NhdGVkIG5vZGUgb2JqZWN0cwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9lcXMgPSBbXTsgLy8gVGVtcCBhcnJheQoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkID0gewogICAgYm9kaWVzOiBbXQogIH07IC8vIFRlbXAgb2JqZWN0CgogIGNvbnN0IFNUQVRJQyA9IEJvZHkuU1RBVElDOwoKICBmdW5jdGlvbiBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSB7CiAgICBjb25zdCBObm9kZXMgPSBub2Rlcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ub2RlczsgaSsrKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKCiAgICAgIGlmICghbm9kZS52aXNpdGVkICYmICEobm9kZS5ib2R5LnR5cGUgJiBTVEFUSUMpKSB7CiAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBjb25zdCBxdWV1ZSA9IFtdOwoKICBmdW5jdGlvbiBiZnMocm9vdCwgdmlzaXRGdW5jLCBiZHMsIGVxcykgewogICAgcXVldWUucHVzaChyb290KTsKICAgIHJvb3QudmlzaXRlZCA9IHRydWU7CiAgICB2aXNpdEZ1bmMocm9vdCwgYmRzLCBlcXMpOwoKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOyAvLyBMb29wIG92ZXIgdW52aXNpdGVkIGNoaWxkIG5vZGVzCgogICAgICBsZXQgY2hpbGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGUuY2hpbGRyZW4pKSB7CiAgICAgICAgY2hpbGQudmlzaXRlZCA9IHRydWU7CiAgICAgICAgdmlzaXRGdW5jKGNoaWxkLCBiZHMsIGVxcyk7CiAgICAgICAgcXVldWUucHVzaChjaGlsZCk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHZpc2l0RnVuYyhub2RlLCBiZHMsIGVxcykgewogICAgYmRzLnB1c2gobm9kZS5ib2R5KTsKICAgIGNvbnN0IE5lcXMgPSBub2RlLmVxcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICBjb25zdCBlcSA9IG5vZGUuZXFzW2ldOwoKICAgICAgaWYgKCFlcXMuaW5jbHVkZXMoZXEpKSB7CiAgICAgICAgZXFzLnB1c2goZXEpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzb3J0QnlJZChhLCBiKSB7CiAgICByZXR1cm4gYi5pZCAtIGEuaWQ7CiAgfQogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwoKCiAgY2xhc3MgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5vYmplY3RzID0gW107CiAgICAgIHRoaXMudHlwZSA9IE9iamVjdDsKICAgIH0KICAgIC8qKgogICAgICogUmVsZWFzZSBhbiBvYmplY3QgYWZ0ZXIgdXNlCiAgICAgKi8KCgogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CiAgLyoqCiAgICogVmVjM1Bvb2wKICAgKi8KCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3RydWN0IGEgdmVjdG9yCiAgICAgKi8KCgogICAgY29uc3RydWN0T2JqZWN0KCkgewogICAgICByZXR1cm4gbmV3IFZlYzMoKTsKICAgIH0KCiAgfQoKICBsZXQgX0NPTExJU0lPTl9UWVBFUyRzcGhlLCBfQ09MTElTSU9OX1RZUEVTJHNwaGUyLCBfQ09MTElTSU9OX1RZUEVTJGJveEIsIF9DT0xMSVNJT05fVFlQRVMkc3BoZTMsIF9DT0xMSVNJT05fVFlQRVMkcGxhbiwgX0NPTExJU0lPTl9UWVBFUyRjb252LCBfQ09MTElTSU9OX1RZUEVTJHNwaGU0LCBfQ09MTElTSU9OX1RZUEVTJHBsYW4yLCBfQ09MTElTSU9OX1RZUEVTJGJveEMsIF9DT0xMSVNJT05fVFlQRVMkc3BoZTUsIF9DT0xMSVNJT05fVFlQRVMkYm94SCwgX0NPTExJU0lPTl9UWVBFUyRjb252MiwgX0NPTExJU0lPTl9UWVBFUyRzcGhlNiwgX0NPTExJU0lPTl9UWVBFUyRwbGFuMywgX0NPTExJU0lPTl9UWVBFUyRib3hQLCBfQ09MTElTSU9OX1RZUEVTJGNvbnYzLCBfQ09MTElTSU9OX1RZUEVTJGN5bGksIF9DT0xMSVNJT05fVFlQRVMkc3BoZTcsIF9DT0xMSVNJT05fVFlQRVMkcGxhbjQsIF9DT0xMSVNJT05fVFlQRVMkYm94QzIsIF9DT0xMSVNJT05fVFlQRVMkY29udjQsIF9DT0xMSVNJT05fVFlQRVMkaGVpZywgX0NPTExJU0lPTl9UWVBFUyRwYXJ0LCBfQ09MTElTSU9OX1RZUEVTJHNwaGU4LCBfQ09MTElTSU9OX1RZUEVTJHBsYW41OyAvLyBOYW1pbmcgcnVsZTogYmFzZWQgb2YgdGhlIG9yZGVyIGluIFNIQVBFX1RZUEVTLAogIC8vIHRoZSBmaXJzdCBwYXJ0IG9mIHRoZSBtZXRob2QgaXMgZm9ybWVkIGJ5IHRoZQogIC8vIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBiZWZvcmUsIGluIHRoZSBzZWNvbmQgcGFydAogIC8vIHRoZXJlIGlzIHRoZSBzaGFwZSB0eXBlIHRoYXQgY29tZXMgYWZ0ZXIgaW4gdGhlIFNIQVBFX1RZUEVTIGxpc3QKCgogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZSA9IENPTExJU0lPTl9UWVBFUy5zcGhlcmVTcGhlcmU7CiAgX0NPTExJU0lPTl9UWVBFUyRzcGhlMiA9IENPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZTsKICBfQ09MTElTSU9OX1RZUEVTJGJveEIgPSBDT0xMSVNJT05fVFlQRVMuYm94Qm94OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTMgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQm94OwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbiA9IENPTExJU0lPTl9UWVBFUy5wbGFuZUJveDsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYgPSBDT0xMSVNJT05fVFlQRVMuY29udmV4Q29udmV4OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTQgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4OwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbjIgPSBDT0xMSVNJT05fVFlQRVMucGxhbmVDb252ZXg7CiAgX0NPTExJU0lPTl9UWVBFUyRib3hDID0gQ09MTElTSU9OX1RZUEVTLmJveENvbnZleDsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU1ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkOwogIF9DT0xMSVNJT05fVFlQRVMkYm94SCA9IENPTExJU0lPTl9UWVBFUy5ib3hIZWlnaHRmaWVsZDsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYyID0gQ09MTElTSU9OX1RZUEVTLmNvbnZleEhlaWdodGZpZWxkOwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTYgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlUGFydGljbGU7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuMyA9IENPTExJU0lPTl9UWVBFUy5wbGFuZVBhcnRpY2xlOwogIF9DT0xMSVNJT05fVFlQRVMkYm94UCA9IENPTExJU0lPTl9UWVBFUy5ib3hQYXJ0aWNsZTsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYzID0gQ09MTElTSU9OX1RZUEVTLmNvbnZleFBhcnRpY2xlOwogIF9DT0xMSVNJT05fVFlQRVMkY3lsaSA9IENPTExJU0lPTl9UWVBFUy5jeWxpbmRlckN5bGluZGVyOwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTcgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuNCA9IENPTExJU0lPTl9UWVBFUy5wbGFuZUN5bGluZGVyOwogIF9DT0xMSVNJT05fVFlQRVMkYm94QzIgPSBDT0xMSVNJT05fVFlQRVMuYm94Q3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRjb252NCA9IENPTExJU0lPTl9UWVBFUy5jb252ZXhDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJGhlaWcgPSBDT0xMSVNJT05fVFlQRVMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJHBhcnQgPSBDT0xMSVNJT05fVFlQRVMucGFydGljbGVDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU4ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2g7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuNSA9IENPTExJU0lPTl9UWVBFUy5wbGFuZVRyaW1lc2g7CiAgLyoqCiAgICogSGVscGVyIGNsYXNzIGZvciB0aGUgV29ybGQuIEdlbmVyYXRlcyBDb250YWN0RXF1YXRpb25zLgogICAqIEB0b2RvIFNwaGVyZS1Db252ZXhQb2x5aGVkcm9uIGNvbnRhY3RzCiAgICogQHRvZG8gQ29udGFjdCByZWR1Y3Rpb24KICAgKiBAdG9kbyBzaG91bGQgbW92ZSBtZXRob2RzIHRvIHByb3RvdHlwZQogICAqLwoKICBjbGFzcyBOYXJyb3dwaGFzZSB7CiAgICAvKioKICAgICAqIEludGVybmFsIHN0b3JhZ2Ugb2YgcG9vbGVkIGNvbnRhY3QgcG9pbnRzLgogICAgICovCgogICAgLyoqCiAgICAgKiBQb29sZWQgdmVjdG9ycy4KICAgICAqLwogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGUyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGxhbmU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGJveEJdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hCb3g7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGUzXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQm94OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRwbGFuXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVCb3g7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnZdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU0XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRwbGFuMl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRib3hDXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlNV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRib3hIXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnYyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU2XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHBsYW4zXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkYm94UF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjb252M10oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjeWxpXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlN10oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGxhbjRdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkYm94QzJdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnY0XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRoZWlnXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGFydF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBhcnRpY2xlQ3lsaW5kZXI7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlVHJpbWVzaDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGxhbjVdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVRyaW1lc2g7CiAgICB9IC8vIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleFRyaW1lc2hdKCkgewogICAgLy8gICByZXR1cm4gdGhpcy5jb252ZXhUcmltZXNoCiAgICAvLyB9CgoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy5yZXN1bHQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSB2b2lkIDA7CiAgICAgIHRoaXMudjNwb29sID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107CiAgICAgIHRoaXMucmVzdWx0ID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBbXTsKICAgICAgdGhpcy52M3Bvb2wgPSBuZXcgVmVjM1Bvb2woKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICB0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgYSBjb250YWN0IG9iamVjdCwgYnkgdXNpbmcgdGhlIGludGVybmFsIHBvb2wgb3IgY3JlYXRpbmcgYSBuZXcgb25lLgogICAgICovCgoKICAgIGNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgb3ZlcnJpZGVTaGFwZUEsIG92ZXJyaWRlU2hhcGVCKSB7CiAgICAgIGxldCBjOwoKICAgICAgaWYgKHRoaXMuY29udGFjdFBvaW50UG9vbC5sZW5ndGgpIHsKICAgICAgICBjID0gdGhpcy5jb250YWN0UG9pbnRQb29sLnBvcCgpOwogICAgICAgIGMuYmkgPSBiaTsKICAgICAgICBjLmJqID0gYmo7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IG5ldyBDb250YWN0RXF1YXRpb24oYmksIGJqKTsKICAgICAgfQoKICAgICAgYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOwogICAgICBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgIGMuc2V0U3Bvb2tQYXJhbXMoY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLCBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLCB0aGlzLndvcmxkLmR0KTsKICAgICAgY29uc3QgbWF0QSA9IHNpLm1hdGVyaWFsIHx8IGJpLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRCID0gc2oubWF0ZXJpYWwgfHwgYmoubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEucmVzdGl0dXRpb24gPj0gMCAmJiBtYXRCLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICBjLnJlc3RpdHV0aW9uID0gbWF0QS5yZXN0aXR1dGlvbiAqIG1hdEIucmVzdGl0dXRpb247CiAgICAgIH0KCiAgICAgIGMuc2kgPSBvdmVycmlkZVNoYXBlQSB8fCBzaTsKICAgICAgYy5zaiA9IG92ZXJyaWRlU2hhcGVCIHx8IHNqOwogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBjcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcXVhdGlvbiwgb3V0QXJyYXkpIHsKICAgICAgY29uc3QgYm9keUEgPSBjb250YWN0RXF1YXRpb24uYmk7CiAgICAgIGNvbnN0IGJvZHlCID0gY29udGFjdEVxdWF0aW9uLmJqOwogICAgICBjb25zdCBzaGFwZUEgPSBjb250YWN0RXF1YXRpb24uc2k7CiAgICAgIGNvbnN0IHNoYXBlQiA9IGNvbnRhY3RFcXVhdGlvbi5zajsKICAgICAgY29uc3Qgd29ybGQgPSB0aGlzLndvcmxkOwogICAgICBjb25zdCBjbSA9IHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbDsgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgbGV0IGZyaWN0aW9uID0gY20uZnJpY3Rpb247CiAgICAgIGNvbnN0IG1hdEEgPSBzaGFwZUEubWF0ZXJpYWwgfHwgYm9keUEubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzaGFwZUIubWF0ZXJpYWwgfHwgYm9keUIubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEuZnJpY3Rpb24gPj0gMCAmJiBtYXRCLmZyaWN0aW9uID49IDApIHsKICAgICAgICBmcmljdGlvbiA9IG1hdEEuZnJpY3Rpb24gKiBtYXRCLmZyaWN0aW9uOwogICAgICB9CgogICAgICBpZiAoZnJpY3Rpb24gPiAwKSB7CiAgICAgICAgLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICBjb25zdCBtdWcgPSBmcmljdGlvbiAqIHdvcmxkLmdyYXZpdHkubGVuZ3RoKCk7CiAgICAgICAgbGV0IHJlZHVjZWRNYXNzID0gYm9keUEuaW52TWFzcyArIGJvZHlCLmludk1hc3M7CgogICAgICAgIGlmIChyZWR1Y2VkTWFzcyA+IDApIHsKICAgICAgICAgIHJlZHVjZWRNYXNzID0gMSAvIHJlZHVjZWRNYXNzOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcG9vbCA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgY29uc3QgYzEgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjb25zdCBjMiA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJvZHlBLCBib2R5QiwgbXVnICogcmVkdWNlZE1hc3MpOwogICAgICAgIGMxLmJpID0gYzIuYmkgPSBib2R5QTsKICAgICAgICBjMS5iaiA9IGMyLmJqID0gYm9keUI7CiAgICAgICAgYzEubWluRm9yY2UgPSBjMi5taW5Gb3JjZSA9IC1tdWcgKiByZWR1Y2VkTWFzczsKICAgICAgICBjMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnICogcmVkdWNlZE1hc3M7IC8vIENvcHkgb3ZlciB0aGUgcmVsYXRpdmUgdmVjdG9ycwoKICAgICAgICBjMS5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzEucmouY29weShjb250YWN0RXF1YXRpb24ucmopOwogICAgICAgIGMyLnJpLmNvcHkoY29udGFjdEVxdWF0aW9uLnJpKTsKICAgICAgICBjMi5yai5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaik7IC8vIENvbnN0cnVjdCB0YW5nZW50cwoKICAgICAgICBjb250YWN0RXF1YXRpb24ubmkudGFuZ2VudHMoYzEudCwgYzIudCk7IC8vIFNldCBzcG9vayBwYXJhbXMKCiAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMi5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgd29ybGQuZHQpOwogICAgICAgIGMxLmVuYWJsZWQgPSBjMi5lbmFibGVkID0gY29udGFjdEVxdWF0aW9uLmVuYWJsZWQ7CiAgICAgICAgb3V0QXJyYXkucHVzaChjMSwgYzIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFRha2UgdGhlIGF2ZXJhZ2UgTiBsYXRlc3QgY29udGFjdCBwb2ludCBvbiB0aGUgcGxhbmUuCiAgICAgKi8KCgogICAgY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cykgewogICAgICAvLyBUaGUgbGFzdCBjb250YWN0RXF1YXRpb24KICAgICAgbGV0IGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxXTsgLy8gQ3JlYXRlIHRoZSByZXN1bHQ6IHR3byAiYXZlcmFnZSIgZnJpY3Rpb24gZXF1YXRpb25zCgogICAgICBpZiAoIXRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjLCB0aGlzLmZyaWN0aW9uUmVzdWx0KSB8fCBudW1Db250YWN0cyA9PT0gMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgZjEgPSB0aGlzLmZyaWN0aW9uUmVzdWx0W3RoaXMuZnJpY3Rpb25SZXN1bHQubGVuZ3RoIC0gMl07CiAgICAgIGNvbnN0IGYyID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDFdOwogICAgICBhdmVyYWdlTm9ybWFsLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEuc2V0WmVybygpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zZXRaZXJvKCk7CiAgICAgIGNvbnN0IGJvZHlBID0gYy5iaTsKICAgICAgYy5iajsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBudW1Db250YWN0czsgaSsrKSB7CiAgICAgICAgYyA9IHRoaXMucmVzdWx0W3RoaXMucmVzdWx0Lmxlbmd0aCAtIDEgLSBpXTsKCiAgICAgICAgaWYgKGMuYmkgIT09IGJvZHlBKSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZhZGQoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaiwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZzdWIoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaSwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgaW52TnVtQ29udGFjdHMgPSAxIC8gbnVtQ29udGFjdHM7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaSk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaik7CiAgICAgIGYyLnJpLmNvcHkoZjEucmkpOyAvLyBTaG91bGQgYmUgdGhlIHNhbWUKCiAgICAgIGYyLnJqLmNvcHkoZjEucmopOwogICAgICBhdmVyYWdlTm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBhdmVyYWdlTm9ybWFsLnRhbmdlbnRzKGYxLnQsIGYyLnQpOyAvLyByZXR1cm4gZXE7CiAgICB9CiAgICAvKioKICAgICAqIEdlbmVyYXRlIGFsbCBjb250YWN0cyBiZXR3ZWVuIGEgbGlzdCBvZiBib2R5IHBhaXJzCiAgICAgKiBAcGFyYW0gcDEgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcDIgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFycmF5IHRvIHN0b3JlIGdlbmVyYXRlZCBjb250YWN0cwogICAgICogQHBhcmFtIG9sZGNvbnRhY3RzIE9wdGlvbmFsLiBBcnJheSBvZiByZXVzYWJsZSBjb250YWN0IG9iamVjdHMKICAgICAqLwoKCiAgICBnZXRDb250YWN0cyhwMSwgcDIsIHdvcmxkLCByZXN1bHQsIG9sZGNvbnRhY3RzLCBmcmljdGlvblJlc3VsdCwgZnJpY3Rpb25Qb29sKSB7CiAgICAgIC8vIFNhdmUgb2xkIGNvbnRhY3Qgb2JqZWN0cwogICAgICB0aGlzLmNvbnRhY3RQb2ludFBvb2wgPSBvbGRjb250YWN0czsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IGZyaWN0aW9uUG9vbDsKICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBmcmljdGlvblJlc3VsdDsKICAgICAgY29uc3QgcWkgPSB0bXBRdWF0MTsKICAgICAgY29uc3QgcWogPSB0bXBRdWF0MjsKICAgICAgY29uc3QgeGkgPSB0bXBWZWMxOwogICAgICBjb25zdCB4aiA9IHRtcFZlYzI7CgogICAgICBmb3IgKGxldCBrID0gMCwgTiA9IHAxLmxlbmd0aDsgayAhPT0gTjsgaysrKSB7CiAgICAgICAgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGJvZGllcwogICAgICAgIGNvbnN0IGJpID0gcDFba107CiAgICAgICAgY29uc3QgYmogPSBwMltrXTsgLy8gR2V0IGNvbnRhY3QgbWF0ZXJpYWwKCiAgICAgICAgbGV0IGJvZHlDb250YWN0TWF0ZXJpYWwgPSBudWxsOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGJvZHlDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCBudWxsOwogICAgICAgIH0KCiAgICAgICAgY29uc3QganVzdFRlc3QgPSBiaS50eXBlICYgQm9keS5LSU5FTUFUSUMgJiYgYmoudHlwZSAmIEJvZHkuU1RBVElDIHx8IGJpLnR5cGUgJiBCb2R5LlNUQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUMgfHwgYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LktJTkVNQVRJQzsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaS5zaGFwZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJpLnF1YXRlcm5pb24ubXVsdChiaS5zaGFwZU9yaWVudGF0aW9uc1tpXSwgcWkpOwogICAgICAgICAgYmkucXVhdGVybmlvbi52bXVsdChiaS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICAgIHhpLnZhZGQoYmkucG9zaXRpb24sIHhpKTsKICAgICAgICAgIGNvbnN0IHNpID0gYmkuc2hhcGVzW2ldOwoKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmouc2hhcGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIC8vIENvbXB1dGUgd29ybGQgdHJhbnNmb3JtIG9mIHNoYXBlcwogICAgICAgICAgICBiai5xdWF0ZXJuaW9uLm11bHQoYmouc2hhcGVPcmllbnRhdGlvbnNbal0sIHFqKTsKICAgICAgICAgICAgYmoucXVhdGVybmlvbi52bXVsdChiai5zaGFwZU9mZnNldHNbal0sIHhqKTsKICAgICAgICAgICAgeGoudmFkZChiai5wb3NpdGlvbiwgeGopOwogICAgICAgICAgICBjb25zdCBzaiA9IGJqLnNoYXBlc1tqXTsKCiAgICAgICAgICAgIGlmICghKHNpLmNvbGxpc2lvbkZpbHRlck1hc2sgJiBzai5jb2xsaXNpb25GaWx0ZXJHcm91cCAmJiBzai5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2kuY29sbGlzaW9uRmlsdGVyR3JvdXApKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSAvLyBHZXQgY29sbGlzaW9uIG1hdGVyaWFsCgoKICAgICAgICAgICAgbGV0IHNoYXBlQ29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChzaS5tYXRlcmlhbCAmJiBzai5tYXRlcmlhbCkgewogICAgICAgICAgICAgIHNoYXBlQ29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKHNpLm1hdGVyaWFsLCBzai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsID0gc2hhcGVDb250YWN0TWF0ZXJpYWwgfHwgYm9keUNvbnRhY3RNYXRlcmlhbCB8fCB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOyAvLyBHZXQgY29udGFjdHMKCiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVySW5kZXggPSBzaS50eXBlIHwgc2oudHlwZTsKICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXIgPSB0aGlzW3Jlc29sdmVySW5kZXhdOwoKICAgICAgICAgICAgaWYgKHJlc29sdmVyKSB7CiAgICAgICAgICAgICAgbGV0IHJldHZhbCA9IGZhbHNlOyAvLyBUTyBETzogaW52ZXN0aWdhdGUgd2h5IHNwaGVyZVBhcnRpY2xlIGFuZCBjb252ZXhQYXJ0aWNsZQogICAgICAgICAgICAgIC8vIHJlc29sdmVycyBleHBlY3Qgc2kgYW5kIHNqIHNoYXBlcyB0byBiZSBpbiByZXZlcnNlIG9yZGVyCiAgICAgICAgICAgICAgLy8gKGkuZS4gbGFyZ2VyIGludGVnZXIgdmFsdWUgdHlwZSBmaXJzdCBpbnN0ZWFkIG9mIHNtYWxsZXIgZmlyc3QpCgogICAgICAgICAgICAgIGlmIChzaS50eXBlIDwgc2oudHlwZSkgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR2YWwgPSByZXNvbHZlci5jYWxsKHRoaXMsIHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocmV0dmFsICYmIGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICAvLyBSZWdpc3RlciBvdmVybGFwCiAgICAgICAgICAgICAgICB3b3JsZC5zaGFwZU92ZXJsYXBLZWVwZXIuc2V0KHNpLmlkLCBzai5pZCk7CiAgICAgICAgICAgICAgICB3b3JsZC5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVTcGhlcmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgcmV0dXJuIHhpLmRpc3RhbmNlU3F1YXJlZCh4aikgPCAoc2kucmFkaXVzICsgc2oucmFkaXVzKSAqKiAyOwogICAgICB9IC8vIFdlIHdpbGwgaGF2ZSBvbmx5IG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQoKCiAgICAgIGNvbnN0IGNvbnRhY3RFcSA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICB4ai52c3ViKHhpLCBjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEubmkubm9ybWFsaXplKCk7IC8vIENvbnRhY3QgcG9pbnQgbG9jYXRpb25zCgogICAgICBjb250YWN0RXEucmkuY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmouY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmkuc2NhbGUoc2kucmFkaXVzLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmouc2NhbGUoLXNqLnJhZGl1cywgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJpLnZhZGQoeGksIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yaS52c3ViKGJpLnBvc2l0aW9uLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmoudmFkZCh4aiwgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJqLnZzdWIoYmoucG9zaXRpb24sIGNvbnRhY3RFcS5yaik7CiAgICAgIHRoaXMucmVzdWx0LnB1c2goY29udGFjdEVxKTsKICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcSwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICB9CgogICAgc3BoZXJlUGxhbmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gV2Ugd2lsbCBoYXZlIG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQogICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgIHIubmkuc2V0KDAsIDAsIDEpOwogICAgICBxai52bXVsdChyLm5pLCByLm5pKTsKICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIGJvZHkgaSBpcyB0aGUgc3BoZXJlLCBmbGlwIG5vcm1hbAoKICAgICAgci5uaS5ub3JtYWxpemUoKTsgLy8gTmVlZGVkPwogICAgICAvLyBWZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QgcG9pbnQKCiAgICAgIHIubmkuc2NhbGUoc2kucmFkaXVzLCByLnJpKTsgLy8gUHJvamVjdCBkb3duIHNwaGVyZSBvbiBwbGFuZQoKICAgICAgeGkudnN1Yih4aiwgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKTsKICAgICAgci5uaS5zY2FsZShyLm5pLmRvdChwb2ludF9vbl9wbGFuZV90b19zcGhlcmUpLCBwbGFuZV90b19zcGhlcmVfb3J0aG8pOwogICAgICBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUudnN1YihwbGFuZV90b19zcGhlcmVfb3J0aG8sIHIucmopOyAvLyBUaGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byBwbGFuZQoKICAgICAgaWYgKC1wb2ludF9vbl9wbGFuZV90b19zcGhlcmUuZG90KHIubmkpIDw9IHNpLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgoKICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveEJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4KHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7IC8vIHdlIHJlZmVyIHRvIHRoZSBib3ggYXMgYm9keSBqCgogICAgICBjb25zdCBzaWRlcyA9IHNwaGVyZUJveF9zaWRlczsKICAgICAgeGkudnN1Yih4aiwgYm94X3RvX3NwaGVyZSk7CiAgICAgIHNqLmdldFNpZGVOb3JtYWxzKHNpZGVzLCBxaik7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBTdG9yZSB0aGUgcmVzdWx0aW5nIHNpZGUgcGVuZXRyYXRpb24gaW5mbwoKICAgICAgY29uc3Qgc2lkZV9ucyA9IHNwaGVyZUJveF9zaWRlX25zOwogICAgICBjb25zdCBzaWRlX25zMSA9IHNwaGVyZUJveF9zaWRlX25zMTsKICAgICAgY29uc3Qgc2lkZV9uczIgPSBzcGhlcmVCb3hfc2lkZV9uczI7CiAgICAgIGxldCBzaWRlX2ggPSBudWxsOwogICAgICBsZXQgc2lkZV9wZW5ldHJhdGlvbnMgPSAwOwogICAgICBsZXQgc2lkZV9kb3QxID0gMDsKICAgICAgbGV0IHNpZGVfZG90MiA9IDA7CiAgICAgIGxldCBzaWRlX2Rpc3RhbmNlID0gbnVsbDsKCiAgICAgIGZvciAobGV0IGlkeCA9IDAsIG5zaWRlcyA9IHNpZGVzLmxlbmd0aDsgaWR4ICE9PSBuc2lkZXMgJiYgZm91bmQgPT09IGZhbHNlOyBpZHgrKykgewogICAgICAgIC8vIEdldCB0aGUgcGxhbmUgc2lkZSBub3JtYWwgKG5zKQogICAgICAgIGNvbnN0IG5zID0gc3BoZXJlQm94X25zOwogICAgICAgIG5zLmNvcHkoc2lkZXNbaWR4XSk7CiAgICAgICAgY29uc3QgaCA9IG5zLmxlbmd0aCgpOwogICAgICAgIG5zLm5vcm1hbGl6ZSgpOyAvLyBUaGUgbm9ybWFsL2Rpc3RhbmNlIGRvdCBwcm9kdWN0IHRlbGxzIHdoaWNoIHNpZGUgb2YgdGhlIHBsYW5lIHdlIGFyZQoKICAgICAgICBjb25zdCBkb3QgPSBib3hfdG9fc3BoZXJlLmRvdChucyk7CgogICAgICAgIGlmIChkb3QgPCBoICsgUiAmJiBkb3QgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgdGhlIG90aGVyIHR3byBkaW1lbnNpb25zCiAgICAgICAgICBjb25zdCBuczEgPSBzcGhlcmVCb3hfbnMxOwogICAgICAgICAgY29uc3QgbnMyID0gc3BoZXJlQm94X25zMjsKICAgICAgICAgIG5zMS5jb3B5KHNpZGVzWyhpZHggKyAxKSAlIDNdKTsKICAgICAgICAgIG5zMi5jb3B5KHNpZGVzWyhpZHggKyAyKSAlIDNdKTsKICAgICAgICAgIGNvbnN0IGgxID0gbnMxLmxlbmd0aCgpOwogICAgICAgICAgY29uc3QgaDIgPSBuczIubGVuZ3RoKCk7CiAgICAgICAgICBuczEubm9ybWFsaXplKCk7CiAgICAgICAgICBuczIubm9ybWFsaXplKCk7CiAgICAgICAgICBjb25zdCBkb3QxID0gYm94X3RvX3NwaGVyZS5kb3QobnMxKTsKICAgICAgICAgIGNvbnN0IGRvdDIgPSBib3hfdG9fc3BoZXJlLmRvdChuczIpOwoKICAgICAgICAgIGlmIChkb3QxIDwgaDEgJiYgZG90MSA+IC1oMSAmJiBkb3QyIDwgaDIgJiYgZG90MiA+IC1oMikgewogICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5hYnMoZG90IC0gaCAtIFIpOwoKICAgICAgICAgICAgaWYgKHNpZGVfZGlzdGFuY2UgPT09IG51bGwgfHwgZGlzdCA8IHNpZGVfZGlzdGFuY2UpIHsKICAgICAgICAgICAgICBzaWRlX2Rpc3RhbmNlID0gZGlzdDsKICAgICAgICAgICAgICBzaWRlX2RvdDEgPSBkb3QxOwogICAgICAgICAgICAgIHNpZGVfZG90MiA9IGRvdDI7CiAgICAgICAgICAgICAgc2lkZV9oID0gaDsKICAgICAgICAgICAgICBzaWRlX25zLmNvcHkobnMpOwogICAgICAgICAgICAgIHNpZGVfbnMxLmNvcHkobnMxKTsKICAgICAgICAgICAgICBzaWRlX25zMi5jb3B5KG5zMik7CiAgICAgICAgICAgICAgc2lkZV9wZW5ldHJhdGlvbnMrKzsKCiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzaWRlX3BlbmV0cmF0aW9ucykgewogICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBzaWRlX25zLnNjYWxlKC1SLCByLnJpKTsgLy8gU3BoZXJlIHIKCiAgICAgICAgci5uaS5jb3B5KHNpZGVfbnMpOwogICAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBOb3JtYWwgc2hvdWxkIGJlIG91dCBvZiBzcGhlcmUKCiAgICAgICAgc2lkZV9ucy5zY2FsZShzaWRlX2gsIHNpZGVfbnMpOwogICAgICAgIHNpZGVfbnMxLnNjYWxlKHNpZGVfZG90MSwgc2lkZV9uczEpOwogICAgICAgIHNpZGVfbnMudmFkZChzaWRlX25zMSwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczIuc2NhbGUoc2lkZV9kb3QyLCBzaWRlX25zMik7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMyLCByLnJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfSAvLyBDaGVjayBjb3JuZXJzCgoKICAgICAgbGV0IHJqID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXI7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gMiAmJiAhZm91bmQ7IGorKykgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSAyICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBmb3IgKGxldCBsID0gMDsgbCAhPT0gMiAmJiAhZm91bmQ7IGwrKykgewogICAgICAgICAgICByai5zZXQoMCwgMCwgMCk7CgogICAgICAgICAgICBpZiAoaikgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzBdLCByaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChrKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMV0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGwpIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1syXSwgcmopOwogICAgICAgICAgICB9IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKCiAgICAgICAgICAgIHhqLnZhZGQocmosIHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICBzcGhlcmVfdG9fY29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICAgICAgaWYgKHNwaGVyZV90b19jb3JuZXIubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIHIucmkuY29weShzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgICAgICByLnJpLnNjYWxlKFIsIHIucmkpOwogICAgICAgICAgICAgIHIucmouY29weShyaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHYzcG9vbC5yZWxlYXNlKHJqKTsKICAgICAgcmogPSBudWxsOyAvLyBDaGVjayBlZGdlcwoKICAgICAgY29uc3QgZWRnZVRhbmdlbnQgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGVkZ2VDZW50ZXIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHIgPSB2M3Bvb2wuZ2V0KCk7IC8vIHIgPSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyCgogICAgICBjb25zdCBvcnRob2dvbmFsID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBkaXN0ID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBOc2lkZXMgPSBzaWRlcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTnNpZGVzICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5zaWRlcyAmJiAhZm91bmQ7IGsrKykgewogICAgICAgICAgaWYgKGogJSAzICE9PSBrICUgMykgewogICAgICAgICAgICAvLyBHZXQgZWRnZSB0YW5nZW50CiAgICAgICAgICAgIHNpZGVzW2tdLmNyb3NzKHNpZGVzW2pdLCBlZGdlVGFuZ2VudCk7CiAgICAgICAgICAgIGVkZ2VUYW5nZW50Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBzaWRlc1tqXS52YWRkKHNpZGVzW2tdLCBlZGdlQ2VudGVyKTsKICAgICAgICAgICAgci5jb3B5KHhpKTsKICAgICAgICAgICAgci52c3ViKGVkZ2VDZW50ZXIsIHIpOwogICAgICAgICAgICByLnZzdWIoeGosIHIpOwogICAgICAgICAgICBjb25zdCBvcnRob25vcm0gPSByLmRvdChlZGdlVGFuZ2VudCk7IC8vIGRpc3RhbmNlIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KCiAgICAgICAgICAgIGVkZ2VUYW5nZW50LnNjYWxlKG9ydGhvbm9ybSwgb3J0aG9nb25hbCk7IC8vIFZlY3RvciBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIgaW4gdGhlIHRhbmdlbnQgZGlyZWN0aW9uCiAgICAgICAgICAgIC8vIEZpbmQgdGhlIHRoaXJkIHNpZGUgb3J0aG9nb25hbCB0byB0aGlzIG9uZQoKICAgICAgICAgICAgbGV0IGwgPSAwOwoKICAgICAgICAgICAgd2hpbGUgKGwgPT09IGogJSAzIHx8IGwgPT09IGsgJSAzKSB7CiAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICB9IC8vIHZlYyBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBwcm9qZWN0ZWQgdG8gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gdGhlIGVkZ2UgdGFuZ2VudAoKCiAgICAgICAgICAgIGRpc3QuY29weSh4aSk7CiAgICAgICAgICAgIGRpc3QudnN1YihvcnRob2dvbmFsLCBkaXN0KTsKICAgICAgICAgICAgZGlzdC52c3ViKGVkZ2VDZW50ZXIsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoeGosIGRpc3QpOyAvLyBEaXN0YW5jZXMgaW4gdGFuZ2VudCBkaXJlY3Rpb24gYW5kIGRpc3RhbmNlIGluIHRoZSBwbGFuZSBvcnRob2dvbmFsIHRvIGl0CgogICAgICAgICAgICBjb25zdCB0ZGlzdCA9IE1hdGguYWJzKG9ydGhvbm9ybSk7CiAgICAgICAgICAgIGNvbnN0IG5kaXN0ID0gZGlzdC5sZW5ndGgoKTsKCiAgICAgICAgICAgIGlmICh0ZGlzdCA8IHNpZGVzW2xdLmxlbmd0aCgpICYmIG5kaXN0IDwgUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgcmVzID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICBlZGdlQ2VudGVyLnZhZGQob3J0aG9nb25hbCwgcmVzLnJqKTsgLy8gYm94IHJqCgogICAgICAgICAgICAgIHJlcy5yai5jb3B5KHJlcy5yaik7CiAgICAgICAgICAgICAgZGlzdC5uZWdhdGUocmVzLm5pKTsKICAgICAgICAgICAgICByZXMubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICByZXMucmkudmFkZCh4aiwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkudnN1Yih4aSwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLnNjYWxlKFIsIHJlcy5yaSk7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKGJpLnBvc2l0aW9uLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yai52YWRkKHhqLCByZXMucmopOwogICAgICAgICAgICAgIHJlcy5yai52c3ViKGJqLnBvc2l0aW9uLCByZXMucmopOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocmVzKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QocmVzLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UoZWRnZVRhbmdlbnQsIGVkZ2VDZW50ZXIsIHIsIG9ydGhvZ29uYWwsIGRpc3QpOwogICAgfQoKICAgIHBsYW5lQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmlkID0gc2ouaWQ7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4KHNpLCBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCwgZmFjZUxpc3RBLCBmYWNlTGlzdEIpIHsKICAgICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwoKICAgICAgaWYgKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHNpLmZpbmRTZXBhcmF0aW5nQXhpcyhzaiwgeGksIHFpLCB4aiwgcWosIHNlcEF4aXMsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSkgewogICAgICAgIGNvbnN0IHJlcyA9IFtdOwogICAgICAgIGNvbnN0IHEgPSBjb252ZXhDb252ZXhfcTsKICAgICAgICBzaS5jbGlwQWdhaW5zdEh1bGwoeGksIHFpLCBzaiwgeGosIHFqLCBzZXBBeGlzLCAtMTAwLCAxMDAsIHJlcyk7CiAgICAgICAgbGV0IG51bUNvbnRhY3RzID0gMDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHJlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgICAgc2VwQXhpcy5uZWdhdGUoci5uaSk7CiAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgICAgICAgIHEuc2NhbGUocmVzW2pdLmRlcHRoLCBxKTsKICAgICAgICAgIHJlc1tqXS5wb2ludC52YWRkKHEsIHJpKTsKICAgICAgICAgIHJqLmNvcHkocmVzW2pdLnBvaW50KTsgLy8gQ29udGFjdCBwb2ludHMgYXJlIGluIHdvcmxkIGNvb3JkaW5hdGVzLiBUcmFuc2Zvcm0gYmFjayB0byByZWxhdGl2ZQoKICAgICAgICAgIHJpLnZzdWIoeGksIHJpKTsKICAgICAgICAgIHJqLnZzdWIoeGosIHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgbnVtQ29udGFjdHMrKzsKCiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gJiYgbnVtQ29udGFjdHMpIHsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlQ29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOwogICAgICB4aS52c3ViKHhqLCBjb252ZXhfdG9fc3BoZXJlKTsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNqLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBmYWNlcyA9IHNqLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0cyA9IHNqLnZlcnRpY2VzOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOyAvLyAgICAgcmV0dXJuOwogICAgICAvLyB9CgogICAgICBsZXQgZm91bmQgPSBmYWxzZTsgLy8gQ2hlY2sgY29ybmVycwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHZlcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOyAvLyBXb3JsZCBwb3NpdGlvbiBvZiBjb3JuZXIKCiAgICAgICAgY29uc3Qgd29ybGRDb3JuZXIgPSBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXI7CiAgICAgICAgcWoudm11bHQodiwgd29ybGRDb3JuZXIpOwogICAgICAgIHhqLnZhZGQod29ybGRDb3JuZXIsIHdvcmxkQ29ybmVyKTsKICAgICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyOwogICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgci5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICB3b3JsZENvcm5lci52c3ViKHhqLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSAvLyBDaGVjayBzaWRlIChwbGFuZSkgaW50ZXJzZWN0aW9ucwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBmYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGkrKykgewogICAgICAgIGNvbnN0IG5vcm1hbCA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ldOyAvLyBHZXQgd29ybGQtdHJhbnNmb3JtZWQgbm9ybWFsIG9mIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gc3BoZXJlQ29udmV4X3dvcmxkTm9ybWFsOwogICAgICAgIHFqLnZtdWx0KG5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBHZXQgYSB3b3JsZCB2ZXJ0ZXggZnJvbSB0aGUgZmFjZQoKICAgICAgICBjb25zdCB3b3JsZFBvaW50ID0gc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQ7CiAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVswXV0sIHdvcmxkUG9pbnQpOwogICAgICAgIHdvcmxkUG9pbnQudmFkZCh4aiwgd29ybGRQb2ludCk7IC8vIEdldCBhIHBvaW50IG9uIHRoZSBzcGhlcmUsIGNsb3Nlc3QgdG8gdGhlIGZhY2Ugbm9ybWFsCgogICAgICAgIGNvbnN0IHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSA9IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmU7CiAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7CiAgICAgICAgeGkudmFkZCh3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7IC8vIFZlY3RvciBmcm9tIGEgZmFjZSBwb2ludCB0byB0aGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgc3BoZXJlCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gc3BoZXJlQ29udmV4X3BlbmV0cmF0aW9uVmVjOwogICAgICAgIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZS52c3ViKHdvcmxkUG9pbnQsIHBlbmV0cmF0aW9uVmVjKTsgLy8gVGhlIHBlbmV0cmF0aW9uLiBOZWdhdGl2ZSB2YWx1ZSBtZWFucyBvdmVybGFwLgoKICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IHBlbmV0cmF0aW9uVmVjLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3Qgd29ybGRQb2ludFRvU3BoZXJlID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludDsKICAgICAgICB4aS52c3ViKHdvcmxkUG9pbnQsIHdvcmxkUG9pbnRUb1NwaGVyZSk7CgogICAgICAgIGlmIChwZW5ldHJhdGlvbiA8IDAgJiYgd29ybGRQb2ludFRvU3BoZXJlLmRvdCh3b3JsZE5vcm1hbCkgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgaWYgdGhlIHNwaGVyZSBpcyBpbnNpZGUgdGhlIGZhY2UgcG9seWdvbgogICAgICAgICAgY29uc3QgZmFjZVZlcnRzID0gW107IC8vIEZhY2UgdmVydGljZXMsIGluIHdvcmxkIGNvb3JkcwoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOdmVydHMgPSBmYWNlLmxlbmd0aDsgaiAhPT0gTnZlcnRzOyBqKyspIHsKICAgICAgICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2Vbal1dLCB3b3JsZFZlcnRleCk7CiAgICAgICAgICAgIHhqLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgZmFjZVZlcnRzLnB1c2god29ybGRWZXJ0ZXgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwb2ludEluUG9seWdvbihmYWNlVmVydHMsIHdvcmxkTm9ybWFsLCB4aSkpIHsKICAgICAgICAgICAgLy8gSXMgdGhlIHNwaGVyZSBjZW50ZXIgaW4gdGhlIGZhY2UgcG9seWdvbj8KICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCByLnJpKTsgLy8gQ29udGFjdCBvZmZzZXQsIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0CgogICAgICAgICAgICB3b3JsZE5vcm1hbC5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBwb2ludGluZyBvdXQgb2Ygc3BoZXJlCgogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblZlYzIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1wZW5ldHJhdGlvbiwgcGVuZXRyYXRpb25WZWMyKTsKICAgICAgICAgICAgY29uc3QgcGVuZXRyYXRpb25TcGhlcmVQb2ludCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOyAvL3hpLnZzdWIoeGopLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCkudmFkZChwZW5ldHJhdGlvblZlYzIgLCByLnJqKTsKCiAgICAgICAgICAgIHhpLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblZlYzIsIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblNwaGVyZVBvaW50KTsKICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOyAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgogICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsgLy8gV2Ugb25seSBleHBlY3QgKm9uZSogZmFjZSBjb250YWN0CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBFZGdlPwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZmFjZS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIC8vIEdldCB0d28gd29ybGQgdHJhbnNmb3JtZWQgdmVydGljZXMKICAgICAgICAgICAgICBjb25zdCB2MSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMSkgJSBmYWNlLmxlbmd0aF1dLCB2MSk7CiAgICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVsoaiArIDIpICUgZmFjZS5sZW5ndGhdXSwgdjIpOwogICAgICAgICAgICAgIHhqLnZhZGQodjEsIHYxKTsKICAgICAgICAgICAgICB4ai52YWRkKHYyLCB2Mik7IC8vIENvbnN0cnVjdCBlZGdlIHZlY3RvcgoKICAgICAgICAgICAgICBjb25zdCBlZGdlID0gc3BoZXJlQ29udmV4X2VkZ2U7CiAgICAgICAgICAgICAgdjIudnN1Yih2MSwgZWRnZSk7IC8vIENvbnN0cnVjdCB0aGUgc2FtZSB2ZWN0b3IsIGJ1dCBub3JtYWxpemVkCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2VVbml0ID0gc3BoZXJlQ29udmV4X2VkZ2VVbml0OwogICAgICAgICAgICAgIGVkZ2UudW5pdChlZGdlVW5pdCk7IC8vIHAgaXMgeGkgcHJvamVjdGVkIG9udG8gdGhlIGVkZ2UKCiAgICAgICAgICAgICAgY29uc3QgcCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MV90b194aSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICB4aS52c3ViKHYxLCB2MV90b194aSk7CiAgICAgICAgICAgICAgY29uc3QgZG90ID0gdjFfdG9feGkuZG90KGVkZ2VVbml0KTsKICAgICAgICAgICAgICBlZGdlVW5pdC5zY2FsZShkb3QsIHApOwogICAgICAgICAgICAgIHAudmFkZCh2MSwgcCk7IC8vIENvbXB1dGUgYSB2ZWN0b3IgZnJvbSBwIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHNwaGVyZQoKICAgICAgICAgICAgICBjb25zdCB4aV90b19wID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHAudnN1Yih4aSwgeGlfdG9fcCk7IC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAvLyBBTkQgaWYgcCBpcyBpbiBiZXR3ZWVuIHYxIGFuZCB2MgoKICAgICAgICAgICAgICBpZiAoZG90ID4gMCAmJiBkb3QgKiBkb3QgPCBlZGdlLmxlbmd0aFNxdWFyZWQoKSAmJiB4aV90b19wLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICAgICAgICAvLyBDb2xsaXNpb24gaWYgdGhlIGVkZ2Utc3BoZXJlIGRpc3RhbmNlIGlzIGxlc3MgdGhhbiB0aGUgcmFkaXVzCiAgICAgICAgICAgICAgICAvLyBFZGdlIGNvbnRhY3QhCiAgICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICAgICAgcC52c3ViKHhpLCByLm5pKTsKICAgICAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICByLm5pLnNjYWxlKFIsIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYyKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MV90b194aSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MSk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHhpX3RvX3ApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcGxhbmVDb252ZXgocGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHBsYW5lUG9zaXRpb24sIGNvbnZleFBvc2l0aW9uLCBwbGFuZVF1YXQsIGNvbnZleFF1YXQsIHBsYW5lQm9keSwgY29udmV4Qm9keSwgc2ksIHNqLCBqdXN0VGVzdCkgewogICAgICAvLyBTaW1wbHkgcmV0dXJuIHRoZSBwb2ludHMgYmVoaW5kIHRoZSBwbGFuZS4KICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSBwbGFuZUNvbnZleF92OwogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IHBsYW5lQ29udmV4X25vcm1hbDsKICAgICAgd29ybGROb3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwbGFuZVF1YXQudm11bHQod29ybGROb3JtYWwsIHdvcmxkTm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lIG9yaWVudGF0aW9uCgogICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwogICAgICBjb25zdCByZWxwb3MgPSBwbGFuZUNvbnZleF9yZWxwb3M7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gY29udmV4U2hhcGUudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgY29udmV4IHZlcnRleAogICAgICAgIHdvcmxkVmVydGV4LmNvcHkoY29udmV4U2hhcGUudmVydGljZXNbaV0pOwogICAgICAgIGNvbnZleFF1YXQudm11bHQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICBjb252ZXhQb3NpdGlvbi52YWRkKHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgd29ybGRWZXJ0ZXgudnN1YihwbGFuZVBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihwbGFuZUJvZHksIGNvbnZleEJvZHksIHBsYW5lU2hhcGUsIGNvbnZleFNoYXBlLCBzaSwgc2opOyAvLyBHZXQgdmVydGV4IHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBsYW5lQ29udmV4X3Byb2plY3RlZDsKICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpLCBwcm9qZWN0ZWQpOwogICAgICAgICAgd29ybGRWZXJ0ZXgudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7CiAgICAgICAgICBwcm9qZWN0ZWQudnN1YihwbGFuZVBvc2l0aW9uLCByLnJpKTsgLy8gRnJvbSBwbGFuZSB0byB2ZXJ0ZXggcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgci5uaS5jb3B5KHdvcmxkTm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbCBvdXQgZnJvbSBwbGFuZQogICAgICAgICAgLy8gcmogaXMgbm93IGp1c3QgdGhlIHZlY3RvciBmcm9tIHRoZSBjb252ZXggY2VudGVyIHRvIHRoZSB2ZXJ0ZXgKCiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKGNvbnZleFBvc2l0aW9uLCByLnJqKTsgLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKICAgICAgICAgIHIucmkudmFkZChwbGFuZVBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai52YWRkKGNvbnZleFBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihjb252ZXhCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgIH0KICAgIH0KCiAgICBib3hDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXgoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlSGVpZ2h0ZmllbGQoc3BoZXJlU2hhcGUsIGhmU2hhcGUsIHNwaGVyZVBvcywgaGZQb3MsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgcmFkaXVzID0gc3BoZXJlU2hhcGUucmFkaXVzOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAyOyAvLyBHZXQgc3BoZXJlIHBvc2l0aW9uIHRvIGhlaWdodGZpZWxkIGxvY2FsIQoKICAgICAgY29uc3QgbG9jYWxTcGhlcmVQb3MgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAxOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUoaGZQb3MsIGhmUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgbGV0IGlNaW5YID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueCAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WCA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueCArIHJhZGl1cykgLyB3KSArIDE7CiAgICAgIGxldCBpTWluWSA9IE1hdGguZmxvb3IoKGxvY2FsU3BoZXJlUG9zLnkgLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFkgPSBNYXRoLmNlaWwoKGxvY2FsU3BoZXJlUG9zLnkgKyByYWRpdXMpIC8gdykgKyAxOyAvLyBCYWlsIG91dCBpZiB3ZSBhcmUgb3V0IG9mIHRoZSB0ZXJyYWluCgogICAgICBpZiAoaU1heFggPCAwIHx8IGlNYXhZIDwgMCB8fCBpTWluWCA+IGRhdGEubGVuZ3RoIHx8IGlNaW5ZID4gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2xhbXAgaW5kZXggdG8gZWRnZXMKCgogICAgICBpZiAoaU1pblggPCAwKSB7CiAgICAgICAgaU1pblggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFggPCAwKSB7CiAgICAgICAgaU1heFggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPCAwKSB7CiAgICAgICAgaU1pblkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPCAwKSB7CiAgICAgICAgaU1heFkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWluWCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1heFggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNYXhZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWluWSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgY29uc3QgbWluTWF4ID0gW107CiAgICAgIGhmU2hhcGUuZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgbWluTWF4KTsKICAgICAgY29uc3QgbWluID0gbWluTWF4WzBdOwogICAgICBjb25zdCBtYXggPSBtaW5NYXhbMV07IC8vIEJhaWwgb3V0IGlmIHdlIGNhbid0IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxTcGhlcmVQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbFNwaGVyZVBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBudW1Db250YWN0c0JlZm9yZSA9IHJlc3VsdC5sZW5ndGg7CiAgICAgICAgICBsZXQgaW50ZXJzZWN0aW5nID0gZmFsc2U7IC8vIExvd2VyIHRyaWFuZ2xlCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgbnVtQ29udGFjdHMgPSByZXN1bHQubGVuZ3RoIC0gbnVtQ29udGFjdHNCZWZvcmU7CgogICAgICAgICAgaWYgKG51bUNvbnRhY3RzID4gMikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICAvKgogICAgICAgICAgICAvLyBTa2lwIGFsbCBidXQgMQogICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IG51bUNvbnRhY3RzIC0gMTsgaysrKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICovCgogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGJveEhlaWdodGZpZWxkKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4SGVpZ2h0ZmllbGQoY29udmV4U2hhcGUsIGhmU2hhcGUsIGNvbnZleFBvcywgaGZQb3MsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgdyA9IGhmU2hhcGUuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IHJhZGl1cyA9IGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDI7CiAgICAgIGNvbnN0IGZhY2VMaXN0ID0gY29udmV4SGVpZ2h0ZmllbGRfZmFjZUxpc3Q7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbENvbnZleFBvcyA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBjb252ZXhQb3MsIGxvY2FsQ29udmV4UG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxDb252ZXhQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxDb252ZXhQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UncmUgY2FudCB0b3VjaCB0aGUgYm91bmRpbmcgaGVpZ2h0IGJveAoKICAgICAgaWYgKGxvY2FsQ29udmV4UG9zLnogLSByYWRpdXMgPiBtYXggfHwgbG9jYWxDb252ZXhQb3MueiArIHJhZGl1cyA8IG1pbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBUaGUgbm9ybWFsIGlzIHRoZSB1bml0IHZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gcGFydGljbGUgY2VudGVyCiAgICAgIGNvbnN0IG5vcm1hbCA9IHBhcnRpY2xlU3BoZXJlX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgeGkudnN1Yih4aiwgbm9ybWFsKTsKICAgICAgY29uc3QgbGVuZ3RoU3F1YXJlZCA9IG5vcm1hbC5sZW5ndGhTcXVhcmVkKCk7CgogICAgICBpZiAobGVuZ3RoU3F1YXJlZCA8PSBzai5yYWRpdXMgKiBzai5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgIHIucmouY29weShub3JtYWwpOwogICAgICAgIHIucmouc2NhbGUoc2oucmFkaXVzLCByLnJqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQoKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIHBsYW5lUGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVQbGFuZV9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIGJqLnF1YXRlcm5pb24udm11bHQobm9ybWFsLCBub3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGNvbnN0IHJlbHBvcyA9IHBhcnRpY2xlUGxhbmVfcmVscG9zOwogICAgICB4aS52c3ViKGJqLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICBjb25zdCBkb3QgPSBub3JtYWwuZG90KHJlbHBvcyk7CgogICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCiAgICAgICAgLy8gR2V0IHBhcnRpY2xlIHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZDsKICAgICAgICBub3JtYWwuc2NhbGUobm9ybWFsLmRvdCh4aSksIHByb2plY3RlZCk7CiAgICAgICAgeGkudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vcHJvamVjdGVkLnZhZGQoYmoucG9zaXRpb24scHJvamVjdGVkKTsKICAgICAgICAvLyByaiBpcyBub3cgdGhlIHByb2plY3RlZCB3b3JsZCBwb3NpdGlvbiBtaW51cyBwbGFuZSBwb3NpdGlvbgoKICAgICAgICByLnJqLmNvcHkocHJvamVjdGVkKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveFBhcnRpY2xlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4UGFydGljbGUoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4UGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgbGV0IHBlbmV0cmF0ZWRGYWNlSW5kZXggPSAtMTsKICAgICAgY29uc3QgcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBjb252ZXhQYXJ0aWNsZV9wZW5ldHJhdGVkRmFjZU5vcm1hbDsKICAgICAgY29uc3Qgd29ybGRQZW5ldHJhdGlvblZlYyA9IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWM7CiAgICAgIGxldCBtaW5QZW5ldHJhdGlvbiA9IG51bGw7CiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQoKICBjb25zdCBhdmVyYWdlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXZlcmFnZUNvbnRhY3RQb2ludEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQxID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB0bXBRdWF0MiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdjIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF90bXAgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlcyA9IFtdOwogIGNvbnN0IHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVfdG9fc3BoZXJlX29ydGhvID0gbmV3IFZlYzMoKTsgLy8gU2VlIGh0dHA6Ly9idWxsZXRwaHlzaWNzLmNvbS9CdWxsZXQvQnVsbGV0RnVsbC9TcGhlcmVUcmlhbmdsZURldGVjdG9yXzhjcHBfc291cmNlLmh0bWwKCiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fdnRwID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gcG9pbnRJblBvbHlnb24odmVydHMsIG5vcm1hbCwgcCkgewogICAgbGV0IHBvc2l0aXZlUmVzdWx0ID0gbnVsbDsKICAgIGNvbnN0IE4gPSB2ZXJ0cy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIEdldCBlZGdlIHRvIHRoZSBuZXh0IHZlcnRleAoKICAgICAgY29uc3QgZWRnZSA9IHBvaW50SW5Qb2x5Z29uX2VkZ2U7CiAgICAgIHZlcnRzWyhpICsgMSkgJSBOXS52c3ViKHYsIGVkZ2UpOyAvLyBHZXQgY3Jvc3MgcHJvZHVjdCBiZXR3ZWVuIHBvbHlnb24gbm9ybWFsIGFuZCB0aGUgZWRnZQoKICAgICAgY29uc3QgZWRnZV94X25vcm1hbCA9IHBvaW50SW5Qb2x5Z29uX2VkZ2VfeF9ub3JtYWw7IC8vY29uc3QgZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CgogICAgICBlZGdlLmNyb3NzKG5vcm1hbCwgZWRnZV94X25vcm1hbCk7IC8vIEdldCB2ZWN0b3IgYmV0d2VlbiBwb2ludCBhbmQgY3VycmVudCB2ZXJ0ZXgKCiAgICAgIGNvbnN0IHZlcnRleF90b19wID0gcG9pbnRJblBvbHlnb25fdnRwOwogICAgICBwLnZzdWIodiwgdmVydGV4X3RvX3ApOyAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgIGNvbnN0IHIgPSBlZGdlX3hfbm9ybWFsLmRvdCh2ZXJ0ZXhfdG9fcCk7IC8vIElmIGFsbCBzdWNoIGRvdCBwcm9kdWN0cyBoYXZlIHNhbWUgc2lnbiwgd2UgYXJlIGluc2lkZSB0aGUgcG9seWdvbi4KCiAgICAgIGlmIChwb3NpdGl2ZVJlc3VsdCA9PT0gbnVsbCB8fCByID4gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gdHJ1ZSB8fCByIDw9IDAgJiYgcG9zaXRpdmVSZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsKSB7CiAgICAgICAgICBwb3NpdGl2ZVJlc3VsdCA9IHIgPiAwOwogICAgICAgIH0KCiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBFbmNvdW50ZXJlZCBzb21lIG90aGVyIHNpZ24uIEV4aXQuCiAgICAgIH0KICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGNvbnN0IGJveF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwogIGNvbnN0IHNwaGVyZUJveF9zcGhlcmVfdG9fY29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfZWRnZVVuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb0Nvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb1dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV93b3JsZFBlbmV0cmF0aW9uVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdCA9IFswXTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKCiAgY2xhc3MgT3ZlcmxhcEtlZXBlciB7CiAgICAvKioKICAgICAqIEB0b2RvIFJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmN1cnJlbnQgPSB2b2lkIDA7CiAgICAgIHRoaXMucHJldmlvdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CiAgICAvKiogZ2V0ICovCgoKICAgIGdldChpLCBqKSB7CiAgICAgIGlmIChpID4gaikgewogICAgICAgIC8vIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZGF0YVtpICsgIi0iICsgal07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBpZiAoaSA+IGopIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgY29uc3Qga2V5ID0gaSArICItIiArIGo7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiByZXNldCAqLwoKCiAgICByZXNldCgpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3Qga2V5cyA9IGRhdGEua2V5czsKCiAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBrZXkgPSBrZXlzLnBvcCgpOwogICAgICAgIGRlbGV0ZSBkYXRhW2tleV07CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIFRoZSBwaHlzaWNzIHdvcmxkCiAgICovCgoKICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYnJvYWRwaGFzZSBhbGdvcml0aG0gdG8gdXNlLgogICAgICogQGRlZmF1bHQgTmFpdmVCcm9hZHBoYXNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCBib2RpZXMgaW4gdGhpcyB3b3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBUcnVlIGlmIGFueSBib2RpZXMgYXJlIG5vdCBzbGVlcGluZywgZmFsc2UgaWYgZXZlcnkgYm9keSBpcyBzbGVlcGluZy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHNvbHZlciBhbGdvcml0aG0gdG8gdXNlLgogICAgICogQGRlZmF1bHQgR1NTb2x2ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uTWF0cml4CiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbGxpc2lvbk1hdHJpeCBmcm9tIHRoZSBwcmV2aW91cyBzdGVwLgogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYWRkZWQgbWF0ZXJpYWxzLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqIEB0b2RvIFJlbW92ZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYWRkZWQgY29udGFjdG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogVXNlZCB0byBsb29rIHVwIGEgQ29udGFjdE1hdGVyaWFsIGdpdmVuIHR3byBpbnN0YW5jZXMgb2YgTWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IG1hdGVyaWFsIG9mIHRoZSBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoaXMgY29udGFjdCBtYXRlcmlhbCBpcyB1c2VkIGlmIG5vIHN1aXRhYmxlIGNvbnRhY3RtYXRlcmlhbCBpcyBmb3VuZCBmb3IgYSBjb250YWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaW1lIGFjY3VtdWxhdG9yIGZvciBpbnRlcnBvbGF0aW9uLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL2dhbWUtcGh5c2ljcy9maXgteW91ci10aW1lc3RlcC8KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdvcmxkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuZHQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHZvaWQgMDsKICAgICAgdGhpcy5jb250YWN0cyA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucyA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplRmFzdCA9IHZvaWQgMDsKICAgICAgdGhpcy50aW1lID0gdm9pZCAwOwogICAgICB0aGlzLnN0ZXBudW1iZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IHZvaWQgMDsKICAgICAgdGhpcy5uZXh0SWQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZ3Jhdml0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5icm9hZHBoYXNlID0gdm9pZCAwOwogICAgICB0aGlzLmJvZGllcyA9IHZvaWQgMDsKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuc29sdmVyID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gdm9pZCAwOwogICAgICB0aGlzLm5hcnJvd3BoYXNlID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlciA9IHZvaWQgMDsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGVmYXVsdE1hdGVyaWFsID0gdm9pZCAwOwogICAgICB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSB2b2lkIDA7CiAgICAgIHRoaXMucHJvZmlsZSA9IHZvaWQgMDsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IHZvaWQgMDsKICAgICAgdGhpcy5zdWJzeXN0ZW1zID0gdm9pZCAwOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHZvaWQgMDsKICAgICAgdGhpcy5yZW1vdmVCb2R5RXZlbnQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWRUb0JvZHlNYXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuZHQgPSAtMTsKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gISFvcHRpb25zLmFsbG93U2xlZXA7CiAgICAgIHRoaXMuY29udGFjdHMgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucyA9IFtdOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVTa2lwID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplU2tpcCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplU2tpcCA6IDA7CiAgICAgIHRoaXMucXVhdE5vcm1hbGl6ZUZhc3QgPSBvcHRpb25zLnF1YXROb3JtYWxpemVGYXN0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnF1YXROb3JtYWxpemVGYXN0IDogZmFsc2U7CiAgICAgIHRoaXMudGltZSA9IDAuMDsKICAgICAgdGhpcy5zdGVwbnVtYmVyID0gMDsKICAgICAgdGhpcy5kZWZhdWx0X2R0ID0gMSAvIDYwOwogICAgICB0aGlzLm5leHRJZCA9IDA7CiAgICAgIHRoaXMuZ3Jhdml0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5ncmF2aXR5KSB7CiAgICAgICAgdGhpcy5ncmF2aXR5LmNvcHkob3B0aW9ucy5ncmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLm1hdGVyaWFscyA9IFtdOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG51bWJlciBvZiBvYmplY3RzIGluIHRoZSB3b3JsZC4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KCgogICAgbnVtT2JqZWN0cygpIHsKICAgICAgcmV0dXJuIHRoaXMuYm9kaWVzLmxlbmd0aDsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBtYXRlcmlhbCB0byB0aGUgV29ybGQuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICogQHRvZG8gUmVtb3ZlCiAgICAgKi8KCgogICAgYWRkTWF0ZXJpYWwobSkgewogICAgICB0aGlzLm1hdGVyaWFscy5wdXNoKG0pOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIGEgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgV29ybGQKICAgICAqLwoKCiAgICBhZGRDb250YWN0TWF0ZXJpYWwoY21hdCkgewogICAgICAvLyBBZGQgY29udGFjdCBtYXRlcmlhbAogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMucHVzaChjbWF0KTsgLy8gQWRkIGN1cnJlbnQgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgbWF0ZXJpYWwgdGFibGUKCiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuc2V0KGNtYXQubWF0ZXJpYWxzWzBdLmlkLCBjbWF0Lm1hdGVyaWFsc1sxXS5pZCwgY21hdCk7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwuCiAgICAgKiBAc2VlIGh0dHBzOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDE4MDQyNjE1NDUzMS9odHRwOi8vYnVsbGV0cGh5c2ljcy5vcmcvbWVkaWF3aWtpLTEuNS44L2luZGV4LnBocC9TdGVwcGluZ19UaGVfV29ybGQjV2hhdF9kb190aGVfcGFyYW1ldGVyc190b19idER5bmFtaWNzV29ybGQ6OnN0ZXBTaW11bGF0aW9uX21lYW4uM0YKICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgLy8gZml4ZWQgdGltZXN0ZXBwaW5nIHdpdGhvdXQgaW50ZXJwb2xhdGlvbgogICAgICogICAgIHdvcmxkLnN0ZXAoMSAvIDYwKQogICAgICovCgoKICAgIHN0ZXAoZHQsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKSB7CiAgICAgIGlmIChtYXhTdWJTdGVwcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4U3ViU3RlcHMgPSAxMDsKICAgICAgfQoKICAgICAgaWYgKHRpbWVTaW5jZUxhc3RDYWxsZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIEZpeGVkLCBzaW1wbGUgc3RlcHBpbmcKICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7IC8vIEluY3JlbWVudCB0aW1lCgogICAgICAgIHRoaXMudGltZSArPSBkdDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgICAgY29uc3QgdDAgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICBsZXQgc3Vic3RlcHMgPSAwOwoKICAgICAgICB3aGlsZSAodGhpcy5hY2N1bXVsYXRvciA+PSBkdCAmJiBzdWJzdGVwcyA8IG1heFN1YlN0ZXBzKSB7CiAgICAgICAgICAvLyBEbyBmaXhlZCBzdGVwcyB0byBjYXRjaCB1cAogICAgICAgICAgdGhpcy5pbnRlcm5hbFN0ZXAoZHQpOwogICAgICAgICAgdGhpcy5hY2N1bXVsYXRvciAtPSBkdDsKICAgICAgICAgIHN1YnN0ZXBzKys7CgogICAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdDAgPiBkdCAqIDEwMDApIHsKICAgICAgICAgICAgLy8gVGhlIGZyYW1lcmF0ZSBpcyBub3QgaW50ZXJhY3RpdmUgYW55bW9yZS4KICAgICAgICAgICAgLy8gV2UgYXJlIGJlbG93IHRoZSB0YXJnZXQgZnJhbWVyYXRlLgogICAgICAgICAgICAvLyBCZXR0ZXIgYmFpbCBvdXQuCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gUmVtb3ZlIHRoZSBleGNlc3MgYWNjdW11bGF0b3IsIHNpbmNlIHdlIG1heSBub3QKICAgICAgICAvLyBoYXZlIGhhZCBlbm91Z2ggc3Vic3RlcHMgYXZhaWxhYmxlIHRvIGNhdGNoIHVwCgoKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yID0gdGhpcy5hY2N1bXVsYXRvciAlIGR0OwogICAgICAgIGNvbnN0IHQgPSB0aGlzLmFjY3VtdWxhdG9yIC8gZHQ7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSB0aGlzLmJvZGllcy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgYiA9IHRoaXMuYm9kaWVzW2pdOwogICAgICAgICAgYi5wcmV2aW91c1Bvc2l0aW9uLmxlcnAoYi5wb3NpdGlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRQb3NpdGlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5zbGVycChiLnF1YXRlcm5pb24sIHQsIGIuaW50ZXJwb2xhdGVkUXVhdGVybmlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5ub3JtYWxpemUoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMudGltZSArPSB0aW1lU2luY2VMYXN0Q2FsbGVkOwogICAgICB9CiAgICB9CgogICAgaW50ZXJuYWxTdGVwKGR0KSB7CiAgICAgIHRoaXMuZHQgPSBkdDsKICAgICAgY29uc3QgY29udGFjdHMgPSB0aGlzLmNvbnRhY3RzOwogICAgICBjb25zdCBwMSA9IFdvcmxkX3N0ZXBfcDE7CiAgICAgIGNvbnN0IHAyID0gV29ybGRfc3RlcF9wMjsKICAgICAgY29uc3QgTiA9IHRoaXMubnVtT2JqZWN0cygpOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIEludm9rZSBwcmUtc3RlcCBjYWxsYmFja3MKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkucHJlU3RlcCkgewogICAgICAgICAgYmkucHJlU3RlcC5jYWxsKGJpKTsKICAgICAgICB9CiAgICAgIH0gLy8gTGVhcCBmcm9nCiAgICAgIC8vIHZuZXcgPSB2ICsgaCpmL20KICAgICAgLy8geG5ldyA9IHggKyBoKnZuZXcKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gSW52b2tlIHBvc3Qtc3RlcCBjYWxsYmFja3MKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwogICAgICAgIGNvbnN0IHBvc3RTdGVwID0gYmkucG9zdFN0ZXA7CgogICAgICAgIGlmIChwb3N0U3RlcCkgewogICAgICAgICAgcG9zdFN0ZXAuY2FsbChiaSk7CiAgICAgICAgfQogICAgICB9IC8vIFNsZWVwaW5nIHVwZGF0ZQoKCiAgICAgIGxldCBoYXNBY3RpdmVCb2RpZXMgPSB0cnVlOwoKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IGZhbHNlOwoKICAgICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmkuc2xlZXBUaWNrKHRoaXMudGltZSk7CgogICAgICAgICAgaWYgKGJpLnNsZWVwU3RhdGUgIT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAgICAgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gaGFzQWN0aXZlQm9kaWVzOwogICAgfQoKICAgIGVtaXRDb250YWN0RXZlbnRzKCkgewogICAgICBjb25zdCBoYXNCZWdpbkNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2JlZ2luQ29udGFjdCcpOwogICAgICBjb25zdCBoYXNFbmRDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRDb250YWN0Jyk7CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0IHx8IGhhc0VuZENvbnRhY3QpIHsKICAgICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLmdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscyk7CiAgICAgIH0KCiAgICAgIGlmIChoYXNCZWdpbkNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaV0pOwogICAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKGFkZGl0aW9uc1tpICsgMV0pOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGJlZ2luQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5Db250YWN0RXZlbnQuYm9keUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcmVtb3ZhbHMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUEgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IHRoaXMuZ2V0Qm9keUJ5SWQocmVtb3ZhbHNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gZW5kQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgYWRkaXRpb25zLmxlbmd0aCA9IHJlbW92YWxzLmxlbmd0aCA9IDA7CiAgICAgIGNvbnN0IGhhc0JlZ2luU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpblNoYXBlQ29udGFjdCcpOwogICAgICBjb25zdCBoYXNFbmRTaGFwZUNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2VuZFNoYXBlQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luU2hhcGVDb250YWN0IHx8IGhhc0VuZFNoYXBlQ29udGFjdCkgewogICAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyLmdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscyk7CiAgICAgIH0KCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYWRkaXRpb25zLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgY29uc3Qgc2hhcGVBID0gdGhpcy5nZXRTaGFwZUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpICsgMV0pOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IHNoYXBlQjsKICAgICAgICAgIGlmIChzaGFwZUEpIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBzaGFwZUEuYm9keTsKICAgICAgICAgIGlmIChzaGFwZUIpIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpblNoYXBlQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgY29uc3Qgc2hhcGVBID0gdGhpcy5nZXRTaGFwZUJ5SWQocmVtb3ZhbHNbaV0pOwogICAgICAgICAgY29uc3Qgc2hhcGVCID0gdGhpcy5nZXRTaGFwZUJ5SWQocmVtb3ZhbHNbaSArIDFdKTsKICAgICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IHNoYXBlQTsKICAgICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IHNoYXBlQjsKICAgICAgICAgIGlmIChzaGFwZUEpIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IHNoYXBlQi5ib2R5OwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGVuZFNoYXBlQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgYWxsIGJvZHkgZm9yY2VzIGluIHRoZSB3b3JsZCB0byB6ZXJvLgogICAgICovCgoKICAgIGNsZWFyRm9yY2VzKCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBiLmZvcmNlOwogICAgICAgIGIudG9ycXVlOwogICAgICAgIGIuZm9yY2Uuc2V0KDAsIDAsIDApOwogICAgICAgIGIudG9ycXVlLnNldCgwLCAwLCAwKTsKICAgICAgfQogICAgfQoKICB9IC8vIFRlbXAgc3R1ZmYKCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfSAvLyBSZXVzYWJsZSBldmVudCBvYmplY3RzIHRvIHNhdmUgbWVtb3J5LgoKCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQoKICAgIGNvbnN0IG1hdGVyaWFsT3B0aW9ucyA9IHR5cGVvZiBuYW1lT3JPcHRpb25zID09PSAnc3RyaW5nJyA/IHsKICAgICAgbmFtZTogbmFtZU9yT3B0aW9ucwogICAgfSA6IHsKICAgICAgbmFtZTogU3ltYm9sLmZvcihgTWF0ZXJpYWwke21hdGVyaWFsSWQrK31gKSwKICAgICAgLi4ubmFtZU9yT3B0aW9ucwogICAgfTsKICAgIGNvbnN0IHsKICAgICAgbmFtZQogICAgfSA9IG1hdGVyaWFsT3B0aW9uczsKICAgIG1hdGVyaWFsc1tuYW1lXSA9IG1hdGVyaWFsc1tuYW1lXSB8fCBuZXcgTWF0ZXJpYWwobWF0ZXJpYWxPcHRpb25zKTsKICAgIHJldHVybiBtYXRlcmlhbHNbbmFtZV07CiAgfTsKCiAgLyoqCiAgICogQHR5cGVkZWYgeyBpbXBvcnQoJ2Nhbm5vbi1lcycpLk1hdGVyaWFsT3B0aW9ucyB9IE1hdGVyaWFsT3B0aW9ucwogICAqLwoKICBjb25zdCBtYWtlVmVjMyA9IF9yZWYgPT4gewogICAgbGV0IFt4LCB5LCB6XSA9IF9yZWY7CiAgICByZXR1cm4gbmV3IFZlYzMoeCwgeSwgeik7CiAgfTsKCiAgY29uc3QgcHJlcGFyZVNwaGVyZSA9IGFyZ3MgPT4gQXJyYXkuaXNBcnJheShhcmdzKSA/IGFyZ3MgOiBbYXJnc107CgogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKCiAgZnVuY3Rpb24gY3JlYXRlU2hhcGUodHlwZSwgYXJncykgewogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgJ0JveCc6CiAgICAgICAgcmV0dXJuIG5ldyBCb3gobmV3IFZlYzMoLi4uYXJncy5tYXAodiA9PiB2IC8gMikpKTsKICAgICAgLy8gZXh0ZW50cyA9PiBoYWxmRXh0ZW50cwoKICAgICAgY2FzZSAnQ29udmV4UG9seWhlZHJvbic6CiAgICAgICAgcmV0dXJuIG5ldyBDb252ZXhQb2x5aGVkcm9uKC4uLnByZXBhcmVDb252ZXhQb2x5aGVkcm9uKGFyZ3MpKTsKCiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCgogICAgICBjYXNlICdIZWlnaHRmaWVsZCc6CiAgICAgICAgcmV0dXJuIG5ldyBIZWlnaHRmaWVsZCguLi5hcmdzKTsKICAgICAgLy8gWyBBcnJheSBkYXRhLCBvcHRpb25zOiB7bWluVmFsdWUsIG1heFZhbHVlLCBlbGVtZW50U2l6ZX0gIF0gPSBhcmdzCgogICAgICBjYXNlICdQYXJ0aWNsZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQYXJ0aWNsZSgpOwogICAgICAvLyBubyBhcmdzCgogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CgogICAgICBjYXNlICdTcGhlcmUnOgogICAgICAgIHJldHVybiBuZXcgU3BoZXJlKC4uLnByZXBhcmVTcGhlcmUoYXJncykpOwogICAgICAvLyByYWRpdXMgPSBhcmdzCgogICAgICBjYXNlICdUcmltZXNoJzoKICAgICAgICByZXR1cm4gbmV3IFRyaW1lc2goLi4uYXJncyk7CiAgICAgIC8vIFt2ZXJ0aWNlcywgaW5kaWNlc10gPSBhcmdzCiAgICB9CiAgfQogIC8qKgogICAqIEBmdW5jdGlvbgogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMudXVpZAogICAqIEBwYXJhbSB7Qm9keVByb3BzfSBvcHRpb25zLnByb3BzCiAgICogQHBhcmFtIHtCb2R5U2hhcGVUeXBlfSBvcHRpb25zLnR5cGUKICAgKiBAcGFyYW0geyhtYXRlcmlhbE9wdGlvbnM6IE1hdGVyaWFsT3B0aW9ucykgPT4gTWF0ZXJpYWwgPX0gb3B0aW9ucy5jcmVhdGVNYXRlcmlhbAogICAqIEByZXR1cm5zIHtCb2R5fQogICAqLwoKCiAgY29uc3QgcHJvcHNUb0JvZHkgPSBvcHRpb25zID0+IHsKICAgIGNvbnN0IHsKICAgICAgdXVpZCwKICAgICAgcHJvcHMsCiAgICAgIHR5cGUsCiAgICAgIGNyZWF0ZU1hdGVyaWFsID0gbWF0ZXJpYWxPcHRpb25zID0+IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpCiAgICB9ID0gb3B0aW9uczsKICAgIGNvbnN0IHsKICAgICAgYW5ndWxhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgYW5ndWxhclZlbG9jaXR5ID0gWzAsIDAsIDBdLAogICAgICBhcmdzID0gW10sCiAgICAgIGNvbGxpc2lvblJlc3BvbnNlLAogICAgICBsaW5lYXJGYWN0b3IgPSBbMSwgMSwgMV0sCiAgICAgIG1hc3MsCiAgICAgIG1hdGVyaWFsLAogICAgICBvbkNvbGxpZGUsCiAgICAgIHBvc2l0aW9uID0gWzAsIDAsIDBdLAogICAgICByb3RhdGlvbiA9IFswLCAwLCAwXSwKICAgICAgc2hhcGVzLAogICAgICB0eXBlOiBib2R5VHlwZSwKICAgICAgdmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIC4uLmV4dHJhCiAgICB9ID0gcHJvcHM7CiAgICBjb25zdCBib2R5ID0gbmV3IEJvZHkoeyAuLi5leHRyYSwKICAgICAgbWFzczogYm9keVR5cGUgPT09ICdTdGF0aWMnID8gMCA6IG1hc3MsCiAgICAgIG1hdGVyaWFsOiBtYXRlcmlhbCA/IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKSA6IHVuZGVmaW5lZCwKICAgICAgdHlwZTogYm9keVR5cGUgPyBCb2R5W2JvZHlUeXBlLnRvVXBwZXJDYXNlKCldIDogdW5kZWZpbmVkCiAgICB9KTsKICAgIGJvZHkudXVpZCA9IHV1aWQ7CgogICAgaWYgKGNvbGxpc2lvblJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHsKICAgICAgYm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGNvbGxpc2lvblJlc3BvbnNlOwogICAgfQoKICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWYzID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgbWF0ZXJpYWwsCiAgICAgICAgICAuLi5leHRyYQogICAgICAgIH0gPSBfcmVmMzsKICAgICAgICBjb25zdCBzaGFwZUJvZHkgPSBib2R5LmFkZFNoYXBlKGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpLCBwb3NpdGlvbiA/IG5ldyBWZWMzKC4uLnBvc2l0aW9uKSA6IHVuZGVmaW5lZCwgcm90YXRpb24gPyBuZXcgUXVhdGVybmlvbigpLnNldEZyb21FdWxlciguLi5yb3RhdGlvbikgOiB1bmRlZmluZWQpOwogICAgICAgIGlmIChtYXRlcmlhbCkgc2hhcGVCb2R5Lm1hdGVyaWFsID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpOwogICAgICAgIE9iamVjdC5hc3NpZ24oc2hhcGVCb2R5LCBleHRyYSk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSk7CiAgICB9CgogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKHJvdGF0aW9uWzBdLCByb3RhdGlvblsxXSwgcm90YXRpb25bMl0pOwogICAgYm9keS52ZWxvY2l0eS5zZXQodmVsb2NpdHlbMF0sIHZlbG9jaXR5WzFdLCB2ZWxvY2l0eVsyXSk7CiAgICBib2R5LmFuZ3VsYXJWZWxvY2l0eS5zZXQoYW5ndWxhclZlbG9jaXR5WzBdLCBhbmd1bGFyVmVsb2NpdHlbMV0sIGFuZ3VsYXJWZWxvY2l0eVsyXSk7CiAgICBib2R5LmxpbmVhckZhY3Rvci5zZXQobGluZWFyRmFjdG9yWzBdLCBsaW5lYXJGYWN0b3JbMV0sIGxpbmVhckZhY3RvclsyXSk7CiAgICBib2R5LmFuZ3VsYXJGYWN0b3Iuc2V0KGFuZ3VsYXJGYWN0b3JbMF0sIGFuZ3VsYXJGYWN0b3JbMV0sIGFuZ3VsYXJGYWN0b3JbMl0pOwogICAgcmV0dXJuIGJvZHk7CiAgfTsKCiAgdmFyIHByb3BzVG9Cb2R5JDEgPSBwcm9wc1RvQm9keTsKCiAgY29uc3QgYWRkQm9kaWVzID0gKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHMsCiAgICAgIHR5cGUsCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXVpZC5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBib2R5ID0gcHJvcHNUb0JvZHkkMSh7CiAgICAgICAgY3JlYXRlTWF0ZXJpYWwsCiAgICAgICAgcHJvcHM6IHByb3BzW2ldLAogICAgICAgIHR5cGUsCiAgICAgICAgdXVpZDogdXVpZFtpXQogICAgICB9KTsKICAgICAgc3RhdGUud29ybGQuYWRkQm9keShib2R5KTsKICAgICAgaWYgKHByb3BzW2ldLm9uQ29sbGlkZSkgYm9keS5hZGRFdmVudExpc3RlbmVyKCdjb2xsaWRlJywgX3JlZjIgPT4gewogICAgICAgIGxldCB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgYm9keSwKICAgICAgICAgIHRhcmdldCwKICAgICAgICAgIGNvbnRhY3QKICAgICAgICB9ID0gX3JlZjI7CiAgICAgICAgY29uc3QgewogICAgICAgICAgbmksCiAgICAgICAgICByaSwKICAgICAgICAgIHJqLAogICAgICAgICAgYmksCiAgICAgICAgICBiaiwKICAgICAgICAgIGlkCiAgICAgICAgfSA9IGNvbnRhY3Q7CiAgICAgICAgY29uc3QgY29udGFjdFBvaW50ID0gYmkucG9zaXRpb24udmFkZChyaSk7CiAgICAgICAgY29uc3QgY29udGFjdE5vcm1hbCA9IGJpID09PSBib2R5ID8gbmkgOiBuaS5zY2FsZSgtMSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBib2R5OiBib2R5LnV1aWQsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJzOiB7CiAgICAgICAgICAgIGJvZHlGaWx0ZXJHcm91cDogYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgYm9keUZpbHRlck1hc2s6IGJvZHkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyR3JvdXA6IHRhcmdldC5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyTWFzazogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlck1hc2sKICAgICAgICAgIH0sCiAgICAgICAgICBjb250YWN0OiB7CiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogdXNlIGlkIGluc3RlYWQgb2YgdXVpZAogICAgICAgICAgICBiaTogYmkudXVpZCwKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJqOiBiai51dWlkLAogICAgICAgICAgICAvLyBOb3JtYWwgb2YgdGhlIGNvbnRhY3QsIHJlbGF0aXZlIHRvIHRoZSBjb2xsaWRpbmcgYm9keQogICAgICAgICAgICBjb250YWN0Tm9ybWFsOiBjb250YWN0Tm9ybWFsLnRvQXJyYXkoKSwKICAgICAgICAgICAgLy8gV29ybGQgcG9zaXRpb24gb2YgdGhlIGNvbnRhY3QKICAgICAgICAgICAgY29udGFjdFBvaW50OiBjb250YWN0UG9pbnQudG9BcnJheSgpLAogICAgICAgICAgICBpZCwKICAgICAgICAgICAgaW1wYWN0VmVsb2NpdHk6IGNvbnRhY3QuZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpLAogICAgICAgICAgICBuaTogbmkudG9BcnJheSgpLAogICAgICAgICAgICByaTogcmkudG9BcnJheSgpLAogICAgICAgICAgICByajogcmoudG9BcnJheSgpCiAgICAgICAgICB9LAogICAgICAgICAgb3A6ICdldmVudCcsCiAgICAgICAgICB0YXJnZXQ6IHRhcmdldC51dWlkLAogICAgICAgICAgdHlwZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9OwoKICBjb25zdCB0cmlwbGV0VG9WZWMzID0gdCA9PiB0ID8gbmV3IFZlYzMoLi4udCkgOiB1bmRlZmluZWQ7CgogIGNvbnN0IGFkZENvbnN0cmFpbnQgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgYW5nbGUsCiAgICAgICAgYXhpc0EsCiAgICAgICAgYXhpc0IsCiAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICBkaXN0YW5jZSwKICAgICAgICBtYXhGb3JjZSwKICAgICAgICBtYXhNdWx0aXBsaWVyLAogICAgICAgIHBpdm90QSwKICAgICAgICBwaXZvdEIsCiAgICAgICAgdHdpc3RBbmdsZSwKICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgfV0sCiAgICAgIHR5cGUsCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgbGV0IGNvbnN0cmFpbnQ7CgogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgJ1BvaW50VG9Qb2ludCc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgdHJpcGxldFRvVmVjMyhwaXZvdEIpLCBtYXhGb3JjZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdIaW5nZSc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBIaW5nZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgYXhpc0E6IHRyaXBsZXRUb1ZlYzMoYXhpc0EpLAogICAgICAgICAgYXhpc0I6IHRyaXBsZXRUb1ZlYzMoYXhpc0IpLAogICAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICAgIG1heEZvcmNlLAogICAgICAgICAgcGl2b3RBOiB0cmlwbGV0VG9WZWMzKHBpdm90QSksCiAgICAgICAgICBwaXZvdEI6IHRyaXBsZXRUb1ZlYzMocGl2b3RCKQogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnRGlzdGFuY2UnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgRGlzdGFuY2VDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIGRpc3RhbmNlLCBtYXhGb3JjZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgd2FrZVVwQm9kaWVzCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICB9CgogICAgY29uc3RyYWludC51dWlkID0gdXVpZDsKICAgIHN0YXRlLndvcmxkLmFkZENvbnN0cmFpbnQoY29uc3RyYWludCk7CgogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwoKICAgICAgICBpZiAobXVsdGlwbGllciA+IG1heE11bHRpcGxpZXIpIHsKICAgICAgICAgIGNvbnN0cmFpbnQuZGlzYWJsZSgpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHN0YXRlLmNvbnN0cmFpbnRzW3V1aWRdID0gcG9zdFN0ZXBDb25zdHJhaW50OwogICAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLmNvbnN0cmFpbnRzW3V1aWRdKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiB0b1VwcGVyY2FzZShzdHIpIHsKICAgIHJldHVybiBzdHIudG9VcHBlckNhc2UoKTsKICB9CgogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwoKICAgIHN0YXRlLnJheXNbdXVpZF0gPSAoKSA9PiB7CiAgICAgIHJheS5pbnRlcnNlY3RXb3JsZChzdGF0ZS53b3JsZCwgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy5yZXN1bHQgfHwgIW9wdGlvbnMucmVzdWx0LmJvZHkpIHJldHVybjsKICAgICAgY29uc3QgewogICAgICAgIGJvZHksCiAgICAgICAgc2hhcGUsCiAgICAgICAgcmF5RnJvbVdvcmxkLAogICAgICAgIHJheVRvV29ybGQsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQsCiAgICAgICAgaGl0UG9pbnRXb3JsZCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSBvcHRpb25zLnJlc3VsdDsKICAgICAgY29uc3QgYm9keVVVSUQgPSBib2R5LnV1aWQ7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGJvZHk6IGJvZHlVVUlEIHx8IG51bGwsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQ6IGhpdE5vcm1hbFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBoaXRQb2ludFdvcmxkOiBoaXRQb2ludFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICByYXk6IHsKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlckdyb3VwOiByYXkuY29sbGlzaW9uRmlsdGVyR3JvdXAsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJNYXNrOiByYXkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgIGRpcmVjdGlvbjogcmF5LmRpcmVjdGlvbi50b0FycmF5KCksCiAgICAgICAgICBmcm9tLAogICAgICAgICAgdG8sCiAgICAgICAgICB1dWlkCiAgICAgICAgfSwKICAgICAgICByYXlGcm9tV29ybGQ6IHJheUZyb21Xb3JsZC50b0FycmF5KCksCiAgICAgICAgcmF5VG9Xb3JsZDogcmF5VG9Xb3JsZC50b0FycmF5KCksCiAgICAgICAgc2hhcGU6IHNoYXBlID8geyAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnJheXNbdXVpZF0pOwogIH07CgogIGNvbnN0IGFkZFJheWNhc3RWZWhpY2xlID0gKHN0YXRlLCBkYXRhKSA9PiB7CiAgICBjb25zdCBbY2hhc3Npc0JvZHksIHdoZWVscywgd2hlZWxJbmZvcywgaW5kZXhGb3J3YXJkQXhpcywgaW5kZXhSaWdodEF4aXMsIGluZGV4VXBBeGlzXSA9IGRhdGEucHJvcHM7CiAgICBjb25zdCB2ZWhpY2xlID0gbmV3IFJheWNhc3RWZWhpY2xlKHsKICAgICAgY2hhc3Npc0JvZHk6IHN0YXRlLmJvZGllc1tjaGFzc2lzQm9keV0sCiAgICAgIGluZGV4Rm9yd2FyZEF4aXMsCiAgICAgIGluZGV4UmlnaHRBeGlzLAogICAgICBpbmRleFVwQXhpcwogICAgfSk7CiAgICB2ZWhpY2xlLndvcmxkID0gc3RhdGUud29ybGQ7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBheGxlTG9jYWwsCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLAogICAgICAgIGRpcmVjdGlvbkxvY2FsLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IHdoZWVsSW5mb3NbaV07CiAgICAgIHZlaGljbGUuYWRkV2hlZWwoewogICAgICAgIGF4bGVMb2NhbDogdHJpcGxldFRvVmVjMyhheGxlTG9jYWwpLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogdHJpcGxldFRvVmVjMyhjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwpLAogICAgICAgIGRpcmVjdGlvbkxvY2FsOiB0cmlwbGV0VG9WZWMzKGRpcmVjdGlvbkxvY2FsKSwKICAgICAgICAuLi5yZXN0CiAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwoKICAgIGNvbnN0IHBvc3RTdGVwID0gKCkgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZlaGljbGUud2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZlaGljbGUudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgICAgY29uc3QgdCA9IHZlaGljbGUud2hlZWxJbmZvc1tpXS53b3JsZFRyYW5zZm9ybTsKICAgICAgICBjb25zdCB3aGVlbEJvZHkgPSBzdGF0ZS5ib2RpZXNbd2hlZWxzW2ldXTsKICAgICAgICB3aGVlbEJvZHkucG9zaXRpb24uY29weSh0LnBvc2l0aW9uKTsKICAgICAgICB3aGVlbEJvZHkucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbik7CiAgICAgIH0KICAgIH07CgogICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXSA9IHsKICAgICAgcG9zdFN0ZXAsCiAgICAgIHByZVN0ZXAsCiAgICAgIHZlaGljbGUKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgcHJlU3RlcCk7CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHBvc3RTdGVwKTsKICB9OwoKICBjb25zdCBhZGRTcHJpbmcgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgZGFtcGluZywKICAgICAgICBsb2NhbEFuY2hvckEsCiAgICAgICAgbG9jYWxBbmNob3JCLAogICAgICAgIHJlc3RMZW5ndGgsCiAgICAgICAgc3RpZmZuZXNzLAogICAgICAgIHdvcmxkQW5jaG9yQSwKICAgICAgICB3b3JsZEFuY2hvckIKICAgICAgfV0sCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgIGRhbXBpbmcsCiAgICAgIGxvY2FsQW5jaG9yQTogdHJpcGxldFRvVmVjMyhsb2NhbEFuY2hvckEpLAogICAgICBsb2NhbEFuY2hvckI6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JCKSwKICAgICAgcmVzdExlbmd0aCwKICAgICAgc3RpZmZuZXNzLAogICAgICB3b3JsZEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMod29ybGRBbmNob3JBKSwKICAgICAgd29ybGRBbmNob3JCOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQikKICAgIH0pOwogICAgc3ByaW5nLnV1aWQgPSB1dWlkOwoKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKCiAgICBzdGF0ZS5zcHJpbmdzW3V1aWRdID0gcG9zdFN0ZXBTcHJpbmc7CiAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbdXVpZF0gPSBzcHJpbmc7IC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAoKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCFib2R5QSB8fCAhYm9keUIpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBlbWl0RW5kQ29udGFjdChfcmVmMikgewogICAgbGV0IHsKICAgICAgYm9keUEsCiAgICAgIGJvZHlCCiAgICB9ID0gX3JlZjI7CiAgICBpZiAoIWJvZHlBIHx8ICFib2R5QikgcmV0dXJuOwogICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIGJvZHlBOiBib2R5QS51dWlkLAogICAgICBib2R5QjogYm9keUIudXVpZCwKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlRW5kJwogICAgfSk7CiAgfQoKICBjb25zdCBpbml0ID0gKHN0YXRlLCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgYWxsb3dTbGVlcCwKICAgICAgYXhpc0luZGV4ID0gMCwKICAgICAgYnJvYWRwaGFzZSwKICAgICAgZGVmYXVsdENvbnRhY3RNYXRlcmlhbCwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgc3RhdGUud29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChncmF2aXR5WzBdLCBncmF2aXR5WzFdLCBncmF2aXR5WzJdKTsKICAgIHN0YXRlLndvcmxkLnF1YXROb3JtYWxpemVGYXN0ID0gcXVhdE5vcm1hbGl6ZUZhc3Q7CiAgICBzdGF0ZS53b3JsZC5xdWF0Tm9ybWFsaXplU2tpcCA9IHF1YXROb3JtYWxpemVTa2lwOwoKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgc3RhdGUud29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KCiAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgc3RhdGUud29ybGQuc29sdmVyLnRvbGVyYW5jZSA9IHRvbGVyYW5jZTsKICAgICAgc3RhdGUud29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBpdGVyYXRpb25zOwogICAgfQoKICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UgPSBicm9hZHBoYXNlID09PSAnU0FQJyA/IG5ldyBTQVBCcm9hZHBoYXNlKHN0YXRlLndvcmxkKSA6IG5ldyBOYWl2ZUJyb2FkcGhhc2UoKTsKCiAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYmVnaW5Db250YWN0JywgZW1pdEJlZ2luQ29udGFjdCk7CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdlbmRDb250YWN0JywgZW1pdEVuZENvbnRhY3QpOwogICAgT2JqZWN0LmFzc2lnbihzdGF0ZS53b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsLCBkZWZhdWx0Q29udGFjdE1hdGVyaWFsKTsKICB9OwoKICBjb25zdCBpc1FvclYgPSB2ID0+IHYgaW5zdGFuY2VvZiBRdWF0ZXJuaW9uIHx8IHYgaW5zdGFuY2VvZiBWZWMzOwoKICBjb25zdCBzdGVwID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwb3NpdGlvbnMsCiAgICAgIHByb3BzOiB7CiAgICAgICAgbWF4U3ViU3RlcHMsCiAgICAgICAgc3RlcFNpemUsCiAgICAgICAgdGltZVNpbmNlTGFzdENhbGxlZAogICAgICB9LAogICAgICBxdWF0ZXJuaW9ucwogICAgfSA9IF9yZWY7CiAgICBzdGF0ZS53b3JsZC5zdGVwKHN0ZXBTaXplLCB0aW1lU2luY2VMYXN0Q2FsbGVkLCBtYXhTdWJTdGVwcyk7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQoKICAgIGNvbnN0IG9ic2VydmF0aW9ucyA9IFtdOwoKICAgIGZvciAoY29uc3QgaWQgb2YgT2JqZWN0LmtleXMoc3RhdGUuc3Vic2NyaXB0aW9ucykpIHsKICAgICAgY29uc3QgW3V1aWQsIHR5cGUsIHRhcmdldCA9ICdib2RpZXMnXSA9IHN0YXRlLnN1YnNjcmlwdGlvbnNbaWRdOwogICAgICBjb25zdCB7CiAgICAgICAgYm9kaWVzLAogICAgICAgIHZlaGljbGVzCiAgICAgIH0gPSBzdGF0ZTsKICAgICAgY29uc3QgdmFsdWUgPSB0YXJnZXQgPT09ICd2ZWhpY2xlcycgPyAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICB2ZWhpY2xlc1t1dWlkXS52ZWhpY2xlW3R5cGVdIDogLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgYm9kaWVzW3V1aWRdW3R5cGVdOwogICAgICBjb25zdCBzZXJpYWxpemFibGVWYWx1ZSA9IGlzUW9yVih2YWx1ZSkgPyB2YWx1ZS50b0FycmF5KCkgOiB2YWx1ZTsKICAgICAgb2JzZXJ2YXRpb25zLnB1c2goW051bWJlcihpZCksIHNlcmlhbGl6YWJsZVZhbHVlLCAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICB0eXBlXSk7CiAgICB9CgogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CgogICAgaWYgKHN0YXRlLmJvZGllc05lZWRTeW5jaW5nKSB7CiAgICAgIG1lc3NhZ2UuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiB7CiAgICAgICAgaWYgKGJvZHkudXVpZCkgYm9kaWVzLnB1c2goYm9keS51dWlkKTsKICAgICAgICByZXR1cm4gYm9kaWVzOwogICAgICB9LCBbXSk7CiAgICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gZmFsc2U7CiAgICB9CgogICAgc2VsZi5wb3N0TWVzc2FnZShtZXNzYWdlLCBbcG9zaXRpb25zLmJ1ZmZlciwgcXVhdGVybmlvbnMuYnVmZmVyXSk7CiAgfTsKCiAgY29uc3Qgc3RhdGUgPSB7CiAgICBib2RpZXM6IHt9LAogICAgYm9kaWVzTmVlZFN5bmNpbmc6IGZhbHNlLAogICAgY29uc3RyYWludHM6IHt9LAogICAgbWF0ZXJpYWxzOiB7fSwKICAgIHJheXM6IHt9LAogICAgc3ByaW5nSW5zdGFuY2VzOiB7fSwKICAgIHNwcmluZ3M6IHt9LAogICAgc3Vic2NyaXB0aW9uczoge30sCiAgICB2ZWhpY2xlczoge30sCiAgICB3b3JsZDogbmV3IFdvcmxkKCkKICB9OwoKICAvLy8gPHJlZmVyZW5jZSBuby1kZWZhdWx0LWxpYj0idHJ1ZSIvPgoKICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKCiAgZnVuY3Rpb24gc3luY0JvZGllcygpIHsKICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gdHJ1ZTsKICAgIHN0YXRlLmJvZGllcyA9IHN0YXRlLndvcmxkLmJvZGllcy5yZWR1Y2UoKGJvZGllcywgYm9keSkgPT4gKHsgLi4uYm9kaWVzLAogICAgICBbYm9keS51dWlkXTogYm9keQogICAgfSksIHt9KTsKICB9CgogIGNvbnN0IGJyb2FkcGhhc2VzID0gewogICAgTmFpdmVCcm9hZHBoYXNlLAogICAgU0FQQnJvYWRwaGFzZQogIH07CiAgY29uc3QgY3JlYXRlTWF0ZXJpYWwgPSBjcmVhdGVNYXRlcmlhbEZhY3Rvcnkoc3RhdGUubWF0ZXJpYWxzKTsKCiAgc2VsZi5vbm1lc3NhZ2UgPSBfcmVmID0+IHsKICAgIGxldCB7CiAgICAgIGRhdGEKICAgIH0gPSBfcmVmOwoKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3N0ZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0ZXAoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkQm9kaWVzJzoKICAgICAgICB7CiAgICAgICAgICBhZGRCb2RpZXMoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBkYXRhKTsKICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHN0YXRlLndvcmxkLnJlbW92ZUJvZHkoc3RhdGUuYm9kaWVzW2RhdGEudXVpZFtpXV0pOwoKICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3N1YnNjcmliZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBpZCwKICAgICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgICB0eXBlCiAgICAgICAgICB9ID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnN1YnNjcmlwdGlvbnNbaWRdID0gW2RhdGEudXVpZCwgdHlwZSwgdGFyZ2V0XTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFBvc2l0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5wb3NpdGlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRRdWF0ZXJuaW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdLCBkYXRhLnByb3BzWzNdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS52ZWxvY2l0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyVmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJWZWxvY2l0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyRmFjdG9yJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyRmFjdG9yLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldE1hc3MnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLm1hc3MgPSBkYXRhLnByb3BzOwogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TGluZWFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubGluZWFyRGFtcGluZyA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYW5ndWxhckRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRTbGVlcFNwZWVkTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwU3BlZWRMaW1pdCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRTbGVlcFRpbWVMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBUaW1lTGltaXQgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbGxpc2lvbkZpbHRlck1hc2snOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlck1hc2sgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uUmVzcG9uc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvblJlc3BvbnNlID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0R3Jhdml0eSc6CiAgICAgICAgc3RhdGUud29ybGQuZ3Jhdml0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRUb2xlcmFuY2UnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyLnRvbGVyYW5jZSA9IGRhdGEucHJvcHM7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEl0ZXJhdGlvbnMnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEF4aXNJbmRleCc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLmJyb2FkcGhhc2UgaW5zdGFuY2VvZiBTQVBCcm9hZHBoYXNlKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlLmF4aXNJbmRleCA9IGRhdGEucHJvcHMgPT09IHVuZGVmaW5lZCB8fCBkYXRhLnByb3BzID09PSBudWxsID8gMCA6IGRhdGEucHJvcHM7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5SW1wdWxzZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUxvY2FsRm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxGb3JjZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseVRvcnF1ZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlUb3JxdWUobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYWRkQ29uc3RyYWludCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29uc3RyYWludChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKCiAgICAgICAgaWYgKHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF0pIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSk7CiAgICAgICAgICBkZWxldGUgc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZGlzYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5tYXAoYyA9PiBjLmRpc2FibGUoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdlbmFibGVDb25zdHJhaW50TW90b3InOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuZW5hYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3RvclNwZWVkJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yU3BlZWQoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yTWF4Rm9yY2UnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JNYXhGb3JjZShkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdTdGlmZm5lc3MnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLnN0aWZmbmVzcyA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdSZXN0TGVuZ3RoJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5yZXN0TGVuZ3RoID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnNwcmluZ3NbZGF0YS51dWlkXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRSYXknOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheShzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FkZFJheWNhc3RWZWhpY2xlJzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXljYXN0VmVoaWNsZShzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVSYXljYXN0VmVoaWNsZSc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0ucHJlU3RlcCk7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0ucG9zdFN0ZXApOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLndvcmxkID0gbnVsbDsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVTdGVlcmluZ1ZhbHVlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbdmFsdWUsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FwcGx5UmF5Y2FzdFZlaGljbGVFbmdpbmVGb3JjZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW3ZhbHVlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRDb250YWN0TWF0ZXJpYWwnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnRhY3RNYXRlcmlhbChzdGF0ZS53b3JsZCwgY3JlYXRlTWF0ZXJpYWwsIGRhdGEucHJvcHMsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVDb250YWN0TWF0ZXJpYWwnOgogICAgICAgIHsKICAgICAgICAgIHJlbW92ZUNvbnRhY3RNYXRlcmlhbChzdGF0ZS53b3JsZCwgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzbGVlcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXAoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICB9OwoKfSkoKTsKCg==",null,!1);class VT extends AT{get axisIndex(){return this.config.axisIndex}set axisIndex(e){this.config.axisIndex=e,this.worker.postMessage({op:"setAxisIndex",props:e})}get broadphase(){return this.config.broadphase}set broadphase(e){this.config.broadphase=e,this.worker.postMessage({op:"setBroadphase",props:e})}get gravity(){return this.config.gravity}set gravity(e){this.config.gravity=e,this.worker.postMessage({op:"setGravity",props:e})}get iterations(){return this.config.iterations}set iterations(e){this.config.iterations=e,this.worker.postMessage({op:"setIterations",props:e})}get tolerance(){return this.config.tolerance}set tolerance(e){this.config.tolerance=e,this.worker.postMessage({op:"setTolerance",props:e})}constructor(e){let{allowSleep:t=!1,axisIndex:i=0,broadphase:o="Naive",defaultContactMaterial:s={contactEquationStiffness:1e6},gravity:r=[0,-9.81,0],iterations:g=5,quatNormalizeFast:a=!1,quatNormalizeSkip:l=0,size:u=1e3,solver:d="GS",tolerance:C=.001}=e;super();this.worker=new ST,this.config={allowSleep:t,axisIndex:i,broadphase:o,defaultContactMaterial:s,gravity:r,iterations:g,quatNormalizeFast:a,quatNormalizeSkip:l,size:u,solver:d,tolerance:C},this.buffers={positions:new Float32Array(u*3),quaternions:new Float32Array(u*4)},this.worker.onmessage=A=>{if(A.data.op==="frame"){this.buffers.positions=A.data.positions,this.buffers.quaternions=A.data.quaternions,this.emit(A.data.op,A.data);return}this.emit(A.data.type,A.data)}}addBodies(e){let{props:t,type:i,uuid:o}=e;this.worker.postMessage({op:"addBodies",props:t,type:i,uuid:o})}addConstraint(e){let{props:[t,i,o],type:s,uuid:r}=e;this.worker.postMessage({op:"addConstraint",props:[t,i,o],type:s,uuid:r})}addContactMaterial(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"addContactMaterial",props:t,uuid:i})}addRay(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"addRay",props:t,uuid:i})}addRaycastVehicle(e){let{props:[t,i,o,s,r,g],uuid:a}=e;this.worker.postMessage({op:"addRaycastVehicle",props:[t,i,o,s,r,g],uuid:a})}addSpring(e){let{props:[t,i,o],uuid:s}=e;this.worker.postMessage({op:"addSpring",props:[t,i,o],uuid:s})}applyForce(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"applyForce",props:t,uuid:i})}applyImpulse(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"applyImpulse",props:t,uuid:i})}applyLocalForce(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"applyLocalForce",props:t,uuid:i})}applyLocalImpulse(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"applyLocalImpulse",props:t,uuid:i})}applyRaycastVehicleEngineForce(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"applyRaycastVehicleEngineForce",props:t,uuid:i})}applyTorque(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"applyTorque",props:t,uuid:i})}disableConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"disableConstraint",uuid:t})}disableConstraintMotor(e){let{uuid:t}=e;this.worker.postMessage({op:"disableConstraintMotor",uuid:t})}enableConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"enableConstraint",uuid:t})}enableConstraintMotor(e){let{uuid:t}=e;this.worker.postMessage({op:"enableConstraintMotor",uuid:t})}init(){const{allowSleep:e,axisIndex:t,broadphase:i,defaultContactMaterial:o,gravity:s,iterations:r,quatNormalizeFast:g,quatNormalizeSkip:a,solver:l,tolerance:u}=this.config;this.worker.postMessage({op:"init",props:{allowSleep:e,axisIndex:t,broadphase:i,defaultContactMaterial:o,gravity:s,iterations:r,quatNormalizeFast:g,quatNormalizeSkip:a,solver:l,tolerance:u}})}removeBodies(e){let{uuid:t}=e;this.worker.postMessage({op:"removeBodies",uuid:t})}removeConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"removeConstraint",uuid:t})}removeContactMaterial(e){let{uuid:t}=e;this.worker.postMessage({op:"removeContactMaterial",uuid:t})}removeRay(e){let{uuid:t}=e;this.worker.postMessage({op:"removeRay",uuid:t})}removeRaycastVehicle(e){let{uuid:t}=e;this.worker.postMessage({op:"removeRaycastVehicle",uuid:t})}removeSpring(e){let{uuid:t}=e;this.worker.postMessage({op:"removeSpring",uuid:t})}setAllowSleep(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setAllowSleep",props:t,uuid:i})}setAngularDamping(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setAngularDamping",props:t,uuid:i})}setAngularFactor(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setAngularFactor",props:t,uuid:i})}setAngularVelocity(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setAngularVelocity",props:t,uuid:i})}setCollisionFilterGroup(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setCollisionFilterGroup",props:t,uuid:i})}setCollisionFilterMask(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setCollisionFilterMask",props:t,uuid:i})}setCollisionResponse(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setCollisionResponse",props:t,uuid:i})}setConstraintMotorMaxForce(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setConstraintMotorMaxForce",props:t,uuid:i})}setConstraintMotorSpeed(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setConstraintMotorSpeed",props:t,uuid:i})}setFixedRotation(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setFixedRotation",props:t,uuid:i})}setIsTrigger(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setIsTrigger",props:t,uuid:i})}setLinearDamping(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setLinearDamping",props:t,uuid:i})}setLinearFactor(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setLinearFactor",props:t,uuid:i})}setMass(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setMass",props:t,uuid:i})}setMaterial(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setMaterial",props:t,uuid:i})}setPosition(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setPosition",props:t,uuid:i})}setQuaternion(e){let{props:[t,i,o,s],uuid:r}=e;this.worker.postMessage({op:"setQuaternion",props:[t,i,o,s],uuid:r})}setRaycastVehicleBrake(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setRaycastVehicleBrake",props:t,uuid:i})}setRaycastVehicleSteeringValue(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setRaycastVehicleSteeringValue",props:t,uuid:i})}setRotation(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setRotation",props:t,uuid:i})}setSleepSpeedLimit(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setSleepSpeedLimit",props:t,uuid:i})}setSleepTimeLimit(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setSleepTimeLimit",props:t,uuid:i})}setSpringDamping(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setSpringDamping",props:t,uuid:i})}setSpringRestLength(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setSpringRestLength",props:t,uuid:i})}setSpringStiffness(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setSpringStiffness",props:t,uuid:i})}setUserData(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setUserData",props:t,uuid:i})}setVelocity(e){let{props:t,uuid:i}=e;this.worker.postMessage({op:"setVelocity",props:t,uuid:i})}sleep(e){let{uuid:t}=e;this.worker.postMessage({op:"sleep",uuid:t})}step(e){const{buffers:{positions:t,quaternions:i}}=this;!t.byteLength&&!i.byteLength||this.worker.postMessage({op:"step",positions:t,props:e,quaternions:i},[t.buffer,i.buffer])}subscribe(e){let{props:{id:t,target:i,type:o},uuid:s}=e;this.worker.postMessage({op:"subscribe",props:{id:t,target:i,type:o},uuid:s})}terminate(){this.worker.terminate()}unsubscribe(e){let{props:t}=e;this.worker.postMessage({op:"unsubscribe",props:t})}wakeUp(e){let{uuid:t}=e;this.worker.postMessage({op:"wakeUp",uuid:t})}}const LH=ce.exports.createContext({}),xT=ce.exports.createContext(null);function HT(n){let{axisIndex:e,broadphase:t,gravity:i,iterations:o,tolerance:s,worker:r}=n;ce.exports.useEffect(()=>{r.axisIndex=e},[e]),ce.exports.useEffect(()=>{r.broadphase=t},[t]),ce.exports.useEffect(()=>{r.gravity=i},[i]),ce.exports.useEffect(()=>{r.iterations=o},[o]),ce.exports.useEffect(()=>{r.tolerance=s},[s])}const XT=new K,MT=new K(1,1,1),KT=new xn,sA=new et;function oR(n,e,t,i){return n!==void 0?(sA.compose(XT.fromArray(e,n*3),KT.fromArray(t,n*4),i?i.scale:MT),i&&(i.matrixAutoUpdate=!1,i.matrix.copy(sA)),sA):sA.identity()}const FT=n=>{let{allowSleep:e=!1,axisIndex:t=0,broadphase:i="Naive",children:o,defaultContactMaterial:s={contactEquationStiffness:1e6},gravity:r=[0,-9.81,0],isPaused:g=!1,iterations:a=5,maxSubSteps:l=10,quatNormalizeFast:u=!1,quatNormalizeSkip:d=0,shouldInvalidate:C=!0,size:A=1e3,solver:f="GS",stepSize:b=1/60,tolerance:G=.001}=n;const{invalidate:m}=tT(),[h]=ce.exports.useState(()=>new VT({allowSleep:e,axisIndex:t,broadphase:i,defaultContactMaterial:s,gravity:r,iterations:a,quatNormalizeFast:u,quatNormalizeSkip:d,size:A,solver:f,tolerance:G})),[B]=ce.exports.useState({}),[y]=ce.exports.useState({}),[Z]=ce.exports.useState({}),R=ce.exports.useRef({});let W=0;const x=ce.exports.useCallback((D,Q)=>{g||(W+=Q,h.step({maxSubSteps:l,stepSize:b,timeSinceLastCalled:W}),W=0)},[g,l,b]),X=D=>{var Q;let Me=D,{body:$,contact:ee}=Me,_=ee,{bi:j,bj:oe}=_,Ie=qn(_,["bi","bj"]),Ae=Me,{target:T}=Ae,P=qn(Ae,["body","contact","target"]);const Ce=(Q=y[T])==null?void 0:Q.collide;Ce&&Ce(gt({body:B[$],contact:gt({bi:B[j],bj:B[oe]},Ie),target:B[T]},P))},Y=D=>{var Q,$;let{bodyA:j,bodyB:oe}=D;const Ie=(Q=y[j])==null?void 0:Q.collideBegin;Ie&&Ie({body:B[oe],op:"event",target:B[j],type:"collideBegin"});const T=($=y[oe])==null?void 0:$.collideBegin;T&&T({body:B[j],op:"event",target:B[oe],type:"collideBegin"})},S=D=>{var Q,$;let{bodyA:j,bodyB:oe}=D;const Ie=(Q=y[j])==null?void 0:Q.collideEnd;Ie&&Ie({body:B[oe],op:"event",target:B[j],type:"collideEnd"});const T=($=y[oe])==null?void 0:$.collideEnd;T&&T({body:B[j],op:"event",target:B[oe],type:"collideEnd"})},H=D=>{let{active:Q,bodies:$=[],observations:j,positions:oe,quaternions:Ie}=D;for(let T=0;T<$.length;T++)R.current[$[T]]=T;if(j.forEach(T=>{let[P,Ce,Me]=T;const _=(Z[P]||{})[Me];_&&_(Ce)}),Q){for(const T of Object.values(B))if(T instanceof Eg)for(let P=0;P<T.count;P++){const Ce=R.current[`${T.uuid}/${P}`];Ce!==void 0&&T.setMatrixAt(P,oR(Ce,oe,Ie)),T.instanceMatrix.needsUpdate=!0}else oR(R.current[T.uuid],oe,Ie,T);C&&m()}},k=D=>{var Q;let P=D,{body:$,ray:Ce}=P,Me=Ce,{uuid:j}=Me,oe=qn(Me,["uuid"]),Ie=qn(P,["body","ray"]);const T=(Q=y[j])==null?void 0:Q.rayhit;T&&T(gt({body:$?B[$]:null,ray:gt({uuid:j},oe)},Ie))};nT(x),ce.exports.useLayoutEffect(()=>(h.init(),h.on("collide",X),h.on("collideBegin",Y),h.on("collideEnd",S),h.on("frame",H),h.on("rayhit",k),()=>{h.terminate(),h.removeAllListeners()}),[]),HT({axisIndex:t,broadphase:i,gravity:r,iterations:a,tolerance:G,worker:h});const U=ce.exports.useMemo(()=>({bodies:R,events:y,refs:B,subscriptions:Z,worker:h}),[R,y,B,Z,h]);return en(LH.Provider,{value:U,children:o})};class br{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=void 0,this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new z);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new z);const i=this.elements,o=e.x,s=e.y,r=e.z;return t.x=i[0]*o+i[1]*s+i[2]*r,t.y=i[3]*o+i[4]*s+i[5]*r,t.z=i[6]*o+i[7]*s+i[8]*r,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new br);const i=this.elements,o=e.elements,s=t.elements,r=i[0],g=i[1],a=i[2],l=i[3],u=i[4],d=i[5],C=i[6],A=i[7],f=i[8],b=o[0],G=o[1],m=o[2],h=o[3],B=o[4],y=o[5],Z=o[6],R=o[7],W=o[8];return s[0]=r*b+g*h+a*Z,s[1]=r*G+g*B+a*R,s[2]=r*m+g*y+a*W,s[3]=l*b+u*h+d*Z,s[4]=l*G+u*B+d*R,s[5]=l*m+u*y+d*W,s[6]=C*b+A*h+f*Z,s[7]=C*G+A*B+f*R,s[8]=C*m+A*y+f*W,t}scale(e,t){t===void 0&&(t=new br);const i=this.elements,o=t.elements;for(let s=0;s!==3;s++)o[3*s+0]=e.x*i[3*s+0],o[3*s+1]=e.y*i[3*s+1],o[3*s+2]=e.z*i[3*s+2];return t}solve(e,t){t===void 0&&(t=new z);const i=3,o=4,s=[];let r,g;for(r=0;r<i*o;r++)s.push(0);for(r=0;r<3;r++)for(g=0;g<3;g++)s[r+o*g]=this.elements[r+3*g];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let a=3;const l=a;let u;const d=4;let C;do{if(r=l-a,s[r+o*r]===0){for(g=r+1;g<l;g++)if(s[r+o*g]!==0){u=d;do C=d-u,s[C+o*r]+=s[C+o*g];while(--u);break}}if(s[r+o*r]!==0)for(g=r+1;g<l;g++){const A=s[r+o*g]/s[r+o*r];u=d;do C=d-u,s[C+o*g]=C<=r?0:s[C+o*g]-s[C+o*r]*A;while(--u)}}while(--a);if(t.z=s[2*o+3]/s[2*o+2],t.y=(s[1*o+3]-s[1*o+2]*t.z)/s[1*o+1],t.x=(s[0*o+3]-s[0*o+2]*t.z-s[0*o+1]*t.y)/s[0*o+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t}e(e,t,i){if(i===void 0)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let i=0;i<9;i++)e+=this.elements[i]+t;return e}reverse(e){e===void 0&&(e=new br);const t=3,i=6,o=YT;let s,r;for(s=0;s<3;s++)for(r=0;r<3;r++)o[s+i*r]=this.elements[s+3*r];o[3+6*0]=1,o[3+6*1]=0,o[3+6*2]=0,o[4+6*0]=0,o[4+6*1]=1,o[4+6*2]=0,o[5+6*0]=0,o[5+6*1]=0,o[5+6*2]=1;let g=3;const a=g;let l;const u=i;let d;do{if(s=a-g,o[s+i*s]===0){for(r=s+1;r<a;r++)if(o[s+i*r]!==0){l=u;do d=u-l,o[d+i*s]+=o[d+i*r];while(--l);break}}if(o[s+i*s]!==0)for(r=s+1;r<a;r++){const C=o[s+i*r]/o[s+i*s];l=u;do d=u-l,o[d+i*r]=d<=s?0:o[d+i*r]-o[d+i*s]*C;while(--l)}}while(--g);s=2;do{r=s-1;do{const C=o[s+i*r]/o[s+i*s];l=i;do d=i-l,o[d+i*r]=o[d+i*r]-o[d+i*s]*C;while(--l)}while(r--)}while(--s);s=2;do{const C=1/o[s+i*s];l=i;do d=i-l,o[d+i*s]=o[d+i*s]*C;while(--l)}while(s--);s=2;do{r=2;do{if(d=o[t+r+i*s],isNaN(d)||d===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(s,r,d)}while(r--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,i=e.y,o=e.z,s=e.w,r=t+t,g=i+i,a=o+o,l=t*r,u=t*g,d=t*a,C=i*g,A=i*a,f=o*a,b=s*r,G=s*g,m=s*a,h=this.elements;return h[3*0+0]=1-(C+f),h[3*0+1]=u-m,h[3*0+2]=d+G,h[3*1+0]=u+m,h[3*1+1]=1-(l+f),h[3*1+2]=A-b,h[3*2+0]=d-G,h[3*2+1]=A+b,h[3*2+2]=1-(l+C),this}transpose(e){e===void 0&&(e=new br);const t=this.elements,i=e.elements;let o;return i[0]=t[0],i[4]=t[4],i[8]=t[8],o=t[1],i[1]=t[3],i[3]=o,o=t[2],i[2]=t[6],i[6]=o,o=t[5],i[5]=t[7],i[7]=o,e}}const YT=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class z{constructor(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.x=e,this.y=t,this.z=i}cross(e,t){t===void 0&&(t=new z);const i=e.x,o=e.y,s=e.z,r=this.x,g=this.y,a=this.z;return t.x=g*s-a*o,t.y=a*i-r*s,t.z=r*o-g*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new z(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new z(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new br([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,i=this.z,o=Math.sqrt(e*e+t*t+i*i);if(o>0){const s=1/o;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return o}unit(e){e===void 0&&(e=new z);const t=this.x,i=this.y,o=this.z;let s=Math.sqrt(t*t+i*i+o*o);return s>0?(s=1/s,e.x=t*s,e.y=i*s,e.z=o*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,i=this.y,o=this.z,s=e.x,r=e.y,g=e.z;return Math.sqrt((s-t)*(s-t)+(r-i)*(r-i)+(g-o)*(g-o))}distanceSquared(e){const t=this.x,i=this.y,o=this.z,s=e.x,r=e.y,g=e.z;return(s-t)*(s-t)+(r-i)*(r-i)+(g-o)*(g-o)}scale(e,t){t===void 0&&(t=new z);const i=this.x,o=this.y,s=this.z;return t.x=e*i,t.y=e*o,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new z),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i){return i===void 0&&(i=new z),i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new z),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const i=this.length();if(i>0){const o=NT,s=1/i;o.set(this.x*s,this.y*s,this.z*s);const r=LT;Math.abs(o.x)<.9?(r.set(1,0,0),o.cross(r,e)):(r.set(0,1,0),o.cross(r,e)),o.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){const o=this.x,s=this.y,r=this.z;i.x=o+(e.x-o)*t,i.y=s+(e.y-s)*t,i.z=r+(e.z-r)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(sR),sR.almostEquals(e,t)}clone(){return new z(this.x,this.y,this.z)}}z.ZERO=void 0;z.UNIT_X=void 0;z.UNIT_Y=void 0;z.UNIT_Z=void 0;z.ZERO=new z(0,0,0);z.UNIT_X=new z(1,0,0);z.UNIT_Y=new z(0,1,0);z.UNIT_Z=new z(0,0,1);const NT=new z,LT=new z,sR=new z;class ho{constructor(e){e===void 0&&(e={}),this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new z,this.upperBound=new z,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,o){const s=this.lowerBound,r=this.upperBound,g=i;s.copy(e[0]),g&&g.vmult(s,s),r.copy(s);for(let a=1;a<e.length;a++){let l=e[a];g&&(g.vmult(l,rR),l=rR),l.x>r.x&&(r.x=l.x),l.x<s.x&&(s.x=l.x),l.y>r.y&&(r.y=l.y),l.y<s.y&&(s.y=l.y),l.z>r.z&&(r.z=l.z),l.z<s.z&&(s.z=l.z)}return t&&(t.vadd(s,s),t.vadd(r,r)),o&&(s.x-=o,s.y-=o,s.z-=o,r.x+=o,r.y+=o,r.z+=o),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new ho().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,i=this.upperBound,o=e.lowerBound,s=e.upperBound,r=o.x<=i.x&&i.x<=s.x||t.x<=s.x&&s.x<=i.x,g=o.y<=i.y&&i.y<=s.y||t.y<=s.y&&s.y<=i.y,a=o.z<=i.z&&i.z<=s.z||t.z<=s.z&&s.z<=i.z;return r&&g&&a}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,i=this.upperBound,o=e.lowerBound,s=e.upperBound;return t.x<=o.x&&i.x>=s.x&&t.y<=o.y&&i.y>=s.y&&t.z<=o.z&&i.z>=s.z}getCorners(e,t,i,o,s,r,g,a){const l=this.lowerBound,u=this.upperBound;e.copy(l),t.set(u.x,l.y,l.z),i.set(u.x,u.y,l.z),o.set(l.x,u.y,u.z),s.set(u.x,l.y,u.z),r.set(l.x,u.y,l.z),g.set(l.x,l.y,u.z),a.copy(u)}toLocalFrame(e,t){const i=gR,o=i[0],s=i[1],r=i[2],g=i[3],a=i[4],l=i[5],u=i[6],d=i[7];this.getCorners(o,s,r,g,a,l,u,d);for(let C=0;C!==8;C++){const A=i[C];e.pointToLocal(A,A)}return t.setFromPoints(i)}toWorldFrame(e,t){const i=gR,o=i[0],s=i[1],r=i[2],g=i[3],a=i[4],l=i[5],u=i[6],d=i[7];this.getCorners(o,s,r,g,a,l,u,d);for(let C=0;C!==8;C++){const A=i[C];e.pointToWorld(A,A)}return t.setFromPoints(i)}overlapsRay(e){const{direction:t,from:i}=e,o=1/t.x,s=1/t.y,r=1/t.z,g=(this.lowerBound.x-i.x)*o,a=(this.upperBound.x-i.x)*o,l=(this.lowerBound.y-i.y)*s,u=(this.upperBound.y-i.y)*s,d=(this.lowerBound.z-i.z)*r,C=(this.upperBound.z-i.z)*r,A=Math.max(Math.max(Math.min(g,a),Math.min(l,u)),Math.min(d,C)),f=Math.min(Math.min(Math.max(g,a),Math.max(l,u)),Math.max(d,C));return!(f<0||A>f)}}const rR=new z,gR=[new z,new z,new z,new z,new z,new z,new z,new z];class Mi{constructor(e,t,i,o){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),o===void 0&&(o=1),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=e,this.y=t,this.z=i,this.w=o}set(e,t,i,o){return this.x=e,this.y=t,this.z=i,this.w=o,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const i=Math.sin(t*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new z),this.normalize();const t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const i=zT,o=kT;e.tangents(i,o),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Mi);const i=this.x,o=this.y,s=this.z,r=this.w,g=e.x,a=e.y,l=e.z,u=e.w;return t.x=i*u+r*g+o*l-s*a,t.y=o*u+r*a+s*g-i*l,t.z=s*u+r*l+i*a-o*g,t.w=r*u-i*g-o*a-s*l,t}inverse(e){e===void 0&&(e=new Mi);const t=this.x,i=this.y,o=this.z,s=this.w;this.conjugate(e);const r=1/(t*t+i*i+o*o+s*s);return e.x*=r,e.y*=r,e.z*=r,e.w*=r,e}conjugate(e){return e===void 0&&(e=new Mi),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new z);const i=e.x,o=e.y,s=e.z,r=this.x,g=this.y,a=this.z,l=this.w,u=l*i+g*s-a*o,d=l*o+a*i-r*s,C=l*s+r*o-g*i,A=-r*i-g*o-a*s;return t.x=u*l+A*-r+d*-a-C*-g,t.y=d*l+A*-g+C*-r-u*-a,t.z=C*l+A*-a+u*-g-d*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let i,o,s;const r=this.x,g=this.y,a=this.z,l=this.w;switch(t){case"YZX":const u=r*g+a*l;if(u>.499&&(i=2*Math.atan2(r,l),o=Math.PI/2,s=0),u<-.499&&(i=-2*Math.atan2(r,l),o=-Math.PI/2,s=0),i===void 0){const d=r*r,C=g*g,A=a*a;i=Math.atan2(2*g*l-2*r*a,1-2*C-2*A),o=Math.asin(2*u),s=Math.atan2(2*r*l-2*g*a,1-2*d-2*A)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=i,e.z=o,e.x=s}setFromEuler(e,t,i,o){o===void 0&&(o="XYZ");const s=Math.cos(e/2),r=Math.cos(t/2),g=Math.cos(i/2),a=Math.sin(e/2),l=Math.sin(t/2),u=Math.sin(i/2);return o==="XYZ"?(this.x=a*r*g+s*l*u,this.y=s*l*g-a*r*u,this.z=s*r*u+a*l*g,this.w=s*r*g-a*l*u):o==="YXZ"?(this.x=a*r*g+s*l*u,this.y=s*l*g-a*r*u,this.z=s*r*u-a*l*g,this.w=s*r*g+a*l*u):o==="ZXY"?(this.x=a*r*g-s*l*u,this.y=s*l*g+a*r*u,this.z=s*r*u+a*l*g,this.w=s*r*g-a*l*u):o==="ZYX"?(this.x=a*r*g-s*l*u,this.y=s*l*g+a*r*u,this.z=s*r*u-a*l*g,this.w=s*r*g+a*l*u):o==="YZX"?(this.x=a*r*g+s*l*u,this.y=s*l*g+a*r*u,this.z=s*r*u-a*l*g,this.w=s*r*g-a*l*u):o==="XZY"&&(this.x=a*r*g-s*l*u,this.y=s*l*g-a*r*u,this.z=s*r*u+a*l*g,this.w=s*r*g+a*l*u),this}clone(){return new Mi(this.x,this.y,this.z,this.w)}slerp(e,t,i){i===void 0&&(i=new Mi);const o=this.x,s=this.y,r=this.z,g=this.w;let a=e.x,l=e.y,u=e.z,d=e.w,C,A,f,b,G;return A=o*a+s*l+r*u+g*d,A<0&&(A=-A,a=-a,l=-l,u=-u,d=-d),1-A>1e-6?(C=Math.acos(A),f=Math.sin(C),b=Math.sin((1-t)*C)/f,G=Math.sin(t*C)/f):(b=1-t,G=t),i.x=b*o+G*a,i.y=b*s+G*l,i.z=b*r+G*u,i.w=b*g+G*d,i}integrate(e,t,i,o){o===void 0&&(o=new Mi);const s=e.x*i.x,r=e.y*i.y,g=e.z*i.z,a=this.x,l=this.y,u=this.z,d=this.w,C=t*.5;return o.x+=C*(s*d+r*u-g*l),o.y+=C*(r*d+g*a-s*u),o.z+=C*(g*d+s*l-r*a),o.w+=C*(-s*a-r*l-g*u),o}}const zT=new z,kT=new z,TT={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class ot{constructor(e){e===void 0&&(e={}),this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=ot.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(e,t,i,o){throw"calculateWorldAABB() not implemented for shape type "+this.type}}ot.idCounter=0;ot.types=TT;class Hi{constructor(e){e===void 0&&(e={}),this.position=void 0,this.quaternion=void 0,this.position=new z,this.quaternion=new Mi,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Hi.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Hi.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new z),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,o){return o===void 0&&(o=new z),i.vsub(e,o),t.conjugate(aR),aR.vmult(o,o),o}static pointToWorldFrame(e,t,i,o){return o===void 0&&(o=new z),t.vmult(i,o),o.vadd(e,o),o}static vectorToWorldFrame(e,t,i){return i===void 0&&(i=new z),e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,o){return o===void 0&&(o=new z),t.w*=-1,t.vmult(i,o),t.w*=-1,o}}const aR=new Mi;new z;new z;new z;new z,new z,new z,new z,new z,new z,new z,new z;new z;new Mi;new ho;new br;new br;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;class lR{constructor(){this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new z,this.rayToWorld=new z,this.hitNormalWorld=new z,this.hitPointWorld=new z,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,o,s,r,g){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(o),this.shape=s,this.body=r,this.distance=g}}let zH,kH,TH,EH,_H,JH,DH;const ey={CLOSEST:1,ANY:2,ALL:4};zH=ot.types.SPHERE;kH=ot.types.PLANE;TH=ot.types.BOX;EH=ot.types.CYLINDER;_H=ot.types.CONVEXPOLYHEDRON;JH=ot.types.HEIGHTFIELD;DH=ot.types.TRIMESH;class ci{get[zH](){return this._intersectSphere}get[kH](){return this._intersectPlane}get[TH](){return this._intersectBox}get[EH](){return this._intersectConvex}get[_H](){return this._intersectConvex}get[JH](){return this._intersectHeightfield}get[DH](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new z),t===void 0&&(t=new z),this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=e.clone(),this.to=t.clone(),this.direction=new z,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ci.ANY,this.result=new lR,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,t){return this.mode=t.mode||ci.ANY,this.result=t.result||new lR,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask!="undefined"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup!="undefined"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse!="undefined"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(IR),ob.length=0,e.broadphase.aabbQuery(e,IR,ob),this.intersectBodies(ob),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const o=ET,s=_T;for(let r=0,g=e.shapes.length;r<g;r++){const a=e.shapes[r];if(!(i&&!a.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],s),e.quaternion.vmult(e.shapeOffsets[r],o),o.vadd(e.position,o),this.intersectShape(a,s,o,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,o=e.length;!this.result.shouldStop&&i<o;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,o){const s=this.from;if(oE(s,this.direction,i)>e.boundingSphereRadius)return;const g=this[e.type];g&&g.call(this,e,t,i,o,e)}_intersectBox(e,t,i,o,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,o,s)}_intersectPlane(e,t,i,o,s){const r=this.from,g=this.to,a=this.direction,l=new z(0,0,1);t.vmult(l,l);const u=new z;r.vsub(i,u);const d=u.dot(l);g.vsub(i,u);const C=u.dot(l);if(d*C>0||r.distanceTo(g)<d)return;const A=l.dot(a);if(Math.abs(A)<this.precision)return;const f=new z,b=new z,G=new z;r.vsub(i,f);const m=-l.dot(f)/A;a.scale(m,b),r.vadd(b,G),this.reportIntersection(l,G,s,o,-1)}getAABB(e){const{lowerBound:t,upperBound:i}=e,o=this.to,s=this.from;t.x=Math.min(o.x,s.x),t.y=Math.min(o.y,s.y),t.z=Math.min(o.z,s.z),i.x=Math.max(o.x,s.x),i.y=Math.max(o.y,s.y),i.z=Math.max(o.z,s.z)}_intersectHeightfield(e,t,i,o,s){e.data,e.elementSize;const r=JT;r.from.copy(this.from),r.to.copy(this.to),Hi.pointToLocalFrame(i,t,r.from,r.from),Hi.pointToLocalFrame(i,t,r.to,r.to),r.updateDirection();const g=DT;let a,l,u,d;a=l=0,u=d=e.data.length-1;const C=new ho;r.getAABB(C),e.getIndexOfPosition(C.lowerBound.x,C.lowerBound.y,g,!0),a=Math.max(a,g[0]),l=Math.max(l,g[1]),e.getIndexOfPosition(C.upperBound.x,C.upperBound.y,g,!0),u=Math.min(u,g[0]+1),d=Math.min(d,g[1]+1);for(let A=a;A<u;A++)for(let f=l;f<d;f++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(A,f,C),!!C.overlapsRay(r)){if(e.getConvexTrianglePillar(A,f,!1),Hi.pointToWorldFrame(i,t,e.pillarOffset,rA),this._intersectConvex(e.pillarConvex,t,rA,o,s,cR),this.result.shouldStop)return;e.getConvexTrianglePillar(A,f,!0),Hi.pointToWorldFrame(i,t,e.pillarOffset,rA),this._intersectConvex(e.pillarConvex,t,rA,o,s,cR)}}}_intersectSphere(e,t,i,o,s){const r=this.from,g=this.to,a=e.radius,l=(g.x-r.x)**2+(g.y-r.y)**2+(g.z-r.z)**2,u=2*((g.x-r.x)*(r.x-i.x)+(g.y-r.y)*(r.y-i.y)+(g.z-r.z)*(r.z-i.z)),d=(r.x-i.x)**2+(r.y-i.y)**2+(r.z-i.z)**2-a**2,C=u**2-4*l*d,A=UT,f=PT;if(!(C<0))if(C===0)r.lerp(g,C,A),A.vsub(i,f),f.normalize(),this.reportIntersection(f,A,s,o,-1);else{const b=(-u-Math.sqrt(C))/(2*l),G=(-u+Math.sqrt(C))/(2*l);if(b>=0&&b<=1&&(r.lerp(g,b,A),A.vsub(i,f),f.normalize(),this.reportIntersection(f,A,s,o,-1)),this.result.shouldStop)return;G>=0&&G<=1&&(r.lerp(g,G,A),A.vsub(i,f),f.normalize(),this.reportIntersection(f,A,s,o,-1))}}_intersectConvex(e,t,i,o,s,r){const g=QT,a=CR,l=r&&r.faceList||null,u=e.faces,d=e.vertices,C=e.faceNormals,A=this.direction,f=this.from,b=this.to,G=f.distanceTo(b),m=l?l.length:u.length,h=this.result;for(let B=0;!h.shouldStop&&B<m;B++){const y=l?l[B]:B,Z=u[y],R=C[y],W=t,x=i;a.copy(d[Z[0]]),W.vmult(a,a),a.vadd(x,a),a.vsub(f,a),W.vmult(R,g);const X=A.dot(g);if(Math.abs(X)<this.precision)continue;const Y=g.dot(a)/X;if(!(Y<0)){A.scale(Y,Vi),Vi.vadd(f,Vi),Ro.copy(d[Z[0]]),W.vmult(Ro,Ro),x.vadd(Ro,Ro);for(let S=1;!h.shouldStop&&S<Z.length-1;S++){_o.copy(d[Z[S]]),Jo.copy(d[Z[S+1]]),W.vmult(_o,_o),W.vmult(Jo,Jo),x.vadd(_o,_o),x.vadd(Jo,Jo);const H=Vi.distanceTo(f);!(ci.pointInTriangle(Vi,Ro,_o,Jo)||ci.pointInTriangle(Vi,_o,Ro,Jo))||H>G||this.reportIntersection(g,Vi,s,o,y)}}}}_intersectTrimesh(e,t,i,o,s,r){const g=OT,a=nE,l=iE,u=CR,d=jT,C=qT,A=$T,f=tE,b=eE,G=e.indices;e.vertices;const m=this.from,h=this.to,B=this.direction;l.position.copy(i),l.quaternion.copy(t),Hi.vectorToLocalFrame(i,t,B,d),Hi.pointToLocalFrame(i,t,m,C),Hi.pointToLocalFrame(i,t,h,A),A.x*=e.scale.x,A.y*=e.scale.y,A.z*=e.scale.z,C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,A.vsub(C,d),d.normalize();const y=C.distanceSquared(A);e.tree.rayQuery(this,l,a);for(let Z=0,R=a.length;!this.result.shouldStop&&Z!==R;Z++){const W=a[Z];e.getNormal(W,g),e.getVertex(G[W*3],Ro),Ro.vsub(C,u);const x=d.dot(g),X=g.dot(u)/x;if(X<0)continue;d.scale(X,Vi),Vi.vadd(C,Vi),e.getVertex(G[W*3+1],_o),e.getVertex(G[W*3+2],Jo);const Y=Vi.distanceSquared(C);!(ci.pointInTriangle(Vi,_o,Ro,Jo)||ci.pointInTriangle(Vi,Ro,_o,Jo))||Y>y||(Hi.vectorToWorldFrame(t,g,b),Hi.pointToWorldFrame(i,t,Vi,f),this.reportIntersection(b,f,s,o,W))}a.length=0}reportIntersection(e,t,i,o,s){const r=this.from,g=this.to,a=r.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=typeof s!="undefined"?s:-1,this.mode){case ci.ALL:this.hasHit=!0,l.set(r,g,e,t,i,o,a),l.hasHit=!0,this.callback(l);break;case ci.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(r,g,e,t,i,o,a));break;case ci.ANY:this.hasHit=!0,l.hasHit=!0,l.set(r,g,e,t,i,o,a),l.shouldStop=!0;break}}static pointInTriangle(e,t,i,o){o.vsub(t,vg),i.vsub(t,cc),e.vsub(t,sb);const s=vg.dot(vg),r=vg.dot(cc),g=vg.dot(sb),a=cc.dot(cc),l=cc.dot(sb);let u,d;return(u=a*g-r*l)>=0&&(d=s*l-r*g)>=0&&u+d<s*a-r*r}}ci.CLOSEST=ey.CLOSEST;ci.ANY=ey.ANY;ci.ALL=ey.ALL;const IR=new ho,ob=[],cc=new z,sb=new z,ET=new z,_T=new Mi,Vi=new z,Ro=new z,_o=new z,Jo=new z,cR={faceList:[0]},rA=new z,JT=new ci,DT=[],UT=new z,PT=new z,QT=new z,CR=new z,OT=new z,jT=new z,qT=new z,$T=new z,eE=new z,tE=new z;new ho;const nE=[],iE=new Hi,vg=new z,gA=new z;function oE(n,e,t){t.vsub(n,vg);const i=vg.dot(e);return e.scale(i,gA),gA.vadd(n,gA),t.distanceTo(gA)}new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new ci;new z;new z;new z(1,0,0),new z(0,1,0),new z(0,0,1);new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new ho;new z;new ho;new z;new z;new z;new z;new z;new z;new z;new ho;new z;new Hi;new ho;ot.types.SPHERE,ot.types.SPHERE|ot.types.PLANE,ot.types.BOX|ot.types.BOX,ot.types.SPHERE|ot.types.BOX,ot.types.PLANE|ot.types.BOX,ot.types.CONVEXPOLYHEDRON,ot.types.SPHERE|ot.types.CONVEXPOLYHEDRON,ot.types.PLANE|ot.types.CONVEXPOLYHEDRON,ot.types.BOX|ot.types.CONVEXPOLYHEDRON,ot.types.SPHERE|ot.types.HEIGHTFIELD,ot.types.BOX|ot.types.HEIGHTFIELD,ot.types.CONVEXPOLYHEDRON|ot.types.HEIGHTFIELD,ot.types.PARTICLE|ot.types.SPHERE,ot.types.PLANE|ot.types.PARTICLE,ot.types.BOX|ot.types.PARTICLE,ot.types.PARTICLE|ot.types.CONVEXPOLYHEDRON,ot.types.CYLINDER,ot.types.SPHERE|ot.types.CYLINDER,ot.types.PLANE|ot.types.CYLINDER,ot.types.BOX|ot.types.CYLINDER,ot.types.CONVEXPOLYHEDRON|ot.types.CYLINDER,ot.types.HEIGHTFIELD|ot.types.CYLINDER,ot.types.PARTICLE|ot.types.CYLINDER,ot.types.SPHERE|ot.types.TRIMESH,ot.types.PLANE|ot.types.TRIMESH;new z;new z;new z;new z;new z;new Mi;new Mi;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new ho;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z,new z,new z,new z,new z,new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new z;new Mi;new z;new z;new z;new z;new z;new z;new z;new z;new ho;new ci;const Cc=globalThis.performance||{};if(!Cc.now){let n=Date.now();Cc.timing&&Cc.timing.navigationStart&&(n=Cc.timing.navigationStart),Cc.now=()=>Date.now()-n}new K;new K(1,1,1);new xn;const uR=new Gt;function sE(n){const e=ce.exports.useRef(null);return n&&typeof n!="function"?n:e}function dR(n){return n.charAt(0).toUpperCase()+n.slice(1)}function ai(n,e){const t=e===void 0?"":`/${e}`;return typeof n=="function"?null:n&&n.current&&`${n.current.uuid}${t}`}const rE=new Es,gE=new xn,aE=n=>e=>n(rE.setFromQuaternion(gE.fromArray(e)).toArray());let UH=0;function rb(n,e,t,i,o,s){return s===void 0&&(s="bodies"),r=>{const g=UH++;t[g]={[i]:r};const a=ai(n,o);return a&&e.subscribe({props:{id:g,target:s,type:i},uuid:a}),()=>{delete t[g],e.unsubscribe({props:g})}}}function AR(n,e){n.userData=e.userData||{},n.position.set(...e.position||[0,0,0]),n.rotation.set(...e.rotation||[0,0,0]),n.updateMatrix()}function hR(n,e,t){let{onCollide:i,onCollideBegin:o,onCollideEnd:s}=e;n[t]={collide:i,collideBegin:o,collideEnd:s}}function PH(n,e,t,i,o){o===void 0&&(o=[]);const s=sE(i),{worker:r,refs:g,events:a,subscriptions:l}=ce.exports.useContext(LH),u=ce.exports.useContext(xT);ce.exports.useLayoutEffect(()=>{s.current||(s.current=new Gt);const C=s.current,A=r,f=C instanceof Eg?(C.instanceMatrix.setUsage(Qg),C.count):1,b=C instanceof Eg?new Array(f).fill(0).map((m,h)=>`${C.uuid}/${h}`):[C.uuid],G=C instanceof Eg?b.map((m,h)=>{const B=e(h);return AR(uR,B),C.setMatrixAt(h,uR.matrix),C.instanceMatrix.needsUpdate=!0,g[m]=C,u&&u.add(m,B,n),hR(a,B,m),Mt(gt({},B),{args:t(B.args)})}):b.map((m,h)=>{const B=e(h);return AR(C,B),g[m]=C,u&&u.add(m,B,n),hR(a,B,m),Mt(gt({},B),{args:t(B.args)})});return A.addBodies({props:G.map(m=>{let R=m,{onCollide:h,onCollideBegin:B,onCollideEnd:y}=R,Z=qn(R,["onCollide","onCollideBegin","onCollideEnd"]);return gt({onCollide:Boolean(h)},Z)}),type:n,uuid:b}),()=>{b.forEach(m=>{delete g[m],u&&u.remove(m),delete a[m]}),A.removeBodies({uuid:b})}},o);const d=ce.exports.useMemo(()=>{const C=(h,B)=>{const y=`set${dR(h)}`;return{set:Z=>{const R=ai(s,B);R&&r[y]({props:Z,uuid:R})},subscribe:rb(s,r,l,h,B)}},A=h=>({copy:y=>{let{w:Z,x:R,y:W,z:x}=y;const X=ai(s,h);X&&r.setQuaternion({props:[R,W,x,Z],uuid:X})},set:(y,Z,R,W)=>{const x=ai(s,h);x&&r.setQuaternion({props:[y,Z,R,W],uuid:x})},subscribe:rb(s,r,l,"quaternion",h)}),f=h=>({copy:B=>{let{x:y,y:Z,z:R}=B;const W=ai(s,h);W&&r.setRotation({props:[y,Z,R],uuid:W})},set:(B,y,Z)=>{const R=ai(s,h);R&&r.setRotation({props:[B,y,Z],uuid:R})},subscribe:B=>{const y=UH++,Z="bodies",R="quaternion",W=ai(s,h);return l[y]={[R]:aE(B)},W&&r.subscribe({props:{id:y,target:Z,type:R},uuid:W}),()=>{delete l[y],r.unsubscribe({props:y})}}}),b=(h,B)=>{const y=`set${dR(h)}`;return{copy:Z=>{let{x:R,y:W,z:x}=Z;const X=ai(s,B);X&&r[y]({props:[R,W,x],uuid:X})},set:(Z,R,W)=>{const x=ai(s,B);x&&r[y]({props:[Z,R,W],uuid:x})},subscribe:rb(s,r,l,h,B)}};function G(h){return{allowSleep:C("allowSleep",h),angularDamping:C("angularDamping",h),angularFactor:b("angularFactor",h),angularVelocity:b("angularVelocity",h),applyForce(B,y){const Z=ai(s,h);Z&&r.applyForce({props:[B,y],uuid:Z})},applyImpulse(B,y){const Z=ai(s,h);Z&&r.applyImpulse({props:[B,y],uuid:Z})},applyLocalForce(B,y){const Z=ai(s,h);Z&&r.applyLocalForce({props:[B,y],uuid:Z})},applyLocalImpulse(B,y){const Z=ai(s,h);Z&&r.applyLocalImpulse({props:[B,y],uuid:Z})},applyTorque(B){const y=ai(s,h);y&&r.applyTorque({props:[B],uuid:y})},collisionFilterGroup:C("collisionFilterGroup",h),collisionFilterMask:C("collisionFilterMask",h),collisionResponse:C("collisionResponse",h),fixedRotation:C("fixedRotation",h),isTrigger:C("isTrigger",h),linearDamping:C("linearDamping",h),linearFactor:b("linearFactor",h),mass:C("mass",h),material:C("material",h),position:b("position",h),quaternion:A(h),rotation:f(h),sleep(){const B=ai(s,h);B&&r.sleep({uuid:B})},sleepSpeedLimit:C("sleepSpeedLimit",h),sleepTimeLimit:C("sleepTimeLimit",h),userData:C("userData",h),velocity:b("velocity",h),wakeUp(){const B=ai(s,h);B&&r.wakeUp({uuid:B})}}}const m={};return Mt(gt({},G(void 0)),{at:h=>m[h]||(m[h]=G(h))})},[]);return[s,d]}function e6(n,e,t){return e===void 0&&(e=null),PH("Plane",n,()=>[],e,t)}function t6(n,e,t){e===void 0&&(e=null);const i=[1,1,1];return PH("Box",n,function(o){return o===void 0&&(o=i),o},e,t)}const n6=n=>en(ce.exports.Suspense,{fallback:null,children:en(FT,gt({},n))});function lE(n){const e=new Error(n);if(e.stack===void 0)try{throw e}catch{}return e}var IE=lE,wt=IE;function cE(n){return!!n&&typeof n.then=="function"}var hn=cE;function CE(n,e){if(n!=null)return n;throw wt(e!=null?e:"Got unexpected null or undefined")}var Et=CE;function bt(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}class Ip{getValue(){throw wt("BaseLoadable")}toPromise(){throw wt("BaseLoadable")}valueMaybe(){throw wt("BaseLoadable")}valueOrThrow(){throw wt(`Loadable expected value, but in "${this.state}" state`)}promiseMaybe(){throw wt("BaseLoadable")}promiseOrThrow(){throw wt(`Loadable expected promise, but in "${this.state}" state`)}errorMaybe(){throw wt("BaseLoadable")}errorOrThrow(){throw wt(`Loadable expected error, but in "${this.state}" state`)}is(e){return e.state===this.state&&e.contents===this.contents}map(e){throw wt("BaseLoadable")}}class uE extends Ip{constructor(e){super();bt(this,"state","hasValue"),bt(this,"contents",void 0),this.contents=e}getValue(){return this.contents}toPromise(){return Promise.resolve(this.contents)}valueMaybe(){return this.contents}valueOrThrow(){return this.contents}promiseMaybe(){}errorMaybe(){}map(e){try{const t=e(this.contents);return hn(t)?ia(t):eI(t)?t:iu(t)}catch(t){return hn(t)?ia(t.next(()=>this.map(e))):cp(t)}}}class dE extends Ip{constructor(e){super();bt(this,"state","hasError"),bt(this,"contents",void 0),this.contents=e}getValue(){throw this.contents}toPromise(){return Promise.reject(this.contents)}valueMaybe(){}promiseMaybe(){}errorMaybe(){return this.contents}errorOrThrow(){return this.contents}map(e){return this}}class QH extends Ip{constructor(e){super();bt(this,"state","loading"),bt(this,"contents",void 0),this.contents=e}getValue(){throw this.contents}toPromise(){return this.contents}valueMaybe(){}promiseMaybe(){return this.contents}promiseOrThrow(){return this.contents}errorMaybe(){}map(e){return ia(this.contents.then(t=>{const i=e(t);if(eI(i)){const o=i;switch(o.state){case"hasValue":return o.contents;case"hasError":throw o.contents;case"loading":return o.contents}}return i}).catch(t=>{if(hn(t))return t.then(()=>this.map(e).contents);throw t}))}}function iu(n){return Object.freeze(new uE(n))}function cp(n){return Object.freeze(new dE(n))}function ia(n){return Object.freeze(new QH(n))}function AE(){return Object.freeze(new QH(new Promise(()=>{})))}function hE(n){return n.every(e=>e.state==="hasValue")?iu(n.map(e=>e.contents)):n.some(e=>e.state==="hasError")?cp(Et(n.find(e=>e.state==="hasError"),"Invalid loadable passed to loadableAll").contents):ia(Promise.all(n.map(e=>e.contents)))}function OH(n){const t=(Array.isArray(n)?n:Object.getOwnPropertyNames(n).map(o=>n[o])).map(o=>eI(o)?o:hn(o)?ia(o):iu(o)),i=hE(t);return Array.isArray(n)?i:i.map(o=>Object.getOwnPropertyNames(n).reduce((s,r,g)=>Mt(gt({},s),{[r]:o[g]}),{}))}function eI(n){return n instanceof Ip}const pE={of:n=>hn(n)?ia(n):eI(n)?n:iu(n),error:n=>cp(n),all:OH,isLoadable:eI};var Aa={loadableWithValue:iu,loadableWithError:cp,loadableWithPromise:ia,loadableLoading:AE,loadableAll:OH,isLoadable:eI,RecoilLoadable:pE},mE=Aa.loadableWithValue,fE=Aa.loadableWithError,bE=Aa.loadableWithPromise,GE=Aa.loadableLoading,BE=Aa.loadableAll,yE=Aa.isLoadable,vE=Aa.RecoilLoadable,ou=Object.freeze({__proto__:null,loadableWithValue:mE,loadableWithError:fE,loadableWithPromise:bE,loadableLoading:GE,loadableAll:BE,isLoadable:yE,RecoilLoadable:vE});class ty{constructor(e){bt(this,"key",void 0),this.key=e}}class jH extends ty{}class qH extends ty{}function ZE(n){return n instanceof jH||n instanceof qH}var Cp={AbstractRecoilValue:ty,RecoilState:jH,RecoilValueReadOnly:qH,isRecoilValue:ZE},wE=Cp.AbstractRecoilValue,RE=Cp.RecoilState,WE=Cp.RecoilValueReadOnly,SE=Cp.isRecoilValue,tI=Object.freeze({__proto__:null,AbstractRecoilValue:wE,RecoilState:RE,RecoilValueReadOnly:WE,isRecoilValue:SE});const up=new Map().set("recoil_hamt_2020",!0).set("recoil_sync_external_store",!0).set("recoil_suppress_rerender_in_callback",!0).set("recoil_memory_managament_2020",!0);function dp(n){var e;return(e=up.get(n))!==null&&e!==void 0?e:!1}dp.setPass=n=>{up.set(n,!0)};dp.setFail=n=>{up.set(n,!1)};dp.clear=()=>{up.clear()};var Qt=dp;function VE(n,e){return function*(){let t=0;for(const i of n)yield e(i,t++)}()}var ny=VE;function xE(n,e,{error:t}={}){return null}var HE=xE,$H=HE;class eX{}const XE=new eX;class ME extends Error{constructor(e){super(`Tried to set the value of Recoil selector ${e} using an updater function, but it is an async selector in a pending or error state; this is not supported.`)}}const oa=new Map,iy=new Map;function KE(n){return ny(n,e=>Et(iy.get(e)))}function FE(n){if(oa.has(n.key)){const t=`Duplicate atom key "${n.key}". This is a FATAL ERROR in
      production. But it is safe to ignore this warning if it occurred because of
      hot module replacement.`;console.warn(t)}oa.set(n.key,n);const e=n.set==null?new tI.RecoilValueReadOnly(n.key):new tI.RecoilState(n.key);return iy.set(n.key,e),e}class tX extends Error{}function YE(n){const e=oa.get(n);if(e==null)throw new tX(`Missing definition for RecoilValue: "${n}""`);return e}function NE(n){return oa.get(n)}const ph=new Map;function LE(n){var e;if(!Qt("recoil_memory_managament_2020"))return;const t=oa.get(n);if(t!=null&&(e=t.shouldDeleteConfigOnRelease)!==null&&e!==void 0&&e.call(t)){var i;oa.delete(n),(i=nX(n))===null||i===void 0||i(),ph.delete(n)}}function zE(n,e){!Qt("recoil_memory_managament_2020")||(e===void 0?ph.delete(n):ph.set(n,e))}function nX(n){return ph.get(n)}var Ti={nodes:oa,recoilValues:iy,registerNode:FE,getNode:YE,getNodeMaybe:NE,deleteNodeConfigIfPossible:LE,setConfigDeletionHandler:zE,getConfigDeletionHandler:nX,recoilValuesForKeys:KE,NodeMissingError:tX,DefaultValue:eX,DEFAULT_VALUE:XE,RecoilValueNotReady:ME};function kE(n,e){e()}var TE={enqueueExecution:kE};function EE(n,e){return e={exports:{}},n(e,e.exports),e.exports}var _E=EE(function(n){var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},t={},i=5,o=Math.pow(2,i),s=o-1,r=o/2,g=o/4,a={},l=function(J){return function(){return J}},u=t.hash=function(E){var J=typeof E=="undefined"?"undefined":e(E);if(J==="number")return E;J!=="string"&&(E+="");for(var se=0,re=0,Ze=E.length;re<Ze;++re){var He=E.charCodeAt(re);se=(se<<5)-se+He|0}return se},d=function(J){return J-=J>>1&1431655765,J=(J&858993459)+(J>>2&858993459),J=J+(J>>4)&252645135,J+=J>>8,J+=J>>16,J&127},C=function(J,se){return se>>>J&s},A=function(J){return 1<<J},f=function(J,se){return d(J&se-1)},b=function(J,se,re,Ze){var He=Ze;if(!J){var Qe=Ze.length;He=new Array(Qe);for(var Te=0;Te<Qe;++Te)He[Te]=Ze[Te]}return He[se]=re,He},G=function(J,se,re){var Ze=re.length-1,He=0,Qe=0,Te=re;if(J)He=Qe=se;else for(Te=new Array(Ze);He<se;)Te[Qe++]=re[He++];for(++He;He<=Ze;)Te[Qe++]=re[He++];return J&&(Te.length=Ze),Te},m=function(J,se,re,Ze){var He=Ze.length;if(J){for(var Qe=He;Qe>=se;)Ze[Qe--]=Ze[Qe];return Ze[se]=re,Ze}for(var Te=0,it=0,lt=new Array(He+1);Te<se;)lt[it++]=Ze[Te++];for(lt[se]=re;Te<He;)lt[++it]=Ze[Te++];return lt},h=1,B=2,y=3,Z=4,R={__hamt_isEmpty:!0},W=function(J){return J===R||J&&J.__hamt_isEmpty},x=function(J,se,re,Ze){return{type:h,edit:J,hash:se,key:re,value:Ze,_modify:j}},X=function(J,se,re){return{type:B,edit:J,hash:se,children:re,_modify:oe}},Y=function(J,se,re){return{type:y,edit:J,mask:se,children:re,_modify:Ie}},S=function(J,se,re){return{type:Z,edit:J,size:se,children:re,_modify:T}},H=function(J){return J===R||J.type===h||J.type===B},k=function(J,se,re,Ze,He){for(var Qe=[],Te=Ze,it=0,lt=0;Te;++lt)Te&1&&(Qe[lt]=He[it++]),Te>>>=1;return Qe[se]=re,S(J,it+1,Qe)},U=function(J,se,re,Ze){for(var He=new Array(se-1),Qe=0,Te=0,it=0,lt=Ze.length;it<lt;++it)if(it!==re){var Ft=Ze[it];Ft&&!W(Ft)&&(He[Qe++]=Ft,Te|=1<<it)}return Y(J,Te,He)},D=function E(J,se,re,Ze,He,Qe){if(re===He)return X(J,re,[Qe,Ze]);var Te=C(se,re),it=C(se,He);return Y(J,A(Te)|A(it),Te===it?[E(J,se+i,re,Ze,He,Qe)]:Te<it?[Ze,Qe]:[Qe,Ze])},Q=function(J,se,re,Ze,He,Qe,Te,it){for(var lt=He.length,Ft=0;Ft<lt;++Ft){var Bn=He[Ft];if(re(Te,Bn.key)){var un=Bn.value,Yn=Qe(un);return Yn===un?He:Yn===a?(--it.value,G(J,Ft,He)):b(J,Ft,x(se,Ze,Te,Yn),He)}}var si=Qe();return si===a?He:(++it.value,b(J,lt,x(se,Ze,Te,si),He))},$=function(J,se){return J===se.edit},j=function(J,se,re,Ze,He,Qe,Te){if(se(Qe,this.key)){var it=Ze(this.value);return it===this.value?this:it===a?(--Te.value,R):$(J,this)?(this.value=it,this):x(J,He,Qe,it)}var lt=Ze();return lt===a?this:(++Te.value,D(J,re,this.hash,this,He,x(J,He,Qe,lt)))},oe=function(J,se,re,Ze,He,Qe,Te){if(He===this.hash){var it=$(J,this),lt=Q(it,J,se,this.hash,this.children,Ze,Qe,Te);return lt===this.children?this:lt.length>1?X(J,this.hash,lt):lt[0]}var Ft=Ze();return Ft===a?this:(++Te.value,D(J,re,this.hash,this,He,x(J,He,Qe,Ft)))},Ie=function(J,se,re,Ze,He,Qe,Te){var it=this.mask,lt=this.children,Ft=C(re,He),Bn=A(Ft),un=f(it,Bn),Yn=it&Bn,si=Yn?lt[un]:R,po=si._modify(J,se,re+i,Ze,He,Qe,Te);if(si===po)return this;var Cs=$(J,this),Yo=it,N=void 0;if(Yn&&W(po)){if(Yo&=~Bn,!Yo)return R;if(lt.length<=2&&H(lt[un^1]))return lt[un^1];N=G(Cs,un,lt)}else if(!Yn&&!W(po)){if(lt.length>=r)return k(J,Ft,po,it,lt);Yo|=Bn,N=m(Cs,un,po,lt)}else N=b(Cs,un,po,lt);return Cs?(this.mask=Yo,this.children=N,this):Y(J,Yo,N)},T=function(J,se,re,Ze,He,Qe,Te){var it=this.size,lt=this.children,Ft=C(re,He),Bn=lt[Ft],un=(Bn||R)._modify(J,se,re+i,Ze,He,Qe,Te);if(Bn===un)return this;var Yn=$(J,this),si=void 0;if(W(Bn)&&!W(un))++it,si=b(Yn,Ft,un,lt);else if(!W(Bn)&&W(un)){if(--it,it<=g)return U(J,it,Ft,lt);si=b(Yn,Ft,R,lt)}else si=b(Yn,Ft,un,lt);return Yn?(this.size=it,this.children=si,this):S(J,it,si)};R._modify=function(E,J,se,re,Ze,He,Qe){var Te=re();return Te===a?R:(++Qe.value,x(E,Ze,He,Te))};function P(E,J,se,re,Ze){this._editable=E,this._edit=J,this._config=se,this._root=re,this._size=Ze}P.prototype.setTree=function(E,J){return this._editable?(this._root=E,this._size=J,this):E===this._root?this:new P(this._editable,this._edit,this._config,E,J)};var Ce=t.tryGetHash=function(E,J,se,re){for(var Ze=re._root,He=0,Qe=re._config.keyEq;;)switch(Ze.type){case h:return Qe(se,Ze.key)?Ze.value:E;case B:{if(J===Ze.hash)for(var Te=Ze.children,it=0,lt=Te.length;it<lt;++it){var Ft=Te[it];if(Qe(se,Ft.key))return Ft.value}return E}case y:{var Bn=C(He,J),un=A(Bn);if(Ze.mask&un){Ze=Ze.children[f(Ze.mask,un)],He+=i;break}return E}case Z:{if(Ze=Ze.children[C(He,J)],Ze){He+=i;break}return E}default:return E}};P.prototype.tryGetHash=function(E,J,se){return Ce(E,J,se,this)};var Me=t.tryGet=function(E,J,se){return Ce(E,se._config.hash(J),J,se)};P.prototype.tryGet=function(E,J){return Me(E,J,this)};var ee=t.getHash=function(E,J,se){return Ce(void 0,E,J,se)};P.prototype.getHash=function(E,J){return ee(E,J,this)},t.get=function(E,J){return Ce(void 0,J._config.hash(E),E,J)},P.prototype.get=function(E,J){return Me(J,E,this)};var _=t.has=function(E,J,se){return Ce(a,E,J,se)!==a};P.prototype.hasHash=function(E,J){return _(E,J,this)};var Ae=t.has=function(E,J){return _(J._config.hash(E),E,J)};P.prototype.has=function(E){return Ae(E,this)};var ye=function(J,se){return J===se};t.make=function(E){return new P(0,0,{keyEq:E&&E.keyEq||ye,hash:E&&E.hash||u},R,0)},t.empty=t.make();var ge=t.isEmpty=function(E){return E&&!!W(E._root)};P.prototype.isEmpty=function(){return ge(this)};var we=t.modifyHash=function(E,J,se,re){var Ze={value:re._size},He=re._root._modify(re._editable?re._edit:NaN,re._config.keyEq,0,E,J,se,Ze);return re.setTree(He,Ze.value)};P.prototype.modifyHash=function(E,J,se){return we(se,E,J,this)};var Ke=t.modify=function(E,J,se){return we(E,se._config.hash(J),J,se)};P.prototype.modify=function(E,J){return Ke(J,E,this)};var ie=t.setHash=function(E,J,se,re){return we(l(se),E,J,re)};P.prototype.setHash=function(E,J,se){return ie(E,J,se,this)};var de=t.set=function(E,J,se){return ie(se._config.hash(E),E,J,se)};P.prototype.set=function(E,J){return de(E,J,this)};var Ge=l(a),Ve=t.removeHash=function(E,J,se){return we(Ge,E,J,se)};P.prototype.removeHash=P.prototype.deleteHash=function(E,J){return Ve(E,J,this)};var xe=t.remove=function(E,J){return Ve(J._config.hash(E),E,J)};P.prototype.remove=P.prototype.delete=function(E){return xe(E,this)};var Pe=t.beginMutation=function(E){return new P(E._editable+1,E._edit+1,E._config,E._root,E._size)};P.prototype.beginMutation=function(){return Pe(this)};var Ue=t.endMutation=function(E){return E._editable=E._editable&&E._editable-1,E};P.prototype.endMutation=function(){return Ue(this)};var nt=t.mutate=function(E,J){var se=Pe(J);return E(se),Ue(se)};P.prototype.mutate=function(E){return nt(E,this)};var ct=function(J){return J&&F(J[0],J[1],J[2],J[3],J[4])},F=function(J,se,re,Ze,He){for(;re<J;){var Qe=se[re++];if(Qe&&!W(Qe))return M(Qe,Ze,[J,se,re,Ze,He])}return ct(He)},M=function(J,se,re){switch(J.type){case h:return{value:se(J),rest:re};case B:case Z:case y:var Ze=J.children;return F(Ze.length,Ze,0,se,re);default:return ct(re)}},me={done:!0};function te(E){this.v=E}te.prototype.next=function(){if(!this.v)return me;var E=this.v;return this.v=ct(E.rest),E},te.prototype[Symbol.iterator]=function(){return this};var he=function(J,se){return new te(M(J._root,se))},Re=function(J){return[J.key,J.value]},Fe=t.entries=function(E){return he(E,Re)};P.prototype.entries=P.prototype[Symbol.iterator]=function(){return Fe(this)};var pe=function(J){return J.key},$e=t.keys=function(E){return he(E,pe)};P.prototype.keys=function(){return $e(this)};var ve=function(J){return J.value},Le=t.values=P.prototype.values=function(E){return he(E,ve)};P.prototype.values=function(){return Le(this)};var Ye=t.fold=function(E,J,se){var re=se._root;if(re.type===h)return E(J,re.value,re.key);for(var Ze=[re.children],He=void 0;He=Ze.pop();)for(var Qe=0,Te=He.length;Qe<Te;){var it=He[Qe++];it&&it.type&&(it.type===h?J=E(J,it.value,it.key):Ze.push(it.children))}return J};P.prototype.fold=function(E,J){return Ye(E,J,this)};var O=t.forEach=function(E,J){return Ye(function(se,re,Ze){return E(re,Ze,J)},null,J)};P.prototype.forEach=function(E){return O(E,this)};var ke=t.count=function(E){return E._size};P.prototype.count=function(){return ke(this)},Object.defineProperty(P.prototype,"size",{get:P.prototype.count}),n.exports?n.exports=t:(void 0).hamt=t});class JE{constructor(e){bt(this,"_map",void 0),this._map=new Map(e==null?void 0:e.entries())}keys(){return this._map.keys()}entries(){return this._map.entries()}get(e){return this._map.get(e)}has(e){return this._map.has(e)}set(e,t){return this._map.set(e,t),this}delete(e){return this._map.delete(e),this}clone(){return sy(this)}toMap(){return new Map(this._map)}}class oy{constructor(e){if(bt(this,"_hamt",_E.empty.beginMutation()),e instanceof oy){const t=e._hamt.endMutation();e._hamt=t.beginMutation(),this._hamt=t.beginMutation()}else if(e)for(const[t,i]of e.entries())this._hamt.set(t,i)}keys(){return this._hamt.keys()}entries(){return this._hamt.entries()}get(e){return this._hamt.get(e)}has(e){return this._hamt.has(e)}set(e,t){return this._hamt.set(e,t),this}delete(e){return this._hamt.delete(e),this}clone(){return sy(this)}toMap(){return new Map(this._hamt)}}function sy(n){return Qt("recoil_hamt_2020")?new oy(n):new JE(n)}var DE={persistentMap:sy},UE=DE.persistentMap,PE=Object.freeze({__proto__:null,persistentMap:UE});function QE(n,...e){const t=new Set;e:for(const i of n){for(const o of e)if(o.has(i))continue e;t.add(i)}return t}var Qc=QE;function OE(n,e){const t=new Map;return n.forEach((i,o)=>{t.set(o,e(i,o))}),t}var mh=OE;function jE(){return{nodeDeps:new Map,nodeToNodeSubscriptions:new Map}}function qE(n){return{nodeDeps:mh(n.nodeDeps,e=>new Set(e)),nodeToNodeSubscriptions:mh(n.nodeToNodeSubscriptions,e=>new Set(e))}}function gb(n,e,t){const{nodeDeps:i,nodeToNodeSubscriptions:o}=e;n.forEach((s,r)=>{const g=i.get(r);if(g&&t&&g!==t.nodeDeps.get(r))return;i.set(r,new Set(s)),(g==null?s:Qc(s,g)).forEach(l=>{o.has(l)||o.set(l,new Set),Et(o.get(l)).add(r)}),g&&Qc(g,s).forEach(u=>{if(!o.has(u))return;const d=Et(o.get(u));d.delete(r),d.size===0&&o.delete(u)})})}function $E(n,e,t){var i,o,s,r;const g=e.getState();t===g.currentTree.version||t===((i=g.nextTree)===null||i===void 0?void 0:i.version)||((o=g.previousTree)===null||o===void 0||o.version);const a=e.getGraph(t);if(gb(n,a),t===((s=g.previousTree)===null||s===void 0?void 0:s.version)){const u=e.getGraph(g.currentTree.version);gb(n,u,a)}if(t===((r=g.previousTree)===null||r===void 0?void 0:r.version)||t===g.currentTree.version){var l;const u=(l=g.nextTree)===null||l===void 0?void 0:l.version;if(u!==void 0){const d=e.getGraph(u);gb(n,d,a)}}}function e_(n,e){n.forEach((t,i)=>{e.has(i)||e.set(i,new Set);const o=Et(e.get(i));t.forEach(s=>o.add(s))})}function t_(n,e,t){t.has(n)||t.set(n,new Set),Et(t.get(n)).add(e)}var su={addToDependencyMap:t_,cloneGraph:qE,graph:jE,mergeDepsIntoDependencyMap:e_,saveDependencyMapToStore:$E};let n_=0;const i_=()=>n_++;let o_=0;const s_=()=>o_++;let r_=0;const g_=()=>r_++;var Ap={getNextTreeStateVersion:i_,getNextStoreID:s_,getNextComponentID:g_};const{persistentMap:pR}=PE,{graph:a_}=su,{getNextTreeStateVersion:iX}=Ap;function oX(){const n=iX();return{version:n,stateID:n,transactionMetadata:{},dirtyAtoms:new Set,atomValues:pR(),nonvalidatedAtoms:pR()}}function l_(){const n=oX();return{currentTree:n,nextTree:null,previousTree:null,commitDepth:0,knownAtoms:new Set,knownSelectors:new Set,transactionSubscriptions:new Map,nodeTransactionSubscriptions:new Map,nodeToComponentSubscriptions:new Map,queuedComponentCallbacks_DEPRECATED:[],suspendedComponentResolvers:new Set,graphsByVersion:new Map().set(n.version,a_()),retention:{referenceCounts:new Map,nodesRetainedByZone:new Map,retainablesToCheckForRelease:new Set},nodeCleanupFunctions:new Map}}var sX={makeEmptyTreeState:oX,makeEmptyStoreState:l_,getNextTreeStateVersion:iX};class rX{}function I_(){return new rX}var hp={RetentionZone:rX,retentionZone:I_};function c_(n,e){const t=new Set(n);return t.add(e),t}function C_(n,e){const t=new Set(n);return t.delete(e),t}function u_(n,e,t){const i=new Map(n);return i.set(e,t),i}function d_(n,e,t){const i=new Map(n);return i.set(e,t(i.get(e))),i}function A_(n,e){const t=new Map(n);return t.delete(e),t}function h_(n,e){const t=new Map(n);return e.forEach(i=>t.delete(i)),t}var gX={setByAddingToSet:c_,setByDeletingFromSet:C_,mapBySettingInMap:u_,mapByUpdatingInMap:d_,mapByDeletingFromMap:A_,mapByDeletingMultipleFromMap:h_};function*p_(n,e){let t=0;for(const i of n)e(i,t++)&&(yield i)}var aX=p_;function m_(n,e){return new Proxy(n,{get:(i,o)=>(!(o in i)&&o in e&&(i[o]=e[o]()),i[o]),ownKeys:i=>Object.keys(i)})}var lX=m_;const{getNode:ru,getNodeMaybe:f_,recoilValuesForKeys:mR}=Ti,{RetentionZone:fR}=hp,{setByAddingToSet:b_}=gX,G_=Object.freeze(new Set);class B_ extends Error{}function y_(n,e,t){if(!Qt("recoil_memory_managament_2020"))return()=>{};const{nodesRetainedByZone:i}=n.getState().retention;function o(s){let r=i.get(s);r||i.set(s,r=new Set),r.add(e)}if(t instanceof fR)o(t);else if(Array.isArray(t))for(const s of t)o(s);return()=>{if(!Qt("recoil_memory_managament_2020"))return;const{retention:s}=n.getState();function r(g){const a=s.nodesRetainedByZone.get(g);a==null||a.delete(e),a&&a.size===0&&s.nodesRetainedByZone.delete(g)}if(t instanceof fR)r(t);else if(Array.isArray(t))for(const g of t)r(g)}}function ry(n,e,t,i){const o=n.getState();if(o.nodeCleanupFunctions.has(t))return;const s=ru(t),r=y_(n,t,s.retainedBy),g=s.init(n,e,i);o.nodeCleanupFunctions.set(t,()=>{g(),r()})}function v_(n,e,t){ry(n,n.getState().currentTree,e,t)}function Z_(n,e){var t;const i=n.getState();(t=i.nodeCleanupFunctions.get(e))===null||t===void 0||t(),i.nodeCleanupFunctions.delete(e)}function w_(n,e,t){return ry(n,e,t,"get"),ru(t).get(n,e)}function IX(n,e,t){return ru(t).peek(n,e)}function R_(n,e,t){var i;const o=f_(e);return o==null||(i=o.invalidate)===null||i===void 0||i.call(o,n),Mt(gt({},n),{atomValues:n.atomValues.clone().delete(e),nonvalidatedAtoms:n.nonvalidatedAtoms.clone().set(e,t),dirtyAtoms:b_(n.dirtyAtoms,e)})}function W_(n,e,t,i){const o=ru(t);if(o.set==null)throw new B_(`Attempt to set read-only RecoilValue: ${t}`);const s=o.set;return ry(n,e,t,"set"),s(n,e,i)}function S_(n,e,t){const i=n.getState(),o=n.getGraph(e.version),s=ru(t).nodeType;return lX({type:s},{loadable:()=>IX(n,e,t),isActive:()=>i.knownAtoms.has(t)||i.knownSelectors.has(t),isSet:()=>s==="selector"?!1:e.atomValues.has(t),isModified:()=>e.dirtyAtoms.has(t),deps:()=>{var r;return mR((r=o.nodeDeps.get(t))!==null&&r!==void 0?r:[])},subscribers:()=>{var r,g;return{nodes:mR(aX(cX(n,e,new Set([t])),a=>a!==t)),components:ny((r=(g=i.nodeToComponentSubscriptions.get(t))===null||g===void 0?void 0:g.values())!==null&&r!==void 0?r:[],([a])=>({name:a}))}}})}function cX(n,e,t){const i=new Set,o=Array.from(t),s=n.getGraph(e.version);for(let g=o.pop();g;g=o.pop()){var r;i.add(g);const a=(r=s.nodeToNodeSubscriptions.get(g))!==null&&r!==void 0?r:G_;for(const l of a)i.has(l)||o.push(l)}return i}var eg={getNodeLoadable:w_,peekNodeLoadable:IX,setNodeValue:W_,initializeNode:v_,cleanUpNode:Z_,setUnvalidatedAtomValue_DEPRECATED:R_,peekNodeInfo:S_,getDownstreamNodes:cX},ab,lb,Ib;const V_=(ab=kt.createMutableSource)!==null&&ab!==void 0?ab:kt.unstable_createMutableSource,CX=(lb=kt.useMutableSource)!==null&&lb!==void 0?lb:kt.unstable_useMutableSource,uX=(Ib=kt.useSyncExternalStore)!==null&&Ib!==void 0?Ib:kt.unstable_useSyncExternalStore;function x_(){return Qt("recoil_transition_support")?{mode:"TRANSITION_SUPPORT",early:!0,concurrent:!0}:Qt("recoil_sync_external_store")&&uX!=null?{mode:"SYNC_EXTERNAL_STORE",early:!0,concurrent:!1}:Qt("recoil_mutable_source")&&CX!=null&&typeof window!="undefined"&&!window.$disableRecoilValueMutableSource_TEMP_HACK_DO_NOT_USE?Qt("recoil_suppress_rerender_in_callback")?{mode:"MUTABLE_SOURCE",early:!0,concurrent:!0}:{mode:"MUTABLE_SOURCE",early:!1,concurrent:!1}:Qt("recoil_suppress_rerender_in_callback")?{mode:"LEGACY",early:!0,concurrent:!1}:{mode:"LEGACY",early:!1,concurrent:!1}}var pp={createMutableSource:V_,useMutableSource:CX,useSyncExternalStore:uX,reactMode:x_};const{getDownstreamNodes:H_,getNodeLoadable:dX,setNodeValue:X_}=eg,{getNextComponentID:M_}=Ap,{getNode:K_,getNodeMaybe:AX}=Ti,{DefaultValue:gy,RecoilValueNotReady:F_}=Ti,{reactMode:Y_}=pp,{AbstractRecoilValue:N_,RecoilState:L_,RecoilValueReadOnly:z_,isRecoilValue:k_}=tI;function T_(n,{key:e},t=n.getState().currentTree){var i,o;const s=n.getState();t.version===s.currentTree.version||t.version===((i=s.nextTree)===null||i===void 0?void 0:i.version)||(t.version,(o=s.previousTree)===null||o===void 0||o.version);const r=dX(n,t,e);return r.state==="loading"&&r.contents.catch(()=>{}),r}function E_(n,e){const t=n.clone();return e.forEach((i,o)=>{i.state==="hasValue"&&i.contents instanceof gy?t.delete(o):t.set(o,i)}),t}function __(n,e,{key:t},i){if(typeof i=="function"){const o=dX(n,e,t);if(o.state==="loading")throw new F_(t);if(o.state==="hasError")throw o.contents;return i(o.contents)}else return i}function J_(n,e,t){if(t.type==="set"){const{recoilValue:o,valueOrUpdater:s}=t,r=__(n,e,o,s),g=X_(n,e,o.key,r);for(const[a,l]of g.entries())U0(e,a,l)}else if(t.type==="setLoadable"){const{recoilValue:{key:o},loadable:s}=t;U0(e,o,s)}else if(t.type==="markModified"){const{recoilValue:{key:o}}=t;e.dirtyAtoms.add(o)}else if(t.type==="setUnvalidated"){var i;const{recoilValue:{key:o},unvalidatedValue:s}=t,r=AX(o);r==null||(i=r.invalidate)===null||i===void 0||i.call(r,e),e.atomValues.delete(o),e.nonvalidatedAtoms.set(o,s),e.dirtyAtoms.add(o)}else $H(`Unknown action ${t.type}`)}function U0(n,e,t){t.state==="hasValue"&&t.contents instanceof gy?n.atomValues.delete(e):n.atomValues.set(e,t),n.dirtyAtoms.add(e),n.nonvalidatedAtoms.delete(e)}function hX(n,e){n.replaceState(t=>{const i=pX(t);for(const o of e)J_(n,i,o);return P0(n,i),i})}function mp(n,e){if(Oc.length){const t=Oc[Oc.length-1];let i=t.get(n);i||t.set(n,i=[]),i.push(e)}else hX(n,[e])}const Oc=[];function D_(){const n=new Map;return Oc.push(n),()=>{for(const[e,t]of n)hX(e,t);Oc.pop()}}function pX(n){return Mt(gt({},n),{atomValues:n.atomValues.clone(),nonvalidatedAtoms:n.nonvalidatedAtoms.clone(),dirtyAtoms:new Set(n.dirtyAtoms)})}function P0(n,e){const t=H_(n,e,e.dirtyAtoms);for(const s of t){var i,o;(i=AX(s))===null||i===void 0||(o=i.invalidate)===null||o===void 0||o.call(i,e)}}function mX(n,e,t){mp(n,{type:"set",recoilValue:e,valueOrUpdater:t})}function U_(n,e,t){if(t instanceof gy)return mX(n,e,t);mp(n,{type:"setLoadable",recoilValue:e,loadable:t})}function P_(n,e){mp(n,{type:"markModified",recoilValue:e})}function Q_(n,e,t){mp(n,{type:"setUnvalidated",recoilValue:e,unvalidatedValue:t})}function O_(n,{key:e},t,i=null){const o=M_(),s=n.getState();s.nodeToComponentSubscriptions.has(e)||s.nodeToComponentSubscriptions.set(e,new Map),Et(s.nodeToComponentSubscriptions.get(e)).set(o,[i!=null?i:"<not captured>",t]);const r=Y_();if(r.early&&(r.mode==="LEGACY"||r.mode==="MUTABLE_SOURCE")){const g=n.getState().nextTree;g&&g.dirtyAtoms.has(e)&&t(g)}return{release:()=>{const g=n.getState(),a=g.nodeToComponentSubscriptions.get(e);a===void 0||!a.has(o)||(a.delete(o),a.size===0&&g.nodeToComponentSubscriptions.delete(e))}}}function j_(n,e){var t;const{currentTree:i}=n.getState(),o=K_(e.key);(t=o.clearCache)===null||t===void 0||t.call(o,n,i)}var Is={RecoilValueReadOnly:z_,AbstractRecoilValue:N_,RecoilState:L_,getRecoilValueAsLoadable:T_,setRecoilValue:mX,setRecoilValueLoadable:U_,markRecoilValueModified:P_,setUnvalidatedRecoilValue:Q_,subscribeToRecoilValue:O_,isRecoilValue:k_,applyAtomValueWrites:E_,batchStart:D_,writeLoadableToTreeState:U0,invalidateDownstreams:P0,copyTreeState:pX,refreshRecoilValue:j_,invalidateDownstreams_FOR_TESTING:P0};function q_(n,e,t){const i=n.entries();let o=i.next();for(;!o.done;){const s=o.value;if(e.call(t,s[1],s[0],n))return!0;o=i.next()}return!1}var $_=q_;const{cleanUpNode:eJ}=eg,{deleteNodeConfigIfPossible:tJ,getNode:fX}=Ti,{RetentionZone:bX}=hp,nJ=12e4,GX=new Set;function BX(n,e){const t=n.getState(),i=t.currentTree;if(t.nextTree)return;const o=new Set;for(const r of e)if(r instanceof bX)for(const g of rJ(t,r))o.add(g);else o.add(r);const s=iJ(n,o);for(const r of s)sJ(n,i,r)}function iJ(n,e){const t=n.getState(),i=t.currentTree,o=n.getGraph(i.version),s=new Set,r=new Set;return g(e),s;function g(a){const l=new Set,u=oJ(n,i,a,s,r);for(const f of u){var d;if(fX(f).retainedBy==="recoilRoot"){r.add(f);continue}if(((d=t.retention.referenceCounts.get(f))!==null&&d!==void 0?d:0)>0){r.add(f);continue}if(yX(f).some(G=>t.retention.referenceCounts.get(G))){r.add(f);continue}const b=o.nodeToNodeSubscriptions.get(f);if(b&&$_(b,G=>r.has(G))){r.add(f);continue}s.add(f),l.add(f)}const C=new Set;for(const f of l)for(const b of(A=o.nodeDeps.get(f))!==null&&A!==void 0?A:GX){var A;s.has(b)||C.add(b)}C.size&&g(C)}}function oJ(n,e,t,i,o){const s=n.getGraph(e.version),r=[],g=new Set;for(;t.size>0;)a(Et(t.values().next().value));return r;function a(l){if(i.has(l)||o.has(l)){t.delete(l);return}if(g.has(l))return;const u=s.nodeToNodeSubscriptions.get(l);if(u)for(const d of u)a(d);g.add(l),t.delete(l),r.push(l)}}function sJ(n,e,t){if(!Qt("recoil_memory_managament_2020"))return;eJ(n,t);const i=n.getState();i.knownAtoms.delete(t),i.knownSelectors.delete(t),i.nodeTransactionSubscriptions.delete(t),i.retention.referenceCounts.delete(t);const o=yX(t);for(const a of o){var s;(s=i.retention.nodesRetainedByZone.get(a))===null||s===void 0||s.delete(t)}e.atomValues.delete(t),e.dirtyAtoms.delete(t),e.nonvalidatedAtoms.delete(t);const r=i.graphsByVersion.get(e.version);if(r){const a=r.nodeDeps.get(t);if(a!==void 0){r.nodeDeps.delete(t);for(const l of a){var g;(g=r.nodeToNodeSubscriptions.get(l))===null||g===void 0||g.delete(t)}}r.nodeToNodeSubscriptions.delete(t)}tJ(t)}function rJ(n,e){var t;return(t=n.retention.nodesRetainedByZone.get(e))!==null&&t!==void 0?t:GX}function yX(n){const e=fX(n).retainedBy;return e===void 0||e==="components"||e==="recoilRoot"?[]:e instanceof bX?[e]:e}function gJ(n,e){const t=n.getState();t.nextTree?t.retention.retainablesToCheckForRelease.add(e):BX(n,new Set([e]))}function aJ(n,e,t){var i;if(!Qt("recoil_memory_managament_2020"))return;const o=n.getState().retention.referenceCounts,s=((i=o.get(e))!==null&&i!==void 0?i:0)+t;s===0?vX(n,e):o.set(e,s)}function vX(n,e){if(!Qt("recoil_memory_managament_2020"))return;n.getState().retention.referenceCounts.delete(e),gJ(n,e)}function lJ(n){if(!Qt("recoil_memory_managament_2020"))return;const e=n.getState();BX(n,e.retention.retainablesToCheckForRelease),e.retention.retainablesToCheckForRelease.clear()}function IJ(n){return n===void 0?"recoilRoot":n}var ha={SUSPENSE_TIMEOUT_MS:nJ,updateRetainCount:aJ,updateRetainCountToZero:vX,releaseScheduledRetainablesNow:lJ,retainedByOptionWithDefault:IJ};const{unstable_batchedUpdates:cJ}=iY;var CJ={unstable_batchedUpdates:cJ};const{unstable_batchedUpdates:uJ}=CJ;var dJ={unstable_batchedUpdates:uJ};const{batchStart:AJ}=Is,{unstable_batchedUpdates:hJ}=dJ;let ay=hJ;const pJ=n=>{ay=n},mJ=()=>ay,fJ=n=>{ay(()=>{let e=()=>{};try{e=AJ(),n()}finally{e()}})};var fp={getBatcher:mJ,setBatcher:pJ,batchUpdates:fJ};function*bJ(n){for(const e of n)for(const t of e)yield t}var GJ=bJ;const BJ=typeof window=="undefined",yJ=typeof navigator!="undefined"&&navigator.product==="ReactNative";var ly={isSSR:BJ,isReactNative:yJ};function vJ(n,e){let t;return(...o)=>{t||(t={});const s=e(...o);return Object.hasOwnProperty.call(t,s)||(t[s]=n.apply(this,o)),t[s]}}function ZJ(n,e){let t,i;return(...s)=>{const r=e(...s);return t===r||(t=r,i=n.apply(this,s)),i}}function wJ(n,e){let t,i;return[(...r)=>{const g=e(...r);return t===g||(t=g,i=n.apply(this,r)),i},()=>{t=null}]}var RJ={memoizeWithArgsHash:vJ,memoizeOneWithArgsHash:ZJ,memoizeOneWithArgsHashAndInvalidation:wJ};const{batchUpdates:Q0}=fp,{initializeNode:WJ,peekNodeInfo:SJ}=eg,{graph:VJ}=su,{getNextStoreID:xJ}=Ap,{DEFAULT_VALUE:HJ,recoilValues:bR,recoilValuesForKeys:GR}=Ti,{AbstractRecoilValue:XJ,getRecoilValueAsLoadable:MJ,setRecoilValue:BR,setUnvalidatedRecoilValue:KJ}=Is,{updateRetainCount:NA}=ha,{getNextTreeStateVersion:FJ,makeEmptyStoreState:YJ}=sX,{isSSR:NJ}=ly,{memoizeOneWithArgsHashAndInvalidation:LJ}=RJ;class bp{constructor(e){bt(this,"_store",void 0),bt(this,"_refCount",1),bt(this,"getLoadable",t=>(this.checkRefCount_INTERNAL(),MJ(this._store,t))),bt(this,"getPromise",t=>(this.checkRefCount_INTERNAL(),this.getLoadable(t).toPromise())),bt(this,"getNodes_UNSTABLE",t=>{if(this.checkRefCount_INTERNAL(),(t==null?void 0:t.isModified)===!0){if((t==null?void 0:t.isInitialized)===!1)return[];const s=this._store.getState().currentTree;return GR(s.dirtyAtoms)}const i=this._store.getState().knownAtoms,o=this._store.getState().knownSelectors;return(t==null?void 0:t.isInitialized)==null?bR.values():t.isInitialized===!0?GR(GJ([this._store.getState().knownAtoms,this._store.getState().knownSelectors])):aX(bR.values(),({key:s})=>!i.has(s)&&!o.has(s))}),bt(this,"getInfo_UNSTABLE",({key:t})=>(this.checkRefCount_INTERNAL(),SJ(this._store,this._store.getState().currentTree,t))),bt(this,"map",t=>{this.checkRefCount_INTERNAL();const i=new O0(this,Q0);return t(i),i}),bt(this,"asyncMap",async t=>{this.checkRefCount_INTERNAL();const i=new O0(this,Q0);return i.retain(),await t(i),i.autoRelease_INTERNAL(),i}),this._store={storeID:xJ(),getState:()=>e,replaceState:t=>{e.currentTree=t(e.currentTree)},getGraph:t=>{const i=e.graphsByVersion;if(i.has(t))return Et(i.get(t));const o=VJ();return i.set(t,o),o},subscribeToTransactions:()=>({release:()=>{}}),addTransactionMetadata:()=>{throw wt("Cannot subscribe to Snapshots")}};for(const t of this._store.getState().knownAtoms)WJ(this._store,t,"get"),NA(this._store,t,1);this.autoRelease_INTERNAL()}retain(){this._refCount<=0,this._refCount++;let e=!1;return()=>{e||(e=!0,this._release())}}autoRelease_INTERNAL(){NJ||window.setTimeout(()=>this._release(),0)}_release(){if(this._refCount--,this._refCount===0){if(this._store.getState().nodeCleanupFunctions.forEach(e=>e()),this._store.getState().nodeCleanupFunctions.clear(),!Qt("recoil_memory_managament_2020"))return}else this._refCount<0}isRetained(){return this._refCount>0}checkRefCount_INTERNAL(){Qt("recoil_memory_managament_2020")&&this._refCount<=0}getStore_INTERNAL(){return this.checkRefCount_INTERNAL(),this._store}getID(){return this.checkRefCount_INTERNAL(),this._store.getState().currentTree.stateID}}function ZX(n,e,t=!1){const i=n.getState(),o=t?FJ():e.version;return{currentTree:t?{version:o,stateID:o,transactionMetadata:gt({},e.transactionMetadata),dirtyAtoms:new Set(e.dirtyAtoms),atomValues:e.atomValues.clone(),nonvalidatedAtoms:e.nonvalidatedAtoms.clone()}:e,commitDepth:0,nextTree:null,previousTree:null,knownAtoms:new Set(i.knownAtoms),knownSelectors:new Set(i.knownSelectors),transactionSubscriptions:new Map,nodeTransactionSubscriptions:new Map,nodeToComponentSubscriptions:new Map,queuedComponentCallbacks_DEPRECATED:[],suspendedComponentResolvers:new Set,graphsByVersion:new Map().set(o,n.getGraph(e.version)),retention:{referenceCounts:new Map,nodesRetainedByZone:new Map,retainablesToCheckForRelease:new Set},nodeCleanupFunctions:new Map(ny(i.nodeCleanupFunctions.entries(),([s])=>[s,()=>{}]))}}function zJ(n){const e=new bp(YJ());return n!=null?e.map(n):e}const[yR,kJ]=LJ((n,e)=>{const t=n.getState(),i=e==="current"?t.currentTree:Et(t.previousTree);return new bp(ZX(n,i))},(n,e)=>{var t;return String(e)+String(n.storeID)+String(n.getState().currentTree.version)+String((t=n.getState().previousTree)===null||t===void 0?void 0:t.version)});function TJ(n,e="current"){const t=yR(n,e);return t.isRetained()?t:(kJ(),yR(n,e))}class O0 extends bp{constructor(e,t){super(ZX(e.getStore_INTERNAL(),e.getStore_INTERNAL().getState().currentTree,!0));bt(this,"_batch",void 0),bt(this,"set",(i,o)=>{this.checkRefCount_INTERNAL();const s=this.getStore_INTERNAL();this._batch(()=>{NA(s,i.key,1),BR(this.getStore_INTERNAL(),i,o)})}),bt(this,"reset",i=>{this.checkRefCount_INTERNAL();const o=this.getStore_INTERNAL();this._batch(()=>{NA(o,i.key,1),BR(this.getStore_INTERNAL(),i,HJ)})}),bt(this,"setUnvalidatedAtomValues_DEPRECATED",i=>{this.checkRefCount_INTERNAL();const o=this.getStore_INTERNAL();Q0(()=>{for(const[s,r]of i.entries())NA(o,s,1),KJ(o,new XJ(s),r)})}),this._batch=t}}var Gp={Snapshot:bp,MutableSnapshot:O0,freshSnapshot:zJ,cloneSnapshot:TJ},EJ=Gp.Snapshot,_J=Gp.MutableSnapshot,JJ=Gp.freshSnapshot,DJ=Gp.cloneSnapshot,Bp=Object.freeze({__proto__:null,Snapshot:EJ,MutableSnapshot:_J,freshSnapshot:JJ,cloneSnapshot:DJ});function UJ(...n){const e=new Set;for(const t of n)for(const i of t)e.add(i);return e}var PJ=UJ;const{useRef:QJ}=kt;function OJ(n){const e=QJ(n);return e.current===n&&typeof n=="function"&&(e.current=n()),e}var vR=OJ;const{getNextTreeStateVersion:jJ,makeEmptyStoreState:wX}=sX,{cleanUpNode:qJ,getDownstreamNodes:$J,initializeNode:eD,setNodeValue:tD,setUnvalidatedAtomValue_DEPRECATED:nD}=eg,{graph:iD}=su,{cloneGraph:oD}=su,{getNextStoreID:RX}=Ap,{createMutableSource:cb,reactMode:WX}=pp,{applyAtomValueWrites:sD}=Is,{releaseScheduledRetainablesNow:SX}=ha,{freshSnapshot:rD}=Bp,{useCallback:gD,useContext:VX,useEffect:j0,useMemo:aD,useRef:lD,useState:ID}=kt;function uc(){throw wt("This component must be used inside a <RecoilRoot> component.")}const xX=Object.freeze({storeID:RX(),getState:uc,replaceState:uc,getGraph:uc,subscribeToTransactions:uc,addTransactionMetadata:uc});let q0=!1;function ZR(n){if(q0)throw wt("An atom update was triggered within the execution of a state updater function. State updater functions provided to Recoil must be pure functions.");const e=n.getState();if(e.nextTree===null){Qt("recoil_memory_managament_2020")&&Qt("recoil_release_on_cascading_update_killswitch_2021")&&e.commitDepth>0&&SX(n);const t=e.currentTree.version,i=jJ();e.nextTree=Mt(gt({},e.currentTree),{version:i,stateID:i,dirtyAtoms:new Set,transactionMetadata:{}}),e.graphsByVersion.set(i,oD(Et(e.graphsByVersion.get(t))))}}const HX=kt.createContext({current:xX}),yp=()=>VX(HX),XX=kt.createContext(null);function cD(){return VX(XX)}function Iy(n,e,t){const i=$J(n,t,t.dirtyAtoms);for(const o of i){const s=e.nodeToComponentSubscriptions.get(o);if(s)for(const[r,[g,a]]of s)a(t)}}function MX(n){const e=n.getState(),t=e.currentTree,i=t.dirtyAtoms;if(i.size){for(const[o,s]of e.nodeTransactionSubscriptions)if(i.has(o))for(const[r,g]of s)g(n);for(const[o,s]of e.transactionSubscriptions)s(n);(!WX().early||e.suspendedComponentResolvers.size>0)&&(Iy(n,e,t),e.suspendedComponentResolvers.forEach(o=>o()),e.suspendedComponentResolvers.clear())}e.queuedComponentCallbacks_DEPRECATED.forEach(o=>o(t)),e.queuedComponentCallbacks_DEPRECATED.splice(0,e.queuedComponentCallbacks_DEPRECATED.length)}function CD(n){const e=n.getState();e.commitDepth++;try{const{nextTree:t}=e;if(t===null)return;e.previousTree=e.currentTree,e.currentTree=t,e.nextTree=null,MX(n),e.previousTree!=null?e.graphsByVersion.delete(e.previousTree.version):$H("Ended batch with no previous state, which is unexpected","recoil"),e.previousTree=null,Qt("recoil_memory_managament_2020")&&SX(n)}finally{e.commitDepth--}}function uD({setNotifyBatcherOfChange:n}){const e=yp(),[,t]=ID([]);return n(()=>t({})),j0(()=>(n(()=>t({})),()=>{n(()=>{})}),[n]),j0(()=>{TE.enqueueExecution("Batcher",()=>{CD(e.current)})}),null}function dD(n,e){const t=wX();return e({set:(i,o)=>{const s=t.currentTree,r=tD(n,s,i.key,o),g=new Set(r.keys()),a=s.nonvalidatedAtoms.clone();for(const l of g)a.delete(l);t.currentTree=Mt(gt({},s),{dirtyAtoms:PJ(s.dirtyAtoms,g),atomValues:sD(s.atomValues,r),nonvalidatedAtoms:a})},setUnvalidatedAtomValues:i=>{i.forEach((o,s)=>{t.currentTree=nD(t.currentTree,s,o)})}}),t}function AD(n){const e=rD().map(n),t=e.getStore_INTERNAL().getState();return e.retain(),t.nodeCleanupFunctions.forEach(i=>i()),t.nodeCleanupFunctions.clear(),t}let wR=0;function hD({initializeState_DEPRECATED:n,initializeState:e,store_INTERNAL:t,children:i}){let o;const s=A=>{const f=o.current.graphsByVersion;if(f.has(A))return Et(f.get(A));const b=iD();return f.set(A,b),b},r=(A,f)=>{if(f==null){const{transactionSubscriptions:b}=d.current.getState(),G=wR++;return b.set(G,A),{release:()=>{b.delete(G)}}}else{const{nodeTransactionSubscriptions:b}=d.current.getState();b.has(f)||b.set(f,new Map);const G=wR++;return Et(b.get(f)).set(G,A),{release:()=>{const m=b.get(f);m&&(m.delete(G),m.size===0&&b.delete(f))}}}},g=A=>{ZR(d.current);for(const f of Object.keys(A))Et(d.current.getState().nextTree).transactionMetadata[f]=A[f]},a=A=>{ZR(d.current);const f=Et(o.current.nextTree);let b;try{q0=!0,b=A(f)}finally{q0=!1}b!==f&&(o.current.nextTree=b,WX().early&&Iy(d.current,o.current,b),Et(l.current)())},l=lD(null),u=gD(A=>{l.current=A},[l]),d=vR(()=>t!=null?t:{storeID:RX(),getState:()=>o.current,replaceState:a,getGraph:s,subscribeToTransactions:r,addTransactionMetadata:g});t!=null&&(d.current=t),o=vR(()=>n!=null?dD(d.current,n):e!=null?AD(e):wX());const C=aD(()=>cb==null?void 0:cb(o,()=>o.current.currentTree.version),[o]);return j0(()=>{const A=d.current;for(const f of new Set(A.getState().knownAtoms))eD(A,f,"get");return()=>{for(const f of A.getState().knownAtoms)qJ(A,f)}},[d]),kt.createElement(HX.Provider,{value:d},kt.createElement(XX.Provider,{value:C},kt.createElement(uD,{setNotifyBatcherOfChange:u}),i))}function pD(n){const o=n,{override:e}=o,t=qn(o,["override"]),i=yp();return e===!1&&i.current!==xX?n.children:kt.createElement(hD,t)}function mD(){return yp().current.storeID}var Js={RecoilRoot:pD,useStoreRef:yp,useRecoilMutableSource:cD,useRecoilStoreID:mD,notifyComponents_FOR_TESTING:Iy,sendEndOfBatchNotifications_FOR_TESTING:MX};function fD(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}var bD=fD;const{useEffect:GD,useRef:BD}=kt;function yD(n){const e=BD();return GD(()=>{e.current=n}),e.current}var KX=yD;const{useStoreRef:vD}=Js,{SUSPENSE_TIMEOUT_MS:ZD}=ha,{updateRetainCount:dc}=ha,{RetentionZone:wD}=hp,{useEffect:RD,useRef:WD}=kt,{isSSR:RR}=ly;function SD(n){if(!!Qt("recoil_memory_managament_2020"))return VD(n)}function VD(n){const t=(Array.isArray(n)?n:[n]).map(r=>r instanceof wD?r:r.key),i=vD();RD(()=>{if(!Qt("recoil_memory_managament_2020"))return;const r=i.current;if(o.current&&!RR)window.clearTimeout(o.current),o.current=null;else for(const g of t)dc(r,g,1);return()=>{for(const g of t)dc(r,g,-1)}},[i,...t]);const o=WD(),s=KX(t);if(!RR&&(s===void 0||!bD(s,t))){const r=i.current;for(const g of t)dc(r,g,1);if(s)for(const g of s)dc(r,g,-1);o.current&&window.clearTimeout(o.current),o.current=window.setTimeout(()=>{o.current=null;for(const g of t)dc(r,g,-1)},ZD)}}var cy=SD;const{useRef:xD}=kt;function HD(){return xD(),"<component name not available>"}var gu=HD;const{batchUpdates:XD}=fp,{DEFAULT_VALUE:FX}=Ti,{reactMode:mI,useMutableSource:MD,useSyncExternalStore:KD}=pp,{useRecoilMutableSource:FD,useStoreRef:cs}=Js,{AbstractRecoilValue:$0,getRecoilValueAsLoadable:au,setRecoilValue:fh,setUnvalidatedRecoilValue:YD,subscribeToRecoilValue:nI}=Is,{useCallback:Ni,useEffect:iI,useMemo:YX,useRef:jc,useState:Cy}=kt,{setByAddingToSet:ND}=gX;function uy(n,e,t){if(n.state==="hasValue")return n.contents;throw n.state==="loading"?new Promise(o=>{t.current.getState().suspendedComponentResolvers.add(o)}):n.state==="hasError"?n.contents:wt(`Invalid value of loadable atom "${e.key}"`)}function LD(){const n=gu(),e=cs(),[,t]=Cy([]),i=jc(new Set);i.current=new Set;const o=jc(new Set),s=jc(new Map),r=Ni(a=>{const l=s.current.get(a);l&&(l.release(),s.current.delete(a))},[s]),g=Ni((a,l)=>{s.current.has(l)&&t([])},[]);return iI(()=>{const a=e.current;Qc(i.current,o.current).forEach(l=>{if(s.current.has(l))return;const u=nI(a,new $0(l),C=>g(C,l),n);s.current.set(l,u),a.getState().nextTree?a.getState().queuedComponentCallbacks_DEPRECATED.push(()=>{g(a.getState(),l)}):g(a.getState(),l)}),Qc(o.current,i.current).forEach(l=>{r(l)}),o.current=i.current}),iI(()=>{const a=s.current;return Qc(i.current,new Set(a.keys())).forEach(l=>{const u=nI(e.current,new $0(l),d=>g(d,l),n);a.set(l,u)}),()=>a.forEach((l,u)=>r(u))},[n,e,r,g]),YX(()=>{function a(f){return b=>{fh(e.current,f,b)}}function l(f){return()=>fh(e.current,f,FX)}function u(f){var b;i.current.has(f.key)||(i.current=ND(i.current,f.key));const G=e.current.getState();return au(e.current,f,mI().early&&(b=G.nextTree)!==null&&b!==void 0?b:G.currentTree)}function d(f){const b=u(f);return uy(b,f,e)}function C(f){return[d(f),a(f)]}function A(f){return[u(f),a(f)]}return{getRecoilValue:d,getRecoilValueLoadable:u,getRecoilState:C,getRecoilStateLoadable:A,getSetRecoilState:a,getResetRecoilState:l}},[i,e])}const zD={current:0};function kD(n){const e=cs(),t=gu(),i=Ni(()=>{var g;const a=e.current,l=a.getState(),u=mI().early&&(g=l.nextTree)!==null&&g!==void 0?g:l.currentTree;return{loadable:au(a,n,u),key:n.key}},[e,n]),o=Ni(g=>{let a;return()=>{var l,u;const d=g();return(l=a)!==null&&l!==void 0&&l.loadable.is(d.loadable)&&((u=a)===null||u===void 0?void 0:u.key)===d.key?a:(a=d,d)}},[]),s=YX(()=>o(i),[i,o]),r=Ni(g=>{const a=e.current;return nI(a,n,g,t).release},[e,n,t]);return KD(r,s,s).loadable}function TD(n){const e=cs(),t=Ni(()=>{var l;const u=e.current,d=u.getState(),C=mI().early&&(l=d.nextTree)!==null&&l!==void 0?l:d.currentTree;return au(u,n,C)},[e,n]),i=Ni(()=>t(),[t]),o=gu(),s=Ni((l,u)=>{const d=e.current;return nI(d,n,()=>{if(!Qt("recoil_suppress_rerender_in_callback"))return u();const A=t();a.current.is(A)||u(),a.current=A},o).release},[e,n,o,t]),r=FD();if(r==null)throw wt("Recoil hooks must be used in components contained within a <RecoilRoot> component.");const g=MD(r,i,s),a=jc(g);return iI(()=>{a.current=g}),g}function NX(n){const e=cs(),t=gu(),i=Ni(()=>{var a;const l=e.current,u=l.getState(),d=mI().early&&(a=u.nextTree)!==null&&a!==void 0?a:u.currentTree;return au(l,n,d)},[e,n]),o=Ni(()=>({loadable:i(),key:n.key}),[i,n.key]),s=Ni(a=>{const l=o();return a.loadable.is(l.loadable)&&a.key===l.key?a:l},[o]);iI(()=>{const a=nI(e.current,n,l=>{g(s)},t);return g(s),a.release},[t,n,e,s]);const[r,g]=Cy(o);return r.key!==n.key?o().loadable:r.loadable}function ED(n){const e=cs(),[,t]=Cy([]),i=gu(),o=Ni(()=>{var g;const a=e.current,l=a.getState(),u=mI().early&&(g=l.nextTree)!==null&&g!==void 0?g:l.currentTree;return au(a,n,u)},[e,n]),s=o(),r=jc(s);return iI(()=>{r.current=s}),iI(()=>{const g=e.current,a=g.getState(),l=nI(g,n,d=>{var C;if(!Qt("recoil_suppress_rerender_in_callback"))return t([]);const A=o();(C=r.current)!==null&&C!==void 0&&C.is(A)||t(A),r.current=A},i);if(a.nextTree)g.getState().queuedComponentCallbacks_DEPRECATED.push(()=>{r.current=null,t([])});else{var u;if(!Qt("recoil_suppress_rerender_in_callback"))return t([]);const d=o();(u=r.current)!==null&&u!==void 0&&u.is(d)||t(d),r.current=d}return l.release},[i,o,n,e]),s}function dy(n){return Qt("recoil_memory_managament_2020")&&cy(n),{TRANSITION_SUPPORT:NX,SYNC_EXTERNAL_STORE:kD,MUTABLE_SOURCE:TD,LEGACY:ED}[mI().mode](n)}function LX(n){const e=cs(),t=dy(n);return uy(t,n,e)}function vp(n){const e=cs();return Ni(t=>{fh(e.current,n,t)},[e,n])}function _D(n){const e=cs();return Ni(()=>{fh(e.current,n,FX)},[e,n])}function JD(n){return[LX(n),vp(n)]}function DD(n){return[dy(n),vp(n)]}function UD(){const n=cs();return(e,t={})=>{XD(()=>{n.current.addTransactionMetadata(t),e.forEach((i,o)=>YD(n.current,new $0(o),i))})}}function zX(n){return Qt("recoil_memory_managament_2020")&&cy(n),NX(n)}function kX(n){const e=cs(),t=zX(n);return uy(t,n,e)}function PD(n){return[kX(n),vp(n)]}var QD={recoilComponentGetRecoilValueCount_FOR_TESTING:zD,useRecoilInterface:LD,useRecoilState:JD,useRecoilStateLoadable:DD,useRecoilValue:LX,useRecoilValueLoadable:dy,useResetRecoilState:_D,useSetRecoilState:vp,useSetUnvalidatedAtomValues:UD,useRecoilValueLoadable_TRANSITION_SUPPORT_UNSTABLE:zX,useRecoilValue_TRANSITION_SUPPORT_UNSTABLE:kX,useRecoilState_TRANSITION_SUPPORT_UNSTABLE:PD};function OD(n,e){const t=new Map;for(const[i,o]of n)e(o,i)&&t.set(i,o);return t}var jD=OD;function qD(n,e){const t=new Set;for(const i of n)e(i)&&t.add(i);return t}var $D=qD;function eU(...n){const e=new Map;for(let t=0;t<n.length;t++){const i=n[t].keys();let o;for(;!(o=i.next()).done;)e.set(o.value,n[t].get(o.value))}return e}var tU=eU;const{batchUpdates:nU}=fp,{DEFAULT_VALUE:iU,getNode:TX,nodes:oU}=Ti,{useStoreRef:Ay}=Js,{AbstractRecoilValue:sU,setRecoilValueLoadable:rU}=Is,{SUSPENSE_TIMEOUT_MS:gU}=ha,{cloneSnapshot:bh}=Bp,{useCallback:Zp,useEffect:EX,useRef:WR,useState:aU}=kt,{isSSR:SR}=ly;function wp(n){const e=Ay();EX(()=>e.current.subscribeToTransactions(n).release,[n,e])}function VR(n){const e=n.atomValues.toMap(),t=mh(jD(e,(i,o)=>{const r=TX(o).persistence_UNSTABLE;return r!=null&&r.type!=="none"&&i.state==="hasValue"}),i=>i.contents);return tU(n.nonvalidatedAtoms.toMap(),t)}function lU(n){wp(Zp(e=>{let t=e.getState().previousTree;const i=e.getState().currentTree;t||(t=e.getState().currentTree);const o=VR(i),s=VR(t),r=mh(oU,a=>{var l,u,d,C;return{persistence_UNSTABLE:{type:(l=(u=a.persistence_UNSTABLE)===null||u===void 0?void 0:u.type)!==null&&l!==void 0?l:"none",backButton:(d=(C=a.persistence_UNSTABLE)===null||C===void 0?void 0:C.backButton)!==null&&d!==void 0?d:!1}}}),g=$D(i.dirtyAtoms,a=>o.has(a)||s.has(a));n({atomValues:o,previousAtomValues:s,atomInfo:r,modifiedAtoms:g,transactionMetadata:gt({},i.transactionMetadata)})},[n]))}function IU(n){wp(Zp(e=>{const t=bh(e,"current"),i=bh(e,"previous");n({snapshot:t,previousSnapshot:i})},[n]))}function cU(){const n=Ay(),[e,t]=aU(()=>bh(n.current)),i=KX(e),o=WR(),s=WR();if(wp(Zp(g=>t(bh(g)),[])),EX(()=>{const g=e.retain();if(o.current&&!SR){var a;window.clearTimeout(o.current),o.current=null,(a=s.current)===null||a===void 0||a.call(s),s.current=null}return g},[e]),i!==e&&!SR){if(o.current){var r;window.clearTimeout(o.current),o.current=null,(r=s.current)===null||r===void 0||r.call(s),s.current=null}s.current=e.retain(),o.current=window.setTimeout(()=>{var g;o.current=null,(g=s.current)===null||g===void 0||g.call(s),s.current=null},gU)}return e}function _X(n,e){var t;const i=n.getState(),o=(t=i.nextTree)!==null&&t!==void 0?t:i.currentTree,s=e.getStore_INTERNAL().getState().currentTree;nU(()=>{const r=new Set;for(const l of[o.atomValues.keys(),s.atomValues.keys()])for(const u of l){var g,a;((g=o.atomValues.get(u))===null||g===void 0?void 0:g.contents)!==((a=s.atomValues.get(u))===null||a===void 0?void 0:a.contents)&&TX(u).shouldRestoreFromSnapshots&&r.add(u)}r.forEach(l=>{rU(n,new sU(l),s.atomValues.has(l)?Et(s.atomValues.get(l)):iU)}),n.replaceState(l=>Mt(gt({},l),{stateID:e.getID()}))})}function CU(){const n=Ay();return Zp(e=>_X(n.current,e),[n])}var JX={useRecoilSnapshot:cU,gotoSnapshot:_X,useGotoRecoilSnapshot:CU,useRecoilTransactionObserver:IU,useTransactionObservation_DEPRECATED:lU,useTransactionSubscription_DEPRECATED:wp};const{peekNodeInfo:uU}=eg,{useStoreRef:dU}=Js;function AU(){const n=dU();return({key:e})=>uU(n.current,n.current.getState().currentTree,e)}var hU=AU;const{reactMode:pU}=pp,{RecoilRoot:mU,useStoreRef:fU}=Js,{useMemo:bU}=kt;function GU(){pU().mode==="MUTABLE_SOURCE"&&console.warn("Warning: There are known issues using useRecoilBridgeAcrossReactRoots() in recoil_mutable_source rendering mode.  Please consider upgrading to recoil_sync_external_store mode.");const n=fU().current;return bU(()=>{function e({children:t}){return kt.createElement(mU,{store_INTERNAL:n},t)}return e},[n])}var BU=GU;const{loadableWithValue:yU}=ou,{initializeNode:vU}=eg,{DEFAULT_VALUE:ZU,getNode:wU}=Ti,{copyTreeState:RU,getRecoilValueAsLoadable:WU,invalidateDownstreams:SU,writeLoadableToTreeState:VU}=Is;function xR(n){return wU(n.key).nodeType==="atom"}class xU{constructor(e,t){bt(this,"_store",void 0),bt(this,"_treeState",void 0),bt(this,"_changes",void 0),bt(this,"get",i=>{if(this._changes.has(i.key))return this._changes.get(i.key);if(!xR(i))throw wt("Reading selectors within atomicUpdate is not supported");const o=WU(this._store,i,this._treeState);if(o.state==="hasValue")return o.contents;throw o.state==="hasError"?o.contents:wt(`Expected Recoil atom ${i.key} to have a value, but it is in a loading state.`)}),bt(this,"set",(i,o)=>{if(!xR(i))throw wt("Setting selectors within atomicUpdate is not supported");if(typeof o=="function"){const s=this.get(i);this._changes.set(i.key,o(s))}else vU(this._store,i.key,"set"),this._changes.set(i.key,o)}),bt(this,"reset",i=>{this.set(i,ZU)}),this._store=e,this._treeState=t,this._changes=new Map}newTreeState_INTERNAL(){if(this._changes.size===0)return this._treeState;const e=RU(this._treeState);for(const[t,i]of this._changes)VU(e,t,yU(i));return SU(this._store,e),e}}function HU(n){return e=>{n.replaceState(t=>{const i=new xU(n,t);return e(i),i.newTreeState_INTERNAL()})}}var XU={atomicUpdater:HU},MU=XU.atomicUpdater,DX=Object.freeze({__proto__:null,atomicUpdater:MU});function KU(n,e){if(!n)throw new Error(e)}var FU=KU,Vc=FU;const{atomicUpdater:YU}=DX,{batchUpdates:NU}=fp,{DEFAULT_VALUE:LU}=Ti,{useStoreRef:zU}=Js,{refreshRecoilValue:kU,setRecoilValue:HR}=Is,{Snapshot:i6,cloneSnapshot:TU}=Bp,{gotoSnapshot:EU}=JX,{useCallback:_U}=kt;class UX{}const JU=new UX;function PX(n,e,t,i){let o=JU;return NU(()=>{const s="useRecoilCallback() expects a function that returns a function: it accepts a function of the type (RecoilInterface) => (Args) => ReturnType and returns a callback function (Args) => ReturnType, where RecoilInterface is an object {snapshot, set, ...} and Args and ReturnType are the argument and return types of the callback you want to create.  Please see the docs at recoiljs.org for details.";if(typeof e!="function")throw wt(s);const r=lX(Mt(gt({},i!=null?i:{}),{set:(a,l)=>HR(n,a,l),reset:a=>HR(n,a,LU),refresh:a=>kU(n,a),gotoSnapshot:a=>EU(n,a),transact_UNSTABLE:a=>YU(n)(a)}),{snapshot:()=>TU(n)}),g=e(r);if(typeof g!="function")throw wt(s);o=g(...t)}),o instanceof UX&&Vc(!1),o}function DU(n,e){const t=zU();return _U((...i)=>PX(t.current,n,i),e!=null?[...e,t]:void 0)}var QX={recoilCallback:PX,useRecoilCallback:DU};const{useStoreRef:UU}=Js,{refreshRecoilValue:PU}=Is,{useCallback:QU}=kt;function OU(n){const e=UU();return QU(()=>{const t=e.current;PU(t,n)},[n,e])}var jU=OU;const{atomicUpdater:qU}=DX,{useStoreRef:$U}=Js,{useMemo:eP}=kt;function tP(n,e){const t=$U();return eP(()=>(...i)=>{qU(t.current)(s=>{n(s)(...i)})},e!=null?[...e,t]:void 0)}var nP=tP;class iP{constructor(e){var t,i,o;bt(this,"_numLeafs",void 0),bt(this,"_root",void 0),bt(this,"_onHit",void 0),bt(this,"_onSet",void 0),bt(this,"_mapNodeValue",void 0),this._numLeafs=0,this._root=null,this._onHit=(t=e==null?void 0:e.onHit)!==null&&t!==void 0?t:()=>{},this._onSet=(i=e==null?void 0:e.onSet)!==null&&i!==void 0?i:()=>{},this._mapNodeValue=(o=e==null?void 0:e.mapNodeValue)!==null&&o!==void 0?o:s=>s}size(){return this._numLeafs}root(){return this._root}get(e,t){var i;return(i=this.getLeafNode(e,t))===null||i===void 0?void 0:i.value}getLeafNode(e,t){return OX(this.root(),i=>this._mapNodeValue(e(i)),{onNodeVisit:i=>{t==null||t.onNodeVisit(i),i.type==="leaf"&&this._onHit(i)}})}set(e,t,i){let o,s=null;const r=()=>{s=eG(this.root(),e.map(([g,a])=>[g,this._mapNodeValue(a)]),null,t,null,{onNodeVisit:g=>{i==null||i.onNodeVisit(g),g.type==="leaf"&&(o=g)}},()=>{this.clear(),r()})};r(),this.root()||(this._root=s),this._numLeafs++,this._onSet(Et(o))}delete(e){if(!this.root())return!1;const t=Et(this.root());return oP(t,e,e.parent)?e===t||t.type==="branch"&&!t.branches.size?(this._root=null,this._numLeafs=0,!0):(this._numLeafs-=qX(e),!0):!1}clear(){this._numLeafs=0,this._root=null}}const OX=(n,e,t)=>{var i;if(n==null)return;if(t==null||(i=t.onNodeVisit)===null||i===void 0||i.call(t,n),n.type==="leaf")return n;const o=e(n.nodeKey);return OX(n.branches.get(o),e,t)},eG=(n,e,t,i,o,s,r)=>{var g;let a;if(n==null)if(e.length===0)a={type:"leaf",value:i,parent:t,branchKey:o};else{const[l,...u]=e,[d,C]=l;a={type:"branch",nodeKey:d,parent:t,branches:new Map,branchKey:o},a.branches.set(C,eG(null,u,a,i,C,s,r))}else if(a=n,e.length){const[l,...u]=e,[d,C]=l;if(n.type!=="branch"||n.nodeKey!==d)return r(),a;n.branches.set(C,eG(n.branches.get(C),u,n,i,C,s,r))}return s==null||(g=s.onNodeVisit)===null||g===void 0||g.call(s,a),a},oP=(n,e,t)=>t?(t.branches.delete(e.branchKey),jX(n,t,t.parent)):n===e,jX=(n,e,t)=>t?(e.branches.size===0&&t.branches.delete(e.branchKey),jX(n,t,t.parent)):n===e,qX=n=>n.type==="leaf"?1:Array.from(n.branches.values()).reduce((e,t)=>e+qX(t),0);var sP={TreeCache:iP},rP=sP.TreeCache,$X=Object.freeze({__proto__:null,TreeCache:rP});class gP{constructor(e){var t;bt(this,"_maxSize",void 0),bt(this,"_size",void 0),bt(this,"_head",void 0),bt(this,"_tail",void 0),bt(this,"_map",void 0),bt(this,"_keyMapper",void 0),this._maxSize=e.maxSize,this._size=0,this._head=null,this._tail=null,this._map=new Map,this._keyMapper=(t=e.mapKey)!==null&&t!==void 0?t:i=>i}head(){return this._head}tail(){return this._tail}size(){return this._size}maxSize(){return this._maxSize}has(e){return this._map.has(this._keyMapper(e))}get(e){const t=this._keyMapper(e),i=this._map.get(t);if(!!i)return this.set(e,i.value),i.value}set(e,t){const i=this._keyMapper(e);this._map.get(i)&&this.delete(e);const s=this.head(),r={key:e,right:s,left:null,value:t};s?s.left=r:this._tail=r,this._map.set(i,r),this._head=r,this._size++,this._maybeDeleteLRU()}_maybeDeleteLRU(){this.size()>this.maxSize()&&this.deleteLru()}deleteLru(){const e=this.tail();e&&this.delete(e.key)}delete(e){const t=this._keyMapper(e);if(!this._size||!this._map.has(t))return;const i=Et(this._map.get(t)),o=i.right,s=i.left;o&&(o.left=i.left),s&&(s.right=i.right),i===this.head()&&(this._head=o),i===this.tail()&&(this._tail=s),this._map.delete(t),this._size--}clear(){this._size=0,this._head=null,this._tail=null,this._map=new Map}}var aP={LRUCache:gP},lP=aP.LRUCache,e9=Object.freeze({__proto__:null,LRUCache:lP});const{LRUCache:IP}=e9,{TreeCache:cP}=$X;function CP(n,e=t=>t){const t=new IP({maxSize:n}),i=new cP({mapNodeValue:e,onHit:o=>{t.set(o,!0)},onSet:o=>{const s=t.tail();t.set(o,!0),s&&i.size()>n&&i.delete(s.key)}});return i}var XR=CP;function Wo(n,e,t){if(typeof n=="string"&&!n.includes('"')&&!n.includes("\\"))return`"${n}"`;switch(typeof n){case"undefined":return"";case"boolean":return n?"true":"false";case"number":case"symbol":return String(n);case"string":return JSON.stringify(n);case"function":if((e==null?void 0:e.allowFunctions)!==!0)throw wt("Attempt to serialize function in a Recoil cache key");return`__FUNCTION(${n.name})__`}if(n===null)return"null";if(typeof n!="object"){var i;return(i=JSON.stringify(n))!==null&&i!==void 0?i:""}if(hn(n))return"__PROMISE__";if(Array.isArray(n))return`[${n.map((o,s)=>Wo(o,e,s.toString()))}]`;if(typeof n.toJSON=="function")return Wo(n.toJSON(t),e,t);if(n instanceof Map){const o={};for(const[s,r]of n)o[typeof s=="string"?s:Wo(s,e)]=r;return Wo(o,e,t)}return n instanceof Set?Wo(Array.from(n).sort((o,s)=>Wo(o,e).localeCompare(Wo(s,e))),e,t):Symbol!==void 0&&n[Symbol.iterator]!=null&&typeof n[Symbol.iterator]=="function"?Wo(Array.from(n),e,t):`{${Object.keys(n).filter(o=>n[o]!==void 0).sort().map(o=>`${Wo(o,e)}:${Wo(n[o],e,o)}`).join(",")}}`}function uP(n,e={allowFunctions:!1}){return Wo(n,e)}var Rp=uP;const{TreeCache:dP}=$X,aA={equality:"reference",eviction:"keep-all",maxSize:1/0};function AP({equality:n=aA.equality,eviction:e=aA.eviction,maxSize:t=aA.maxSize}=aA){const i=hP(n);return pP(e,t,i)}function hP(n){switch(n){case"reference":return e=>e;case"value":return e=>Rp(e)}throw wt(`Unrecognized equality policy ${n}`)}function pP(n,e,t){switch(n){case"keep-all":return new dP({mapNodeValue:t});case"lru":return XR(Et(e),t);case"most-recent":return XR(1,t)}throw wt(`Unrecognized eviction policy ${n}`)}var mP=AP;function fP(n){return()=>null}var bP={startPerfBlock:fP};const{loadableWithError:lA,loadableWithPromise:GP,loadableWithValue:Cb}=ou,{getNodeLoadable:BP,peekNodeLoadable:yP,setNodeValue:vP}=eg,{saveDependencyMapToStore:ZP}=su,{DEFAULT_VALUE:wP,RecoilValueNotReady:RP,getConfigDeletionHandler:WP,getNode:SP,registerNode:MR}=Ti,{isRecoilValue:VP}=tI,{markRecoilValueModified:KR}=Is,{retainedByOptionWithDefault:xP}=ha,{recoilCallback:HP}=QX,{startPerfBlock:XP}=bP;class t9{}const Ac=new t9,hc=[],IA=new Map,MP=(()=>{let n=0;return()=>n++})();function KP(n){let e=null;const{key:t,get:i,cachePolicy_UNSTABLE:o}=n,s=n.set!=null?n.set:void 0,r=new Set,g=mP(o!=null?o:{equality:"reference",eviction:"keep-all"}),a=xP(n.retainedBy_UNSTABLE),l=new Map;let u=0;function d(){return!Qt("recoil_memory_managament_2020")||u>0}function C(ee){return ee.getState().knownSelectors.add(t),u++,()=>{u--}}function A(){return WP(t)!==void 0&&!d()}function f(ee,_,Ae,ye,ge){oe(_,ye,ge),y(ee,_,new Set(ge.keys()),Ae),b(ee,Ae)}function b(ee,_){j(ee,_)&&$(ee);const Ae=IA.get(_);if(Ae!==void 0){for(const ye of Ae)KR(ye,Et(e));IA.delete(_)}}function G(ee,_){let Ae=IA.get(_);Ae==null&&IA.set(_,Ae=new Set),Ae.add(ee)}function m(ee,_,Ae){const ye=ee.getState().knownSelectors.has(Ae);if(ye&&_.atomValues.has(Ae))return Et(_.atomValues.get(Ae));const ge=BP(ee,_,Ae);return ge.state!=="loading"&&ye&&_.atomValues.set(Ae,ge),ge}function h(ee,_,Ae,ye,ge,we){return _.then(Ke=>{if(!d())throw $(ee),Ac;const ie=Cb(Ke);return f(ee,Ae,ge,ie,ye),Ke}).catch(Ke=>{if(!d())throw $(ee),Ac;if(Q(ee,ge,ye),hn(Ke))return B(ee,Ke,Ae,ye,ge,we);const ie=lA(Ke);throw f(ee,Ae,ge,ie,ye),Ke})}function B(ee,_,Ae,ye,ge,we){return _.then(Ke=>{if(!d())throw $(ee),Ac;we.loadingDepKey!=null&&we.loadingDepPromise===_?Ae.atomValues.set(we.loadingDepKey,Cb(Ke)):ee.getState().knownSelectors.forEach(Ve=>{Ae.atomValues.delete(Ve)});const ie=W(ee,Ae);if(ie&&ie.state!=="loading"){if((j(ee,ge)||U(ee)==null)&&b(ee,ge),ie.state==="hasValue")return ie.contents;throw ie.contents}if(!j(ee,ge)){const Ve=S(Ae);if((Ve==null?void 0:Ve.latestLoadable.state)==="loading")return Ve.latestLoadable.contents}const[de,Ge]=R(ee,Ae,ge);if(Q(ee,ge,Ge),de.state!=="loading"&&f(ee,Ae,ge,de,Ge),de.state==="hasError")throw de.contents;return de.contents}).catch(Ke=>{if(Ke instanceof t9)throw Ac;if(!d())throw $(ee),Ac;const ie=lA(Ke);throw f(ee,Ae,ge,ie,ye),Ke})}function y(ee,_,Ae,ye){var ge,we,Ke,ie;if(j(ee,ye)||_.version===((ge=ee.getState())===null||ge===void 0||(we=ge.currentTree)===null||we===void 0?void 0:we.version)||_.version===((Ke=ee.getState())===null||Ke===void 0||(ie=Ke.nextTree)===null||ie===void 0?void 0:ie.version)){var de,Ge,Ve;ZP(new Map([[t,Ae]]),ee,(de=(Ge=ee.getState())===null||Ge===void 0||(Ve=Ge.nextTree)===null||Ve===void 0?void 0:Ve.version)!==null&&de!==void 0?de:ee.getState().currentTree.version),Ae.forEach(xe=>r.add(xe))}}function Z(ee,_,Ae,ye,ge){Ae.add(ye),y(ee,_,Ae,ge)}function R(ee,_,Ae){const ye=XP(t);let ge=!0;const we=()=>{ye(),ge=!1};let Ke,ie=!1,de;const Ge={loadingDepKey:null,loadingDepPromise:null},Ve=new Map,xe=new Set;y(ee,_,xe,Ae);function Pe(nt){const{key:ct}=nt;Z(ee,_,xe,ct,Ae);const F=m(ee,_,ct);switch(Ve.set(ct,F),F.state){case"hasValue":return F.contents;case"hasError":throw F.contents;case"loading":throw Ge.loadingDepKey=ct,Ge.loadingDepPromise=F.contents,F.contents}throw wt("Invalid Loadable state")}const Ue=nt=>(...ct)=>{if(ge)throw wt("Callbacks from getCallback() should only be called asynchronously after the selector is evalutated.  It can be used for selectors to return objects with callbacks that can work with Recoil state without a subscription.");return e==null&&Vc(!1),HP(ee,nt,ct,{node:e})};try{Ke=i({get:Pe,getCallback:Ue}),Ke=VP(Ke)?Pe(Ke):Ke,hn(Ke)?Ke=h(ee,Ke,_,Ve,Ae,Ge).finally(we):we()}catch(nt){Ke=nt,hn(Ke)?Ke=B(ee,Ke,_,Ve,Ae,Ge).finally(we):(ie=!0,we())}return ie?de=lA(Ke):hn(Ke)?de=GP(Ke):de=Cb(Ke),[de,Ve]}function W(ee,_){const Ae=new Set,ye=U(ee);let ge;try{ge=g.get(we=>(typeof we!="string"&&Vc(!1),m(ee,_,we).contents),{onNodeVisit:we=>{we.type==="branch"&&we.nodeKey!==t&&Ae.add(we.nodeKey)}})}catch(we){throw wt(`Problem with cache lookup for selector "${t}": ${we.message}`)}return ge&&y(ee,_,Ae,ye==null?void 0:ye.latestExecutionId),ge}function x(ee){return Array.from(ee.entries()).map(([_,Ae])=>[_,Ae.contents])}function X(ee,_){const Ae=MP(),[ye,ge]=R(ee,_,Ae);return ye.state==="loading"?(D(ee,Ae,ye,ge,_),G(ee,Ae)):($(ee),oe(_,ye,ge)),ye}function Y(ee,_){const Ae=W(ee,_);if(Ae!=null)return $(ee),Ae;const ye=S(_);if(ye!=null){var ge;return((ge=ye.latestLoadable)===null||ge===void 0?void 0:ge.state)==="loading"&&G(ee,Et(ye.latestExecutionId)),Et(ye.latestLoadable)}return X(ee,_)}function S(ee){var _;const[,Ae]=(_=Array.from(l.entries()).find(([ye,ge])=>ge.latestLoadable!=null&&ge.latestExecutionId!=null&&!k(ye,ee)))!==null&&_!==void 0?_:[];return Ae}const H=new Map;function k(ee,_){var Ae,ye;const ge=U(ee),we=(Ae=ge==null?void 0:ge.depValuesDiscoveredSoFarDuringAsyncWork)!==null&&Ae!==void 0?Ae:new Map,Ke=Array(((ye=H.get(_.version))!==null&&ye!==void 0?ye:new Map).entries()),ie=H.has(_.version)&&Ke.length===we.size&&Ke.every(([de,Ge])=>we.get(de)===Ge);return we==null||_.version===(ge==null?void 0:ge.stateVersion)||ie?!1:(H.set(_.version,new Map(we)),Array.from(we).some(([de,Ge])=>m(ee,_,de).contents!==Ge.contents))}function U(ee){return l.get(ee)}function D(ee,_,Ae,ye,ge){l.set(ee,{depValuesDiscoveredSoFarDuringAsyncWork:ye,latestExecutionId:_,latestLoadable:Ae,stateVersion:ge.version})}function Q(ee,_,Ae){if(j(ee,_)){const ye=U(ee);ye!=null&&(ye.depValuesDiscoveredSoFarDuringAsyncWork=Ae)}}function $(ee){l.delete(ee)}function j(ee,_){var Ae;return _===((Ae=U(ee))===null||Ae===void 0?void 0:Ae.latestExecutionId)}function oe(ee,_,Ae){ee.atomValues.set(t,_);try{g.set(x(Ae),_)}catch(ye){throw wt(`Problem with setting cache for selector "${t}": ${ye.message}`)}}function Ie(ee){if(hc.includes(t)){const _=`Recoil selector has circular dependencies: ${hc.slice(hc.indexOf(t)).join(" \u2192 ")}`;return lA(wt(_))}hc.push(t);try{return ee()}finally{hc.pop()}}function T(ee,_){return g.get(Ae=>{var ye;return typeof Ae!="string"&&Vc(!1),(ye=yP(ee,_,Ae))===null||ye===void 0?void 0:ye.contents})}function P(ee,_){return Ie(()=>Y(ee,_))}function Ce(ee){ee.atomValues.delete(t)}function Me(ee,_){e==null&&Vc(!1);for(const ye of r){var Ae;const ge=SP(ye);(Ae=ge.clearCache)===null||Ae===void 0||Ae.call(ge,ee,_)}r.clear(),Ce(_),g.clear(),KR(ee,e)}return s!=null?e=MR({key:t,nodeType:"selector",peek:T,get:P,set:(_,Ae,ye)=>{let ge=!1;const we=new Map;function Ke({key:Ve}){if(ge)throw wt("Recoil: Async selector sets are not currently supported.");const xe=m(_,Ae,Ve);if(xe.state==="hasValue")return xe.contents;throw xe.state==="loading"?new RP(Ve):xe.contents}function ie(Ve,xe){if(ge)throw wt("Recoil: Async selector sets are not currently supported.");const Pe=typeof xe=="function"?xe(Ke(Ve)):xe;vP(_,Ae,Ve.key,Pe).forEach((nt,ct)=>we.set(ct,nt))}function de(Ve){ie(Ve,wP)}const Ge=s({set:ie,get:Ke,reset:de},ye);if(Ge!==void 0)throw hn(Ge)?wt("Recoil: Async selector sets are not currently supported."):wt("Recoil: selector set should be a void function.");return ge=!0,we},init:C,invalidate:Ce,clearCache:Me,shouldDeleteConfigOnRelease:A,dangerouslyAllowMutability:n.dangerouslyAllowMutability,shouldRestoreFromSnapshots:!1,retainedBy:a}):e=MR({key:t,nodeType:"selector",peek:T,get:P,init:C,invalidate:Ce,clearCache:Me,shouldDeleteConfigOnRelease:A,dangerouslyAllowMutability:n.dangerouslyAllowMutability,shouldRestoreFromSnapshots:!1,retainedBy:a})}var Gh=KP;const{loadableWithError:ub,loadableWithPromise:db,loadableWithValue:Pa}=ou,{peekNodeInfo:FP}=eg,{DEFAULT_VALUE:Zg,DefaultValue:dr,getConfigDeletionHandler:n9,registerNode:YP,setConfigDeletionHandler:NP}=Ti,{isRecoilValue:LP}=tI,{getRecoilValueAsLoadable:zP,markRecoilValueModified:kP,setRecoilValue:FR,setRecoilValueLoadable:TP}=Is,{retainedByOptionWithDefault:EP}=ha;function _P(n){const{key:e,persistence_UNSTABLE:t}=n,i=EP(n.retainedBy_UNSTABLE);let o=0,s=hn(n.default)?db(n.default.then(m=>(s=Pa(m),m)).catch(m=>{throw s=ub(m),m})):Pa(n.default);n.default;let r;const g=new Map;function a(m){return m}function l(m,h){const B=h.then(y=>{var Z,R;return((R=((Z=m.getState().nextTree)!==null&&Z!==void 0?Z:m.getState().currentTree).atomValues.get(e))===null||R===void 0?void 0:R.contents)===B&&FR(m,G,y),y}).catch(y=>{var Z,R;throw((R=((Z=m.getState().nextTree)!==null&&Z!==void 0?Z:m.getState().currentTree).atomValues.get(e))===null||R===void 0?void 0:R.contents)===B&&TP(m,G,ub(y)),y});return B}function u(m,h,B){var y;o++;const Z=()=>{var X;o--,(X=g.get(m))===null||X===void 0||X.forEach(Y=>Y()),g.delete(m)};if(m.getState().knownAtoms.add(e),s.state==="loading"){const X=()=>{var Y;((Y=m.getState().nextTree)!==null&&Y!==void 0?Y:m.getState().currentTree).atomValues.has(e)||kP(m,G)};s.contents.finally(X)}const R=(y=n.effects)!==null&&y!==void 0?y:n.effects_UNSTABLE;if(R!=null){let k=function(oe){if(X&&oe.key===e){const Ie=Y;return Ie instanceof dr?d(m,h):hn(Ie)?db(Ie.then(T=>T instanceof dr?s.toPromise():T)):Pa(Ie)}return zP(m,oe)},U=function(oe){return k(oe).toPromise()},D=function(oe){var Ie;const T=FP(m,(Ie=m.getState().nextTree)!==null&&Ie!==void 0?Ie:m.getState().currentTree,oe.key);return X&&oe.key===e&&!(Y instanceof dr)?Mt(gt({},T),{isSet:!0,loadable:k(oe)}):T},X=!0,Y=Zg,S=!1,H=null;const Q=oe=>Ie=>{if(X){const T=k(G),P=T.state==="hasValue"?T.contents:Zg;Y=typeof Ie=="function"?Ie(P):Ie,hn(Y)&&(Y=Y.then(Ce=>(H={effect:oe,value:Ce},Ce)))}else{if(hn(Ie))throw wt("Setting atoms to async values is not implemented.");typeof Ie!="function"&&(H={effect:oe,value:Ie}),FR(m,G,typeof Ie=="function"?T=>{const P=Ie(T);return H={effect:oe,value:P},P}:Ie)}},$=oe=>()=>Q(oe)(Zg),j=oe=>Ie=>{var T;const{release:P}=m.subscribeToTransactions(Ce=>{var Me;let{currentTree:ee,previousTree:_}=Ce.getState();_||(_=ee);const Ae=(Me=ee.atomValues.get(e))!==null&&Me!==void 0?Me:s;if(Ae.state==="hasValue"){var ye,ge,we,Ke;const ie=Ae.contents,de=(ye=_.atomValues.get(e))!==null&&ye!==void 0?ye:s,Ge=de.state==="hasValue"?de.contents:Zg;((ge=H)===null||ge===void 0?void 0:ge.effect)!==oe||((we=H)===null||we===void 0?void 0:we.value)!==ie?Ie(ie,Ge,!ee.atomValues.has(e)):((Ke=H)===null||Ke===void 0?void 0:Ke.effect)===oe&&(H=null)}},e);g.set(m,[...(T=g.get(m))!==null&&T!==void 0?T:[],P])};for(const oe of R)try{const Ie=oe({node:G,storeID:m.storeID,trigger:B,setSelf:Q(oe),resetSelf:$(oe),onSet:j(oe),getPromise:U,getLoadable:k,getInfo_UNSTABLE:D});if(Ie!=null){var W;g.set(m,[...(W=g.get(m))!==null&&W!==void 0?W:[],Ie])}}catch(Ie){Y=Ie,S=!0}if(X=!1,!(Y instanceof dr)){var x;const oe=Y,Ie=S?ub(Y):hn(oe)?db(l(m,oe)):Pa(oe);h.atomValues.set(e,Ie),(x=m.getState().nextTree)===null||x===void 0||x.atomValues.set(e,Ie)}}return Z}function d(m,h){var B,y;return(B=(y=h.atomValues.get(e))!==null&&y!==void 0?y:r)!==null&&B!==void 0?B:s}function C(m,h){if(h.atomValues.has(e))return Et(h.atomValues.get(e));if(h.nonvalidatedAtoms.has(e)){if(r!=null)return r;if(t==null)return s;const B=h.nonvalidatedAtoms.get(e),y=t.validator(B,Zg);return r=y instanceof dr?s:Pa(y),r}else return s}function A(){r=void 0}function f(m,h,B){if(h.atomValues.has(e)){const y=Et(h.atomValues.get(e));if(y.state==="hasValue"&&B===y.contents)return new Map}else if(!h.nonvalidatedAtoms.has(e)&&B instanceof dr)return new Map;return r=void 0,new Map().set(e,Pa(B))}function b(){return n9(e)!==void 0&&o<=0}const G=YP({key:e,nodeType:"atom",peek:d,get:C,set:f,init:u,invalidate:A,shouldDeleteConfigOnRelease:b,dangerouslyAllowMutability:n.dangerouslyAllowMutability,persistence_UNSTABLE:n.persistence_UNSTABLE?{type:n.persistence_UNSTABLE.type,backButton:n.persistence_UNSTABLE.backButton}:void 0,shouldRestoreFromSnapshots:!0,retainedBy:i});return G}function i9(n){const i=n,{default:e}=i,t=qn(i,["default"]);return LP(e)?JP(Mt(gt({},t),{default:e})):_P(Mt(gt({},t),{default:e}))}function JP(n){const e=i9(Mt(gt({},n),{default:Zg,persistence_UNSTABLE:n.persistence_UNSTABLE===void 0?void 0:Mt(gt({},n.persistence_UNSTABLE),{validator:i=>i instanceof dr?i:Et(n.persistence_UNSTABLE).validator(i,Zg)}),effects:n.effects,effects_UNSTABLE:n.effects_UNSTABLE})),t=Gh({key:`${n.key}__withFallback`,get:({get:i})=>{const o=i(e);return o instanceof dr?n.default:o},set:({set:i},o)=>i(e,o),dangerouslyAllowMutability:n.dangerouslyAllowMutability});return NP(t.key,n9(n.key)),t}var o9=i9;class DP{constructor(e){var t;bt(this,"_map",void 0),bt(this,"_keyMapper",void 0),this._map=new Map,this._keyMapper=(t=e==null?void 0:e.mapKey)!==null&&t!==void 0?t:i=>i}size(){return this._map.size}has(e){return this._map.has(this._keyMapper(e))}get(e){return this._map.get(this._keyMapper(e))}set(e,t){this._map.set(this._keyMapper(e),t)}delete(e){this._map.delete(this._keyMapper(e))}clear(){this._map.clear()}}var UP={MapCache:DP},PP=UP.MapCache,QP=Object.freeze({__proto__:null,MapCache:PP});const{LRUCache:YR}=e9,{MapCache:OP}=QP,cA={equality:"reference",eviction:"none",maxSize:1/0};function jP({equality:n=cA.equality,eviction:e=cA.eviction,maxSize:t=cA.maxSize}=cA){const i=qP(n);return $P(e,t,i)}function qP(n){switch(n){case"reference":return e=>e;case"value":return e=>Rp(e)}throw wt(`Unrecognized equality policy ${n}`)}function $P(n,e,t){switch(n){case"keep-all":return new OP({mapKey:t});case"lru":return new YR({mapKey:t,maxSize:Et(e)});case"most-recent":return new YR({mapKey:t,maxSize:1})}throw wt(`Unrecognized eviction policy ${n}`)}var s9=jP;const{setConfigDeletionHandler:eQ}=Ti;function tQ(n){var e,t;const i=s9({equality:(e=(t=n.cachePolicyForParams_UNSTABLE)===null||t===void 0?void 0:t.equality)!==null&&e!==void 0?e:"value",eviction:"keep-all"});return o=>{var s,r;const g=i.get(o);if(g!=null)return g;const d=n,{cachePolicyForParams_UNSTABLE:a}=d,l=qn(d,["cachePolicyForParams_UNSTABLE"]),u=o9(Mt(gt({},l),{key:`${n.key}__${(s=Rp(o))!==null&&s!==void 0?s:"void"}`,default:typeof n.default=="function"?n.default(o):n.default,retainedBy_UNSTABLE:typeof n.retainedBy_UNSTABLE=="function"?n.retainedBy_UNSTABLE(o):n.retainedBy_UNSTABLE,effects:typeof n.effects=="function"?n.effects(o):typeof n.effects_UNSTABLE=="function"?n.effects_UNSTABLE(o):(r=n.effects)!==null&&r!==void 0?r:n.effects_UNSTABLE}));return i.set(o,u),eQ(u.key,()=>{i.delete(o)}),u}}var nQ=tQ;const{setConfigDeletionHandler:iQ}=Ti;let oQ=0;function sQ(n){var e,t;const i=s9({equality:(e=(t=n.cachePolicyForParams_UNSTABLE)===null||t===void 0?void 0:t.equality)!==null&&e!==void 0?e:"value",eviction:"keep-all"});return o=>{var s;const r=i.get(o);if(r!=null)return r;const g=`${n.key}__selectorFamily/${(s=Rp(o,{allowFunctions:!0}))!==null&&s!==void 0?s:"void"}/${oQ++}`,a=C=>n.get(o)(C),l=n.cachePolicy_UNSTABLE,u=typeof n.retainedBy_UNSTABLE=="function"?n.retainedBy_UNSTABLE(o):n.retainedBy_UNSTABLE;let d;if(n.set!=null){const C=n.set;d=Gh({key:g,get:a,set:(f,b)=>C(o)(f,b),cachePolicy_UNSTABLE:l,dangerouslyAllowMutability:n.dangerouslyAllowMutability,retainedBy_UNSTABLE:u})}else d=Gh({key:g,get:a,cachePolicy_UNSTABLE:l,dangerouslyAllowMutability:n.dangerouslyAllowMutability,retainedBy_UNSTABLE:u});return i.set(o,d),iQ(d.key,()=>{i.delete(o)}),d}}var tg=sQ;const rQ=tg({key:"__constant",get:n=>()=>n,cachePolicyForParams_UNSTABLE:{equality:"reference"}});function gQ(n){return rQ(n)}var aQ=gQ;const lQ=tg({key:"__error",get:n=>()=>{throw wt(n)},cachePolicyForParams_UNSTABLE:{equality:"reference"}});function IQ(n){return lQ(n)}var cQ=IQ;function CQ(n){return n}var uQ=CQ;const{loadableWithError:r9,loadableWithPromise:g9,loadableWithValue:a9}=ou;function Wp(n,e){const t=Array(e.length).fill(void 0),i=Array(e.length).fill(void 0);for(const[o,s]of e.entries())try{t[o]=n(s)}catch(r){i[o]=r}return[t,i]}function dQ(n){return n!=null&&!hn(n)}function Sp(n){return Array.isArray(n)?n:Object.getOwnPropertyNames(n).map(e=>n[e])}function tG(n,e){return Array.isArray(n)?e:Object.getOwnPropertyNames(n).reduce((t,i,o)=>Mt(gt({},t),{[i]:e[o]}),{})}function Wl(n,e,t){const i=t.map((o,s)=>o==null?a9(e[s]):hn(o)?g9(o):r9(o));return tG(n,i)}function AQ(n,e){return e.map((t,i)=>t===void 0?n[i]:t)}const hQ=tg({key:"__waitForNone",get:n=>({get:e})=>{const t=Sp(n),[i,o]=Wp(e,t);return Wl(n,i,o)},dangerouslyAllowMutability:!0}),pQ=tg({key:"__waitForAny",get:n=>({get:e})=>{const t=Sp(n),[i,o]=Wp(e,t);return o.some(s=>!hn(s))?Wl(n,i,o):new Promise(s=>{for(const[r,g]of o.entries())hn(g)&&g.then(a=>{i[r]=a,o[r]=void 0,s(Wl(n,i,o))}).catch(a=>{o[r]=a,s(Wl(n,i,o))})})},dangerouslyAllowMutability:!0}),mQ=tg({key:"__waitForAll",get:n=>({get:e})=>{const t=Sp(n),[i,o]=Wp(e,t);if(o.every(r=>r==null))return tG(n,i);const s=o.find(dQ);if(s!=null)throw s;return Promise.all(o).then(r=>tG(n,AQ(i,r)))},dangerouslyAllowMutability:!0}),fQ=tg({key:"__waitForAllSettled",get:n=>({get:e})=>{const t=Sp(n),[i,o]=Wp(e,t);return o.every(s=>!hn(s))?Wl(n,i,o):Promise.all(o.map((s,r)=>hn(s)?s.then(g=>{i[r]=g,o[r]=void 0}).catch(g=>{i[r]=void 0,o[r]=g}):null)).then(()=>Wl(n,i,o))},dangerouslyAllowMutability:!0}),bQ=tg({key:"__noWait",get:n=>({get:e})=>{try{return a9(e(n))}catch(t){return hn(t)?g9(t):r9(t)}},dangerouslyAllowMutability:!0});var GQ={waitForNone:hQ,waitForAny:pQ,waitForAll:mQ,waitForAllSettled:fQ,noWait:bQ};const{RecoilLoadable:BQ}=ou,{DefaultValue:yQ}=Ti,{RecoilRoot:vQ,useRecoilStoreID:ZQ}=Js,{isRecoilValue:wQ}=tI,{retentionZone:RQ}=hp,{freshSnapshot:WQ}=Bp,{useRecoilState:SQ,useRecoilState_TRANSITION_SUPPORT_UNSTABLE:VQ,useRecoilStateLoadable:xQ,useRecoilValue:HQ,useRecoilValue_TRANSITION_SUPPORT_UNSTABLE:XQ,useRecoilValueLoadable:MQ,useRecoilValueLoadable_TRANSITION_SUPPORT_UNSTABLE:KQ,useResetRecoilState:FQ,useSetRecoilState:YQ}=QD,{useGotoRecoilSnapshot:NQ,useRecoilSnapshot:LQ,useRecoilTransactionObserver:zQ}=JX,{useRecoilCallback:kQ}=QX,{noWait:TQ,waitForAll:EQ,waitForAllSettled:_Q,waitForAny:JQ,waitForNone:DQ}=GQ;var lu={DefaultValue:yQ,isRecoilValue:wQ,RecoilLoadable:BQ,RecoilRoot:vQ,useRecoilStoreID:ZQ,useRecoilBridgeAcrossReactRoots_UNSTABLE:BU,atom:o9,selector:Gh,atomFamily:nQ,selectorFamily:tg,constSelector:aQ,errorSelector:cQ,readOnlySelector:uQ,noWait:TQ,waitForNone:DQ,waitForAny:JQ,waitForAll:EQ,waitForAllSettled:_Q,useRecoilValue:HQ,useRecoilValueLoadable:MQ,useRecoilState:SQ,useRecoilStateLoadable:xQ,useSetRecoilState:YQ,useResetRecoilState:FQ,useGetRecoilValueInfo_UNSTABLE:hU,useRecoilRefresher_UNSTABLE:jU,useRecoilValueLoadable_TRANSITION_SUPPORT_UNSTABLE:KQ,useRecoilValue_TRANSITION_SUPPORT_UNSTABLE:XQ,useRecoilState_TRANSITION_SUPPORT_UNSTABLE:VQ,useRecoilCallback:kQ,useRecoilTransaction_UNSTABLE:nP,useGotoRecoilSnapshot:NQ,useRecoilSnapshot:LQ,useRecoilTransactionObserver_UNSTABLE:zQ,snapshot_UNSTABLE:WQ,useRetain:cy,retentionZone:RQ},o6=lu.RecoilRoot,s6=lu.useRecoilBridgeAcrossReactRoots_UNSTABLE,r6=lu.atom,g6=lu.useRecoilValue,a6=lu.useRecoilState;function Xe(){return Xe=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Xe.apply(this,arguments)}class hy extends oi{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new OQ(t)}),this.register(function(t){return new nO(t)}),this.register(function(t){return new iO(t)}),this.register(function(t){return new jQ(t)}),this.register(function(t){return new qQ(t)}),this.register(function(t){return new $Q(t)}),this.register(function(t){return new eO(t)}),this.register(function(t){return new tO(t)}),this.register(function(t){return new PQ(t)}),this.register(function(t){return new oO(t)})}load(e,t,i,o){const s=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=Ho.extractUrlBase(e),this.manager.itemStart(e);const g=function(l){o?o(l):console.error(l),s.manager.itemError(e),s.manager.itemEnd(e)},a=new Li(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{s.parse(l,r,function(u){t(u),s.manager.itemEnd(e)},g)}catch(u){g(u)}},i,g)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,o){let s;const r={},g={};if(typeof e=="string")s=e;else if(Ho.decodeText(new Uint8Array(e,0,4))===l9){try{r[Wt.KHR_BINARY_GLTF]=new sO(e)}catch(d){o&&o(d);return}s=r[Wt.KHR_BINARY_GLTF].content}else s=Ho.decodeText(new Uint8Array(e));const a=JSON.parse(s);if(a.asset===void 0||a.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new pO(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](l);g[d.name]=d,r[d.name]=!0}if(a.extensionsUsed)for(let u=0;u<a.extensionsUsed.length;++u){const d=a.extensionsUsed[u],C=a.extensionsRequired||[];switch(d){case Wt.KHR_MATERIALS_UNLIT:r[d]=new QQ;break;case Wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[d]=new aO;break;case Wt.KHR_DRACO_MESH_COMPRESSION:r[d]=new rO(a,this.dracoLoader);break;case Wt.KHR_TEXTURE_TRANSFORM:r[d]=new gO;break;case Wt.KHR_MESH_QUANTIZATION:r[d]=new lO;break;default:C.indexOf(d)>=0&&g[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(r),l.setPlugins(g),l.parse(i,o)}parseAsync(e,t){const i=this;return new Promise(function(o,s){i.parse(e,t,o,s)})}}function UQ(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Wt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class PQ{constructor(e){this.parser=e,this.name=Wt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,o=t.length;i<o;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let o=t.cache.get(i);if(o)return o;const s=t.json,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let l;const u=new ze(16777215);a.color!==void 0&&u.fromArray(a.color);const d=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new sp(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new op(u),l.distance=d;break;case"spot":l=new ip(u),l.distance=d,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,a.intensity!==void 0&&(l.intensity=a.intensity),l.name=t.createUniqueName(a.name||"light_"+e),o=Promise.resolve(l),t.cache.add(i,o),o}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],g=(s.extensions&&s.extensions[this.name]||{}).light;return g===void 0?null:this._loadLight(g).then(function(a){return i._getNodeRef(t.cache,g,a)})}}class QQ{constructor(){this.name=Wt.KHR_MATERIALS_UNLIT}getMaterialType(){return Ki}extendParams(e,t,i){const o=[];e.color=new ze(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const r=s.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}s.baseColorTexture!==void 0&&o.push(i.assignTexture(e,"map",s.baseColorTexture))}return Promise.all(o)}}class OQ{constructor(e){this.parser=e,this.name=Wt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,o=i.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],r=o.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const g=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Se(g,g)}return Promise.all(s)}}class jQ{constructor(e){this.parser=e,this.name=Wt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,o=i.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new ze(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=o.extensions[this.name];return r.sheenColorFactor!==void 0&&t.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture)),r.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class qQ{constructor(e){this.parser=e,this.name=Wt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,o=i.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],r=o.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class $Q{constructor(e){this.parser=e,this.name=Wt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,o=i.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],r=o.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||0;const g=r.attenuationColor||[1,1,1];return t.attenuationColor=new ze(g[0],g[1],g[2]),Promise.all(s)}}class eO{constructor(e){this.parser=e,this.name=Wt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=o.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class tO{constructor(e){this.parser=e,this.name=Wt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,o=i.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],r=o.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const g=r.specularColorFactor||[1,1,1];return t.specularColor=new ze(g[0],g[1],g[2]),r.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture).then(function(a){a.encoding=Lt})),Promise.all(s)}}class nO{constructor(e){this.parser=e,this.name=Wt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,o=i.textures[e];if(!o.extensions||!o.extensions[this.name])return null;const s=o.extensions[this.name],r=i.images[s.source],g=t.options.ktx2Loader;if(!g){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r,g)}}class iO{constructor(e){this.parser=e,this.name=Wt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,o=i.json,s=o.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],g=o.images[r.source];let a=i.textureLoader;if(g.uri){const l=i.options.manager.getHandler(g.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,g,a);if(o.extensionsRequired&&o.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class oO{constructor(e){this.name=Wt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const o=i.extensions[this.name],s=this.parser.getDependency("buffer",o.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([s,r.ready]).then(function(g){const a=o.byteOffset||0,l=o.byteLength||0,u=o.count,d=o.byteStride,C=new ArrayBuffer(u*d),A=new Uint8Array(g[0],a,l);return r.decodeGltfBuffer(new Uint8Array(C),u,d,A,o.mode,o.filter),C})}else return null}}const l9="glTF",pc=12,NR={JSON:1313821514,BIN:5130562};class sO{constructor(e){this.name=Wt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,pc);if(this.header={magic:Ho.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==l9)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-pc,o=new DataView(e,pc);let s=0;for(;s<i;){const r=o.getUint32(s,!0);s+=4;const g=o.getUint32(s,!0);if(s+=4,g===NR.JSON){const a=new Uint8Array(e,pc+s,r);this.content=Ho.decodeText(a)}else if(g===NR.BIN){const a=pc+s;this.body=e.slice(a,a+r)}s+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class rO{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Wt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,o=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,g={},a={},l={};for(const u in r){const d=iG[u]||u.toLowerCase();g[d]=r[u]}for(const u in e.attributes){const d=iG[u]||u.toLowerCase();if(r[u]!==void 0){const C=i.accessors[e.attributes[u]],A=VC[C.componentType];l[d]=A,a[d]=C.normalized===!0}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(d){o.decodeDracoFile(u,function(C){for(const A in C.attributes){const f=C.attributes[A],b=a[A];b!==void 0&&(f.normalized=b)}d(C)},g,l)})})}}class gO{constructor(){this.name=Wt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class nG extends Ca{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),g={specular:{value:new ze().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=g,this.onBeforeCompile=function(a){for(const l in g)a.uniforms[l]=g[l];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return g.specular.value},set:function(a){g.specular.value=a}},specularMap:{get:function(){return g.specularMap.value},set:function(a){g.specularMap.value=a,a?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return g.glossiness.value},set:function(a){g.glossiness.value=a}},glossinessMap:{get:function(){return g.glossinessMap.value},set:function(a){g.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class aO{constructor(){this.name=Wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return nG}extendParams(e,t,i){const o=t.extensions[this.name];e.color=new ze(1,1,1),e.opacity=1;const s=[];if(Array.isArray(o.diffuseFactor)){const r=o.diffuseFactor;e.color.fromArray(r),e.opacity=r[3]}if(o.diffuseTexture!==void 0&&s.push(i.assignTexture(e,"map",o.diffuseTexture)),e.emissive=new ze(0,0,0),e.glossiness=o.glossinessFactor!==void 0?o.glossinessFactor:1,e.specular=new ze(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),o.specularGlossinessTexture!==void 0){const r=o.specularGlossinessTexture;s.push(i.assignTexture(e,"glossinessMap",r)),s.push(i.assignTexture(e,"specularMap",r))}return Promise.all(s)}createMaterial(e){const t=new nG(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Pr,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class lO{constructor(){this.name=Wt.KHR_MESH_QUANTIZATION}}class sa extends as{constructor(e,t,i,o){super(e,t,i,o)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o*3+o;for(let r=0;r!==o;r++)t[r]=i[s+r];return t}}sa.prototype.beforeStart_=sa.prototype.copySampleValue_;sa.prototype.afterEnd_=sa.prototype.copySampleValue_;sa.prototype.interpolate_=function(n,e,t,i){const o=this.resultBuffer,s=this.sampleValues,r=this.valueSize,g=r*2,a=r*3,l=i-e,u=(t-e)/l,d=u*u,C=d*u,A=n*a,f=A-a,b=-2*C+3*d,G=C-d,m=1-b,h=G-d+u;for(let B=0;B!==r;B++){const y=s[f+B+r],Z=s[f+B+g]*l,R=s[A+B+r],W=s[A+B]*l;o[B]=m*y+h*Z+b*R+G*W}return o};const IO=new xn;class cO extends sa{interpolate_(e,t,i,o){const s=super.interpolate_(e,t,i,o);return IO.fromArray(s).normalize().toArray(s),s}}const Rs={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},VC={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},LR={9728:Rn,9729:gn,9984:pC,9985:zh,9986:mC,9987:ks},zR={33071:ui,33648:Fl,10497:kr},kR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iG={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},cr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},CO={CUBICSPLINE:void 0,LINEAR:Pg,STEP:Nl},Ab={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function uO(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Ca({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Yr})),n.DefaultMaterial}function mc(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Gg(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function dO(n,e,t){let i=!1,o=!1;for(let g=0,a=e.length;g<a;g++){const l=e[g];if(l.POSITION!==void 0&&(i=!0),l.NORMAL!==void 0&&(o=!0),i&&o)break}if(!i&&!o)return Promise.resolve(n);const s=[],r=[];for(let g=0,a=e.length;g<a;g++){const l=e[g];if(i){const u=l.POSITION!==void 0?t.getDependency("accessor",l.POSITION):n.attributes.position;s.push(u)}if(o){const u=l.NORMAL!==void 0?t.getDependency("accessor",l.NORMAL):n.attributes.normal;r.push(u)}}return Promise.all([Promise.all(s),Promise.all(r)]).then(function(g){const a=g[0],l=g[1];return i&&(n.morphAttributes.position=a),o&&(n.morphAttributes.normal=l),n.morphTargetsRelative=!0,n})}function AO(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,o=t.length;i<o;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function hO(n){const e=n.extensions&&n.extensions[Wt.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+TR(e.attributes):t=n.indices+":"+TR(n.attributes)+":"+n.mode,t}function TR(n){let e="";const t=Object.keys(n).sort();for(let i=0,o=t.length;i<o;i++)e+=t[i]+":"+n[t[i]]+";";return e}function oG(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class pO{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new UQ,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new DB(this.options.manager):this.textureLoader=new LB(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Li(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,o=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(r){const g={scene:r[0][o.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:o.asset,parser:i,userData:{}};mc(s,g,o),Gg(g,o),Promise.all(i._invokeAll(function(a){return a.afterRoot&&a.afterRoot(g)})).then(function(){e(g)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let o=0,s=t.length;o<s;o++){const r=t[o].joints;for(let g=0,a=r.length;g<a;g++)e[r[g]].isBone=!0}for(let o=0,s=e.length;o<s;o++){const r=e[o];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(i[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const o=i.clone(),s=(r,g)=>{const a=this.associations.get(r);a!=null&&this.associations.set(g,a);for(const[l,u]of r.children.entries())s(u,g.children[l])};return s(i,o),o.name+="_instance_"+e.uses[t]++,o}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const o=e(t[i]);if(o)return o}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let o=0;o<t.length;o++){const s=e(t[o]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let o=this.cache.get(i);if(!o){switch(e){case"scene":o=this.loadScene(t);break;case"node":o=this.loadNode(t);break;case"mesh":o=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":o=this.loadAccessor(t);break;case"bufferView":o=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":o=this.loadBuffer(t);break;case"material":o=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":o=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":o=this.loadSkin(t);break;case"animation":o=this.loadAnimation(t);break;case"camera":o=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,o)}return o}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,o=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(o.map(function(s,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Wt.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(s,r){i.load(Ho.resolveURL(t.uri,o.path),s,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const o=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+o)})}loadAccessor(e){const t=this,i=this.json,o=this.json.accessors[e];if(o.bufferView===void 0&&o.sparse===void 0)return Promise.resolve(null);const s=[];return o.bufferView!==void 0?s.push(this.getDependency("bufferView",o.bufferView)):s.push(null),o.sparse!==void 0&&(s.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(s).then(function(r){const g=r[0],a=kR[o.type],l=VC[o.componentType],u=l.BYTES_PER_ELEMENT,d=u*a,C=o.byteOffset||0,A=o.bufferView!==void 0?i.bufferViews[o.bufferView].byteStride:void 0,f=o.normalized===!0;let b,G;if(A&&A!==d){const m=Math.floor(C/A),h="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+m+":"+o.count;let B=t.cache.get(h);B||(b=new l(g,m*A,o.count*A/u),B=new qr(b,A/u),t.cache.add(h,B)),G=new Ns(B,a,C%A/u,f)}else g===null?b=new l(o.count*a):b=new l(g,C,o.count*a),G=new vt(b,a,f);if(o.sparse!==void 0){const m=kR.SCALAR,h=VC[o.sparse.indices.componentType],B=o.sparse.indices.byteOffset||0,y=o.sparse.values.byteOffset||0,Z=new h(r[1],B,o.sparse.count*m),R=new l(r[2],y,o.sparse.count*a);g!==null&&(G=new vt(G.array.slice(),G.itemSize,G.normalized));for(let W=0,x=Z.length;W<x;W++){const X=Z[W];if(G.setX(X,R[W*a]),a>=2&&G.setY(X,R[W*a+1]),a>=3&&G.setZ(X,R[W*a+2]),a>=4&&G.setW(X,R[W*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return G})}loadTexture(e){const t=this.json,i=this.options,o=t.textures[e],s=t.images[o.source];let r=this.textureLoader;if(s.uri){const g=i.manager.getHandler(s.uri);g!==null&&(r=g)}return this.loadTextureImage(e,s,r)}loadTextureImage(e,t,i){const o=this,s=this.json,r=this.options,g=s.textures[e],a=(t.uri||t.bufferView)+":"+g.sampler;if(this.textureCache[a])return this.textureCache[a];const l=self.URL||self.webkitURL;let u=t.uri||"",d=!1;if(t.bufferView!==void 0)u=o.getDependency("bufferView",t.bufferView).then(function(A){d=!0;const f=new Blob([A],{type:t.mimeType});return u=l.createObjectURL(f),u});else if(t.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const C=Promise.resolve(u).then(function(A){return new Promise(function(f,b){let G=f;i.isImageBitmapLoader===!0&&(G=function(m){const h=new pn(m);h.needsUpdate=!0,f(h)}),i.load(Ho.resolveURL(A,r.path),G,void 0,b)})}).then(function(A){d===!0&&l.revokeObjectURL(u),A.flipY=!1,g.name&&(A.name=g.name);const b=(s.samplers||{})[g.sampler]||{};return A.magFilter=LR[b.magFilter]||gn,A.minFilter=LR[b.minFilter]||ks,A.wrapS=zR[b.wrapS]||kr,A.wrapT=zR[b.wrapT]||kr,o.associations.set(A,{textures:e}),A}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null});return this.textureCache[a]=C,C}assignTexture(e,t,i){const o=this;return this.getDependency("texture",i.index).then(function(s){if(i.texCoord!==void 0&&i.texCoord!=0&&!(t==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),o.extensions[Wt.KHR_TEXTURE_TRANSFORM]){const r=i.extensions!==void 0?i.extensions[Wt.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const g=o.associations.get(s);s=o.extensions[Wt.KHR_TEXTURE_TRANSFORM].extendTexture(s,r),o.associations.set(s,g)}}return e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const o=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const g="PointsMaterial:"+i.uuid;let a=this.cache.get(g);a||(a=new $r,cn.prototype.copy.call(a,i),a.color.copy(i.color),a.map=i.map,a.sizeAttenuation=!1,this.cache.add(g,a)),i=a}else if(e.isLine){const g="LineBasicMaterial:"+i.uuid;let a=this.cache.get(g);a||(a=new En,cn.prototype.copy.call(a,i),a.color.copy(i.color),this.cache.add(g,a)),i=a}if(o||s||r){let g="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(g+="specular-glossiness:"),o&&(g+="derivative-tangents:"),s&&(g+="vertex-colors:"),r&&(g+="flat-shading:");let a=this.cache.get(g);a||(a=i.clone(),s&&(a.vertexColors=!0),r&&(a.flatShading=!0),o&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(g,a),this.associations.set(a,this.associations.get(i))),i=a}i.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return Ca}loadMaterial(e){const t=this,i=this.json,o=this.extensions,s=i.materials[e];let r;const g={},a=s.extensions||{},l=[];if(a[Wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const d=o[Wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=d.getMaterialType(),l.push(d.extendParams(g,s,t))}else if(a[Wt.KHR_MATERIALS_UNLIT]){const d=o[Wt.KHR_MATERIALS_UNLIT];r=d.getMaterialType(),l.push(d.extendParams(g,s,t))}else{const d=s.pbrMetallicRoughness||{};if(g.color=new ze(1,1,1),g.opacity=1,Array.isArray(d.baseColorFactor)){const C=d.baseColorFactor;g.color.fromArray(C),g.opacity=C[3]}d.baseColorTexture!==void 0&&l.push(t.assignTexture(g,"map",d.baseColorTexture)),g.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,g.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(g,"metalnessMap",d.metallicRoughnessTexture)),l.push(t.assignTexture(g,"roughnessMap",d.metallicRoughnessTexture))),r=this._invokeOne(function(C){return C.getMaterialType&&C.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(C){return C.extendMaterialParams&&C.extendMaterialParams(e,g)})))}s.doubleSided===!0&&(g.side=Nr);const u=s.alphaMode||Ab.OPAQUE;if(u===Ab.BLEND?(g.transparent=!0,g.depthWrite=!1):(g.transparent=!1,u===Ab.MASK&&(g.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&r!==Ki&&(l.push(t.assignTexture(g,"normalMap",s.normalTexture)),g.normalScale=new Se(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;g.normalScale.set(d,d)}return s.occlusionTexture!==void 0&&r!==Ki&&(l.push(t.assignTexture(g,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(g.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&r!==Ki&&(g.emissive=new ze().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&r!==Ki&&l.push(t.assignTexture(g,"emissiveMap",s.emissiveTexture)),Promise.all(l).then(function(){let d;return r===nG?d=o[Wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(g):d=new r(g),s.name&&(d.name=s.name),d.map&&(d.map.encoding=Lt),d.emissiveMap&&(d.emissiveMap.encoding=Lt),Gg(d,s),t.associations.set(d,{materials:e}),s.extensions&&mc(o,d,s),d})}createUniqueName(e){const t=Vt.sanitizeNodeName(e||"");let i=t;for(let o=1;this.nodeNamesUsed[i];++o)i=t+"_"+o;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,o=this.primitiveCache;function s(g){return i[Wt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(g,t).then(function(a){return ER(a,g,t)})}const r=[];for(let g=0,a=e.length;g<a;g++){const l=e[g],u=hO(l),d=o[u];if(d)r.push(d.promise);else{let C;l.extensions&&l.extensions[Wt.KHR_DRACO_MESH_COMPRESSION]?C=s(l):C=ER(new at,l,t),o[u]={primitive:l,promise:C},r.push(C)}}return Promise.all(r)}loadMesh(e){const t=this,i=this.json,o=this.extensions,s=i.meshes[e],r=s.primitives,g=[];for(let a=0,l=r.length;a<l;a++){const u=r[a].material===void 0?uO(this.cache):this.getDependency("material",r[a].material);g.push(u)}return g.push(t.loadGeometries(r)),Promise.all(g).then(function(a){const l=a.slice(0,a.length-1),u=a[a.length-1],d=[];for(let A=0,f=u.length;A<f;A++){const b=u[A],G=r[A];let m;const h=l[A];if(G.mode===Rs.TRIANGLES||G.mode===Rs.TRIANGLE_STRIP||G.mode===Rs.TRIANGLE_FAN||G.mode===void 0)m=s.isSkinnedMesh===!0?new QC(b,h):new Sn(b,h),m.isSkinnedMesh===!0&&!m.geometry.attributes.skinWeight.normalized&&m.normalizeSkinWeights(),G.mode===Rs.TRIANGLE_STRIP?m.geometry=_R(m.geometry,ix):G.mode===Rs.TRIANGLE_FAN&&(m.geometry=_R(m.geometry,AB));else if(G.mode===Rs.LINES)m=new yi(b,h);else if(G.mode===Rs.LINE_STRIP)m=new ss(b,h);else if(G.mode===Rs.LINE_LOOP)m=new jh(b,h);else if(G.mode===Rs.POINTS)m=new hI(b,h);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+G.mode);Object.keys(m.geometry.morphAttributes).length>0&&AO(m,s),m.name=t.createUniqueName(s.name||"mesh_"+e),Gg(m,s),G.extensions&&mc(o,m,G),t.assignFinalMaterial(m),d.push(m)}for(let A=0,f=d.length;A<f;A++)t.associations.set(d[A],{meshes:e,primitives:A});if(d.length===1)return d[0];const C=new qo;t.associations.set(C,{meshes:e});for(let A=0,f=d.length;A<f;A++)C.add(d[A]);return C})}loadCamera(e){let t;const i=this.json.cameras[e],o=i[i.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Kn(Y0.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):i.type==="orthographic"&&(t=new ca(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Gg(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(o){return i.inverseBindMatrices=o,i})}loadAnimation(e){const i=this.json.animations[e],o=[],s=[],r=[],g=[],a=[];for(let l=0,u=i.channels.length;l<u;l++){const d=i.channels[l],C=i.samplers[d.sampler],A=d.target,f=A.node!==void 0?A.node:A.id,b=i.parameters!==void 0?i.parameters[C.input]:C.input,G=i.parameters!==void 0?i.parameters[C.output]:C.output;o.push(this.getDependency("node",f)),s.push(this.getDependency("accessor",b)),r.push(this.getDependency("accessor",G)),g.push(C),a.push(A)}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(r),Promise.all(g),Promise.all(a)]).then(function(l){const u=l[0],d=l[1],C=l[2],A=l[3],f=l[4],b=[];for(let m=0,h=u.length;m<h;m++){const B=u[m],y=d[m],Z=C[m],R=A[m],W=f[m];if(B===void 0)continue;B.updateMatrix(),B.matrixAutoUpdate=!0;let x;switch(cr[W.path]){case cr.weights:x=jl;break;case cr.rotation:x=Jr;break;case cr.position:case cr.scale:default:x=ql;break}const X=B.name?B.name:B.uuid,Y=R.interpolation!==void 0?CO[R.interpolation]:Pg,S=[];cr[W.path]===cr.weights?B.traverse(function(k){k.morphTargetInfluences&&S.push(k.name?k.name:k.uuid)}):S.push(X);let H=Z.array;if(Z.normalized){const k=oG(H.constructor),U=new Float32Array(H.length);for(let D=0,Q=H.length;D<Q;D++)U[D]=H[D]*k;H=U}for(let k=0,U=S.length;k<U;k++){const D=new x(S[k]+"."+cr[W.path],y.array,H,Y);R.interpolation==="CUBICSPLINE"&&(D.createInterpolant=function($){const j=this instanceof Jr?cO:sa;return new j(this.times,this.values,this.getValueSize()/3,$)},D.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),b.push(D)}}const G=i.name?i.name:"animation_"+e;return new $l(G,void 0,b)})}createNodeMesh(e){const t=this.json,i=this,o=t.nodes[e];return o.mesh===void 0?null:i.getDependency("mesh",o.mesh).then(function(s){const r=i._getNodeRef(i.meshCache,o.mesh,s);return o.weights!==void 0&&r.traverse(function(g){if(!!g.isMesh)for(let a=0,l=o.weights.length;a<l;a++)g.morphTargetInfluences[a]=o.weights[a]}),r})}loadNode(e){const t=this.json,i=this.extensions,o=this,s=t.nodes[e],r=s.name?o.createUniqueName(s.name):"";return function(){const g=[],a=o._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return a&&g.push(a),s.camera!==void 0&&g.push(o.getDependency("camera",s.camera).then(function(l){return o._getNodeRef(o.cameraCache,s.camera,l)})),o._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){g.push(l)}),Promise.all(g)}().then(function(g){let a;if(s.isBone===!0?a=new OC:g.length>1?a=new qo:g.length===1?a=g[0]:a=new Gt,a!==g[0])for(let l=0,u=g.length;l<u;l++)a.add(g[l]);if(s.name&&(a.userData.name=s.name,a.name=r),Gg(a,s),s.extensions&&mc(i,a,s),s.matrix!==void 0){const l=new et;l.fromArray(s.matrix),a.applyMatrix4(l)}else s.translation!==void 0&&a.position.fromArray(s.translation),s.rotation!==void 0&&a.quaternion.fromArray(s.rotation),s.scale!==void 0&&a.scale.fromArray(s.scale);return o.associations.has(a)||o.associations.set(a,{}),o.associations.get(a).nodes=e,a})}loadScene(e){const t=this.json,i=this.extensions,o=this.json.scenes[e],s=this,r=new qo;o.name&&(r.name=s.createUniqueName(o.name)),Gg(r,o),o.extensions&&mc(i,r,o);const g=o.nodes||[],a=[];for(let l=0,u=g.length;l<u;l++)a.push(I9(g[l],r,t,s));return Promise.all(a).then(function(){const l=u=>{const d=new Map;for(const[C,A]of s.associations)(C instanceof cn||C instanceof pn)&&d.set(C,A);return u.traverse(C=>{const A=s.associations.get(C);A!=null&&d.set(C,A)}),d};return s.associations=l(r),r})}}function I9(n,e,t,i){const o=t.nodes[n];return i.getDependency("node",n).then(function(s){if(o.skin===void 0)return s;let r;return i.getDependency("skin",o.skin).then(function(g){r=g;const a=[];for(let l=0,u=r.joints.length;l<u;l++)a.push(i.getDependency("node",r.joints[l]));return Promise.all(a)}).then(function(g){return s.traverse(function(a){if(!a.isMesh)return;const l=[],u=[];for(let d=0,C=g.length;d<C;d++){const A=g[d];if(A){l.push(A);const f=new et;r.inverseBindMatrices!==void 0&&f.fromArray(r.inverseBindMatrices.array,d*16),u.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[d])}a.bind(new jC(l,u),a.matrixWorld)}),s})}).then(function(s){e.add(s);const r=[];if(o.children){const g=o.children;for(let a=0,l=g.length;a<l;a++){const u=g[a];r.push(I9(u,s,t,i))}}return Promise.all(r)})}function mO(n,e,t){const i=e.attributes,o=new ki;if(i.POSITION!==void 0){const g=t.json.accessors[i.POSITION],a=g.min,l=g.max;if(a!==void 0&&l!==void 0){if(o.set(new K(a[0],a[1],a[2]),new K(l[0],l[1],l[2])),g.normalized){const u=oG(VC[g.componentType]);o.min.multiplyScalar(u),o.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const g=new K,a=new K;for(let l=0,u=s.length;l<u;l++){const d=s[l];if(d.POSITION!==void 0){const C=t.json.accessors[d.POSITION],A=C.min,f=C.max;if(A!==void 0&&f!==void 0){if(a.setX(Math.max(Math.abs(A[0]),Math.abs(f[0]))),a.setY(Math.max(Math.abs(A[1]),Math.abs(f[1]))),a.setZ(Math.max(Math.abs(A[2]),Math.abs(f[2]))),C.normalized){const b=oG(VC[C.componentType]);a.multiplyScalar(b)}g.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(g)}n.boundingBox=o;const r=new Ts;o.getCenter(r.center),r.radius=o.min.distanceTo(o.max)/2,n.boundingSphere=r}function ER(n,e,t){const i=e.attributes,o=[];function s(r,g){return t.getDependency("accessor",r).then(function(a){n.setAttribute(g,a)})}for(const r in i){const g=iG[r]||r.toLowerCase();g in n.attributes||o.push(s(i[r],g))}if(e.indices!==void 0&&!n.index){const r=t.getDependency("accessor",e.indices).then(function(g){n.setIndex(g)});o.push(r)}return Gg(n,e),mO(n,e,t),Promise.all(o).then(function(){return e.targets!==void 0?dO(n,e.targets,t):n})}function _R(n,e){let t=n.getIndex();if(t===null){const r=[],g=n.getAttribute("position");if(g!==void 0){for(let a=0;a<g.count;a++)r.push(a);n.setIndex(r),t=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,o=[];if(e===AB)for(let r=1;r<=i;r++)o.push(t.getX(0)),o.push(t.getX(r)),o.push(t.getX(r+1));else for(let r=0;r<i;r++)r%2===0?(o.push(t.getX(r)),o.push(t.getX(r+1)),o.push(t.getX(r+2))):(o.push(t.getX(r+2)),o.push(t.getX(r+1)),o.push(t.getX(r)));o.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(o),s}const hb=new WeakMap;class fO extends oi{constructor(e){super(e);this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,o){const s=new Li(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,r=>{const g={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(r,g).then(t).catch(o)},i,o)}decodeDracoFile(e,t,i,o){const s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const a in t.attributeTypes){const l=t.attributeTypes[a];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[a]=l.name)}const i=JSON.stringify(t);if(hb.has(e)){const a=hb.get(e);if(a.key===i)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const s=this.workerNextTaskID++,r=e.byteLength,g=this._getWorker(s,r).then(a=>(o=a,new Promise((l,u)=>{o._callbacks[s]={resolve:l,reject:u},o.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return g.catch(()=>!0).then(()=>{o&&s&&this._releaseTask(o,s)}),hb.set(e,{key:i,promise:g}),g}_createGeometry(e){const t=new at;e.index&&t.setIndex(new vt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const o=e.attributes[i],s=o.name,r=o.array,g=o.itemSize;t.setAttribute(s,new vt(r,g))}return t}_loadLibrary(e,t){const i=new Li(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((o,s)=>{i.load(e,o,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const o=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const s=bO.toString(),r=["/* draco decoder */",o,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(s){const r=s.data;switch(r.type){case"decode":o._callbacks[r.id].resolve(r);break;case"error":o._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,s){return o._taskLoad>s._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function bO(){let n,e;onmessage=function(r){const g=r.data;switch(g.type){case"init":n=g.decoderConfig,e=new Promise(function(u){n.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(n)});break;case"decode":const a=g.buffer,l=g.taskConfig;e.then(u=>{const d=u.draco,C=new d.Decoder,A=new d.DecoderBuffer;A.Init(new Int8Array(a),a.byteLength);try{const f=t(d,C,A,l),b=f.attributes.map(G=>G.array.buffer);f.index&&b.push(f.index.array.buffer),self.postMessage({type:"decode",id:g.id,geometry:f},b)}catch(f){console.error(f),self.postMessage({type:"error",id:g.id,error:f.message})}finally{d.destroy(A),d.destroy(C)}});break}};function t(r,g,a,l){const u=l.attributeIDs,d=l.attributeTypes;let C,A;const f=g.GetEncodedGeometryType(a);if(f===r.TRIANGULAR_MESH)C=new r.Mesh,A=g.DecodeBufferToMesh(a,C);else if(f===r.POINT_CLOUD)C=new r.PointCloud,A=g.DecodeBufferToPointCloud(a,C);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!A.ok()||C.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());const b={index:null,attributes:[]};for(const G in u){const m=self[d[G]];let h,B;if(l.useUniqueIDs)B=u[G],h=g.GetAttributeByUniqueId(C,B);else{if(B=g.GetAttributeId(C,r[u[G]]),B===-1)continue;h=g.GetAttribute(C,B)}b.attributes.push(o(r,g,C,G,m,h))}return f===r.TRIANGULAR_MESH&&(b.index=i(r,g,C)),r.destroy(C),b}function i(r,g,a){const u=a.num_faces()*3,d=u*4,C=r._malloc(d);g.GetTrianglesUInt32Array(a,d,C);const A=new Uint32Array(r.HEAPF32.buffer,C,u).slice();return r._free(C),{array:A,itemSize:1}}function o(r,g,a,l,u,d){const C=d.num_components(),f=a.num_points()*C,b=f*u.BYTES_PER_ELEMENT,G=s(r,u),m=r._malloc(b);g.GetAttributeDataArrayForAllPoints(a,d,G,b,m);const h=new u(r.HEAPF32.buffer,m,f).slice();return r._free(m),{name:l,array:h,itemSize:C}}function s(r,g){switch(g){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}let CA;const pb=()=>{if(CA)return CA;const n="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let o=n;WebAssembly.validate(t)&&(o=e);let s;const r=WebAssembly.instantiate(g(o),{}).then(d=>{s=d.instance,s.exports.__wasm_call_ctors()});function g(d){const C=new Uint8Array(d.length);for(let f=0;f<d.length;++f){const b=d.charCodeAt(f);C[f]=b>96?b-71:b>64?b-65:b>47?b+4:b>46?63:62}let A=0;for(let f=0;f<d.length;++f)C[A++]=C[f]<60?i[C[f]]:(C[f]-60)*64+C[++f];return C.buffer.slice(0,A)}function a(d,C,A,f,b,G){const m=s.exports.sbrk,h=A+3&-4,B=m(h*f),y=m(b.length),Z=new Uint8Array(s.exports.memory.buffer);Z.set(b,y);const R=d(B,A,f,y,b.length);if(R===0&&G&&G(B,h,f),C.set(Z.subarray(B,B+A*f)),m(B-m(0)),R!==0)throw new Error(`Malformed buffer data: ${R}`)}const l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return CA={ready:r,supported:!0,decodeVertexBuffer(d,C,A,f,b){a(s.exports.meshopt_decodeVertexBuffer,d,C,A,f,s.exports[l[b]])},decodeIndexBuffer(d,C,A,f){a(s.exports.meshopt_decodeIndexBuffer,d,C,A,f)},decodeIndexSequence(d,C,A,f){a(s.exports.meshopt_decodeIndexSequence,d,C,A,f)},decodeGltfBuffer(d,C,A,f,b,G){a(s.exports[u[b]],d,C,A,f,s.exports[l[G]])}},CA};let uA=null;function c9(n,e,t){return i=>{t&&t(i),n&&(uA||(uA=new fO),uA.setDecoderPath(typeof n=="string"?n:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),i.setDRACOLoader(uA)),e&&i.setMeshoptDecoder(typeof pb=="function"?pb():pb)}}function C9(n,e=!0,t=!0,i){return tu(hy,n,c9(e,t,i))}C9.preload=(n,e=!0,t=!0,i)=>tu.preload(hy,n,c9(e,t,i));C9.clear=n=>tu.clear(hy,n);const GO={black:"#000",white:"#fff"};var xC=GO;const BO={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"};var Qa=BO;const yO={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"};var Oa=yO;const vO={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"};var ja=vO;const ZO={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"};var qa=ZO;const wO={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"};var $a=wO;const RO={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"};var fc=RO;const WO={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};var SO=WO;function Tn(n,e){if(n==null)return{};var t={},i=Object.keys(n),o,s;for(s=0;s<i.length;s++)o=i[s],!(e.indexOf(o)>=0)&&(t[o]=n[o]);return t}function u9(n){var e=Object.create(null);return function(t){return e[t]===void 0&&(e[t]=n(t)),e[t]}}var VO=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,xO=u9(function(n){return VO.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91});function HO(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function XO(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var MO=function(){function n(t){var i=this;this._insertTag=function(o){var s;i.tags.length===0?i.insertionPoint?s=i.insertionPoint.nextSibling:i.prepend?s=i.container.firstChild:s=i.before:s=i.tags[i.tags.length-1].nextSibling,i.container.insertBefore(o,s),i.tags.push(o)},this.isSpeedy=t.speedy===void 0?!0:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(i){i.forEach(this._insertTag)},e.insert=function(i){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(XO(this));var o=this.tags[this.tags.length-1];if(this.isSpeedy){var s=HO(o);try{s.insertRule(i,s.cssRules.length)}catch{}}else o.appendChild(document.createTextNode(i));this.ctr++},e.flush=function(){this.tags.forEach(function(i){return i.parentNode&&i.parentNode.removeChild(i)}),this.tags=[],this.ctr=0},n}(),li="-ms-",Bh="-moz-",Kt="-webkit-",d9="comm",py="rule",my="decl",KO="@import",A9="@keyframes",FO=Math.abs,Vp=String.fromCharCode,YO=Object.assign;function NO(n,e){return(((e<<2^Xi(n,0))<<2^Xi(n,1))<<2^Xi(n,2))<<2^Xi(n,3)}function h9(n){return n.trim()}function LO(n,e){return(n=e.exec(n))?n[0]:n}function Nt(n,e,t){return n.replace(e,t)}function sG(n,e){return n.indexOf(e)}function Xi(n,e){return n.charCodeAt(e)|0}function HC(n,e,t){return n.slice(e,t)}function Uo(n){return n.length}function fy(n){return n.length}function dA(n,e){return e.push(n),n}function zO(n,e){return n.map(e).join("")}var xp=1,oI=1,p9=0,zi=0,Fn=0,fI="";function Hp(n,e,t,i,o,s,r){return{value:n,root:e,parent:t,type:i,props:o,children:s,line:xp,column:oI,length:r,return:""}}function bc(n,e){return YO(Hp("",null,null,"",null,null,0),n,{length:-n.length},e)}function kO(){return Fn}function TO(){return Fn=zi>0?Xi(fI,--zi):0,oI--,Fn===10&&(oI=1,xp--),Fn}function Qi(){return Fn=zi<p9?Xi(fI,zi++):0,oI++,Fn===10&&(oI=1,xp++),Fn}function os(){return Xi(fI,zi)}function LA(){return zi}function Iu(n,e){return HC(fI,n,e)}function XC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function m9(n){return xp=oI=1,p9=Uo(fI=n),zi=0,[]}function f9(n){return fI="",n}function zA(n){return h9(Iu(zi-1,rG(n===91?n+2:n===40?n+1:n)))}function EO(n){for(;(Fn=os())&&Fn<33;)Qi();return XC(n)>2||XC(Fn)>3?"":" "}function _O(n,e){for(;--e&&Qi()&&!(Fn<48||Fn>102||Fn>57&&Fn<65||Fn>70&&Fn<97););return Iu(n,LA()+(e<6&&os()==32&&Qi()==32))}function rG(n){for(;Qi();)switch(Fn){case n:return zi;case 34:case 39:n!==34&&n!==39&&rG(Fn);break;case 40:n===41&&rG(n);break;case 92:Qi();break}return zi}function JO(n,e){for(;Qi()&&n+Fn!==47+10;)if(n+Fn===42+42&&os()===47)break;return"/*"+Iu(e,zi-1)+"*"+Vp(n===47?n:Qi())}function DO(n){for(;!XC(os());)Qi();return Iu(n,zi)}function UO(n){return f9(kA("",null,null,null,[""],n=m9(n),0,[0],n))}function kA(n,e,t,i,o,s,r,g,a){for(var l=0,u=0,d=r,C=0,A=0,f=0,b=1,G=1,m=1,h=0,B="",y=o,Z=s,R=i,W=B;G;)switch(f=h,h=Qi()){case 40:if(f!=108&&W.charCodeAt(d-1)==58){sG(W+=Nt(zA(h),"&","&\f"),"&\f")!=-1&&(m=-1);break}case 34:case 39:case 91:W+=zA(h);break;case 9:case 10:case 13:case 32:W+=EO(f);break;case 92:W+=_O(LA()-1,7);continue;case 47:switch(os()){case 42:case 47:dA(PO(JO(Qi(),LA()),e,t),a);break;default:W+="/"}break;case 123*b:g[l++]=Uo(W)*m;case 125*b:case 59:case 0:switch(h){case 0:case 125:G=0;case 59+u:A>0&&Uo(W)-d&&dA(A>32?DR(W+";",i,t,d-1):DR(Nt(W," ","")+";",i,t,d-2),a);break;case 59:W+=";";default:if(dA(R=JR(W,e,t,l,u,o,g,B,y=[],Z=[],d),s),h===123)if(u===0)kA(W,e,R,R,y,s,d,g,Z);else switch(C){case 100:case 109:case 115:kA(n,R,R,i&&dA(JR(n,R,R,0,0,o,g,B,o,y=[],d),Z),o,Z,d,g,i?y:Z);break;default:kA(W,R,R,R,[""],Z,0,g,Z)}}l=u=A=0,b=m=1,B=W="",d=r;break;case 58:d=1+Uo(W),A=f;default:if(b<1){if(h==123)--b;else if(h==125&&b++==0&&TO()==125)continue}switch(W+=Vp(h),h*b){case 38:m=u>0?1:(W+="\f",-1);break;case 44:g[l++]=(Uo(W)-1)*m,m=1;break;case 64:os()===45&&(W+=zA(Qi())),C=os(),u=d=Uo(B=W+=DO(LA())),h++;break;case 45:f===45&&Uo(W)==2&&(b=0)}}return s}function JR(n,e,t,i,o,s,r,g,a,l,u){for(var d=o-1,C=o===0?s:[""],A=fy(C),f=0,b=0,G=0;f<i;++f)for(var m=0,h=HC(n,d+1,d=FO(b=r[f])),B=n;m<A;++m)(B=h9(b>0?C[m]+" "+h:Nt(h,/&\f/g,C[m])))&&(a[G++]=B);return Hp(n,e,t,o===0?py:g,a,l,u)}function PO(n,e,t){return Hp(n,e,t,d9,Vp(kO()),HC(n,2,-2),0)}function DR(n,e,t,i){return Hp(n,e,t,my,HC(n,0,i),HC(n,i+1,-1),i)}function b9(n,e){switch(NO(n,e)){case 5103:return Kt+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Kt+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Kt+n+Bh+n+li+n+n;case 6828:case 4268:return Kt+n+li+n+n;case 6165:return Kt+n+li+"flex-"+n+n;case 5187:return Kt+n+Nt(n,/(\w+).+(:[^]+)/,Kt+"box-$1$2"+li+"flex-$1$2")+n;case 5443:return Kt+n+li+"flex-item-"+Nt(n,/flex-|-self/,"")+n;case 4675:return Kt+n+li+"flex-line-pack"+Nt(n,/align-content|flex-|-self/,"")+n;case 5548:return Kt+n+li+Nt(n,"shrink","negative")+n;case 5292:return Kt+n+li+Nt(n,"basis","preferred-size")+n;case 6060:return Kt+"box-"+Nt(n,"-grow","")+Kt+n+li+Nt(n,"grow","positive")+n;case 4554:return Kt+Nt(n,/([^-])(transform)/g,"$1"+Kt+"$2")+n;case 6187:return Nt(Nt(Nt(n,/(zoom-|grab)/,Kt+"$1"),/(image-set)/,Kt+"$1"),n,"")+n;case 5495:case 3959:return Nt(n,/(image-set\([^]*)/,Kt+"$1$`$1");case 4968:return Nt(Nt(n,/(.+:)(flex-)?(.*)/,Kt+"box-pack:$3"+li+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Kt+n+n;case 4095:case 3583:case 4068:case 2532:return Nt(n,/(.+)-inline(.+)/,Kt+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Uo(n)-1-e>6)switch(Xi(n,e+1)){case 109:if(Xi(n,e+4)!==45)break;case 102:return Nt(n,/(.+:)(.+)-([^]+)/,"$1"+Kt+"$2-$3$1"+Bh+(Xi(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~sG(n,"stretch")?b9(Nt(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Xi(n,e+1)!==115)break;case 6444:switch(Xi(n,Uo(n)-3-(~sG(n,"!important")&&10))){case 107:return Nt(n,":",":"+Kt)+n;case 101:return Nt(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Kt+(Xi(n,14)===45?"inline-":"")+"box$3$1"+Kt+"$2$3$1"+li+"$2box$3")+n}break;case 5936:switch(Xi(n,e+11)){case 114:return Kt+n+li+Nt(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Kt+n+li+Nt(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Kt+n+li+Nt(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return Kt+n+li+n+n}return n}function Sl(n,e){for(var t="",i=fy(n),o=0;o<i;o++)t+=e(n[o],o,n,e)||"";return t}function QO(n,e,t,i){switch(n.type){case KO:case my:return n.return=n.return||n.value;case d9:return"";case A9:return n.return=n.value+"{"+Sl(n.children,i)+"}";case py:n.value=n.props.join(",")}return Uo(t=Sl(n.children,i))?n.return=n.value+"{"+t+"}":""}function OO(n){var e=fy(n);return function(t,i,o,s){for(var r="",g=0;g<e;g++)r+=n[g](t,i,o,s)||"";return r}}function jO(n){return function(e){e.root||(e=e.return)&&n(e)}}function qO(n,e,t,i){if(n.length>-1&&!n.return)switch(n.type){case my:n.return=b9(n.value,n.length);break;case A9:return Sl([bc(n,{value:Nt(n.value,"@","@"+Kt)})],i);case py:if(n.length)return zO(n.props,function(o){switch(LO(o,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Sl([bc(n,{props:[Nt(o,/:(read-\w+)/,":"+Bh+"$1")]})],i);case"::placeholder":return Sl([bc(n,{props:[Nt(o,/:(plac\w+)/,":"+Kt+"input-$1")]}),bc(n,{props:[Nt(o,/:(plac\w+)/,":"+Bh+"$1")]}),bc(n,{props:[Nt(o,/:(plac\w+)/,li+"input-$1")]})],i)}return""})}}var $O=function(e,t,i){for(var o=0,s=0;o=s,s=os(),o===38&&s===12&&(t[i]=1),!XC(s);)Qi();return Iu(e,zi)},ej=function(e,t){var i=-1,o=44;do switch(XC(o)){case 0:o===38&&os()===12&&(t[i]=1),e[i]+=$O(zi-1,t,i);break;case 2:e[i]+=zA(o);break;case 4:if(o===44){e[++i]=os()===58?"&\f":"",t[i]=e[i].length;break}default:e[i]+=Vp(o)}while(o=Qi());return e},tj=function(e,t){return f9(ej(m9(e),t))},UR=new WeakMap,nj=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var t=e.value,i=e.parent,o=e.column===i.column&&e.line===i.line;i.type!=="rule";)if(i=i.parent,!i)return;if(!(e.props.length===1&&t.charCodeAt(0)!==58&&!UR.get(i))&&!o){UR.set(e,!0);for(var s=[],r=tj(t,s),g=i.props,a=0,l=0;a<r.length;a++)for(var u=0;u<g.length;u++,l++)e.props[l]=s[a]?r[a].replace(/&\f/g,g[u]):g[u]+" "+r[a]}}},ij=function(e){if(e.type==="decl"){var t=e.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(e.return="",e.value="")}},oj=[qO],sj=function(e){var t=e.key;if(t==="css"){var i=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(i,function(b){var G=b.getAttribute("data-emotion");G.indexOf(" ")!==-1&&(document.head.appendChild(b),b.setAttribute("data-s",""))})}var o=e.stylisPlugins||oj,s={},r,g=[];r=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(b){for(var G=b.getAttribute("data-emotion").split(" "),m=1;m<G.length;m++)s[G[m]]=!0;g.push(b)});var a,l=[nj,ij];{var u,d=[QO,jO(function(b){u.insert(b)})],C=OO(l.concat(o,d)),A=function(G){return Sl(UO(G),C)};a=function(G,m,h,B){u=h,A(G?G+"{"+m.styles+"}":m.styles),B&&(f.inserted[m.name]=!0)}}var f={key:t,sheet:new MO({key:t,container:r,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:s,registered:{},insert:a};return f.sheet.hydrate(g),f},G9={exports:{}},_t={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Un=typeof Symbol=="function"&&Symbol.for,by=Un?Symbol.for("react.element"):60103,Gy=Un?Symbol.for("react.portal"):60106,Xp=Un?Symbol.for("react.fragment"):60107,Mp=Un?Symbol.for("react.strict_mode"):60108,Kp=Un?Symbol.for("react.profiler"):60114,Fp=Un?Symbol.for("react.provider"):60109,Yp=Un?Symbol.for("react.context"):60110,By=Un?Symbol.for("react.async_mode"):60111,Np=Un?Symbol.for("react.concurrent_mode"):60111,Lp=Un?Symbol.for("react.forward_ref"):60112,zp=Un?Symbol.for("react.suspense"):60113,rj=Un?Symbol.for("react.suspense_list"):60120,kp=Un?Symbol.for("react.memo"):60115,Tp=Un?Symbol.for("react.lazy"):60116,gj=Un?Symbol.for("react.block"):60121,aj=Un?Symbol.for("react.fundamental"):60117,lj=Un?Symbol.for("react.responder"):60118,Ij=Un?Symbol.for("react.scope"):60119;function qi(n){if(typeof n=="object"&&n!==null){var e=n.$$typeof;switch(e){case by:switch(n=n.type,n){case By:case Np:case Xp:case Kp:case Mp:case zp:return n;default:switch(n=n&&n.$$typeof,n){case Yp:case Lp:case Tp:case kp:case Fp:return n;default:return e}}case Gy:return e}}}function B9(n){return qi(n)===Np}_t.AsyncMode=By;_t.ConcurrentMode=Np;_t.ContextConsumer=Yp;_t.ContextProvider=Fp;_t.Element=by;_t.ForwardRef=Lp;_t.Fragment=Xp;_t.Lazy=Tp;_t.Memo=kp;_t.Portal=Gy;_t.Profiler=Kp;_t.StrictMode=Mp;_t.Suspense=zp;_t.isAsyncMode=function(n){return B9(n)||qi(n)===By};_t.isConcurrentMode=B9;_t.isContextConsumer=function(n){return qi(n)===Yp};_t.isContextProvider=function(n){return qi(n)===Fp};_t.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===by};_t.isForwardRef=function(n){return qi(n)===Lp};_t.isFragment=function(n){return qi(n)===Xp};_t.isLazy=function(n){return qi(n)===Tp};_t.isMemo=function(n){return qi(n)===kp};_t.isPortal=function(n){return qi(n)===Gy};_t.isProfiler=function(n){return qi(n)===Kp};_t.isStrictMode=function(n){return qi(n)===Mp};_t.isSuspense=function(n){return qi(n)===zp};_t.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===Xp||n===Np||n===Kp||n===Mp||n===zp||n===rj||typeof n=="object"&&n!==null&&(n.$$typeof===Tp||n.$$typeof===kp||n.$$typeof===Fp||n.$$typeof===Yp||n.$$typeof===Lp||n.$$typeof===aj||n.$$typeof===lj||n.$$typeof===Ij||n.$$typeof===gj)};_t.typeOf=qi;G9.exports=_t;var y9=G9.exports,cj={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Cj={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},v9={};v9[y9.ForwardRef]=cj;v9[y9.Memo]=Cj;var uj=!0;function dj(n,e,t){var i="";return t.split(" ").forEach(function(o){n[o]!==void 0?e.push(n[o]+";"):i+=o+" "}),i}var Z9=function(e,t,i){var o=e.key+"-"+t.name;(i===!1||uj===!1)&&e.registered[o]===void 0&&(e.registered[o]=t.styles)},Aj=function(e,t,i){Z9(e,t,i);var o=e.key+"-"+t.name;if(e.inserted[t.name]===void 0){var s=t;do e.insert(t===s?"."+o:"",s,e.sheet,!0),s=s.next;while(s!==void 0)}};function hj(n){for(var e=0,t,i=0,o=n.length;o>=4;++i,o-=4)t=n.charCodeAt(i)&255|(n.charCodeAt(++i)&255)<<8|(n.charCodeAt(++i)&255)<<16|(n.charCodeAt(++i)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(o){case 3:e^=(n.charCodeAt(i+2)&255)<<16;case 2:e^=(n.charCodeAt(i+1)&255)<<8;case 1:e^=n.charCodeAt(i)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var pj={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},mj=/[A-Z]|^ms/g,fj=/_EMO_([^_]+?)_([^]*?)_EMO_/g,w9=function(e){return e.charCodeAt(1)===45},PR=function(e){return e!=null&&typeof e!="boolean"},mb=u9(function(n){return w9(n)?n:n.replace(mj,"-$&").toLowerCase()}),QR=function(e,t){switch(e){case"animation":case"animationName":if(typeof t=="string")return t.replace(fj,function(i,o,s){return Po={name:o,styles:s,next:Po},o})}return pj[e]!==1&&!w9(e)&&typeof t=="number"&&t!==0?t+"px":t};function MC(n,e,t){if(t==null)return"";if(t.__emotion_styles!==void 0)return t;switch(typeof t){case"boolean":return"";case"object":{if(t.anim===1)return Po={name:t.name,styles:t.styles,next:Po},t.name;if(t.styles!==void 0){var i=t.next;if(i!==void 0)for(;i!==void 0;)Po={name:i.name,styles:i.styles,next:Po},i=i.next;var o=t.styles+";";return o}return bj(n,e,t)}case"function":{if(n!==void 0){var s=Po,r=t(n);return Po=s,MC(n,e,r)}break}}if(e==null)return t;var g=e[t];return g!==void 0?g:t}function bj(n,e,t){var i="";if(Array.isArray(t))for(var o=0;o<t.length;o++)i+=MC(n,e,t[o])+";";else for(var s in t){var r=t[s];if(typeof r!="object")e!=null&&e[r]!==void 0?i+=s+"{"+e[r]+"}":PR(r)&&(i+=mb(s)+":"+QR(s,r)+";");else if(Array.isArray(r)&&typeof r[0]=="string"&&(e==null||e[r[0]]===void 0))for(var g=0;g<r.length;g++)PR(r[g])&&(i+=mb(s)+":"+QR(s,r[g])+";");else{var a=MC(n,e,r);switch(s){case"animation":case"animationName":{i+=mb(s)+":"+a+";";break}default:i+=s+"{"+a+"}"}}}return i}var OR=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Po,R9=function(e,t,i){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var o=!0,s="";Po=void 0;var r=e[0];r==null||r.raw===void 0?(o=!1,s+=MC(i,t,r)):s+=r[0];for(var g=1;g<e.length;g++)s+=MC(i,t,e[g]),o&&(s+=r[g]);OR.lastIndex=0;for(var a="",l;(l=OR.exec(s))!==null;)a+="-"+l[1];var u=hj(s)+a;return{name:u,styles:s,next:Po}},W9=ce.exports.createContext(typeof HTMLElement!="undefined"?sj({key:"css"}):null);W9.Provider;var Gj=function(e){return ce.exports.forwardRef(function(t,i){var o=ce.exports.useContext(W9);return e(t,o,i)})},Bj=ce.exports.createContext({});xl["useInsertionEffect"]&&xl["useInsertionEffect"];xl["useInsertionEffect"]?xl["useInsertionEffect"]:ce.exports.useLayoutEffect;function yj(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return R9(e)}var yy=function(){var e=yj.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},vj=xO,Zj=function(e){return e!=="theme"},jR=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?vj:Zj},qR=function(e,t,i){var o;if(t){var s=t.shouldForwardProp;o=e.__emotion_forwardProp&&s?function(r){return e.__emotion_forwardProp(r)&&s(r)}:s}return typeof o!="function"&&i&&(o=e.__emotion_forwardProp),o},wj=xl["useInsertionEffect"]?xl["useInsertionEffect"]:function(e){e()};function Rj(n){wj(n)}var Wj=function(e){var t=e.cache,i=e.serialized,o=e.isStringTag;return Z9(t,i,o),Rj(function(){return Aj(t,i,o)}),null},Sj=function n(e,t){var i=e.__emotion_real===e,o=i&&e.__emotion_base||e,s,r;t!==void 0&&(s=t.label,r=t.target);var g=qR(e,t,i),a=g||jR(o),l=!a("as");return function(){var u=arguments,d=i&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(s!==void 0&&d.push("label:"+s+";"),u[0]==null||u[0].raw===void 0)d.push.apply(d,u);else{d.push(u[0][0]);for(var C=u.length,A=1;A<C;A++)d.push(u[A],u[0][A])}var f=Gj(function(b,G,m){var h=l&&b.as||o,B="",y=[],Z=b;if(b.theme==null){Z={};for(var R in b)Z[R]=b[R];Z.theme=ce.exports.useContext(Bj)}typeof b.className=="string"?B=dj(G.registered,y,b.className):b.className!=null&&(B=b.className+" ");var W=R9(d.concat(y),G.registered,Z);B+=G.key+"-"+W.name,r!==void 0&&(B+=" "+r);var x=l&&g===void 0?jR(h):a,X={};for(var Y in b)l&&Y==="as"||x(Y)&&(X[Y]=b[Y]);return X.className=B,X.ref=m,ce.exports.createElement(ce.exports.Fragment,null,ce.exports.createElement(Wj,{cache:G,serialized:W,isStringTag:typeof h=="string"}),ce.exports.createElement(h,X))});return f.displayName=s!==void 0?s:"Styled("+(typeof o=="string"?o:o.displayName||o.name||"Component")+")",f.defaultProps=e.defaultProps,f.__emotion_real=f,f.__emotion_base=o,f.__emotion_styles=d,f.__emotion_forwardProp=g,Object.defineProperty(f,"toString",{value:function(){return"."+r}}),f.withComponent=function(b,G){return n(b,Xe({},t,G,{shouldForwardProp:qR(f,G,!0)})).apply(void 0,d)},f}},Vj=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],gG=Sj.bind();Vj.forEach(function(n){gG[n]=gG(n)});var xj=gG;/** @license MUI v5.4.4
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function S9(n,e){return xj(n,e)}function xc(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function Ks(n,e,t={clone:!0}){const i=t.clone?Xe({},n):n;return xc(n)&&xc(e)&&Object.keys(e).forEach(o=>{o!=="__proto__"&&(xc(e[o])&&o in n&&xc(n[o])?i[o]=Ks(n[o],e[o],t):i[o]=e[o])}),i}function KC(n){let e="https://mui.com/production-error/?code="+n;for(let t=1;t<arguments.length;t+=1)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified MUI error #"+n+"; visit "+e+" for the full message."}function tn(n){if(typeof n!="string")throw new Error(KC(7));return n.charAt(0).toUpperCase()+n.slice(1)}function TA(n){return n&&n.ownerDocument||document}function $R(n,e){typeof n=="function"?n(e):n&&(n.current=e)}const Hj=typeof window!="undefined"?ce.exports.useLayoutEffect:ce.exports.useEffect;var V9=Hj;function Xj({controlled:n,default:e,name:t,state:i="value"}){const{current:o}=ce.exports.useRef(n!==void 0),[s,r]=ce.exports.useState(e),g=o?n:s,a=ce.exports.useCallback(l=>{o||r(l)},[]);return[g,a]}function Mg(n){const e=ce.exports.useRef(n);return V9(()=>{e.current=n}),ce.exports.useCallback((...t)=>(0,e.current)(...t),[])}function qc(n,e){return ce.exports.useMemo(()=>n==null&&e==null?null:t=>{$R(n,t),$R(e,t)},[n,e])}let Ep=!0,aG=!1,eW;const Mj={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function Kj(n){const{type:e,tagName:t}=n;return!!(t==="INPUT"&&Mj[e]&&!n.readOnly||t==="TEXTAREA"&&!n.readOnly||n.isContentEditable)}function Fj(n){n.metaKey||n.altKey||n.ctrlKey||(Ep=!0)}function fb(){Ep=!1}function Yj(){this.visibilityState==="hidden"&&aG&&(Ep=!0)}function Nj(n){n.addEventListener("keydown",Fj,!0),n.addEventListener("mousedown",fb,!0),n.addEventListener("pointerdown",fb,!0),n.addEventListener("touchstart",fb,!0),n.addEventListener("visibilitychange",Yj,!0)}function Lj(n){const{target:e}=n;try{return e.matches(":focus-visible")}catch{}return Ep||Kj(e)}function x9(){const n=ce.exports.useCallback(o=>{o!=null&&Nj(o.ownerDocument)},[]),e=ce.exports.useRef(!1);function t(){return e.current?(aG=!0,window.clearTimeout(eW),eW=window.setTimeout(()=>{aG=!1},100),e.current=!1,!0):!1}function i(o){return Lj(o)?(e.current=!0,!0):!1}return{isFocusVisibleRef:e,onFocus:i,onBlur:t,ref:n}}const zj={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:-1,overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};var kj=zj;function H9(n,e){const t=Xe({},e);return Object.keys(n).forEach(i=>{t[i]===void 0&&(t[i]=n[i])}),t}function $c(n,e){return e?Ks(n,e,{clone:!1}):n}const vy={xs:0,sm:600,md:900,lg:1200,xl:1536},tW={keys:["xs","sm","md","lg","xl"],up:n=>`@media (min-width:${vy[n]}px)`};function Fo(n,e,t){const i=n.theme||{};if(Array.isArray(e)){const s=i.breakpoints||tW;return e.reduce((r,g,a)=>(r[s.up(s.keys[a])]=t(e[a]),r),{})}if(typeof e=="object"){const s=i.breakpoints||tW;return Object.keys(e).reduce((r,g)=>{if(Object.keys(s.values||vy).indexOf(g)!==-1){const a=s.up(g);r[a]=t(e[g],g)}else{const a=g;r[a]=e[a]}return r},{})}return t(e)}function Tj(n={}){var e;return(n==null||(e=n.keys)==null?void 0:e.reduce((i,o)=>{const s=n.up(o);return i[s]={},i},{}))||{}}function Ej(n,e){return n.reduce((t,i)=>{const o=t[i];return(!o||Object.keys(o).length===0)&&delete t[i],t},e)}function _j(n,e){if(typeof n!="object")return{};const t={},i=Object.keys(e);return Array.isArray(n)?i.forEach((o,s)=>{s<n.length&&(t[o]=!0)}):i.forEach(o=>{n[o]!=null&&(t[o]=!0)}),t}function _p({values:n,breakpoints:e,base:t}){const i=t||_j(n,e),o=Object.keys(i);if(o.length===0)return n;let s;return o.reduce((r,g,a)=>(Array.isArray(n)?(r[g]=n[a]!=null?n[a]:n[s],s=a):(r[g]=n[g]!=null?n[g]:n[s]||n,s=g),r),{})}function Zy(n,e){return!e||typeof e!="string"?null:e.split(".").reduce((t,i)=>t&&t[i]?t[i]:null,n)}function nW(n,e,t,i=t){let o;return typeof n=="function"?o=n(t):Array.isArray(n)?o=n[t]||i:o=Zy(n,t)||i,e&&(o=e(o)),o}function qe(n){const{prop:e,cssProperty:t=n.prop,themeKey:i,transform:o}=n,s=r=>{if(r[e]==null)return null;const g=r[e],a=r.theme,l=Zy(a,i)||{};return Fo(r,g,d=>{let C=nW(l,o,d);return d===C&&typeof d=="string"&&(C=nW(l,o,`${e}${d==="default"?"":tn(d)}`,d)),t===!1?C:{[t]:C}})};return s.propTypes={},s.filterProps=[e],s}function ng(...n){const e=n.reduce((i,o)=>(o.filterProps.forEach(s=>{i[s]=o}),i),{}),t=i=>Object.keys(i).reduce((o,s)=>e[s]?$c(o,e[s](i)):o,{});return t.propTypes={},t.filterProps=n.reduce((i,o)=>i.concat(o.filterProps),[]),t}function Jj(n){const e={};return t=>(e[t]===void 0&&(e[t]=n(t)),e[t])}const Dj={m:"margin",p:"padding"},Uj={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},iW={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},Pj=Jj(n=>{if(n.length>2)if(iW[n])n=iW[n];else return[n];const[e,t]=n.split(""),i=Dj[e],o=Uj[t]||"";return Array.isArray(o)?o.map(s=>i+s):[i+o]}),Qj=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],Oj=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],X9=[...Qj,...Oj];function cu(n,e,t,i){const o=Zy(n,e)||t;return typeof o=="number"?s=>typeof s=="string"?s:o*s:Array.isArray(o)?s=>typeof s=="string"?s:o[s]:typeof o=="function"?o:()=>{}}function M9(n){return cu(n,"spacing",8)}function Cu(n,e){if(typeof e=="string"||e==null)return e;const t=Math.abs(e),i=n(t);return e>=0?i:typeof i=="number"?-i:`-${i}`}function jj(n,e){return t=>n.reduce((i,o)=>(i[o]=Cu(e,t),i),{})}function qj(n,e,t,i){if(e.indexOf(t)===-1)return null;const o=Pj(t),s=jj(o,i),r=n[t];return Fo(n,r,s)}function $j(n,e){const t=M9(n.theme);return Object.keys(n).map(i=>qj(n,e,i,t)).reduce($c,{})}function Jp(n){return $j(n,X9)}Jp.propTypes={};Jp.filterProps=X9;function uu(n){return typeof n!="number"?n:`${n}px solid`}const e4=qe({prop:"border",themeKey:"borders",transform:uu}),t4=qe({prop:"borderTop",themeKey:"borders",transform:uu}),n4=qe({prop:"borderRight",themeKey:"borders",transform:uu}),i4=qe({prop:"borderBottom",themeKey:"borders",transform:uu}),o4=qe({prop:"borderLeft",themeKey:"borders",transform:uu}),s4=qe({prop:"borderColor",themeKey:"palette"}),r4=qe({prop:"borderTopColor",themeKey:"palette"}),g4=qe({prop:"borderRightColor",themeKey:"palette"}),a4=qe({prop:"borderBottomColor",themeKey:"palette"}),l4=qe({prop:"borderLeftColor",themeKey:"palette"}),wy=n=>{if(n.borderRadius!==void 0&&n.borderRadius!==null){const e=cu(n.theme,"shape.borderRadius",4),t=i=>({borderRadius:Cu(e,i)});return Fo(n,n.borderRadius,t)}return null};wy.propTypes={};wy.filterProps=["borderRadius"];const I4=ng(e4,t4,n4,i4,o4,s4,r4,g4,a4,l4,wy);var K9=I4;const c4=qe({prop:"displayPrint",cssProperty:!1,transform:n=>({"@media print":{display:n}})}),C4=qe({prop:"display"}),u4=qe({prop:"overflow"}),d4=qe({prop:"textOverflow"}),A4=qe({prop:"visibility"}),h4=qe({prop:"whiteSpace"});var F9=ng(c4,C4,u4,d4,A4,h4);const p4=qe({prop:"flexBasis"}),m4=qe({prop:"flexDirection"}),f4=qe({prop:"flexWrap"}),b4=qe({prop:"justifyContent"}),G4=qe({prop:"alignItems"}),B4=qe({prop:"alignContent"}),y4=qe({prop:"order"}),v4=qe({prop:"flex"}),Z4=qe({prop:"flexGrow"}),w4=qe({prop:"flexShrink"}),R4=qe({prop:"alignSelf"}),W4=qe({prop:"justifyItems"}),S4=qe({prop:"justifySelf"}),V4=ng(p4,m4,f4,b4,G4,B4,y4,v4,Z4,w4,R4,W4,S4);var Y9=V4;const Ry=n=>{if(n.gap!==void 0&&n.gap!==null){const e=cu(n.theme,"spacing",8),t=i=>({gap:Cu(e,i)});return Fo(n,n.gap,t)}return null};Ry.propTypes={};Ry.filterProps=["gap"];const Wy=n=>{if(n.columnGap!==void 0&&n.columnGap!==null){const e=cu(n.theme,"spacing",8),t=i=>({columnGap:Cu(e,i)});return Fo(n,n.columnGap,t)}return null};Wy.propTypes={};Wy.filterProps=["columnGap"];const Sy=n=>{if(n.rowGap!==void 0&&n.rowGap!==null){const e=cu(n.theme,"spacing",8),t=i=>({rowGap:Cu(e,i)});return Fo(n,n.rowGap,t)}return null};Sy.propTypes={};Sy.filterProps=["rowGap"];const x4=qe({prop:"gridColumn"}),H4=qe({prop:"gridRow"}),X4=qe({prop:"gridAutoFlow"}),M4=qe({prop:"gridAutoColumns"}),K4=qe({prop:"gridAutoRows"}),F4=qe({prop:"gridTemplateColumns"}),Y4=qe({prop:"gridTemplateRows"}),N4=qe({prop:"gridTemplateAreas"}),L4=qe({prop:"gridArea"}),z4=ng(Ry,Wy,Sy,x4,H4,X4,M4,K4,F4,Y4,N4,L4);var N9=z4;const k4=qe({prop:"color",themeKey:"palette"}),T4=qe({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette"}),E4=qe({prop:"backgroundColor",themeKey:"palette"}),_4=ng(k4,T4,E4);var L9=_4;const J4=qe({prop:"position"}),D4=qe({prop:"zIndex",themeKey:"zIndex"}),U4=qe({prop:"top"}),P4=qe({prop:"right"}),Q4=qe({prop:"bottom"}),O4=qe({prop:"left"});var z9=ng(J4,D4,U4,P4,Q4,O4);const j4=qe({prop:"boxShadow",themeKey:"shadows"});var k9=j4;function ig(n){return n<=1&&n!==0?`${n*100}%`:n}const q4=qe({prop:"width",transform:ig}),T9=n=>{if(n.maxWidth!==void 0&&n.maxWidth!==null){const e=t=>{var i,o,s;return{maxWidth:((i=n.theme)==null||(o=i.breakpoints)==null||(s=o.values)==null?void 0:s[t])||vy[t]||ig(t)}};return Fo(n,n.maxWidth,e)}return null};T9.filterProps=["maxWidth"];const $4=qe({prop:"minWidth",transform:ig}),e7=qe({prop:"height",transform:ig}),t7=qe({prop:"maxHeight",transform:ig}),n7=qe({prop:"minHeight",transform:ig});qe({prop:"size",cssProperty:"width",transform:ig});qe({prop:"size",cssProperty:"height",transform:ig});const i7=qe({prop:"boxSizing"}),o7=ng(q4,T9,$4,e7,t7,n7,i7);var E9=o7;const s7=qe({prop:"fontFamily",themeKey:"typography"}),r7=qe({prop:"fontSize",themeKey:"typography"}),g7=qe({prop:"fontStyle",themeKey:"typography"}),a7=qe({prop:"fontWeight",themeKey:"typography"}),l7=qe({prop:"letterSpacing"}),I7=qe({prop:"textTransform"}),c7=qe({prop:"lineHeight"}),C7=qe({prop:"textAlign"}),u7=qe({prop:"typography",cssProperty:!1,themeKey:"typography"}),d7=ng(u7,s7,r7,g7,a7,l7,c7,C7,I7);var _9=d7;const oW={borders:K9.filterProps,display:F9.filterProps,flexbox:Y9.filterProps,grid:N9.filterProps,positions:z9.filterProps,palette:L9.filterProps,shadows:k9.filterProps,sizing:E9.filterProps,spacing:Jp.filterProps,typography:_9.filterProps},J9={borders:K9,display:F9,flexbox:Y9,grid:N9,positions:z9,palette:L9,shadows:k9,sizing:E9,spacing:Jp,typography:_9},A7=Object.keys(oW).reduce((n,e)=>(oW[e].forEach(t=>{n[t]=J9[e]}),n),{});function h7(...n){const e=n.reduce((i,o)=>i.concat(Object.keys(o)),[]),t=new Set(e);return n.every(i=>t.size===Object.keys(i).length)}function p7(n,e){return typeof n=="function"?n(e):n}function m7(n=J9){const e=Object.keys(n).reduce((o,s)=>(n[s].filterProps.forEach(r=>{o[r]=n[s]}),o),{});function t(o,s,r){const g={[o]:s,theme:r},a=e[o];return a?a(g):{[o]:s}}function i(o){const{sx:s,theme:r={}}=o||{};if(!s)return null;function g(a){let l=a;if(typeof a=="function")l=a(r);else if(typeof a!="object")return a;if(!l)return null;const u=Tj(r.breakpoints),d=Object.keys(u);let C=u;return Object.keys(l).forEach(A=>{const f=p7(l[A],r);if(f!=null)if(typeof f=="object")if(e[A])C=$c(C,t(A,f,r));else{const b=Fo({theme:r},f,G=>({[A]:G}));h7(b,f)?C[A]=i({sx:f,theme:r}):C=$c(C,b)}else C=$c(C,t(A,f,r))}),Ej(d,C)}return Array.isArray(s)?s.map(g):g(s)}return i}const D9=m7();D9.filterProps=["sx"];var U9=D9;const f7=["sx"],b7=n=>{const e={systemProps:{},otherProps:{}};return Object.keys(n).forEach(t=>{A7[t]?e.systemProps[t]=n[t]:e.otherProps[t]=n[t]}),e};function P9(n){const{sx:e}=n,t=Tn(n,f7),{systemProps:i,otherProps:o}=b7(t);let s;return Array.isArray(e)?s=[i,...e]:typeof e=="function"?s=(...r)=>{const g=e(...r);return xc(g)?Xe({},i,g):i}:s=Xe({},i,e),Xe({},o,{sx:s})}function Q9(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n))for(e=0;e<n.length;e++)n[e]&&(t=Q9(n[e]))&&(i&&(i+=" "),i+=t);else for(e in n)n[e]&&(i&&(i+=" "),i+=e);return i}function nn(){for(var n=0,e,t,i="";n<arguments.length;)(e=arguments[n++])&&(t=Q9(e))&&(i&&(i+=" "),i+=t);return i}const G7=["values","unit","step"],B7=n=>{const e=Object.keys(n).map(t=>({key:t,val:n[t]}))||[];return e.sort((t,i)=>t.val-i.val),e.reduce((t,i)=>Xe({},t,{[i.key]:i.val}),{})};function y7(n){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:t="px",step:i=5}=n,o=Tn(n,G7),s=B7(e),r=Object.keys(s);function g(C){return`@media (min-width:${typeof e[C]=="number"?e[C]:C}${t})`}function a(C){return`@media (max-width:${(typeof e[C]=="number"?e[C]:C)-i/100}${t})`}function l(C,A){const f=r.indexOf(A);return`@media (min-width:${typeof e[C]=="number"?e[C]:C}${t}) and (max-width:${(f!==-1&&typeof e[r[f]]=="number"?e[r[f]]:A)-i/100}${t})`}function u(C){return r.indexOf(C)+1<r.length?l(C,r[r.indexOf(C)+1]):g(C)}function d(C){const A=r.indexOf(C);return A===0?g(r[1]):A===r.length-1?a(r[A]):l(C,r[r.indexOf(C)+1]).replace("@media","@media not all and")}return Xe({keys:r,values:s,up:g,down:a,between:l,only:u,not:d,unit:t},o)}const v7={borderRadius:4};var Z7=v7;function w7(n=8){if(n.mui)return n;const e=M9({spacing:n}),t=(...i)=>(i.length===0?[1]:i).map(s=>{const r=e(s);return typeof r=="number"?`${r}px`:r}).join(" ");return t.mui=!0,t}const R7=["breakpoints","palette","spacing","shape"];function Vy(n={},...e){const{breakpoints:t={},palette:i={},spacing:o,shape:s={}}=n,r=Tn(n,R7),g=y7(t),a=w7(o);let l=Ks({breakpoints:g,direction:"ltr",components:{},palette:Xe({mode:"light"},i),spacing:a,shape:Xe({},Z7,s)},r);return l=e.reduce((u,d)=>Ks(u,d),l),l}const W7=ce.exports.createContext(null);var S7=W7;function V7(){return ce.exports.useContext(S7)}function x7(n){return Object.keys(n).length===0}function H7(n=null){const e=V7();return!e||x7(e)?n:e}const X7=Vy();function xy(n=X7){return H7(n)}const M7=["className","component"];function K7(n={}){const{defaultTheme:e,defaultClassName:t="MuiBox-root",generateClassName:i,styleFunctionSx:o=U9}=n,s=S9("div")(o);return ce.exports.forwardRef(function(a,l){const u=xy(e),d=P9(a),{className:C,component:A="div"}=d,f=Tn(d,M7);return en(s,Xe({as:A,ref:l,className:nn(C,i?i(t):t),theme:u},f))})}const F7=["variant"];function sW(n){return n.length===0}function O9(n){const{variant:e}=n,t=Tn(n,F7);let i=e||"";return Object.keys(t).sort().forEach(o=>{o==="color"?i+=sW(i)?n[o]:tn(n[o]):i+=`${sW(i)?o:tn(o)}${tn(n[o].toString())}`}),i}const Y7=["name","slot","skipVariantsResolver","skipSx","overridesResolver"],N7=["theme"],L7=["theme"];function Gc(n){return Object.keys(n).length===0}const z7=(n,e)=>e.components&&e.components[n]&&e.components[n].styleOverrides?e.components[n].styleOverrides:null,k7=(n,e)=>{let t=[];e&&e.components&&e.components[n]&&e.components[n].variants&&(t=e.components[n].variants);const i={};return t.forEach(o=>{const s=O9(o.props);i[s]=o.style}),i},T7=(n,e,t,i)=>{var o,s;const{ownerState:r={}}=n,g=[],a=t==null||(o=t.components)==null||(s=o[i])==null?void 0:s.variants;return a&&a.forEach(l=>{let u=!0;Object.keys(l.props).forEach(d=>{r[d]!==l.props[d]&&n[d]!==l.props[d]&&(u=!1)}),u&&g.push(e[O9(l.props)])}),g};function eC(n){return n!=="ownerState"&&n!=="theme"&&n!=="sx"&&n!=="as"}const E7=Vy();function _7(n={}){const{defaultTheme:e=E7,rootShouldForwardProp:t=eC,slotShouldForwardProp:i=eC,styleFunctionSx:o=U9}=n;return(s,r={})=>{const{name:g,slot:a,skipVariantsResolver:l,skipSx:u,overridesResolver:d}=r,C=Tn(r,Y7),A=l!==void 0?l:a&&a!=="Root"||!1,f=u||!1;let b,G=eC;a==="Root"?G=t:a&&(G=i);const m=S9(s,Xe({shouldForwardProp:G,label:b},C)),h=(B,...y)=>{const Z=y?y.map(X=>typeof X=="function"&&X.__emotion_real!==X?Y=>{let{theme:S}=Y,H=Tn(Y,N7);return X(Xe({theme:Gc(S)?e:S},H))}:X):[];let R=B;g&&d&&Z.push(X=>{const Y=Gc(X.theme)?e:X.theme,S=z7(g,Y);if(S){const H={};return Object.entries(S).forEach(([k,U])=>{H[k]=typeof U=="function"?U(X):U}),d(X,H)}return null}),g&&!A&&Z.push(X=>{const Y=Gc(X.theme)?e:X.theme;return T7(X,k7(g,Y),Y,g)}),f||Z.push(X=>{const Y=Gc(X.theme)?e:X.theme;return o(Xe({},X,{theme:Y}))});const W=Z.length-y.length;if(Array.isArray(B)&&W>0){const X=new Array(W).fill("");R=[...B,...X],R.raw=[...B.raw,...X]}else typeof B=="function"&&B.__emotion_real!==B&&(R=X=>{let{theme:Y}=X,S=Tn(X,L7);return B(Xe({theme:Gc(Y)?e:Y},S))});return m(R,...Z)};return m.withConfig&&(h.withConfig=m.withConfig),h}}function J7(n){const{theme:e,name:t,props:i}=n;return!e||!e.components||!e.components[t]||!e.components[t].defaultProps?i:H9(e.components[t].defaultProps,i)}function D7({props:n,name:e,defaultTheme:t}){const i=xy(t);return J7({theme:i,name:e,props:n})}function Hy(n,e=0,t=1){return Math.min(Math.max(e,n),t)}function U7(n){n=n.substr(1);const e=new RegExp(`.{1,${n.length>=6?2:1}}`,"g");let t=n.match(e);return t&&t[0].length===1&&(t=t.map(i=>i+i)),t?`rgb${t.length===4?"a":""}(${t.map((i,o)=>o<3?parseInt(i,16):Math.round(parseInt(i,16)/255*1e3)/1e3).join(", ")})`:""}function ra(n){if(n.type)return n;if(n.charAt(0)==="#")return ra(U7(n));const e=n.indexOf("("),t=n.substring(0,e);if(["rgb","rgba","hsl","hsla","color"].indexOf(t)===-1)throw new Error(KC(9,n));let i=n.substring(e+1,n.length-1),o;if(t==="color"){if(i=i.split(" "),o=i.shift(),i.length===4&&i[3].charAt(0)==="/"&&(i[3]=i[3].substr(1)),["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(o)===-1)throw new Error(KC(10,o))}else i=i.split(",");return i=i.map(s=>parseFloat(s)),{type:t,values:i,colorSpace:o}}function Dp(n){const{type:e,colorSpace:t}=n;let{values:i}=n;return e.indexOf("rgb")!==-1?i=i.map((o,s)=>s<3?parseInt(o,10):o):e.indexOf("hsl")!==-1&&(i[1]=`${i[1]}%`,i[2]=`${i[2]}%`),e.indexOf("color")!==-1?i=`${t} ${i.join(" ")}`:i=`${i.join(", ")}`,`${e}(${i})`}function P7(n){n=ra(n);const{values:e}=n,t=e[0],i=e[1]/100,o=e[2]/100,s=i*Math.min(o,1-o),r=(l,u=(l+t/30)%12)=>o-s*Math.max(Math.min(u-3,9-u,1),-1);let g="rgb";const a=[Math.round(r(0)*255),Math.round(r(8)*255),Math.round(r(4)*255)];return n.type==="hsla"&&(g+="a",a.push(e[3])),Dp({type:g,values:a})}function rW(n){n=ra(n);let e=n.type==="hsl"?ra(P7(n)).values:n.values;return e=e.map(t=>(n.type!=="color"&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function Q7(n,e){const t=rW(n),i=rW(e);return(Math.max(t,i)+.05)/(Math.min(t,i)+.05)}function dl(n,e){return n=ra(n),e=Hy(e),(n.type==="rgb"||n.type==="hsl")&&(n.type+="a"),n.type==="color"?n.values[3]=`/${e}`:n.values[3]=e,Dp(n)}function j9(n,e){if(n=ra(n),e=Hy(e),n.type.indexOf("hsl")!==-1)n.values[2]*=1-e;else if(n.type.indexOf("rgb")!==-1||n.type.indexOf("color")!==-1)for(let t=0;t<3;t+=1)n.values[t]*=1-e;return Dp(n)}function q9(n,e){if(n=ra(n),e=Hy(e),n.type.indexOf("hsl")!==-1)n.values[2]+=(100-n.values[2])*e;else if(n.type.indexOf("rgb")!==-1)for(let t=0;t<3;t+=1)n.values[t]+=(255-n.values[t])*e;else if(n.type.indexOf("color")!==-1)for(let t=0;t<3;t+=1)n.values[t]+=(1-n.values[t])*e;return Dp(n)}function wg(n){return typeof n=="string"}function Cr(n,e={},t){return wg(n)?e:Xe({},e,{ownerState:Xe({},e.ownerState,t)})}function Up(n,e,t){const i={};return Object.keys(n).forEach(o=>{i[o]=n[o].reduce((s,r)=>(r&&(t&&t[r]&&s.push(t[r]),s.push(e(r))),s),[]).join(" ")}),i}const gW=n=>n,O7=()=>{let n=gW;return{configure(e){n=e},generate(e){return n(e)},reset(){n=gW}}},j7=O7();var $9=j7;const q7={active:"Mui-active",checked:"Mui-checked",completed:"Mui-completed",disabled:"Mui-disabled",error:"Mui-error",expanded:"Mui-expanded",focused:"Mui-focused",focusVisible:"Mui-focusVisible",required:"Mui-required",selected:"Mui-selected"};function du(n,e){return q7[e]||`${$9.generate(n)}-${e}`}function bI(n,e){const t={};return e.forEach(i=>{t[i]=du(n,i)}),t}function Hc(n){return du("MuiSlider",n)}const $7=bI("MuiSlider",["root","active","focusVisible","disabled","dragging","marked","vertical","trackInverted","trackFalse","rail","track","mark","markActive","markLabel","markLabelActive","thumb","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel"]);var EA=$7;const e8=n=>{const{open:e}=n;return{offset:nn(e&&EA.valueLabelOpen),circle:EA.valueLabelCircle,label:EA.valueLabelLabel}};function eM(n){const{children:e,className:t,value:i,theme:o}=n,s=e8(n);return ce.exports.cloneElement(e,{className:nn(e.props.className)},SC(ce.exports.Fragment,{children:[e.props.children,en("span",{className:nn(s.offset,t),theme:o,"aria-hidden":!0,children:en("span",{className:s.circle,children:en("span",{className:s.label,children:i})})})]}))}const t8=2;function tM(n,e){return n-e}function Bc(n,e,t){return n==null?e:Math.min(Math.max(e,n),t)}function aW(n,e){var t;const{index:i}=(t=n.reduce((o,s,r)=>{const g=Math.abs(e-s);return o===null||g<o.distance||g===o.distance?{distance:g,index:r}:o},null))!=null?t:{};return i}function AA(n,e){if(e.current!==void 0&&n.changedTouches){const t=n;for(let i=0;i<t.changedTouches.length;i+=1){const o=t.changedTouches[i];if(o.identifier===e.current)return{x:o.clientX,y:o.clientY}}return!1}return{x:n.clientX,y:n.clientY}}function yh(n,e,t){return(n-e)*100/(t-e)}function n8(n,e,t){return(t-e)*n+e}function i8(n){if(Math.abs(n)<1){const t=n.toExponential().split("e-"),i=t[0].split(".")[1];return(i?i.length:0)+parseInt(t[1],10)}const e=n.toString().split(".")[1];return e?e.length:0}function o8(n,e,t){const i=Math.round((n-t)/e)*e+t;return Number(i.toFixed(i8(e)))}function lW({values:n,newValue:e,index:t}){const i=n.slice();return i[t]=e,i.sort(tM)}function hA({sliderRef:n,activeIndex:e,setActive:t}){var i,o;const s=TA(n.current);if(!((i=n.current)!=null&&i.contains(s.activeElement))||Number(s==null||(o=s.activeElement)==null?void 0:o.getAttribute("data-index"))!==e){var r;(r=n.current)==null||r.querySelector(`[type="range"][data-index="${e}"]`).focus()}t&&t(e)}const s8={horizontal:{offset:n=>({left:`${n}%`}),leap:n=>({width:`${n}%`})},"horizontal-reverse":{offset:n=>({right:`${n}%`}),leap:n=>({width:`${n}%`})},vertical:{offset:n=>({bottom:`${n}%`}),leap:n=>({height:`${n}%`})}},r8=n=>n;let pA;function bb(){return pA===void 0&&(typeof CSS!="undefined"&&typeof CSS.supports=="function"?pA=CSS.supports("touch-action","none"):pA=!0),pA}function g8(n){const{ref:e,"aria-labelledby":t,defaultValue:i,disableSwap:o=!1,disabled:s=!1,marks:r=!1,max:g=100,min:a=0,name:l,onChange:u,onChangeCommitted:d,orientation:C="horizontal",scale:A=r8,step:f=1,tabIndex:b,value:G,isRtl:m=!1}=n,h=ce.exports.useRef(),[B,y]=ce.exports.useState(-1),[Z,R]=ce.exports.useState(-1),[W,x]=ce.exports.useState(!1),X=ce.exports.useRef(0),[Y,S]=Xj({controlled:G,default:i!=null?i:a,name:"Slider"}),H=u&&((te,he,Re)=>{const Fe=te.nativeEvent||te,pe=new Fe.constructor(Fe.type,Fe);Object.defineProperty(pe,"target",{writable:!0,value:{value:he,name:l}}),u(pe,he,Re)}),k=Array.isArray(Y);let U=k?Y.slice().sort(tM):[Y];U=U.map(te=>Bc(te,a,g));const D=r===!0&&f!==null?[...Array(Math.floor((g-a)/f)+1)].map((te,he)=>({value:a+f*he})):r||[],Q=D.map(te=>te.value),{isFocusVisibleRef:$,onBlur:j,onFocus:oe,ref:Ie}=x9(),[T,P]=ce.exports.useState(-1),Ce=ce.exports.useRef(),Me=qc(Ie,Ce),ee=qc(e,Me),_=te=>he=>{var Re;const Fe=Number(he.currentTarget.getAttribute("data-index"));oe(he),$.current===!0&&P(Fe),R(Fe),te==null||(Re=te.onFocus)==null||Re.call(te,he)},Ae=te=>he=>{var Re;j(he),$.current===!1&&P(-1),R(-1),te==null||(Re=te.onBlur)==null||Re.call(te,he)};V9(()=>{if(s&&Ce.current.contains(document.activeElement)){var te;(te=document.activeElement)==null||te.blur()}},[s]),s&&B!==-1&&y(-1),s&&T!==-1&&P(-1);const ye=te=>he=>{var Re;(Re=te.onChange)==null||Re.call(te,he);const Fe=Number(he.currentTarget.getAttribute("data-index")),pe=U[Fe],$e=Q.indexOf(pe);let ve=he.target.valueAsNumber;if(D&&f==null&&(ve=ve<pe?Q[$e-1]:Q[$e+1]),ve=Bc(ve,a,g),D&&f==null){const Le=Q.indexOf(U[Fe]);ve=ve<U[Fe]?Q[Le-1]:Q[Le+1]}if(k){o&&(ve=Bc(ve,U[Fe-1]||-1/0,U[Fe+1]||1/0));const Le=ve;ve=lW({values:U,newValue:ve,index:Fe});let Ye=Fe;o||(Ye=ve.indexOf(Le)),hA({sliderRef:Ce,activeIndex:Ye})}S(ve),P(Fe),H&&H(he,ve,Fe),d&&d(he,ve)},ge=ce.exports.useRef();let we=C;m&&C==="horizontal"&&(we+="-reverse");const Ke=({finger:te,move:he=!1,values:Re})=>{const{current:Fe}=Ce,{width:pe,height:$e,bottom:ve,left:Le}=Fe.getBoundingClientRect();let Ye;we.indexOf("vertical")===0?Ye=(ve-te.y)/$e:Ye=(te.x-Le)/pe,we.indexOf("-reverse")!==-1&&(Ye=1-Ye);let O;if(O=n8(Ye,a,g),f)O=o8(O,f,a);else{const E=aW(Q,O);O=Q[E]}O=Bc(O,a,g);let ke=0;if(k){he?ke=ge.current:ke=aW(Re,O),o&&(O=Bc(O,Re[ke-1]||-1/0,Re[ke+1]||1/0));const E=O;O=lW({values:Re,newValue:O,index:ke}),o&&he||(ke=O.indexOf(E),ge.current=ke)}return{newValue:O,activeIndex:ke}},ie=Mg(te=>{const he=AA(te,h);if(!he)return;if(X.current+=1,te.type==="mousemove"&&te.buttons===0){de(te);return}const{newValue:Re,activeIndex:Fe}=Ke({finger:he,move:!0,values:U});hA({sliderRef:Ce,activeIndex:Fe,setActive:y}),S(Re),!W&&X.current>t8&&x(!0),H&&H(te,Re,Fe)}),de=Mg(te=>{const he=AA(te,h);if(x(!1),!he)return;const{newValue:Re}=Ke({finger:he,values:U});y(-1),te.type==="touchend"&&R(-1),d&&d(te,Re),h.current=void 0,Ve()}),Ge=Mg(te=>{bb()||te.preventDefault();const he=te.changedTouches[0];he!=null&&(h.current=he.identifier);const Re=AA(te,h);if(Re!==!1){const{newValue:pe,activeIndex:$e}=Ke({finger:Re,values:U});hA({sliderRef:Ce,activeIndex:$e,setActive:y}),S(pe),H&&H(te,pe,$e)}X.current=0;const Fe=TA(Ce.current);Fe.addEventListener("touchmove",ie),Fe.addEventListener("touchend",de)}),Ve=ce.exports.useCallback(()=>{const te=TA(Ce.current);te.removeEventListener("mousemove",ie),te.removeEventListener("mouseup",de),te.removeEventListener("touchmove",ie),te.removeEventListener("touchend",de)},[de,ie]);ce.exports.useEffect(()=>{const{current:te}=Ce;return te.addEventListener("touchstart",Ge,{passive:bb()}),()=>{te.removeEventListener("touchstart",Ge,{passive:bb()}),Ve()}},[Ve,Ge]),ce.exports.useEffect(()=>{s&&Ve()},[s,Ve]);const xe=te=>he=>{var Re;if((Re=te.onMouseDown)==null||Re.call(te,he),he.defaultPrevented||he.button!==0)return;he.preventDefault();const Fe=AA(he,h);if(Fe!==!1){const{newValue:$e,activeIndex:ve}=Ke({finger:Fe,values:U});hA({sliderRef:Ce,activeIndex:ve,setActive:y}),S($e),H&&H(he,$e,ve)}X.current=0;const pe=TA(Ce.current);pe.addEventListener("mousemove",ie),pe.addEventListener("mouseup",de)},Pe=yh(k?U[0]:a,a,g),Ue=yh(U[U.length-1],a,g)-Pe,nt=te=>{const he={onMouseDown:xe(te||{})},Re=Xe({},te,he);return Xe({ref:ee},Re)},ct=te=>he=>{var Re;(Re=te.onMouseOver)==null||Re.call(te,he);const Fe=Number(he.currentTarget.getAttribute("data-index"));R(Fe)},F=te=>he=>{var Re;(Re=te.onMouseLeave)==null||Re.call(te,he),R(-1)};return{axis:we,axisProps:s8,getRootProps:nt,getHiddenInputProps:te=>{const he={onChange:ye(te||{}),onFocus:_(te||{}),onBlur:Ae(te||{})},Re=Xe({},te,he);return Xe({tabIndex:b,"aria-labelledby":t,"aria-orientation":C,"aria-valuemax":A(g),"aria-valuemin":A(a),name:l,type:"range",min:n.min,max:n.max,step:n.step,disabled:s},Re,{style:Xe({},kj,{direction:m?"rtl":"ltr",width:"100%",height:"100%"})})},getThumbProps:te=>{const he={onMouseOver:ct(te||{}),onMouseLeave:F(te||{})},Re=Xe({},te,he);return Xe({},Re)},dragging:W,marks:D,values:U,active:B,focusVisible:T,open:Z,range:k,trackOffset:Pe,trackLeap:Ue}}const a8=["aria-label","aria-valuetext","className","component","classes","disableSwap","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","onMouseDown","orientation","scale","step","tabIndex","track","value","valueLabelDisplay","valueLabelFormat","isRtl","components","componentsProps"],IW=n=>n,l8=n=>{const{disabled:e,dragging:t,marked:i,orientation:o,track:s,classes:r}=n;return Up({root:["root",e&&"disabled",t&&"dragging",i&&"marked",o==="vertical"&&"vertical",s==="inverted"&&"trackInverted",s===!1&&"trackFalse"],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",e&&"disabled"],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]},Hc,r)},I8=({children:n})=>n,c8=ce.exports.forwardRef(function(e,t){var i,o,s,r,g,a,l;const{"aria-label":u,"aria-valuetext":d,className:C,component:A,classes:f,disableSwap:b=!1,disabled:G=!1,getAriaLabel:m,getAriaValueText:h,marks:B=!1,max:y=100,min:Z=0,onMouseDown:R,orientation:W="horizontal",scale:x=IW,step:X=1,track:Y="normal",valueLabelDisplay:S="off",valueLabelFormat:H=IW,isRtl:k=!1,components:U={},componentsProps:D={}}=e,Q=Tn(e,a8),$=Xe({},e,{mark:B,classes:f,disabled:G,isRtl:k,max:y,min:Z,orientation:W,scale:x,step:X,track:Y,valueLabelDisplay:S,valueLabelFormat:H}),{axisProps:j,getRootProps:oe,getHiddenInputProps:Ie,getThumbProps:T,open:P,active:Ce,axis:Me,range:ee,focusVisible:_,dragging:Ae,marks:ye,values:ge,trackOffset:we,trackLeap:Ke}=g8(Xe({},$,{ref:t}));$.marked=ye.length>0&&ye.some(Le=>Le.label),$.dragging=Ae;const ie=(i=A!=null?A:U.Root)!=null?i:"span",de=Cr(ie,Xe({},Q,D.root),$),Ge=(o=U.Rail)!=null?o:"span",Ve=Cr(Ge,D.rail,$),xe=(s=U.Track)!=null?s:"span",Pe=Cr(xe,D.track,$),Ue=Xe({},j[Me].offset(we),j[Me].leap(Ke)),nt=(r=U.Thumb)!=null?r:"span",ct=Cr(nt,D.thumb,$),F=(g=U.ValueLabel)!=null?g:eM,M=Cr(F,D.valueLabel,$),me=(a=U.Mark)!=null?a:"span",te=Cr(me,D.mark,$),he=(l=U.MarkLabel)!=null?l:"span",Re=Cr(he,D.markLabel,$),Fe=U.Input||"input",pe=Cr(Fe,D.input,$),$e=Ie(),ve=l8($);return SC(ie,Xe({},de,oe({onMouseDown:R}),{className:nn(ve.root,de.className,C),children:[en(Ge,Xe({},Ve,{className:nn(ve.rail,Ve.className)})),en(xe,Xe({},Pe,{className:nn(ve.track,Pe.className),style:Xe({},Ue,Pe.style)})),ye.map((Le,Ye)=>{const O=yh(Le.value,Z,y),ke=j[Me].offset(O);let E;return Y===!1?E=ge.indexOf(Le.value)!==-1:E=Y==="normal"&&(ee?Le.value>=ge[0]&&Le.value<=ge[ge.length-1]:Le.value<=ge[0])||Y==="inverted"&&(ee?Le.value<=ge[0]||Le.value>=ge[ge.length-1]:Le.value>=ge[0]),SC(ce.exports.Fragment,{children:[en(me,Xe({"data-index":Ye},te,!wg(me)&&{markActive:E},{style:Xe({},ke,te.style),className:nn(ve.mark,te.className,E&&ve.markActive)})),Le.label!=null?en(he,Xe({"aria-hidden":!0,"data-index":Ye},Re,!wg(he)&&{markLabelActive:E},{style:Xe({},ke,Re.style),className:nn(ve.markLabel,Re.className,E&&ve.markLabelActive),children:Le.label})):null]},Le.value)}),ge.map((Le,Ye)=>{const O=yh(Le,Z,y),ke=j[Me].offset(O),E=S==="off"?I8:F;return en(ce.exports.Fragment,{children:en(E,Xe({},!wg(E)&&{valueLabelFormat:H,valueLabelDisplay:S,value:typeof H=="function"?H(x(Le),Ye):H,index:Ye,open:P===Ye||Ce===Ye||S==="on",disabled:G},M,{className:nn(ve.valueLabel,M.className),children:en(nt,Xe({"data-index":Ye},ct,T(),{className:nn(ve.thumb,ct.className,Ce===Ye&&ve.active,_===Ye&&ve.focusVisible)},!wg(nt)&&{ownerState:Xe({},$,ct.ownerState)},{style:Xe({},ke,{pointerEvents:b&&Ce!==Ye?"none":void 0},ct.style),children:en(Fe,Xe({},$e,{"data-index":Ye,"aria-label":m?m(Ye):u,"aria-valuenow":x(Le),"aria-valuetext":h?h(x(Le),Ye):d,value:ge[Ye]},!wg(Fe)&&{ownerState:Xe({},$,pe.ownerState)},pe,{style:Xe({},$e.style,pe.style)}))}))}))},Ye)})]}))});var C8=c8;function u8(n,e,t){return Xe({toolbar:{minHeight:56,[`${n.up("xs")} and (orientation: landscape)`]:{minHeight:48},[n.up("sm")]:{minHeight:64}}},t)}const d8=["mode","contrastThreshold","tonalOffset"],cW={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:xC.white,default:xC.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},Gb={text:{primary:xC.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:xC.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function CW(n,e,t,i){const o=i.light||i,s=i.dark||i*1.5;n[e]||(n.hasOwnProperty(t)?n[e]=n[t]:e==="light"?n.light=q9(n.main,o):e==="dark"&&(n.dark=j9(n.main,s)))}function A8(n="light"){return n==="dark"?{main:ja[200],light:ja[50],dark:ja[400]}:{main:ja[700],light:ja[400],dark:ja[800]}}function h8(n="light"){return n==="dark"?{main:Oa[200],light:Oa[50],dark:Oa[400]}:{main:Oa[500],light:Oa[300],dark:Oa[700]}}function p8(n="light"){return n==="dark"?{main:Qa[500],light:Qa[300],dark:Qa[700]}:{main:Qa[700],light:Qa[400],dark:Qa[800]}}function m8(n="light"){return n==="dark"?{main:qa[400],light:qa[300],dark:qa[700]}:{main:qa[700],light:qa[500],dark:qa[900]}}function f8(n="light"){return n==="dark"?{main:$a[400],light:$a[300],dark:$a[700]}:{main:$a[800],light:$a[500],dark:$a[900]}}function b8(n="light"){return n==="dark"?{main:fc[400],light:fc[300],dark:fc[700]}:{main:"#ed6c02",light:fc[500],dark:fc[900]}}function G8(n){const{mode:e="light",contrastThreshold:t=3,tonalOffset:i=.2}=n,o=Tn(n,d8),s=n.primary||A8(e),r=n.secondary||h8(e),g=n.error||p8(e),a=n.info||m8(e),l=n.success||f8(e),u=n.warning||b8(e);function d(b){return Q7(b,Gb.text.primary)>=t?Gb.text.primary:cW.text.primary}const C=({color:b,name:G,mainShade:m=500,lightShade:h=300,darkShade:B=700})=>{if(b=Xe({},b),!b.main&&b[m]&&(b.main=b[m]),!b.hasOwnProperty("main"))throw new Error(KC(11,G?` (${G})`:"",m));if(typeof b.main!="string")throw new Error(KC(12,G?` (${G})`:"",JSON.stringify(b.main)));return CW(b,"light",h,i),CW(b,"dark",B,i),b.contrastText||(b.contrastText=d(b.main)),b},A={dark:Gb,light:cW};return Ks(Xe({common:xC,mode:e,primary:C({color:s,name:"primary"}),secondary:C({color:r,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:C({color:g,name:"error"}),warning:C({color:u,name:"warning"}),info:C({color:a,name:"info"}),success:C({color:l,name:"success"}),grey:SO,contrastThreshold:t,getContrastText:d,augmentColor:C,tonalOffset:i},A[e]),o)}const B8=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];function y8(n){return Math.round(n*1e5)/1e5}const uW={textTransform:"uppercase"},dW='"Roboto", "Helvetica", "Arial", sans-serif';function v8(n,e){const t=typeof e=="function"?e(n):e,{fontFamily:i=dW,fontSize:o=14,fontWeightLight:s=300,fontWeightRegular:r=400,fontWeightMedium:g=500,fontWeightBold:a=700,htmlFontSize:l=16,allVariants:u,pxToRem:d}=t,C=Tn(t,B8),A=o/14,f=d||(m=>`${m/l*A}rem`),b=(m,h,B,y,Z)=>Xe({fontFamily:i,fontWeight:m,fontSize:f(h),lineHeight:B},i===dW?{letterSpacing:`${y8(y/h)}em`}:{},Z,u),G={h1:b(s,96,1.167,-1.5),h2:b(s,60,1.2,-.5),h3:b(r,48,1.167,0),h4:b(r,34,1.235,.25),h5:b(r,24,1.334,0),h6:b(g,20,1.6,.15),subtitle1:b(r,16,1.75,.15),subtitle2:b(g,14,1.57,.1),body1:b(r,16,1.5,.15),body2:b(r,14,1.43,.15),button:b(g,14,1.75,.4,uW),caption:b(r,12,1.66,.4),overline:b(r,12,2.66,1,uW)};return Ks(Xe({htmlFontSize:l,pxToRem:f,fontFamily:i,fontSize:o,fontWeightLight:s,fontWeightRegular:r,fontWeightMedium:g,fontWeightBold:a},G),C,{clone:!1})}const Z8=.2,w8=.14,R8=.12;function In(...n){return[`${n[0]}px ${n[1]}px ${n[2]}px ${n[3]}px rgba(0,0,0,${Z8})`,`${n[4]}px ${n[5]}px ${n[6]}px ${n[7]}px rgba(0,0,0,${w8})`,`${n[8]}px ${n[9]}px ${n[10]}px ${n[11]}px rgba(0,0,0,${R8})`].join(",")}const W8=["none",In(0,2,1,-1,0,1,1,0,0,1,3,0),In(0,3,1,-2,0,2,2,0,0,1,5,0),In(0,3,3,-2,0,3,4,0,0,1,8,0),In(0,2,4,-1,0,4,5,0,0,1,10,0),In(0,3,5,-1,0,5,8,0,0,1,14,0),In(0,3,5,-1,0,6,10,0,0,1,18,0),In(0,4,5,-2,0,7,10,1,0,2,16,1),In(0,5,5,-3,0,8,10,1,0,3,14,2),In(0,5,6,-3,0,9,12,1,0,3,16,2),In(0,6,6,-3,0,10,14,1,0,4,18,3),In(0,6,7,-4,0,11,15,1,0,4,20,3),In(0,7,8,-4,0,12,17,2,0,5,22,4),In(0,7,8,-4,0,13,19,2,0,5,24,4),In(0,7,9,-4,0,14,21,2,0,5,26,4),In(0,8,9,-5,0,15,22,2,0,6,28,5),In(0,8,10,-5,0,16,24,2,0,6,30,5),In(0,8,11,-5,0,17,26,2,0,6,32,5),In(0,9,11,-5,0,18,28,2,0,7,34,6),In(0,9,12,-6,0,19,29,2,0,7,36,6),In(0,10,13,-6,0,20,31,3,0,8,38,7),In(0,10,13,-6,0,21,33,3,0,8,40,7),In(0,10,14,-6,0,22,35,3,0,8,42,7),In(0,11,14,-7,0,23,36,3,0,9,44,8),In(0,11,15,-7,0,24,38,3,0,9,46,8)];var S8=W8;const V8=["duration","easing","delay"],x8={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},H8={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function AW(n){return`${Math.round(n)}ms`}function X8(n){if(!n)return 0;const e=n/36;return Math.round((4+15*e**.25+e/5)*10)}function M8(n){const e=Xe({},x8,n.easing),t=Xe({},H8,n.duration);return Xe({getAutoHeightDuration:X8,create:(o=["all"],s={})=>{const{duration:r=t.standard,easing:g=e.easeInOut,delay:a=0}=s;return Tn(s,V8),(Array.isArray(o)?o:[o]).map(l=>`${l} ${typeof r=="string"?r:AW(r)} ${g} ${typeof a=="string"?a:AW(a)}`).join(",")}},n,{easing:e,duration:t})}const K8={mobileStepper:1e3,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};var F8=K8;const Y8=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function nM(n={},...e){const{mixins:t={},palette:i={},transitions:o={},typography:s={}}=n,r=Tn(n,Y8),g=G8(i),a=Vy(n);let l=Ks(a,{mixins:u8(a.breakpoints,a.spacing,t),palette:g,shadows:S8.slice(),typography:v8(g,s),transitions:M8(o),zIndex:Xe({},F8)});return l=Ks(l,r),l=e.reduce((u,d)=>Ks(u,d),l),l}const N8=nM();var Xy=N8;function L8(){return xy(Xy)}function Au({props:n,name:e}){return D7({props:n,name:e,defaultTheme:Xy})}const iM=n=>eC(n)&&n!=="classes",oM=eC,z8=_7({defaultTheme:Xy,rootShouldForwardProp:iM});var Ei=z8;function lG(n,e){return lG=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},lG(n,e)}function k8(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,lG(n,e)}var hW=kt.createContext(null);function T8(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function My(n,e){var t=function(s){return e&&ce.exports.isValidElement(s)?e(s):s},i=Object.create(null);return n&&ce.exports.Children.map(n,function(o){return o}).forEach(function(o){i[o.key]=t(o)}),i}function E8(n,e){n=n||{},e=e||{};function t(u){return u in e?e[u]:n[u]}var i=Object.create(null),o=[];for(var s in n)s in e?o.length&&(i[s]=o,o=[]):o.push(s);var r,g={};for(var a in e){if(i[a])for(r=0;r<i[a].length;r++){var l=i[a][r];g[i[a][r]]=t(l)}g[a]=t(a)}for(r=0;r<o.length;r++)g[o[r]]=t(o[r]);return g}function Kg(n,e,t){return t[e]!=null?t[e]:n.props[e]}function _8(n,e){return My(n.children,function(t){return ce.exports.cloneElement(t,{onExited:e.bind(null,t),in:!0,appear:Kg(t,"appear",n),enter:Kg(t,"enter",n),exit:Kg(t,"exit",n)})})}function J8(n,e,t){var i=My(n.children),o=E8(e,i);return Object.keys(o).forEach(function(s){var r=o[s];if(!!ce.exports.isValidElement(r)){var g=s in e,a=s in i,l=e[s],u=ce.exports.isValidElement(l)&&!l.props.in;a&&(!g||u)?o[s]=ce.exports.cloneElement(r,{onExited:t.bind(null,r),in:!0,exit:Kg(r,"exit",n),enter:Kg(r,"enter",n)}):!a&&g&&!u?o[s]=ce.exports.cloneElement(r,{in:!1}):a&&g&&ce.exports.isValidElement(l)&&(o[s]=ce.exports.cloneElement(r,{onExited:t.bind(null,r),in:l.props.in,exit:Kg(r,"exit",n),enter:Kg(r,"enter",n)}))}}),o}var D8=Object.values||function(n){return Object.keys(n).map(function(e){return n[e]})},U8={component:"div",childFactory:function(e){return e}},Ky=function(n){k8(e,n);function e(i,o){var s;s=n.call(this,i,o)||this;var r=s.handleExited.bind(T8(s));return s.state={contextValue:{isMounting:!0},handleExited:r,firstRender:!0},s}var t=e.prototype;return t.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},t.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(o,s){var r=s.children,g=s.handleExited,a=s.firstRender;return{children:a?_8(o,g):J8(o,r,g),firstRender:!1}},t.handleExited=function(o,s){var r=My(this.props.children);o.key in r||(o.props.onExited&&o.props.onExited(s),this.mounted&&this.setState(function(g){var a=Xe({},g.children);return delete a[o.key],{children:a}}))},t.render=function(){var o=this.props,s=o.component,r=o.childFactory,g=Tn(o,["component","childFactory"]),a=this.state.contextValue,l=D8(this.state.children).map(r);return delete g.appear,delete g.enter,delete g.exit,s===null?kt.createElement(hW.Provider,{value:a},l):kt.createElement(hW.Provider,{value:a},kt.createElement(s,g,l))},e}(kt.Component);Ky.propTypes={};Ky.defaultProps=U8;var P8=Ky;function Q8(n){const{className:e,classes:t,pulsate:i=!1,rippleX:o,rippleY:s,rippleSize:r,in:g,onExited:a,timeout:l}=n,[u,d]=ce.exports.useState(!1),C=nn(e,t.ripple,t.rippleVisible,i&&t.ripplePulsate),A={width:r,height:r,top:-(r/2)+s,left:-(r/2)+o},f=nn(t.child,u&&t.childLeaving,i&&t.childPulsate);return!g&&!u&&d(!0),ce.exports.useEffect(()=>{if(!g&&a!=null){const b=setTimeout(a,l);return()=>{clearTimeout(b)}}},[a,g,l]),en("span",{className:C,style:A,children:en("span",{className:f})})}const O8=bI("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]);var go=O8;const j8=["center","classes","className"];let Pp=n=>n,pW,mW,fW,bW;const IG=550,q8=80,$8=yy(pW||(pW=Pp`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),eq=yy(mW||(mW=Pp`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),tq=yy(fW||(fW=Pp`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),nq=Ei("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),iq=Ei(Q8,{name:"MuiTouchRipple",slot:"Ripple"})(bW||(bW=Pp`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),go.rippleVisible,$8,IG,({theme:n})=>n.transitions.easing.easeInOut,go.ripplePulsate,({theme:n})=>n.transitions.duration.shorter,go.child,go.childLeaving,eq,IG,({theme:n})=>n.transitions.easing.easeInOut,go.childPulsate,tq,({theme:n})=>n.transitions.easing.easeInOut),oq=ce.exports.forwardRef(function(e,t){const i=Au({props:e,name:"MuiTouchRipple"}),{center:o=!1,classes:s={},className:r}=i,g=Tn(i,j8),[a,l]=ce.exports.useState([]),u=ce.exports.useRef(0),d=ce.exports.useRef(null);ce.exports.useEffect(()=>{d.current&&(d.current(),d.current=null)},[a]);const C=ce.exports.useRef(!1),A=ce.exports.useRef(null),f=ce.exports.useRef(null),b=ce.exports.useRef(null);ce.exports.useEffect(()=>()=>{clearTimeout(A.current)},[]);const G=ce.exports.useCallback(y=>{const{pulsate:Z,rippleX:R,rippleY:W,rippleSize:x,cb:X}=y;l(Y=>[...Y,en(iq,{classes:{ripple:nn(s.ripple,go.ripple),rippleVisible:nn(s.rippleVisible,go.rippleVisible),ripplePulsate:nn(s.ripplePulsate,go.ripplePulsate),child:nn(s.child,go.child),childLeaving:nn(s.childLeaving,go.childLeaving),childPulsate:nn(s.childPulsate,go.childPulsate)},timeout:IG,pulsate:Z,rippleX:R,rippleY:W,rippleSize:x},u.current)]),u.current+=1,d.current=X},[s]),m=ce.exports.useCallback((y={},Z={},R)=>{const{pulsate:W=!1,center:x=o||Z.pulsate,fakeElement:X=!1}=Z;if(y.type==="mousedown"&&C.current){C.current=!1;return}y.type==="touchstart"&&(C.current=!0);const Y=X?null:b.current,S=Y?Y.getBoundingClientRect():{width:0,height:0,left:0,top:0};let H,k,U;if(x||y.clientX===0&&y.clientY===0||!y.clientX&&!y.touches)H=Math.round(S.width/2),k=Math.round(S.height/2);else{const{clientX:D,clientY:Q}=y.touches?y.touches[0]:y;H=Math.round(D-S.left),k=Math.round(Q-S.top)}if(x)U=Math.sqrt((2*S.width**2+S.height**2)/3),U%2===0&&(U+=1);else{const D=Math.max(Math.abs((Y?Y.clientWidth:0)-H),H)*2+2,Q=Math.max(Math.abs((Y?Y.clientHeight:0)-k),k)*2+2;U=Math.sqrt(D**2+Q**2)}y.touches?f.current===null&&(f.current=()=>{G({pulsate:W,rippleX:H,rippleY:k,rippleSize:U,cb:R})},A.current=setTimeout(()=>{f.current&&(f.current(),f.current=null)},q8)):G({pulsate:W,rippleX:H,rippleY:k,rippleSize:U,cb:R})},[o,G]),h=ce.exports.useCallback(()=>{m({},{pulsate:!0})},[m]),B=ce.exports.useCallback((y,Z)=>{if(clearTimeout(A.current),y.type==="touchend"&&f.current){f.current(),f.current=null,A.current=setTimeout(()=>{B(y,Z)});return}f.current=null,l(R=>R.length>0?R.slice(1):R),d.current=Z},[]);return ce.exports.useImperativeHandle(t,()=>({pulsate:h,start:m,stop:B}),[h,m,B]),en(nq,Xe({className:nn(s.root,go.root,r),ref:b},g,{children:en(P8,{component:null,exit:!0,children:a})}))});var sq=oq;function rq(n){return du("MuiButtonBase",n)}const gq=bI("MuiButtonBase",["root","disabled","focusVisible"]);var aq=gq;const lq=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],Iq=n=>{const{disabled:e,focusVisible:t,focusVisibleClassName:i,classes:o}=n,r=Up({root:["root",e&&"disabled",t&&"focusVisible"]},rq,o);return t&&i&&(r.root+=` ${i}`),r},cq=Ei("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(n,e)=>e.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${aq.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),Cq=ce.exports.forwardRef(function(e,t){const i=Au({props:e,name:"MuiButtonBase"}),{action:o,centerRipple:s=!1,children:r,className:g,component:a="button",disabled:l=!1,disableRipple:u=!1,disableTouchRipple:d=!1,focusRipple:C=!1,LinkComponent:A="a",onBlur:f,onClick:b,onContextMenu:G,onDragLeave:m,onFocus:h,onFocusVisible:B,onKeyDown:y,onKeyUp:Z,onMouseDown:R,onMouseLeave:W,onMouseUp:x,onTouchEnd:X,onTouchMove:Y,onTouchStart:S,tabIndex:H=0,TouchRippleProps:k,touchRippleRef:U,type:D}=i,Q=Tn(i,lq),$=ce.exports.useRef(null),j=ce.exports.useRef(null),oe=qc(j,U),{isFocusVisibleRef:Ie,onFocus:T,onBlur:P,ref:Ce}=x9(),[Me,ee]=ce.exports.useState(!1);l&&Me&&ee(!1),ce.exports.useImperativeHandle(o,()=>({focusVisible:()=>{ee(!0),$.current.focus()}}),[]),ce.exports.useEffect(()=>{Me&&C&&!u&&j.current.pulsate()},[u,C,Me]);function _(ve,Le,Ye=d){return Mg(O=>(Le&&Le(O),!Ye&&j.current&&j.current[ve](O),!0))}const Ae=_("start",R),ye=_("stop",G),ge=_("stop",m),we=_("stop",x),Ke=_("stop",ve=>{Me&&ve.preventDefault(),W&&W(ve)}),ie=_("start",S),de=_("stop",X),Ge=_("stop",Y),Ve=_("stop",ve=>{P(ve),Ie.current===!1&&ee(!1),f&&f(ve)},!1),xe=Mg(ve=>{$.current||($.current=ve.currentTarget),T(ve),Ie.current===!0&&(ee(!0),B&&B(ve)),h&&h(ve)}),Pe=()=>{const ve=$.current;return a&&a!=="button"&&!(ve.tagName==="A"&&ve.href)},Ue=ce.exports.useRef(!1),nt=Mg(ve=>{C&&!Ue.current&&Me&&j.current&&ve.key===" "&&(Ue.current=!0,j.current.stop(ve,()=>{j.current.start(ve)})),ve.target===ve.currentTarget&&Pe()&&ve.key===" "&&ve.preventDefault(),y&&y(ve),ve.target===ve.currentTarget&&Pe()&&ve.key==="Enter"&&!l&&(ve.preventDefault(),b&&b(ve))}),ct=Mg(ve=>{C&&ve.key===" "&&j.current&&Me&&!ve.defaultPrevented&&(Ue.current=!1,j.current.stop(ve,()=>{j.current.pulsate(ve)})),Z&&Z(ve),b&&ve.target===ve.currentTarget&&Pe()&&ve.key===" "&&!ve.defaultPrevented&&b(ve)});let F=a;F==="button"&&(Q.href||Q.to)&&(F=A);const M={};F==="button"?(M.type=D===void 0?"button":D,M.disabled=l):(!Q.href&&!Q.to&&(M.role="button"),l&&(M["aria-disabled"]=l));const me=qc(Ce,$),te=qc(t,me),[he,Re]=ce.exports.useState(!1);ce.exports.useEffect(()=>{Re(!0)},[]);const Fe=he&&!u&&!l,pe=Xe({},i,{centerRipple:s,component:a,disabled:l,disableRipple:u,disableTouchRipple:d,focusRipple:C,tabIndex:H,focusVisible:Me}),$e=Iq(pe);return SC(cq,Xe({as:F,className:nn($e.root,g),ownerState:pe,onBlur:Ve,onClick:b,onContextMenu:ye,onFocus:xe,onKeyDown:nt,onKeyUp:ct,onMouseDown:Ae,onMouseLeave:Ke,onMouseUp:we,onDragLeave:ge,onTouchEnd:de,onTouchMove:Ge,onTouchStart:ie,ref:te,tabIndex:l?-1:H,type:D},M,Q,{children:[r,Fe?en(sq,Xe({ref:oe,center:s},k)):null]}))});var uq=Cq;const dq=n=>!n||!wg(n);var mA=dq;const Aq=nM(),hq=K7({defaultTheme:Aq,defaultClassName:"MuiBox-root",generateClassName:$9.generate});var l6=hq;function pq(n){return du("MuiButton",n)}const mq=bI("MuiButton",["root","text","textInherit","textPrimary","textSecondary","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","contained","containedInherit","containedPrimary","containedSecondary","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);var fA=mq;const fq=ce.exports.createContext({});var bq=fq;const Gq=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],Bq=n=>{const{color:e,disableElevation:t,fullWidth:i,size:o,variant:s,classes:r}=n,g={root:["root",s,`${s}${tn(e)}`,`size${tn(o)}`,`${s}Size${tn(o)}`,e==="inherit"&&"colorInherit",t&&"disableElevation",i&&"fullWidth"],label:["label"],startIcon:["startIcon",`iconSize${tn(o)}`],endIcon:["endIcon",`iconSize${tn(o)}`]},a=Up(g,pq,r);return Xe({},r,a)},sM=n=>Xe({},n.size==="small"&&{"& > *:nth-of-type(1)":{fontSize:18}},n.size==="medium"&&{"& > *:nth-of-type(1)":{fontSize:20}},n.size==="large"&&{"& > *:nth-of-type(1)":{fontSize:22}}),yq=Ei(uq,{shouldForwardProp:n=>iM(n)||n==="classes",name:"MuiButton",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,e[t.variant],e[`${t.variant}${tn(t.color)}`],e[`size${tn(t.size)}`],e[`${t.variant}Size${tn(t.size)}`],t.color==="inherit"&&e.colorInherit,t.disableElevation&&e.disableElevation,t.fullWidth&&e.fullWidth]}})(({theme:n,ownerState:e})=>Xe({},n.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:n.shape.borderRadius,transition:n.transitions.create(["background-color","box-shadow","border-color","color"],{duration:n.transitions.duration.short}),"&:hover":Xe({textDecoration:"none",backgroundColor:dl(n.palette.text.primary,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},e.variant==="text"&&e.color!=="inherit"&&{backgroundColor:dl(n.palette[e.color].main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},e.variant==="outlined"&&e.color!=="inherit"&&{border:`1px solid ${n.palette[e.color].main}`,backgroundColor:dl(n.palette[e.color].main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},e.variant==="contained"&&{backgroundColor:n.palette.grey.A100,boxShadow:n.shadows[4],"@media (hover: none)":{boxShadow:n.shadows[2],backgroundColor:n.palette.grey[300]}},e.variant==="contained"&&e.color!=="inherit"&&{backgroundColor:n.palette[e.color].dark,"@media (hover: none)":{backgroundColor:n.palette[e.color].main}}),"&:active":Xe({},e.variant==="contained"&&{boxShadow:n.shadows[8]}),[`&.${fA.focusVisible}`]:Xe({},e.variant==="contained"&&{boxShadow:n.shadows[6]}),[`&.${fA.disabled}`]:Xe({color:n.palette.action.disabled},e.variant==="outlined"&&{border:`1px solid ${n.palette.action.disabledBackground}`},e.variant==="outlined"&&e.color==="secondary"&&{border:`1px solid ${n.palette.action.disabled}`},e.variant==="contained"&&{color:n.palette.action.disabled,boxShadow:n.shadows[0],backgroundColor:n.palette.action.disabledBackground})},e.variant==="text"&&{padding:"6px 8px"},e.variant==="text"&&e.color!=="inherit"&&{color:n.palette[e.color].main},e.variant==="outlined"&&{padding:"5px 15px",border:`1px solid ${n.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`},e.variant==="outlined"&&e.color!=="inherit"&&{color:n.palette[e.color].main,border:`1px solid ${dl(n.palette[e.color].main,.5)}`},e.variant==="contained"&&{color:n.palette.getContrastText(n.palette.grey[300]),backgroundColor:n.palette.grey[300],boxShadow:n.shadows[2]},e.variant==="contained"&&e.color!=="inherit"&&{color:n.palette[e.color].contrastText,backgroundColor:n.palette[e.color].main},e.color==="inherit"&&{color:"inherit",borderColor:"currentColor"},e.size==="small"&&e.variant==="text"&&{padding:"4px 5px",fontSize:n.typography.pxToRem(13)},e.size==="large"&&e.variant==="text"&&{padding:"8px 11px",fontSize:n.typography.pxToRem(15)},e.size==="small"&&e.variant==="outlined"&&{padding:"3px 9px",fontSize:n.typography.pxToRem(13)},e.size==="large"&&e.variant==="outlined"&&{padding:"7px 21px",fontSize:n.typography.pxToRem(15)},e.size==="small"&&e.variant==="contained"&&{padding:"4px 10px",fontSize:n.typography.pxToRem(13)},e.size==="large"&&e.variant==="contained"&&{padding:"8px 22px",fontSize:n.typography.pxToRem(15)},e.fullWidth&&{width:"100%"}),({ownerState:n})=>n.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${fA.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${fA.disabled}`]:{boxShadow:"none"}}),vq=Ei("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.startIcon,e[`iconSize${tn(t.size)}`]]}})(({ownerState:n})=>Xe({display:"inherit",marginRight:8,marginLeft:-4},n.size==="small"&&{marginLeft:-2},sM(n))),Zq=Ei("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.endIcon,e[`iconSize${tn(t.size)}`]]}})(({ownerState:n})=>Xe({display:"inherit",marginRight:-4,marginLeft:8},n.size==="small"&&{marginRight:-2},sM(n))),wq=ce.exports.forwardRef(function(e,t){const i=ce.exports.useContext(bq),o=H9(i,e),s=Au({props:o,name:"MuiButton"}),{children:r,color:g="primary",component:a="button",className:l,disabled:u=!1,disableElevation:d=!1,disableFocusRipple:C=!1,endIcon:A,focusVisibleClassName:f,fullWidth:b=!1,size:G="medium",startIcon:m,type:h,variant:B="text"}=s,y=Tn(s,Gq),Z=Xe({},s,{color:g,component:a,disabled:u,disableElevation:d,disableFocusRipple:C,fullWidth:b,size:G,type:h,variant:B}),R=Bq(Z),W=m&&en(vq,{className:R.startIcon,ownerState:Z,children:m}),x=A&&en(Zq,{className:R.endIcon,ownerState:Z,children:A});return SC(yq,Xe({ownerState:Z,className:nn(l,i.className),component:a,disabled:u,focusRipple:!C,focusVisibleClassName:nn(R.focusVisible,f),ref:t,type:h},y,{classes:R,children:[W,r,x]}))});var I6=wq;const Rq=ce.exports.createContext();var GW=Rq;function Wq(n){return du("MuiGrid",n)}const Sq=[0,1,2,3,4,5,6,7,8,9,10],Vq=["column-reverse","column","row-reverse","row"],xq=["nowrap","wrap-reverse","wrap"],yc=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Fy=bI("MuiGrid",["root","container","item","zeroMinWidth",...Sq.map(n=>`spacing-xs-${n}`),...Vq.map(n=>`direction-xs-${n}`),...xq.map(n=>`wrap-xs-${n}`),...yc.map(n=>`grid-xs-${n}`),...yc.map(n=>`grid-sm-${n}`),...yc.map(n=>`grid-md-${n}`),...yc.map(n=>`grid-lg-${n}`),...yc.map(n=>`grid-xl-${n}`)]),Hq=["className","columns","columnSpacing","component","container","direction","item","lg","md","rowSpacing","sm","spacing","wrap","xl","xs","zeroMinWidth"];function Vl(n){const e=parseFloat(n);return`${e}${String(n).replace(String(e),"")||"px"}`}function Xq({theme:n,ownerState:e}){let t;return n.breakpoints.keys.reduce((i,o)=>{let s={};if(e[o]&&(t=e[o]),!t)return i;if(t===!0)s={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(t==="auto")s={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const r=_p({values:e.columns,breakpoints:n.breakpoints.values}),g=typeof r=="object"?r[o]:r;if(g==null)return i;const a=`${Math.round(t/g*1e8)/1e6}%`;let l={};if(e.container&&e.item&&e.columnSpacing!==0){const u=n.spacing(e.columnSpacing);if(u!=="0px"){const d=`calc(${a} + ${Vl(u)})`;l={flexBasis:d,maxWidth:d}}}s=Xe({flexBasis:a,flexGrow:0,maxWidth:a},l)}return n.breakpoints.values[o]===0?Object.assign(i,s):i[n.breakpoints.up(o)]=s,i},{})}function Mq({theme:n,ownerState:e}){const t=_p({values:e.direction,breakpoints:n.breakpoints.values});return Fo({theme:n},t,i=>{const o={flexDirection:i};return i.indexOf("column")===0&&(o[`& > .${Fy.item}`]={maxWidth:"none"}),o})}function Kq({theme:n,ownerState:e}){const{container:t,rowSpacing:i}=e;let o={};if(t&&i!==0){const s=_p({values:i,breakpoints:n.breakpoints.values});o=Fo({theme:n},s,r=>{const g=n.spacing(r);return g!=="0px"?{marginTop:`-${Vl(g)}`,[`& > .${Fy.item}`]:{paddingTop:Vl(g)}}:{}})}return o}function Fq({theme:n,ownerState:e}){const{container:t,columnSpacing:i}=e;let o={};if(t&&i!==0){const s=_p({values:i,breakpoints:n.breakpoints.values});o=Fo({theme:n},s,r=>{const g=n.spacing(r);return g!=="0px"?{width:`calc(100% + ${Vl(g)})`,marginLeft:`-${Vl(g)}`,[`& > .${Fy.item}`]:{paddingLeft:Vl(g)}}:{}})}return o}function rM(n,e,t={}){if(!e||!n||n<=0)return[];if(typeof n=="string"&&!Number.isNaN(Number(n))||typeof n=="number")return[t[`spacing-xs-${String(n)}`]||`spacing-xs-${String(n)}`];const{xs:i,sm:o,md:s,lg:r,xl:g}=n;return[Number(i)>0&&(t[`spacing-xs-${String(i)}`]||`spacing-xs-${String(i)}`),Number(o)>0&&(t[`spacing-sm-${String(o)}`]||`spacing-sm-${String(o)}`),Number(s)>0&&(t[`spacing-md-${String(s)}`]||`spacing-md-${String(s)}`),Number(r)>0&&(t[`spacing-lg-${String(r)}`]||`spacing-lg-${String(r)}`),Number(g)>0&&(t[`spacing-xl-${String(g)}`]||`spacing-xl-${String(g)}`)]}const Yq=Ei("div",{name:"MuiGrid",slot:"Root",overridesResolver:(n,e)=>{const{container:t,direction:i,item:o,lg:s,md:r,sm:g,spacing:a,wrap:l,xl:u,xs:d,zeroMinWidth:C}=n.ownerState;return[e.root,t&&e.container,o&&e.item,C&&e.zeroMinWidth,...rM(a,t,e),i!=="row"&&e[`direction-xs-${String(i)}`],l!=="wrap"&&e[`wrap-xs-${String(l)}`],d!==!1&&e[`grid-xs-${String(d)}`],g!==!1&&e[`grid-sm-${String(g)}`],r!==!1&&e[`grid-md-${String(r)}`],s!==!1&&e[`grid-lg-${String(s)}`],u!==!1&&e[`grid-xl-${String(u)}`]]}})(({ownerState:n})=>Xe({boxSizing:"border-box"},n.container&&{display:"flex",flexWrap:"wrap",width:"100%"},n.item&&{margin:0},n.zeroMinWidth&&{minWidth:0},n.wrap!=="wrap"&&{flexWrap:n.wrap}),Mq,Kq,Fq,Xq),Nq=n=>{const{classes:e,container:t,direction:i,item:o,lg:s,md:r,sm:g,spacing:a,wrap:l,xl:u,xs:d,zeroMinWidth:C}=n,A={root:["root",t&&"container",o&&"item",C&&"zeroMinWidth",...rM(a,t),i!=="row"&&`direction-xs-${String(i)}`,l!=="wrap"&&`wrap-xs-${String(l)}`,d!==!1&&`grid-xs-${String(d)}`,g!==!1&&`grid-sm-${String(g)}`,r!==!1&&`grid-md-${String(r)}`,s!==!1&&`grid-lg-${String(s)}`,u!==!1&&`grid-xl-${String(u)}`]};return Up(A,Wq,e)},Lq=ce.exports.forwardRef(function(e,t){const i=Au({props:e,name:"MuiGrid"}),o=P9(i),{className:s,columns:r,columnSpacing:g,component:a="div",container:l=!1,direction:u="row",item:d=!1,lg:C=!1,md:A=!1,rowSpacing:f,sm:b=!1,spacing:G=0,wrap:m="wrap",xl:h=!1,xs:B=!1,zeroMinWidth:y=!1}=o,Z=Tn(o,Hq),R=f||G,W=g||G,x=ce.exports.useContext(GW),X=r||x||12,Y=Xe({},o,{columns:X,container:l,direction:u,item:d,lg:C,md:A,sm:b,rowSpacing:R,columnSpacing:W,wrap:m,xl:h,xs:B,zeroMinWidth:y}),S=Nq(Y);return(k=>X!==12?en(GW.Provider,{value:X,children:k}):k)(en(Yq,Xe({ownerState:Y,className:nn(S.root,s),as:a,ref:t},Z)))});var c6=Lq;const zq=["component","components","componentsProps","color","size"],Gr=Xe({},EA,bI("MuiSlider",["colorPrimary","colorSecondary","thumbColorPrimary","thumbColorSecondary","sizeSmall","thumbSizeSmall"])),kq=Ei("span",{name:"MuiSlider",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n,i=t.marksProp===!0&&t.step!==null?[...Array(Math.floor((t.max-t.min)/t.step)+1)].map((s,r)=>({value:t.min+t.step*r})):t.marksProp||[],o=i.length>0&&i.some(s=>s.label);return[e.root,e[`color${tn(t.color)}`],t.size!=="medium"&&e[`size${tn(t.size)}`],o&&e.marked,t.orientation==="vertical"&&e.vertical,t.track==="inverted"&&e.trackInverted,t.track===!1&&e.trackFalse]}})(({theme:n,ownerState:e})=>Xe({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:n.palette[e.color].main,WebkitTapHighlightColor:"transparent"},e.orientation==="horizontal"&&Xe({height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}},e.size==="small"&&{height:2},e.marked&&{marginBottom:20}),e.orientation==="vertical"&&Xe({height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}},e.size==="small"&&{width:2},e.marked&&{marginRight:44}),{"@media print":{colorAdjust:"exact"},[`&.${Gr.disabled}`]:{pointerEvents:"none",cursor:"default",color:n.palette.grey[400]},[`&.${Gr.dragging}`]:{[`& .${Gr.thumb}, & .${Gr.track}`]:{transition:"none"}}})),Tq=Ei("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(n,e)=>e.rail})(({ownerState:n})=>Xe({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38},n.orientation==="horizontal"&&{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"},n.orientation==="vertical"&&{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"},n.track==="inverted"&&{opacity:1})),Eq=Ei("span",{name:"MuiSlider",slot:"Track",overridesResolver:(n,e)=>e.track})(({theme:n,ownerState:e})=>{const t=n.palette.mode==="light"?q9(n.palette[e.color].main,.62):j9(n.palette[e.color].main,.5);return Xe({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:n.transitions.create(["left","width","bottom","height"],{duration:n.transitions.duration.shortest})},e.size==="small"&&{border:"none"},e.orientation==="horizontal"&&{height:"inherit",top:"50%",transform:"translateY(-50%)"},e.orientation==="vertical"&&{width:"inherit",left:"50%",transform:"translateX(-50%)"},e.track===!1&&{display:"none"},e.track==="inverted"&&{backgroundColor:t,borderColor:t})}),_q=Ei("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.thumb,e[`thumbColor${tn(t.color)}`],t.size!=="medium"&&e[`thumbSize${tn(t.size)}`]]}})(({theme:n,ownerState:e})=>Xe({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:n.transitions.create(["box-shadow","left","bottom"],{duration:n.transitions.duration.shortest})},e.size==="small"&&{width:12,height:12},e.orientation==="horizontal"&&{top:"50%",transform:"translate(-50%, -50%)"},e.orientation==="vertical"&&{left:"50%",transform:"translate(-50%, 50%)"},{"&:before":Xe({position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:n.shadows[2]},e.size==="small"&&{boxShadow:"none"}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&:hover, &.${Gr.focusVisible}`]:{boxShadow:`0px 0px 0px 8px ${dl(n.palette[e.color].main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},[`&.${Gr.active}`]:{boxShadow:`0px 0px 0px 14px ${dl(n.palette[e.color].main,.16)}`},[`&.${Gr.disabled}`]:{"&:hover":{boxShadow:"none"}}})),Jq=Ei(eM,{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(n,e)=>e.valueLabel})(({theme:n,ownerState:e})=>Xe({[`&.${Gr.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"},zIndex:1,whiteSpace:"nowrap"},n.typography.body2,{fontWeight:500,transition:n.transitions.create(["transform"],{duration:n.transitions.duration.shortest}),top:-10,transformOrigin:"bottom center",transform:"translateY(-100%) scale(0)",position:"absolute",backgroundColor:n.palette.grey[600],borderRadius:2,color:n.palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem"},e.size==="small"&&{fontSize:n.typography.pxToRem(12),padding:"0.25rem 0.5rem"},{"&:before":{position:"absolute",content:'""',width:8,height:8,bottom:0,left:"50%",transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit"}})),Dq=Ei("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:n=>oM(n)&&n!=="markActive",overridesResolver:(n,e)=>e.mark})(({theme:n,ownerState:e,markActive:t})=>Xe({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},e.orientation==="horizontal"&&{top:"50%",transform:"translate(-1px, -50%)"},e.orientation==="vertical"&&{left:"50%",transform:"translate(-50%, 1px)"},t&&{backgroundColor:n.palette.background.paper,opacity:.8})),Uq=Ei("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:n=>oM(n)&&n!=="markLabelActive",overridesResolver:(n,e)=>e.markLabel})(({theme:n,ownerState:e,markLabelActive:t})=>Xe({},n.typography.body2,{color:n.palette.text.secondary,position:"absolute",whiteSpace:"nowrap"},e.orientation==="horizontal"&&{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}},e.orientation==="vertical"&&{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}},t&&{color:n.palette.text.primary})),Pq=n=>{const{color:e,size:t,classes:i={}}=n;return Xe({},i,{root:nn(i.root,Hc(`color${tn(e)}`),i[`color${tn(e)}`],t&&[Hc(`size${tn(t)}`),i[`size${tn(t)}`]]),thumb:nn(i.thumb,Hc(`thumbColor${tn(e)}`),i[`thumbColor${tn(e)}`],t&&[Hc(`thumbSize${tn(t)}`),i[`thumbSize${tn(t)}`]])})},Qq=ce.exports.forwardRef(function(e,t){var i,o,s,r;const g=Au({props:e,name:"MuiSlider"}),l=L8().direction==="rtl",{component:u="span",components:d={},componentsProps:C={},color:A="primary",size:f="medium"}=g,b=Tn(g,zq),G=Xe({},g,{color:A,size:f}),m=Pq(G);return en(C8,Xe({},b,{isRtl:l,components:Xe({Root:kq,Rail:Tq,Track:Eq,Thumb:_q,ValueLabel:Jq,Mark:Dq,MarkLabel:Uq},d),componentsProps:Xe({},C,{root:Xe({},C.root,mA(d.Root)&&{as:u,ownerState:Xe({},(i=C.root)==null?void 0:i.ownerState,{color:A,size:f})}),thumb:Xe({},C.thumb,mA(d.Thumb)&&{ownerState:Xe({},(o=C.thumb)==null?void 0:o.ownerState,{color:A,size:f})}),track:Xe({},C.track,mA(d.Track)&&{ownerState:Xe({},(s=C.track)==null?void 0:s.ownerState,{color:A,size:f})}),valueLabel:Xe({},C.valueLabel,mA(d.ValueLabel)&&{ownerState:Xe({},(r=C.valueLabel)==null?void 0:r.ownerState,{color:A,size:f})})}),classes:m,ref:t}))});var C6=Qq;export{l6 as B,ze as C,$q as F,c6 as G,n6 as P,r6 as R,C6 as S,tT as a,a6 as b,t6 as c,nT as d,en as e,e6 as f,I6 as g,g6 as h,s6 as i,SC as j,qq as k,iY as l,kt as m,o6 as n,ce as r,C9 as u};
